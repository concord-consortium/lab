(function(){var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../vendor/almond/almond",function(){}),define("common/actual-root",["require"],function(e){function r(){var e=document.location.pathname.match(t);return e&&e[1]?e[1]:""}var t=new RegExp("(\\/.*?)\\/(doc|examples|experiments)(\\/\\w+)*?\\/\\w+\\.html"),n;return n=r(),n}),define("lab.config",["require","common/actual-root"],function(e){var t=e("common/actual-root"),n;return n={sharing:!0,home:"http://lab.concord.org",homeForSharing:"http://lab.concord.org",homeInteractivePath:"/examples/interactives/interactive.html",homeEmbeddablePath:"/examples/interactives/embeddable.html",utmCampaign:null,fontface:"Lato",hostName:"lab4.dev.concord.org",dataGamesProxyPrefix:"DataGames/Games/concord/lab/",logging:!0,tracing:!1,authoring:!1,actualRoot:""},n.actualRoot=t,n}),define("arrays/index",["require","exports","module"],function(e,t,n){var r={};r.version="0.0.1",r.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,r.typed=function(){try{return new Float64Array(0),!0}catch(e){return!1}}(),r.create=function(e,t,n){n||(r.webgl||r.typed?n="Float32Array":n="regular"),t===undefined&&(t=0);var i,s;if(n==="regular")i=new Array(e);else switch(n){case"Float64Array":i=new Float64Array(e);break;case"Float32Array":i=new Float32Array(e);break;case"Int32Array":i=new Int32Array(e);break;case"Int16Array":i=new Int16Array(e);break;case"Int8Array":i=new Int8Array(e);break;case"Uint32Array":i=new Uint32Array(e);break;case"Uint16Array":i=new Uint16Array(e);break;case"Uint8Array":i=new Uint8Array(e);break;case"Uint8ClampedArray":i=new Uint8ClampedArray(e);break;default:throw new Error("arrays: couldn't understand array type \""+n+'".')}s=-1;while(++s<e)i[s]=t;return i},r.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor&&Object.prototype.toString.call(e)==="[object Array]")return e.__proto__.constructor;switch(e.constructor){case Array:return Array;case Float32Array:return Float32Array;case Uint8Array:return Uint8Array;case Float64Array:return Float64Array;case Int32Array:return Int32Array;case Int16Array:return Int16Array;case Int8Array:return Int8Array;case Uint32Array:return Uint32Array;case Uint16Array:return Uint16Array;case Uint8ClampedArray:return Uint8ClampedArray;default:throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e)}},r.copy=function(e,t){var n=e.length,i=-1;while(++i<n)t[i]=e[i];return r.constructor_function(t)===Array&&(t.length=n),t},r.clone=function(e){var t,n=e.length,i,s;s=r.constructor_function(e);if(s===Array){i=new s(n);for(t=0;t<n;t++)i[t]=e[t];return i}if(e.buffer.slice)return i=new s(e.buffer.slice(0)),i;i=new s(n);for(t=0;t<n;t++)i[t]=e[t];return i},r.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},r.max=function(e){return Math.max.apply(Math,e)},r.min=function(e){return Math.min.apply(Math,e)},r.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},r.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},r.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},r.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},r.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r},r.extend=function(e,t){var n,i,s;i=r.constructor_function(e);if(i===Array){s=e.length,e.length=t;for(;s<t;s++)e[s]=0;return e}return n=new i(t),n.set(e.subarray(0,t)),n},r.remove=function(e,t){var n=r.constructor_function(e),i;if(n!==Array)throw new Error("arrays.remove for typed arrays not implemented yet.");return i=e.slice(t+1),e.length=t,Array.prototype.push.apply(e,i),e},r.isArray=function(e){if(e===undefined||e===null)return!1;switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object Uint8ClampedArray]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":return!0;default:return!1}};for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}),define("arrays",["arrays/index"],function(e){return e}),define("common/console",["require","lab.config"],function(e){var t=e("lab.config"),n,r,i=function(){};return typeof console=="undefined"&&(console={},window&&(window.console=console)),r=console,r.log===undefined&&(r.log=i),r.info===undefined&&(r.info=i),r.warn===undefined&&(r.warn=i),r.error===undefined&&(r.error=i),r.time===undefined&&(r.time=i),r.timeEnd===undefined&&(r.timeEnd=i),r.log.apply===undefined&&(r.log=Function.prototype.bind.call(console.log,console)),r.info.apply===undefined&&(r.info=Function.prototype.bind.call(console.info,console)),r.warn.apply===undefined&&(r.warn=Function.prototype.bind.call(console.warn,console)),r.error.apply===undefined&&(r.error=Function.prototype.bind.call(console.error,console)),r.time.apply===undefined&&(r.time=Function.prototype.bind.call(console.time,console)),r.timeEnd.apply===undefined&&(r.timeEnd=Function.prototype.bind.call(console.timeEnd,console)),n={log:function(){t.logging&&r.log.apply(r,arguments)},info:function(){t.logging&&r.info.apply(r,arguments)},warn:function(){t.logging&&r.warn.apply(r,arguments)},error:function(){t.logging&&r.error.apply(r,arguments)},time:function(){t.tracing&&r.time.apply(r,arguments)},timeEnd:function(){t.tracing&&r.timeEnd.apply(r,arguments)}},n}),define("common/alert",["require","common/console"],function(e){var t=e("common/console"),n=typeof alert!="undefined"?alert:t.error;return function(t){n(t)}}),define("common/controllers/interactive-metadata",[],function(){return{interactive:{title:{required:!0},publicationStatus:{defaultValue:"public"},subtitle:{defaultValue:""},about:{defaultValue:""},fontScale:{defaultValue:1},models:{required:!0},parameters:{defaultValue:[]},outputs:{defaultValue:[]},filteredOutputs:{defaultValue:[]},exports:{required:!1},components:{defaultValue:[]},layout:{defaultValue:{}},template:{defaultValue:"simple"}},model:{id:{required:!0},url:{conflictsWith:["model"]},model:{conflictsWith:["url"]},onLoad:{},viewOptions:{},modelOptions:{},parameters:{},outputs:{},filteredOutputs:{}},parameter:{name:{required:!0},initialValue:{required:!0},onChange:{},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},output:{name:{required:!0},value:{required:!0},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},filteredOutput:{name:{required:!0},property:{required:!0},type:{defaultValue:"RunningAverage"},period:{defaultValue:2500},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},exports:{perRun:{required:!1,defaultValue:[]},perTick:{required:!0}},playback:{id:{required:!0},type:{required:!0},stepping:{defaultValue:!0}},text:{id:{required:!0},type:{required:!0},onClick:{},text:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"}},image:{id:{required:!0},type:{required:!0},src:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{}},div:{id:{required:!0},type:{required:!0},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{},classes:{defaultValue:[]},tooltip:{}},button:{id:{required:!0},type:{required:!0},action:{required:!0},text:{defaultValue:""},width:{defaultValue:""},height:{defaultValue:""}},checkbox:{id:{required:!0},type:{required:!0},text:{defaultValue:""},textOn:{defaultValue:"right"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},property:{conflictsWith:["initialValue"]},onClick:{},initialValue:{conflictsWith:["property"]}},slider:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},steps:{required:!0},title:{defaultValue:""},labels:{defaultValue:[]},width:{defaultValue:"auto"},height:{defaultValue:"auto"},displayValue:{},property:{conflictsWith:["initialValue","action"]},action:{conflictsWith:["property"]},initialValue:{conflictsWith:["property"]}},pulldown:{id:{required:!0},type:{required:!0},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{}},pulldownOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{},loadModel:{}},radio:{id:{required:!0},type:{required:!0},orientation:{defaultValue:"vertical"},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{}},radioOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{},loadModel:{}},numericOutput:{id:{required:!0},type:{required:!0},label:{defaultValue:""},units:{defaultValue:""},orientation:{defaultValue:"horizontal"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},property:{},displayValue:{}},thermometer:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},width:{defaultValue:"2.5em"},height:{defaultValue:"100%"},labelIsReading:{defaultValue:!1},reading:{defaultValue:{units:"K",offset:0,scale:1,digits:0}},labels:{defaultValue:[]}},graph:{id:{required:!0},type:{required:!0},realTime:{defaultValue:!0},fontScaleRelativeToParent:{defaultValue:!0},properties:{defaultValue:[]},title:{defaultValue:"Graph"},width:{defaultValue:"100%"},height:{defaultValue:"100%"},xlabel:{defaultValue:"Model Time (ps)"},xmin:{defaultValue:0},xmax:{defaultValue:20},ylabel:{defaultValue:""},ymin:{defaultValue:0},ymax:{defaultValue:10},xTickCount:{defaultValue:10},yTickCount:{defaultValue:10},xscaleExponent:{defaultValue:.5},yscaleExponent:{defaultValue:.5},xFormatter:{defaultValue:"3.2r"},yFormatter:{defaultValue:"3.2r"},lines:{defaultValue:!0},bars:{defaultValue:!1}},barGraph:{id:{required:!0},type:{required:!0},property:{required:!0},secondProperty:{conflictsWith:["averagePeriod"]},min:{defaultValue:0},max:{defaultValue:10},title:{defaultValue:""},labels:{defaultValue:5},units:{defaultValue:!1},gridLines:{defaultValue:10},labelFormat:{defaultValue:"0.1f"},averagePeriod:{conflictsWith:["secondProperty"]},barWidth:{defaultValue:"2em"},height:{defaultValue:"100%"},barColor:{defaultValue:"#e23c34"},fillColor:{defaultValue:"#fff"}}}}),define("common/validator",["require","arrays"],function(e){function n(e,t){this.prop=e,this.message=t}function r(e,t,r){var i,s;for(i=0,s=r.length;i<s;i++)if(e.hasOwnProperty(r[i]))throw new n(t,"Properties set contains conflicting properties: "+r[i]+" and "+t)}var t=e("arrays");return n.prototype=new Error,n.prototype.constructor=n,{validate:function(e,t,i){var s={},o,u;if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(o in t)if(t.hasOwnProperty(o)){u=e[o];if(u!==undefined){if(u.readOnly===!0)throw new n(o,"Properties set tries to overwrite read-only property "+o);if(!i&&u.immutable===!0)throw new n(o,"Properties set tries to overwrite immutable property "+o);u.conflictsWith&&r(t,o,u.conflictsWith),s[o]=t[o]}}return s},validateCompleteness:function(e,r){var i={},s,o;if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(s in e)if(e.hasOwnProperty(s)){o=e[s];if(r[s]===undefined||r[s]===null){if(o.required===!0)throw new n(s,"Properties set is missing required property "+s);t.isArray(o.defaultValue)?i[s]=t.copy(o.defaultValue,[]):typeof o.defaultValue=="object"?i[s]=$.extend(!0,{},o.defaultValue):o.defaultValue!==undefined&&(i[s]=o.defaultValue)}else!t.isArray(r[s])&&typeof r[s]=="object"&&typeof o.defaultValue=="object"?i[s]=$.extend(!0,{},o.defaultValue,r[s]):t.isArray(r[s])?i[s]=$.extend(!0,[],r[s]):i[s]=r[s]}return this.validate(e,i,!0)},ValidationError:n}}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=O(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.0.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},u.extend(this,u.pick(t,d)),t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},d=["url","urlRoot","collection"];u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1
;n&&n(t,r,e),t.trigger("sync",t,r,e)},j(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t;if(r&&(!n||!n.wait)&&!this.set(r,n))return!1;n=u.extend({validate:!0},n);if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},j(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;j(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||B();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t||{},{validationError:n})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];u.each(v,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var m=o.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};u.extend(m.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.defaults(t||{},y))},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},set:function(e,t){t=u.defaults(t||{},g),t.parse&&(e=this.parse(e,t)),u.isArray(e)||(e=e?[e]:[]);var n,i,o,a,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=u.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(e[n],t)))continue;(f=this.get(o))?(t.remove&&(m[f.cid]=!0),t.merge&&(f.set(o.attributes,t),h&&!l&&f.hasChanged(p)&&(l=!0))):t.add&&(d.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o))}if(t.remove){for(n=0,i=this.length;n<i;++n)m[(o=this.models[n]).cid]||v.push(o);v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?s.apply(this.models,[c,0].concat(d)):r.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=d.length;n<i;n++)(o=d[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(b,function(e){m.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var w=["groupBy","countBy","sortBy"];u.each(w,function(e){m.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var E=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];u.extend(E.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(S),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,x)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||B()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){return e?decodeURIComponent(e):null})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,D=/msie [\w.]+/,P=/\/$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!O.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new O;var H=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=m.extend=N.extend=E.extend=O.extend=H;var B=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["underscore"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),define("grapher/bar-graph/bar-graph-model",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({defaults:{value:0,secondValue:null,min:0,max:10,barWidth:"2em",height:"20em",title:"",barColor:"#e23c34",fillColor:"white",labels:10,units:"",gridLines:10,labelFormat:"0.1f"}});return n}),define("common/jquery-plugins",[],function(){$.fn.measure=function(e,t,n){var r,i,s;return r=$(this).clone(!1),r.css({visibility:"hidden",position:"absolute"}),r.appendTo(n),t?i=r.find(t):i=r,s=e.apply(i),r.remove(),s},$.fn.truncate=function(e){var t=$(this),n=$("<span>"),r,i;n.text(t.text()),n.css({"font-size":t.css("font-size"),"font-weight":t.css("font-weight"),"white-space":"nowrap",visibility:"hidden"}),n.appendTo(t.parent()),r=n.width();if(r>e){i=n.text()+"...",n.text(i);while(r>e&&i.length>3)i=n.text().slice(0,-4)+"...",n.text(i),r=n.width();t.attr("title",t.text()),t.text(i)}n.remove()}}),define("grapher/bar-graph/bar-graph-view",["require","common/jquery-plugins","backbone"],function(e){e("common/jquery-plugins");var t=e("backbone"),n=0,r=function(){return n++},i=function(e){return e.node().getBBox().width},s=16,o=function(e){var t=e/s;return function(e){return e*t}},u=function(e,t){var n=[],r={},i,s;for(i=0,s=t.length;i<s;i++)n[i]=t[i].value,r[n[i]]=t[i].label;e.tickValues(n).tickFormat(function(e){return r[e]})},a=function(e,t){var n=d3.format(e);return function(e){return n(e)+" "+t}},f=t.View.extend({tagName:"div",className:"bar-graph",initialize:function(){this.uid=r(),this.vis=d3.select(this.el).append("svg"),this.defs=this.vis.append("defs"),this.axisContainer=this.vis.append("g"),this.fill=this.vis.append("rect"),this.bar=this.vis.append("rect"),this.gridContainer=this.vis.append("g"),this.trianglePos=this.vis.append("g"),this.traingle=this.trianglePos.append("polygon"),this.titleContainer=this.vis.append("g"),this.yScale=d3.scale.linear(),this.heightScale=d3.scale.linear(),this.yAxis=d3.svg.axis(),this.scale=null,this.barWidth=null,this.model.on("change",this.modelChanged,this)},render:function(){var e=this.model.toJSON(),t=parseFloat(this.$el.css("font-size")),n=this.scale=o(t),r=e.labels>0||e.labels.length>0,s=r?n(8):n(3),f=r?n(8):n(3),l=0;this.$el.outerHeight(e.height),this.svgHeight=this.$el.height(),this.vis.attr({width:600,height:this.svgHeight}),this.yScale.domain([e.min,e.max]).range([this.svgHeight-s,f]).clamp(!0),this.heightScale.domain([e.min,e.max]).range([0,this.svgHeight-s-f]).clamp(!0),this.axisContainer.selectAll("*").remove(),r&&(this.yAxis.scale(this.yScale).tickValues(null).tickPadding(0).tickSize(0,0,0).orient("left"),typeof e.labels=="number"?this.yAxis.ticks(e.labels).tickFormat(a(e.labelFormat,e.units)):u(this.yAxis,e.labels),this.axisContainer.call(this.yAxis),l+=i(this.axisContainer),this.axisContainer.attr("transform","translate("+l+")"),l+=n(5)),this.fill.attr({width:e.barWidth,height:this.heightScale(e.max),x:l,y:this.yScale(e.max),rx:"0.5em",ry:"0.5em"}).attr({fill:this._getFillGradient(e.fillColor)}),this.bar.attr({width:e.barWidth,x:l,rx:"0.5em",ry:"0.5em"}).style({fill:this._getBarGradient(e.barColor)}),this.barWidth=i(this.fill),this.traingle.classed("triangle",!0).attr({points:"15,-7 15,7 1,0",transform:"translate("+l+") scale("+n(1)+")"}),this._setupGrid(l),l+=this.barWidth,l=this._setupTitle(l),this.vis.attr("width",l/t+"em"),this.$el.css("min-width",l/t+.8+"em"),this.update()},update:function(){var e=this.model.get("value"),t=this.model.get("secondValue");this.bar.attr("height",this.heightScale(e)).attr("y",this.yScale(e)),typeof t!="undefined"&&t!==null?(this.traingle.classed("hidden",!1),this.trianglePos.attr("transform","translate(0,"+this.yScale(t)+")")):this.traingle.classed("hidden",!0)},modelChanged:function(){var e=this.model.changedAttributes(),t=0,n,r,i;for(i in e)if(e.hasOwnProperty(i)){t++;if(t>2){this.render();return}}n=typeof e.value!="undefined",r=typeof e.secondValue!="undefined",t===1&&(n||r)||t===2&&n&&r?this.update():this.render()},_getBarGradient:function(e){var t="bar-gradient-"+this.uid,n=this.defs.select("#"+t);return e=d3.rgb(e),n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e.brighter(2).toString()).attr("offset","0%"),n.append("stop").attr("stop-color",e.toString()).attr("offset","100%"),"url(#"+t+")"},_getFillGradient:function(e){var t="fill-gradient-"+this.uid,n=this.defs.select("#"+t);return n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e).attr("offset","0%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.5).attr("offset","15%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.4).attr("offset","100%"),"url(#"+t+")"},_setupGrid:function(e){var t=this.yScale.ticks(this.model.get("gridLines")),n=this.yScale,r=this.barWidth;return t.pop(),t.shift(),this.grid=this.gridContainer.selectAll(".grid-line").data(t,String),this.grid.enter().append("path").attr("class","grid-line"),this.grid.exit().remove(),this.grid.attr("d",function(t){return"M "+e+" "+Math.round(n(t))+" h "+r}),e},_setupTitle:function(e){var t=this.model.get("title"),n=this,r,i,s,o;return t&&(e+=this.scale(10),r=$.isArray(t),i=r?t.length:1,s=this.titleContainer.selectAll(".title").data(r?t:[t]),s.exit().remove(),o=s.enter().append("g").attr("class","title"),o.append("title"),o.append("text"),s.each(function(e,t){var r=d3.select(this);r.select("title").text(e),r.select("text").text(n._processTitle(e)).attr("dy",-(i-t-1)+"em")}),this.titleContainer.attr("transform","translate("+e+", "+this.svgHeight/2+") rotate(90)"),e+=parseFloat($(s.node()).css("font-size"))*i),e},_processTitle:function(e){var t=$('<span class="title">'+e+"</span>").appendTo(this.$el),n;return t.truncate(this.svgHeight),n=t.text(),t.remove(),n}});return f}),define("common/controllers/bar-graph-controller",["require","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view","common/controllers/interactive-metadata","common/validator"],function(e){var t=e("grapher/bar-graph/bar-graph-model"),n=e("grapher/bar-graph/bar-graph-view"),r=e("common/controllers/interactive-metadata"),i=e("common/validator"),s={min:"min",max:"max",title:"title",barColor:"barColor",fillColor:"fillColor",labels:"labels",gridLines:"gridLines",labelFormat:"labelFormat",units:"units"},o=function(e){var t={},n,r;for(n in s)s.hasOwnProperty(n)&&(r=s[n],e[n]!==undefined&&(t[r]=e[n]));return t};return function(s){var u,a,f,l,c,h=function(){a.set({value:model.get(l)})},p=function(){a.set({secondValue:model.get(c)})};return s=i.validateCompleteness(r.barGraph,s),a=new t(o(s)),f=new n({model:a,id:s.id}),f.$el.addClass("component"),l=s.property,c=s.secondProperty,u={modelLoadedCallback:function(){var e="";model.addPropertiesListener([l],h),typeof s.averagePeriod!="undefined"&&s.averagePeriod!==null&&(c=l+"-bargraph-"+s.id+"-average",model.defineFilteredOutput(c,{},l,"RunningAverage",s.averagePeriod)),c&&model.addPropertiesListener([c],p),s.units===!0?e=model.getPropertyDescription(l).getUnitAbbreviation():s.units&&(e=s.units),a.set({barWidth:s.barWidth,height:s.height,units:e}),f.render(),h()},getViewContainer:function(){return f.$el},resize:function(){f.render()},serialize:function(){var e=$.extend(!0,{},s);return e}},u}}),define("grapher/core/axis",["require"],function(e){return{numberWidthUsingFormatter:function(e,t,n,r,i){var s,o,u,a,f,l;return s=e.append("svg").attr("width",t).attr("height",n).attr("class","graph"),o=s.append("g").append("text").attr("class","axis").attr("x",-r/4+"px").attr("dy",".35em").attr("text-anchor","end").text(i),l=o.node(),l.getBBox?(u=o.node().getBBox(),a=u.width,f=u.height):(a=0,f=0),s.remove(),[a,f]},axisProcessDrag:function(e,t,n){var r,i,s=n,o=0,u=n[0],a=n[1],f=a-u;if(t!==0)if(u>=0&&a>u)o=u,r=e-o,i=r*.4+o,t>i&&(change=r/(t-o),f=a-o,s=[u,u+f*change]);else if(u<0&&a>0){o=0,r=e-o,i=r*.4+o;if(e>=0&&t>i||e<0&&t<i)change=r/(t-o),s=[u*change,a*change]}else u<0&&a<0&&(o=a,r=e-o,i=r*.4+o,t<i&&(change=r/(t-o),f=u-o,s=[a+f*change,a]));return s}}}),define("grapher/core/graph",["require","grapher/core/axis"],function(e){var t=e("grapher/core/axis"),n={autoscale:"Show all data (autoscale)"};return function(r,i,s,o){function Mt(e,t){e&&(a=d3.select(e),f=a.node(),l=$(f),c=a.property("clientWidth"),h=a.property("clientHeight")),t&&(s=t),y!==undefined&&(y.remove(),y=undefined),S!==undefined&&(S.remove(),S=undefined),x!==undefined&&($(x).remove(),x=undefined),i.dataChange?q="ns-resize":q="crosshair",_t(),ht=NaN,pt=NaN,dt=null}function _t(e,t){!e&&!t?(c=Math.max(a.property("clientWidth"),120),h=Math.max(a.property("clientHeight"),62)):(c=e,f.style.width=c+"px",t?(h=t,f.style.height=h+"px"):(f.style.height="100%",t=a.property("clientHeight"),h=t,f.style.height=h+"px")),Ht()}function Dt(){_t(),R=parseFloat(l.css("font-size")),i.fontScaleRelativeToParent||l.css("font-size",.5+ct.value/6+"em"),R=parseFloat(l.css("font-size")),U=R/2,z=R/4,y===undefined?(W=R,X=R,V=R,J=R):(W=parseFloat($("svg.graph text.title").css("font-size")),X=parseFloat($("svg.graph text.axis").css("font-size")),V=parseFloat($("svg.graph text.xlabel").css("font-size")),J=parseFloat($("svg.graph text.ylabel").css("font-size"))),P===undefined?(K=[R,R],ylabelMetrics=[R*2,R]):(K=t.numberWidthUsingFormatter(a,c,h,X,Bt(P.ticks(i.xTickCount),m)),ylabelMetrics=t.numberWidthUsingFormatter(a,c,h,X,Bt(H.ticks(i.yTickCount),g))),G=K[0],Y=K[1],Z=ylabelMetrics[0],et=ylabelMetrics[0],tt=G*.5,rt=Y*1.1,nt=rt+Y*1.3,it=nt-Y/3,ot=Z+Y/4,st=ot+et,ut=-(ot+et/4);switch(ct.value){case 0:_={top:R,right:R,bottom:R,left:R};break;case 1:_={top:R,right:R,bottom:R,left:R};break;case 2:_={top:i.title?W*1.8:U,right:tt,bottom:X*1.25,left:Z};break;case 3:_={top:i.title?W*1.8:U,right:tt,bottom:i.xlabel?nt:X*1.25,left:i.ylabel?st:Z};break;default:_={top:i.title?W*1.8:U,right:tt,bottom:i.xlabel?nt:X*1.25,left:i.ylabel?st:Z}}ct.value>2?_.top+=(mt.length-1)*ct.value/3*ct.value/3*R:mt=[mt[0]],D={width:c-_.left-_.right,height:h-_.top-_.bottom},P=d3.scale[i.xscale]().domain([i.xmin,i.xmax]).range([0,D.width]),i.xscale==="pow"&&P.exponent(i.xscaleExponent),H=d3.scale[i.yscale]().domain([i.ymin,i.ymax]).nice().range([D.height,0]).nice(),i.yscale==="pow"&&H.exponent(i.yscaleExponent),jt(),Ft(),B=d3.svg.line().x(function(e,t){return P(gt[t][0])}).y(function(e,t){return H(gt[t][1])})}function Pt(e){if(e)for(var t in xt)e[t]===undefined&&(e[t]=xt[t]);else e=xt;return e.axisShift<1&&(e.axisShift=1),e}function Ht(){i.responsiveLayout?c<=ct.icon?(ct.category="icon",ct.value=0):c<=ct.tiny?(ct.category="tiny",ct.value=1):c<=ct.small?(ct.category="small",ct.value=2):c<=ct.medium?(ct.category="medium",ct.value=3):c<=ct.large?(ct.category="large",ct.value=4):(ct.category="extralarge",ct.value=5):(ct.category="large",ct.value=4)}function Bt(e,t,n){var r=0,i=0,s,o,u;n=n||5;for(u=0;u<e.length;u++)s=t(+e[u].toPrecision(n)),s=s.replace(/^\s\s*/,"").replace(/\s\s*$/,""),o=s.length,o>r&&(r=o,i=u);return t(e[i])}function jt(){P.domain([i.xmin,i.xmax]).range([0,D.width])}function Ft(){H.domain([i.ymin,i.ymax]).range([D.height,0])}function It(){var e=P.domain(),t=H.domain();i.xmax=e[1],i.xmin=e[0],i.ymax=t[1],i.ymin=t[0]}function qt(){var e=i.yrange/2,t=e/2,n;return i.datacount=D.width/30,i.xtic=i.xrange/i.datacount,i.ytic=i.yrange/i.datacount,n=d3.range(i.datacount).map(function(n){return[n*i.xtic+i.xmin,i.ymin+t+Math.random()*e]}),n}function Rt(e){return typeof e=="number"&&(bt=e),typeof bt!="number"&&(bt=gt.length-1),bt}function Ut(e,t,n){var r=0,i=t||0,s=e.length,o=[];n=n||1;for(r=0;r<s;r++)o.push({x:(r+i)*n,y:e[r]});return o}function zt(){return gt?gt.length:!1}function Wt(){k=a.append("div"),k.attr("class","button-layer").style("z-index",3).append("a").attr({"class":"autoscale-button",title:n.autoscale}).on("click",function(){wn()}).append("i").attr("class","icon-picture"),Xt()}function Xt(){k.style({width:R*1.75+"px",height:R*1.25+"px",top:_.top+U+"px",left:_.left+(D.width-R*2)+"px"})}function Vt(){y=a.append("svg").attr("width",c).attr("height",h).attr("class","graph").style("z-index",2),b=y.append("g").attr("transform","translate("+_.left+","+_.top+")"),w=b.append("rect").attr("class","plot").attr("width",D.width).attr("height",D.height).attr("pointer-events","all").attr("fill","rgba(255,255,255,0)").on("mousedown",Zt).on("touchstart",Zt),w.call(d3.behavior.zoom().x(P).y(H).on("zoom",Kt)),S=a.append("div").attr("class","background").style({width:D.width+"px",height:D.height+"px",top:_.top+"px",left:_.left+"px","z-index":0}),E=b.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",D.width).attr("height",D.height).attr("viewBox","0 0 "+D.width+" "+D.height),i.realTime||E.append("path").attr("class","line").style("stroke-width",lt).attr("d",B(gt)),ft=y.append("rect").attr("class","draggable-axis").attr("x",_.left-ot).attr("y",_.top).attr("rx",et/6).attr("width",ot).attr("height",D.height).attr("pointer-events","all").style("cursor","row-resize").on("mousedown",sn).on("touchstart",sn),at=y.append("rect").attr("class","draggable-axis").attr("x",_.left).attr("y",D.height+_.top).attr("rx",et/6).attr("width",D.width).attr("height",rt).attr("pointer-events","all").style("cursor","col-resize").on("mousedown",rn).on("touchstart",rn),Et=E.append("path").attr("class","marker"),At=E.append("g").attr("class","brush"),i.title&&ct.value>1&&(L=b.selectAll("text").data(mt,function(e){return e}),L.enter().append("text").attr("class","title").text(function(e){return e}).attr("x",D.width/2).attr("dy",function(e,t){return-t*W-U+"px"}).style("text-anchor","middle")),i.xlabel&&ct.value>2&&(A=b.append("text").attr("class","axis").attr("class","xlabel").text(i.xlabel).attr("x",D.width/2).attr("y",D.height).attr("dy",it+"px").style("text-anchor","middle")),i.ylabel&&ct.value>2&&(O=b.append("g").append("text").attr("class","axis").attr("class","ylabel").text(i.ylabel).style("text-anchor","middle").attr("transform","translate("+ut+" "+D.height/2+") rotate(-90)")),d3.select(f).on("mousemove.drag",un).on("touchmove.drag",un).on("mouseup.drag",an).on("touchend.drag",an),M=b.append("text").attr("class","graph-notification").text(s).attr("x",D.width/2).attr("y",D.height/2).style("text-anchor","middle"),i.realTime&&(Rn(),Fn())}function $t(){b.attr("width",c).attr("height",h).attr("transform","translate("+_.left+","+_.top+")"),w.attr("width",D.width).attr("height",D.height),S.style({width:D.width+"px",height:D.height+"px",top:_.top+"px",left:_.left+"px","z-index":0}),E.attr("top",0).attr("left",0).attr("width",D.width).attr("height",D.height).attr("viewBox","0 0 "+D.width+" "+D.height),ft.attr("x",_.left-ot).attr("y",_.top-et/2).attr("width",ot).attr("height",D.height+et),at.attr("x",_.left).attr("y",D.height+_.top).attr("width",D.width).attr("height",rt),i.title&&ct.value>1&&L.attr("x",D.width/2).attr("dy",function(e,t){return-t*W-U+"px"}),i.xlabel&&ct.value>1&&A.attr("x",D.width/2).attr("y",D.height).attr("dy",it+"px"),i.ylabel&&ct.value>1&&O.attr("transform","translate("+ut+" "+D.height/2+") rotate(-90)"),M.attr("x",D.width/2).attr("y",D.height/2),b.selectAll("g.x").remove(),b.selectAll("g.y").remove(),i.realTime&&Un()}function Jt(e){s=e,e?M.text(e):M.text("")}function Kt(){var e=b.selectAll("g.x").data(P.ticks(i.xTickCount),String).attr("transform",d),t=e.enter().insert("g","a").attr("class","x").attr("transform",d);t.append("line").attr("stroke",p).attr("y1",0).attr("y2",D.height),ct.value>1&&t.append("text").attr("class","axis").attr("y",D.height).attr("dy",X+"px").attr("text-anchor","middle").text(m).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")}),e.exit().remove();var n=b.selectAll("g.y").data(H.ticks(i.yTickCount),String).attr("transform",v),r=n.enter().insert("g","a").attr("class","y").attr("transform",v).attr("background-fill","#FFEEB6");r.append("line").attr("stroke",p).attr("x1",0).attr("x2",D.width);if(ct.value>1){if(i.yscale==="log"){var s=r[0].length;s>100?r=r.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[1]/)}):s>50?r=r.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[12]/)}):r=r.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[125]/)})}r.append("text").attr("class","axis").attr("x",-X/4+"px").attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(g).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")})}n.exit().remove(),w.call(d3.behavior.zoom().x(P).y(H).on("zoom",Kt)),Qt()}function Qt(e){Rt(e),i.realTime?Gt(bt):Yt()}function Gt(e){Rt(e),qn(bt),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function Yt(){kn(),b.select("path").attr("d",B(gt));var e=b.select("svg").selectAll("circle").data(gt,function(e){return e});i.circleRadius&&ct.value>1&&(i.circleRadius<=4&&ct.value<3||(e.enter().append("circle").attr("class",function(e){return e===vt?"selected":null}).attr("cx",function(e){return P(e[0])}).attr("cy",function(e){return H(e[1])}).attr("r",i.circleRadius*(1+ct.value)/4).style("stroke-width",lt).style("cursor",q).on("mousedown.drag",on).on("touchstart.drag",on),e.attr("class",function(e){return e===vt?"selected":null}).attr("cx",function(e){return P(e[0])}).attr("cy",function(e){return H(e[1])}).attr("r",i.circleRadius*(1+ct.value)/4).style("stroke-width",lt))),e.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function Zt(){i.realTime?en():tn()}function en(){d3.event.preventDefault(),w.style("cursor","move");if(d3.event.altKey){w.style("cursor","nesw-resize");var e=d3.mouse(b.node());ht=P.invert(e[0]),pt=H.invert(e[1]),dt=!1,d3.event.stopPropagation()}}function tn(){var e;d3.event.preventDefault(),d3.select("body").style("cursor","move");if(d3.event.altKey){w.style("cursor","nesw-resize");if(d3.event.shiftKey&&i.addData){e=d3.mouse(b.node());var t=[];t[0]=P.invert(Math.max(0,Math.min(D.width,e[0]))),t[1]=H.invert(Math.max(0,Math.min(D.height,e[1]))),gt.push(t),gt.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),vt=t,Qt()}else e=d3.mouse(b.node()),ht=P.invert(e[0]),pt=H.invert(e[1]),dt=!1,d3.event.stopPropagation()}}function nn(){return!1}function rn(){document.onselectstart=nn,d3.event.preventDefault();var e=d3.mouse(b.node());ht=P.invert(e[0])}function sn(){d3.event
.preventDefault(),document.onselectstart=nn;var e=d3.mouse(b.node());pt=H.invert(e[1])}function on(e){y.node().focus(),d3.event.preventDefault(),document.onselectstart=nn,vt=dt=e,Qt()}function un(){var e=d3.mouse(b.node());document.onselectstart=function(){return!0},d3.event.preventDefault(),dt&&i.dataChange&&(dt[1]=H.invert(Math.max(0,Math.min(D.height,e[1]))),It(),Qt()),isNaN(ht)||(d3.select("body").style("cursor","col-resize"),w.style("cursor","col-resize"),j?(P.domain(t.axisProcessDrag(ht,P.invert(e[0]),P.domain())),It(),Kt()):(P.domain(t.axisProcessDrag(ht,P.invert(e[0]),P.domain())),It(),Kt()),d3.event.stopPropagation()),isNaN(pt)||(d3.select("body").style("cursor","row-resize"),w.style("cursor","row-resize"),H.domain(t.axisProcessDrag(pt,H.invert(e[1]),H.domain())),It(),Kt(),d3.event.stopPropagation())}function an(){d3.select("body").style("cursor","auto"),w.style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(ht)||(Kt(),ht=NaN),isNaN(pt)||(Kt(),pt=NaN),dt=null}function fn(e){wt={x:gt[e].x,y:gt[e].y}}function ln(e){Rt(e),i.realTime?cn(bt):dn()}function cn(e){var t,n=P.domain(),r=Math.round(n[0]/St),s=Math.round(n[1]/St),o=Math.max(0,r),u=n[1]-n[0],a=u*.95,f;Rt(e),f=bt*St,j?(j=I(),j?(pn(),Kt()):Qt(bt)):f>n[0]+a?(I=hn(a*.9,i.axisShift),j=I(),Kt()):f<n[1]-a&&bt<gt.length&&r>0?(I=hn(a*.9,i.axisShift,-1),j=I(),Kt()):f<n[0]?(I=hn(a*.1,1,-1),j=I(),Kt()):Qt(bt)}function hn(e,t,n){var r=P.domain()[0],i=P.domain()[1],s=1/t,o=0;return function(){var t;return n=n||1,o+=s,t=e*F(o),n>0?(P.domain([r+t,i+t]),It(),P.domain()[0]<r+e):(P.domain([r-t,i-t]),It(),P.domain()[0]>r-e)}}function pn(){isNaN(ht)||(ht=NaN),isNaN(pt)||(pt=NaN)}function dn(){var e,t=P.domain(),n=t[1]-t[0],r=n*.8;j?(j=I(),j?Kt():Qt()):gt[gt.length-1][0]>t[0]+r?(I=vn(r*.75,i.axisShift),j=I(),Kt()):Qt()}function vn(e,t){var n=P.domain()[0],r=P.domain()[1],i=1/t,s=0;return function(){var t;return s+=i,t=e*F(s),P.domain([n+t,r+t]),It(),P.domain()[0]<n+e}}function mn(){i.title&&L&&L.text(i.title)}function gn(){i.xlabel&&A&&A.text(i.xlabel)}function yn(){i.ylabel&&O?O.text(i.ylabel):O.style("display","none")}function bn(e){if(!arguments.length)return gt;var t;if(e instanceof Array&&e.length>0)if(e[0]instanceof Array)for(t=0;t<e.length;t++)gt.push(e[t]);else{if(e.length!==2)throw new Error("invalid argument to graph.addData() "+e+" length should === 2.");gt.push(e)}return ln(),u}function wn(){var e,t,n,r,s,o=Infinity,u=-Infinity,a=Infinity,f=-Infinity,l,c;if(gt.length<2)return;for(e=0,t=gt.length;e<t;e++)n=gt[e],r=n.length?n[0]:n.x,s=n.length?n[1]:n.y,r<o&&(o=r),r>u&&(u=r),s<a&&(a=s),s>f&&(f=s);c=function(e,t){return e<0?-Math.pow(-e,t):Math.pow(e,t)};switch(i.yscale){case"linear":l=function(e){return e};break;case"log":a=Math.log(a)/Math.log(10),f=Math.log(f)/Math.log(10),l=function(e){return Math.pow(10,e)};break;case"pow":a=c(a,i.yscaleExponent),f=c(f,i.yscaleExponent),l=function(e){return c(e,1/i.yscaleExponent)}}P.domain([o,u]).nice(),H.domain([l(a-.15*(f-a)),l(f+.15*(f-a))]).nice(),It(),Kt()}function En(e){return arguments.length?(e===null?Nt=!1:e.length===0?(Nt=!0,Tt.xmin=Infinity,Tt.xmax=Infinity):(Nt=!0,Tt.xmin=e[0],Tt.xmax=e[1]),kn(),Lt&&Lt(En()),u):Nt?Tt.xmax===Infinity&&Tt.xmin===Infinity?[]:[Tt.xmin,Tt.xmax]:null}function Sn(){return Nt}function xn(e){return arguments.length?(e=!!e,Ct!==e&&(Ct=e,kn()),u):Ct}function Tn(e){return arguments.length?(e=!!e,kt!==e&&(kt=e,kn()),u):kt}function Nn(e){return arguments.length?(Lt=e,u):Lt}function Cn(){var e;kt&&(e=Ot.extent(),En(e[0]!==e[1]?e:[]))}function kn(){Nt&&Ct?(Ot=Ot||d3.svg.brush().x(P).extent([Tt.xmin||0,Tt.xmax||0]).on("brush",Cn),At.call(Ot.extent([Tt.xmin||0,Tt.xmax||0])).style("display","inline").style("pointer-events",kt?"all":"none").selectAll("rect").attr("height",D.height)):At.style("display","none")}function Ln(e){if(gt.length===0)return;wt=!1;var t=gt.length,n=t*St,r={x:n,y:e};gt.push(r)}function An(e){if(gt.length===0)return;Ln(e),ln()}function On(e){if(gt.length===0)return;wt=!1;var t=gt.length,n=t*St,r=n-St,i={x:n,y:e},s=P.call(self,r,r),o=H.call(self,gt[t-1].y,t-1),u,a;gt.push(i),u=P.call(self,n,n),a=H.call(self,e,n),T.beginPath(),T.moveTo(s,o),T.lineTo(u,a),T.stroke()}function Mn(e){for(var t=0;t<yt.length;t++)gt=yt[t],Ln(e[t]);Rt(gt.length-1),ln()}function _n(e){var t;yt=[];if(Object.prototype.toString.call(e)==="[object Array]")for(t=0;t<e.length;t++)gt=Ut(e[t],0,St),yt.push(gt);else gt=Ut(i.dataset,0,St),yt=[gt]}function Dn(e){var t=yt[0].length;_n(e);if(yt[0].length===t)return;j=!1,Rt(gt.length),ln()}function Pn(e){_n(e),j=!1,Rt(gt.length-1),ln()}function Hn(e,t){var n=t?.4:1;switch(e){case 0:T.strokeStyle="rgba(160,00,0,"+n+")";break;case 1:T.strokeStyle="rgba(44,160,0,"+n+")";break;case 2:T.strokeStyle="rgba(44,0,160,"+n+")"}}function Bn(e,t){var n=t?.4:1;switch(e){case 0:T.fillStyle="rgba(160,00,0,"+n+")";break;case 1:T.fillStyle="rgba(44,160,0,"+n+")";break;case 2:T.fillStyle="rgba(44,0,160,"+n+")"}}function jn(){x.width=x.width,T.fillStyle=N,T.fillRect(0,0,x.width,x.height),T.strokeStyle="rgba(255,65,0, 1.0)"}function Fn(){b.select("path.line").remove(),x.style.zIndex=1}function In(){x.style.zIndex=-1,Qt()}function qn(e){var t,n,r,s,o=H(1e-5),u=i.lines,a=i.bars,f=2*Math.PI,l=yt[0].length,c=yt.length,h=Math.round(P.domain()[0]/St),p=Math.max(0,h),d,v;Rt(e),jn(),T.fillRect(0,0,x.width,x.height);if(gt.length===0||h>=gt.length)return;if(u)for(t=0;t<c;t++){gt=yt[t],d=p*St,v=P(d),r=H(gt[p].y),Hn(t),T.beginPath(),T.moveTo(v,r),s=e-1;for(n=p+1;n<s;n++)d=n*St,v=P(d),r=H(gt[n].y),T.lineTo(v,r);T.stroke(),s=gt.length-1;if(n<s){Hn(t,!0);for(;n<s;n++)d=n*St,v=P(d),r=H(gt[n].y),T.lineTo(v,r);T.stroke()}}else if(a)for(t=0;t<c;t++){gt=yt[t],Hn(t),s=e-1;for(n=p;n<s;n++){d=n*St,v=P(d),r=H(gt[n].y);if(r===0)continue;T.beginPath(),T.moveTo(v,o),T.lineTo(v,r),T.stroke()}s=gt.length-1;if(n<s){Hn(t,!0);for(;n<s;n++)d=n*St,v=P(d),r=H(gt[n].y),T.beginPath(),T.moveTo(v,o),T.lineTo(v,r),T.stroke()}}else for(t=0;t<c;t++){gt=yt[t],d=0,Bn(t),Hn(t,!0),s=e-1;for(n=0;n<s;n++)v=P(d),r=H(gt[n].y),T.arc(v,r,1,0,f,!1),T.fill(),d+=St;s=gt.length-1;if(n<s){Bn(t,!0),Hn(t,!0);for(;n<s;n++)v=P(d),r=H(gt[n].y),T.arc(v,r,1,0,f,!1),T.fill(),d+=St}}}function Rn(){x||(x=x||document.createElement("canvas"),f.appendChild(x)),x.style.zIndex=-1,zn(x)}function Un(){zn(x),qn()}function zn(e){C.rect=w.node(),C.width=C.rect.width.baseVal.value,C.height=C.rect.height.baseVal.value,C.left=C.rect.getCTM().e,C.top=C.rect.getCTM().f,e.style.position="absolute",e.width=C.width,e.height=C.height,e.style.width=C.width+"px",e.style.height=C.height+"px",e.offsetLeft=C.left,e.offsetTop=C.top,e.style.left=C.left+"px",e.style.top=C.top+"px",e.style.pointerEvents="none",e.className.search("overlay")<0&&(e.className+=" overlay"),T=x.getContext("2d"),T.globalCompositeOperation="source-over",T.lineWidth=1,T.fillStyle=N,T.fillRect(0,0,e.width,x.height),T.strokeStyle="rgba(255,65,0, 1.0)"}function Wn(){y.node().addEventListener("keydown",function(e){if(!vt)return!1;if(e.type=="keydown"){switch(e.keyCode){case 8:case 46:if(i.dataChange){var t=gt.indexOf(vt);gt.splice(t,1),vt=gt.length?gt[t>0?t-1:0]:null,Qt()}e.preventDefault(),e.stopPropagation()}e.preventDefault()}})}function Xn(){Dt(),y===undefined?Vt():$t(),i.showButtons&&(k||Wt(),Xt()),Kt()}function Vn(e,t,n){return arguments.length?Jn(e,t,n):Jn(),Xn(),Xn(),Wn(),u}function $n(e,t){return _t(e,t),Mt(),Xn(),u}function Jn(e,t,n){if(t||!i)i=Pt(t);Mt(e,n),i.xrange=i.xmax-i.xmin,i.yrange=i.ymax-i.ymin,Object.prototype.toString.call(i.title)==="[object Array]"?mt=i.title:mt=[i.title],mt.reverse(),m=d3.format(i.xFormatter),g=d3.format(i.yFormatter),St=i.sample,lt=i.strokeWidth,gt=i.points,gt==="fake"&&(gt=qt());if(i.realTime){yt=[];if(Object.prototype.toString.call(i.dataset[0])==="[object Array]"){for(var r=0;r<i.dataset.length;r++)yt.push(Ut(i.dataset[r],0,St));gt=yt[0]}else gt=Ut(i.dataset,0),yt=[gt]}Rt(gt.length-1)}var u={},a,f,l,c,h,p=function(e){return e?"#ccc":"#666"},d=function(e){return"translate("+P(e)+",0)"},v=function(e){return"translate(0,"+H(e)+")"},m,g,y,b,w,E,S,x,T,N="rgba(255,255,255, 0.0)",C={},k,L,A,O,M,_,D,P,H,B,j=!1,F=d3.ease("cubic"),I,q,R,U,z,W,X,V,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},ht=NaN,pt=NaN,dt=null,vt=null,mt=[],gt,yt,bt,wt,Et,St,xt={showButtons:!0,responsiveLayout:!1,fontScaleRelativeToParent:!0,realTime:!1,title:"graph",xlabel:"x-axis",ylabel:"y-axis",xscale:"linear",yscale:"linear",xTickCount:10,yTickCount:10,xscaleExponent:.5,yscaleExponent:.5,xFormatter:"2s",yFormatter:"2s",axisShift:10,xmax:10,xmin:0,ymax:10,ymin:0,dataset:[0],selectablePoints:!1,circleRadius:10,strokeWidth:2,dataChange:!0,addData:!0,points:!1,notification:!1,sample:1,lines:!0,bars:!1},Tt={xmin:null,xmax:null,ymin:null,ymax:null},Nt=!1,Ct=!1,kt=!0,Lt,At,Ot;return u={update:Qt,repaint:Xn,reset:Vn,redraw:Kt,resize:$n,notify:Jt,selectionDomain:En,selectionVisible:xn,selectionListener:Nn,selectionEnabled:Tn,hasSelection:Sn,brushElement:function(){return At},brushControl:function(){return Ot},brushListener:function(){return Cn},scale:_t,updateOrRescale:ln,xDomain:function(e){return arguments.length?(P.domain(e),jt&&(jt(),Kt()),u):P.domain()},yDomain:function(e){return arguments.length?(H.domain(e),Ft&&(Ft(),Kt()),u):H.domain()},xmin:function(e){return arguments.length?(i.xmin=e,i.xrange=i.xmax-i.xmin,jt&&(jt(),Kt()),u):i.xmin},xmax:function(e){return arguments.length?(i.xmax=e,i.xrange=i.xmax-i.xmin,jt&&(jt(),Kt()),u):i.xmax},ymin:function(e){return arguments.length?(i.ymin=e,i.yrange=i.ymax-i.ymin,Ft&&(Ft(),Kt()),u):i.ymin},ymax:function(e){return arguments.length?(i.ymax=e,i.yrange=i.ymax-i.ymin,Ft&&(Ft(),Kt()),u):i.ymax},xLabel:function(e){return arguments.length?(i.xlabel=e,gn(),u):i.xlabel},yLabel:function(e){return arguments.length?(i.ylabel=e,yn(),u):i.ylabel},title:function(e){return arguments.length?(i.title=e,mn(),u):i.title},width:function(e){return arguments.length?(D.width=e,u):D.width},height:function(e){return arguments.length?(D.height=e,u):D.height},elem:function(e){return arguments.length?(a=d3.select(e),graph(a),u):a},newRealTimeData:Pn,truncateRealTimeData:Dn,addPoint:An,addPoints:Mn,addOneXYDataPair:bn,numberOfPoints:zt,data:function(e){if(!arguments.length)return gt;var t=P.domain();return i.points=gt=e,gt.length>t[1]?(t[0]+=shift,t[1]+=shift,P.domain(t),Kt()):Qt(),u},showMarker:fn},Jn(r,i,s),f&&(Xn(),Xn()),u}}),define("common/controllers/graph-controller",["require","grapher/core/graph","common/controllers/interactive-metadata","common/validator"],function(e){var t=e("grapher/core/graph"),n=e("common/controllers/interactive-metadata"),r=e("common/validator"),i={title:"title",realTime:"realTime",fontScaleRelativeToParent:"fontScaleRelativeToParent",xlabel:"xlabel",xmin:"xmin",xmax:"xmax",ylabel:"ylabel",ymin:"ymin",ymax:"ymax",xTickCount:"xTickCount",yTickCount:"yTickCount",xscaleExponent:"xscaleExponent",yscaleExponent:"yscaleExponent",xFormatter:"xFormatter",yFormatter:"yFormatter",lines:"lines",bars:"bars"},s=0;return function(o,u,a){function v(){return model.get("displayTimePerTick")}function m(){var e=[],t,n;for(t=0,n=h.length;t<n;t++)e.push(model.get(h[t]));return e}function g(){var e,t,n={sample:v()};for(e in i)i.hasOwnProperty(e)&&(t=i[e],n[t]=o[e]);return n}function y(){var e=m(),t;for(t=0;t<e.length;t++)p[t]=[e[t]];l.newRealTimeData(p)}function b(){var e=m(),t;for(t=0;t<e.length;t++)p[t].push(e[t]);l.addPoints(e)}function w(){var e;for(e=0;e<h.length;e++)p[e].length=model.stepCounter()+1;l.truncateRealTimeData(p)}function E(){l.updateOrRescale(model.stepCounter()),l.showMarker(model.stepCounter())}function S(){l.reset("#"+o.id,g())}function x(){model.on("tick."+d,b),model.on("stepBack."+d,E),model.on("stepForward."+d,E),model.on("seek."+d,E),model.on("reset."+d,function(){S(),y()}),model.on("play."+d,function(){l.numberOfPoints()&&model.stepCounter()<l.numberOfPoints()&&w()}),model.on("invalidation."+d,w),model.addPropertiesListener(["timeStepsPerTick","timeStep"],function(){S(),y()})}var f,l,c,h,p=[],d="graphController"+ ++s;return o=r.validateCompleteness(n.graph,o),h=o.properties.slice(),f=$("<div>").attr("id",o.id).addClass("graph"),f.addClass("component"),f.css({width:o.width,height:o.height}),c={modelLoadedCallback:function(){l?S():l=new t(f[0],g(),undefined,a.getNextTabIndex()),y(),x()},getView:function(){return l},getViewContainer:function(){return f},resize:function(){l&&l.resize()},serialize:function(){var e=$.extend(!0,{},o),t=l.xDomain(),n=l.yDomain(),r=o.xmin;return e.ymin=n[0],e.ymax=n[1],e.xmin=r,e.xmax=r+t[1]-t[0],e}}}}),define("import-export/dg-exporter",["require","common/console"],function(e){var t=e("common/console");return{gameName:"Next Gen MW",parentCollectionName:"Summary of Run",childCollectionName:"Time Series of Run",perRunColumnLabelCount:0,perRunColumnLabelPositions:{},mockDGController:{doCommand:function(e){return t.log("action: ",e.action),t.log("args: ",e.args),{caseID:0}}},isDgGameControllerDefined:function(){return!!(window.parent&&window.parent.DG&&window.parent.DG.currGameController)},isExportAvailable:function(){return this.isDgGameControllerDefined()},getDGGameController:function(){return this.isDgGameControllerDefined()?window.parent.DG.currGameController:this.mockDGController},doCommand:function(e,t){var n=this.getDGGameController();return n.doCommand({action:e,args:t})},exportData:function(e,t,n,r){var i,s,o,u=[],a=[],f=[],l,c,h;for(h=0;h<t.length;h++)i=e[h],s=t[h],this.perRunColumnLabelPositions[i]==null&&(this.perRunColumnLabelPositions[i]=this.perRunColumnLabelCount++),o=this.perRunColumnLabelPositions[i],u[o]={name:i},a[o]=s;for(h=0;h<n.length;h++)f.push({name:n[h]});this.doCommand("initGame",{name:this.gameName}),this.doCommand("createCollection",{name:this.parentCollectionName,attrs:[{name:"Number of Time Points"}].concat(u),childAttrName:"contents"}),this.doCommand("createCollection",{name:this.childCollectionName,attrs:f}),c=[r.length].concat(a),l=this.doCommand("openCase",{collection:this.parentCollectionName,values:c}),this.doCommand("createCases",{collection:this.childCollectionName,values:r,parent:l.caseID}),this.doCommand("closeCase",{collection:this.parentCollectionName,values:c,caseID:l.caseID})},openTable:function(){this.doCommand("createComponent",{type:"DG.TableView",log:!1})},logAction:function(e){this.doCommand("logAction",{formatStr:e})}}}),define("common/controllers/export-controller",["require","import-export/dg-exporter"],function(e){var t=e("import-export/dg-exporter"),n=function(n){function u(){var e=[],t,n;for(t=0,n=i.length;t<n;t++)e.push(model.get(i[t]));return e}function a(){s=[u()]}function f(){s.push(u())}function l(){s.length=model.stepCounter()+1}function c(e){var n,i=[],s=[],o;for(o=0;o<r.length;o++)i[o]=p(r[o]),s[o]=model.get(r[o]);n="User "+e+" model. ",n+="Per-run Settings and Data: ",n+=JSON.stringify({action:e,type:"model",fields:i,values:s}),t.logAction(n)}function h(){model.on("tick.exportController",f),model.on("reset.exportController",a),model.on("play.exportController",l),model.on("invalidation.exportController",l),model.on("play.exportController",function(){c("started")}),model.on("willReset.exportController",function(){c("reset")})}function p(e){var t=model.getPropertyDescription(e),n=t.getLabel(),r=t.getUnitAbbreviation(),i="";return n.length>0?i+=n:i+=e,r&&r.length>0&&(i+=" (",i+=r,i+=")"),i}var r=(n.perRun||[]).slice(),i=["displayTime"].concat(n.perTick.slice()),s,o;return o={modelLoadedCallback:function(){function e(e){return function(t){return model.getPropertyType(t)===e}}r=r.filter(e("parameter")).concat(r.filter(e("output"))),a(),h()},exportData:function(){var e=[],n=[],o=[],u;c("exported");for(u=0;u<r.length;u++)e[u]=p(r[u]),n[u]=model.get(r[u]);for(u=0;u<i.length;u++)o[u]=p(i[u]);t.exportData(e,n,o,s),t.openTable()}}};return n.isExportAvailable=function(){return t.isExportAvailable()},n}),define("common/controllers/scripting-api",["require","common/alert"],function(e){var t=e("common/alert");return function(n){var r={api:function(){function e(e){return typeof e=="number"&&parseFloat(e)===parseInt(e,10)}function r(e){return typeof e=="object"&&e.slice===Array.prototype.slice}function i(e){return e?Math.random()*e:Math.random()}function s(e){return Math.floor(Math.random()*e)}function o(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function u(e,t){var n=[],r;for(r=0;r<t;r++)n[r]=r;for(r=0;r<e;r++)o(n,r,r+s(t-r));return n.length=e,n}function a(e,t,n){var r;if(typeof _gaq=="undefined")return;r=_gaq,e||(e="Interactive"),r.push(["_trackEvent",e,t,n])}return{isInteger:e,isArray:r,randomInteger:s,randomFloat:i,swapElementsOfArray:o,choose:u,deg2rad:Math.PI/180,rad2deg:180/Math.PI,trackEvent:a,format:d3.format,get:function(){return model.get.apply(model,arguments)},set:function(){return model.set.apply(model,arguments)},loadModel:function(t,r){model.stop(),n.loadModel(t),typeof r=="function"&&n.pushOnLoadScript(r)},onPropertyChange:function(t,n){model.addPropertiesListener([t],function(){n(model.get(t))})},callAt:function(t,n){var r={time:t,action:n,check:function(){model.get("time")>=this.time&&(this.action(),this.check=function(){})}};model.addPropertiesListener("time",function(){r.check()})},callEvery:function(t,n){var r={lastCall:0,interval:t,action:n,execute:function(){var e=model.get("time");while(e-this.lastCall>=this.interval)this.action(),this.lastCall+=this.interval}};model.addPropertiesListener("time",function(){r.execute()})},onClick:function(t,r){n.getModelController().modelContainer.setClickHandler("."+t,r)},onSelect:function(t){n.getModelController().modelContainer.setSelectHandler(t)},start:function(){model.start(),a("Interactive","Start","Starting interactive: "+n.get("title"))},stop:function(){model.stop()},reset:function(){model.stop(),n.modelController.reload()},stepForward:function(){model.stepForward(),model.isNewStep()||n.modelController.modelContainer.update()},stepBack:function(){model.stepBack(),n.modelController.modelContainer.update()},tick:function(){model.tick()},isStopped:function(){return model.is_stopped()},getTime:function(){return model.get("time")},getFPS:function(){return model.getFPS()},getSimulationProgressRate:function(){return model.getSimulationProgressRate()},startPerformanceTuning:function(){model.performanceOptimizer.enable()},repaint:function(){n.getModelController().repaint()},exportData:function(){var t=n.getDGExportController();if(!t)throw new Error("No exports have been specified.");t.exportData()},Math:Math,"undefined":undefined,alert:t,console:window.console!==null?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}}}(),freeze:function(){Object.freeze(this.api)},extend:function(e){$.extend(this.api,new e(this.api))},exposeScriptingAPI:function(){window.script=$.extend({},this.api),window.script.run=function(e,t){var n,i=[],s=[];for(n in t)t.hasOwnProperty(n)&&(i.push(n),s.push(t[n]));return r.makeFunctionInScriptContext.apply(null,i.concat(e)).apply(null,s)}},makeFunctionInScriptContext:function(){function u(){var t=Object.getOwnPropertyNames(window),n,r,i,s;for(r=0,i=t.length;r<i;r++)n=t[r],e.hasOwnProperty(n)||(s=function(e){return function(){throw new ReferenceError(e+" is not defined")}}(n),Object.defineProperty(e,n,{set:s,get:s}))}var e={},n=Array.prototype.slice.call(arguments,0,arguments.length-1),r=arguments[arguments.length-1],i,s,o;typeof r!="string"&&(r=r.join("      \n")),i="with (shadowedGlobals) {\n  with (scriptingAPI) {\n    return function("+n.join(",")+") {\n"+"      'use "+"strict';\n"+"      "+r+"\n"+"    };\n"+"  }\n"+"}";try{s=new Function("shadowedGlobals","scriptingAPI","scriptSource",i),o=s(e,this.api,r)}catch(a){return t('Error compiling script: "'+a.toString()+'"\nScript:\n\n'+r),function(){throw new Error("Cannot run a script that could not be compiled")}}return function(){u();try{return o.apply(null,Array.prototype.slice.call(arguments))}catch(e){t('Error running script: "'+e.toString()+'"\nScript:\n\n'+r)}}}};return r}}),define("common/controllers/button-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i,s){var o,u;return r=t.validateCompleteness(e.button,r),o=$("<button>").attr("tabindex",s.getNextTabIndex()).attr("id",r.id).html(r.text),o.addClass("component"),o.css({width:r.width,height:r.height}),o.click(i.makeFunctionInScriptContext(r.action)),u={getViewContainer:function(){return o},serialize:function(){return $.extend(!0,{},r)}},u}}),define("common/controllers/checkbox-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i,s){function d(){v(model.get(o))}function v(e){e?(f.attr("checked","checked"),l.addClass("checked")):(f.removeAttr("checked"),l.removeClass("checked"))}function m(e){e.preventDefault(),f.attr("checked")!==undefined?v(!1):v(!0),f.trigger("change")}var o,u,a,f,l,c,h,p;return r=t.validateCompleteness(e.checkbox,r),o=r.property,u=r.onClick,a=r.initialValue,c=$("<label>").append("<span>"+r.text+"</span>"),c.attr("for",r.id),f=$('<input type="checkbox">').attr("tabindex",s.getNextTabIndex()).attr("id",r.id),l=$('<div class="fakeCheckable">'),f.css("display","none"),r.textOn==="left"?h=$("<div>").append(c).append(f).append(l.addClass("right")):h=$("<div>").append(f).append(l).append(c),h.addClass("interactive-checkbox"),h.addClass("component"),l.on("touchstart click",m),c.on("touchstart click",m),h.css({width:r.width,height:r.height}),u&&(u=i.makeFunctionInScriptContext("value",u)),f.on("change",function(){var e=!1,t;$(this).is(":checked")&&(e=!0),o!==undefined&&(t={},t[o]=e,model.set(t)),u!==undefined&&u(e)}),p={modelLoadedCallback:function(){o!==undefined?(model.addPropertiesListener([o],d),d()):a!==undefined&&(v(a),u(a))},getViewContainer:function(){return h},serialize:function(){var e=$.extend(!0,{},r);return o===undefined&&(e.initialValue=f.is(":checked")?!0:!1),e}},p}}),function(e){function n(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function r(){var e=require("util");return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}function s(e){var t=0,n=-1;while((n=e.indexOf("\n",n+1))!==-1)t++;return t}function o(e,t){function i(e){this.len_after=e,this.name="close_"+t}var n=e+"_state",r=e=="strong"?"em_state":"strong_state";return function(s,o){if(this[n][0]==t)return this[n].shift(),[s.length,new i(s.length-t.length)];var u=this[r].slice(),a=this[n].slice();this[n].unshift(t);var f=this.processInline(s.substr(t.length)),l=f[f.length-1],c=this[n].shift();if(l instanceof i){f.pop();var h=s.length-l.len_after;return[h,[e].concat(f)]}return this[r]=u,this[n]=a,[t.length,t]}}function u(e){var t=e.split(""),n=[""],r=!1;while(t.length){var i=t.shift();switch(i){case" ":r?n[n.length-1]+=i:n.push("");break;case"'":case'"':r=!r;break;case"\\":i=t.shift();default:n[n.length-1]+=i}}return n}function c(e){return f(e)&&e.length>1&&typeof e[1]=="object"&&!f(e[1])?e[1]:undefined}function h(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function d(e){if(typeof e=="string")return h(e);var t=e.shift(),n={},r=[];e.length&&typeof e[0]=="object"&&!(e[0]instanceof Array)&&(n=e.shift());while(e.length)r.push(arguments.callee(e.shift()));var i="";for(var s in n)i+=" "+s+'="'+h(n[s])+'"';return t=="img"||t=="br"||t=="hr"?"<"+t+i+"/>":"<"+t+i+">"+r.join("")+"</"+t+">"}function v(e,t,n){var r;n=n||{};var i=e.slice(0);typeof n.preprocessTreeNode=="function"&&(i=n.preprocessTreeNode(i,t));var s=c(i);if(s){i[1]={};for(r in s)i[1][r]=s[r];s=i[1]}if(typeof i=="string")return i;switch(i[0]){case"header":i[0]="h"+i[1].level,delete i[1].level;break;case"bulletlist":i[0]="ul";break;case"numberlist":i[0]="ol";break;case"listitem":i[0]="li";break;case"para":i[0]="p";break;case"markdown":i[0]="html",s&&delete s.references;break;case"code_block":i[0]="pre",r=s?2:1;var o=["code"];o.push.apply(o,i.splice(r)),i[r]=o;break;case"inlinecode":i[0]="code";break;case"img":i[1].src=i[1].href,delete i[1].href;break;case"linebreak":i[0]="br";break;case"link":i[0]="a";break;case"link_ref":i[0]="a";var u=t[s.ref];if(!u)return s.original;delete s.ref,s.href=u.href,u.title&&(s.title=u.title),delete s.original;break;case"img_ref":i[0]="img";var u=t[s.ref];if(!u)return s.original;delete s.ref,s.src=u.href,u.title&&(s.title=u.title),delete s.original}r=1;if(s){for(var a in i[1])r=2;r===1&&i.splice(r,1)}for(;r<i.length;++r)i[r]=arguments.callee(i[r],t,n);return i}function m(e){var t=c(e)?2:1;while(t<e.length)typeof e[t]=="string"?t+1<e.length&&typeof e[t+1]=="string"?e[t]+=e.splice(t+1,1)[0]:++t:(arguments.callee(e[t]),++t)}var t=e.Markdown=function g(e){switch(typeof e){case"undefined":this.dialect=g.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in g.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=g.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};e.parse=function(e,n){var r=new t(n);return r.toTree(e)},e.toHTML=function(n,r,i){var s=e.toHTMLTree(n,r,i);return e.renderJsonML(s)},e.toHTMLTree=function(t,n,r){typeof t=="string"&&(t=this.parse(t,n));var i=c(t),s={};i&&i.references&&(s=i.references);var o=v(t,s,r);return m(o),o};var i=t.mk_block=function(e,t,i){arguments.length==1&&(t="\n\n");var s=new String(e);return s.trailing=t,s.inspect=r,s.toSource=n,i!=undefined&&(s.lineNumber=i),s};t.prototype.split_blocks=function(t,n){var r=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,o=[],u,a=1;(u=/^(\s*\n)/.exec(t))!=null&&(a+=s(u[0]),r.lastIndex=u[0].length);while((u=r.exec(t))!==null)o.push(i(u[1],u[2],a)),a+=s(u[0]);return o},t.prototype.processBlock=function(t,n){var r=this.dialect.block,i=r.__order__;if("__call__"in r)return r.__call__.call(this,t,n);for(var s=0;s<i.length;s++){var o=r[i[s]].call(this,t,n);if(o)return(!f(o)||o.length>0&&!f(o[0]))&&this.debug(i[s],"didn't return a proper array"),o}return[]},t.prototype.processInline=function(t){return this.dialect.inline.__call__.call(this,String(t))},t.prototype.toTree=function(t,n){var r=t instanceof Array?t:this.split_blocks(t),i=this.tree;try{this.tree=n||this.tree||["markdown"];e:while(r.length){var s=this.processBlock(r.shift(),r);if(!s.length)continue e;this.tree.push.apply(this.tree,s)}return this.tree}finally{n&&(this.tree=i)}},t.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),typeof print!="undefined"&&print.apply(print,e),typeof console!="undefined"&&typeof console.log!="undefined"&&console.log.apply(null,e)},t.prototype.loop_re_over_block=function(e,t,n){var r,i=t.valueOf();while(i.length&&(r=e.exec(i))!=null)i=i.substr(r[0].length),n.call(this,r);return i},t.dialects={},t.dialects.Gruber={block:{atxHeader:function(t,n){var r=t.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!r)return undefined;var s=["header",{level:r[1].length}];return Array.prototype.push.apply(s,this.processInline(r[2])),r[0].length<t.length&&n.unshift(i(t.substr(r[0].length),t.trailing,t.lineNumber+2)),[s]},setextHeader:function(t,n){var r=t.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!r)return undefined;var s=r[2]==="="?1:2,o=["header",{level:s},r[1]];return r[0].length<t.length&&n.unshift(i(t.substr(r[0].length),t.trailing,t.lineNumber+2)),[o]},code:function(t,n){var r=[],s=/^(?: {0,3}\t| {4})(.*)\n?/,o;if(!t.match(s))return undefined;e:do{var u=this.loop_re_over_block(s,t.valueOf(),function(e){r.push(e[1])});if(u.length){n.unshift(i(u,t.trailing));break e}if(!n.length)break e;if(!n[0].match(s))break e;r.push(t.trailing.replace(/[^\n]/g,"").substring(2)),t=n.shift()}while(!0);return[["code_block",r.join("\n")]]},horizRule:function(t,n){var r=t.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!r)return undefined;var s=[["hr"]];return r[1]&&s.unshift.apply(s,this.processBlock(r[1],[])),r[3]&&n.unshift(i(r[3])),s},lists:function(){function o(t){return new RegExp("(?:^("+s+"{0,"+t+"} {0,3})("+e+")\\s+)|"+"(^"+s+"{0,"+(t-1)+"}[ ]{0,4})")}function u(e){return e.replace(/ {0,3}\t/g,"    ")}function a(e,t,n,r){if(t){e.push(["para"].concat(n));return}var i=e[e.length-1]instanceof Array&&e[e.length-1][0]=="para"?e[e.length-1]:e;r&&e.length>1&&n.unshift(r);for(var s=0;s<n.length;s++){var o=n[s],u=typeof o=="string";u&&i.length>1&&typeof i[i.length-1]=="string"?i[i.length-1]+=o:i.push(o)}}function f(e,t){var n=new RegExp("^("+s+"{"+e+"}.*?\\n?)*$"),r=new RegExp("^"+s+"{"+e+"}","gm"),o=[];while(t.length>0){if(n.exec(t[0])){var u=t.shift(),a=u.replace(r,"");o.push(i(a,u.trailing,u.lineNumber))}break}return o}function c(e,t,n){var r=e.list,i=r[r.length-1];if(i[1]instanceof Array&&i[1][0]=="para")return;if(t+1==n.length)i.push(["para"].concat(i.splice(1)));else{var s=i.pop();i.push(["para"].concat(i.splice(1)),s)}}var e="[*+-]|\\d+\\.",t=/[*+-]/,n=/\d+\./,r=new RegExp("^( {0,3})("+e+")[ 	]+"),s="(?: {0,3}\\t| {4})";return function(e,n){function s(e){var n=t.exec(e[2])?["bulletlist"]:["numberlist"];return h.push({list:n,indent:e[1]}),n}var i=e.match(r);if(!i)return undefined;var h=[],p=s(i),d,v=!1,m=[h[0].list],g;e:for(;;){var y=e.split(/(?=\n)/),b="";for(var w=0;w<y.length;w++){var E="",S=y[w].replace(/^\n/,function(e){return E=e,""}),x=o(h.length);i=S.match(x);if(i[1]!==undefined){b.length&&(a(d,v,this.processInline(b),E),v=!1,b=""),i[1]=u(i[1]);var T=Math.floor(i[1].length/4)+1;if(T>h.length)p=s(i),d.push(p),d=p[1]=["listitem"];else{var N=!1;for(g=0;g<h.length;g++){if(h[g].indent!=i[1])continue;p=h[g].list,h.splice(g+1),N=!0;break}N||(T++,T<=h.length?(h.splice(T),p=h[T-1].list):(p=s(i),d.push(p))),d=["listitem"],p.push(d)}E=""}S.length>i[0].length&&(b+=E+S.substr(i[0].length))}b.length&&(a(d,v,this.processInline(b),E),v=!1,b="");var C=f(h.length,n);C.length>0&&(l(h,c,this),d.push.apply(d,this.toTree(C,[])));var k=n[0]&&n[0].valueOf()||"";if(k.match(r)||k.match(/^ /)){e=n.shift();var L=this.dialect.block.horizRule(e,n);if(L){m.push.apply(m,L);break}l(h,c,this),v=!0;continue e}break}return m}}(),blockquote:function(t,n){if(!t.match(/^>/m))return undefined;var r=[];if(t[0]!=">"){var i=t.split(/\n/),s=[];while(i.length&&i[0][0]!=">")s.push(i.shift());t=i.join("\n"),r.push.apply(r,this.processBlock(s.join("\n"),[]))}while(n.length&&n[0][0]==">"){var o=n.shift();t=new String(t+t.trailing+o),t.trailing=o.trailing}var u=t.replace(/^> ?/gm,""),a=this.tree;return r.push(this.toTree(u,["blockquote"])),r},referenceDefn:function(t,n){var r=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!t.match(r))return undefined;c(this.tree)||this.tree.splice(1,0,{});var s=c(this.tree);s.references===undefined&&(s.references={});var o=this.loop_re_over_block(r,t,function(e){e[2]&&e[2][0]=="<"&&e[2][e[2].length-1]==">"&&(e[2]=e[2].substring(1,e[2].length-1));var t=s.references[e[1].toLowerCase()]={href:e[2]};e[4]!==undefined?t.title=e[4]:e[5]!==undefined&&(t.title=e[5])});return o.length&&n.unshift(i(o,t.trailing)),[]},para:function(t,n){return[["para"].concat(this.processInline(t))]}}},t.dialects.Gruber.inline={__oneElement__:function(t,n,r){var i,s,o=0;n=n||this.dialect.inline.__patterns__;var u=new RegExp("([\\s\\S]*?)("+(n.source||n)+")");i=u.exec(t);if(!i)return[t.length,t];if(i[1])return[i[1].length,i[1]];var s;return i[2]in this.dialect.inline&&(s=this.dialect.inline[i[2]].call(this,t.substr(i.index),i,r||[])),s=s||[i[2].length,i[2]],s},__call__:function(t,n){function s(e){typeof e=="string"&&typeof r[r.length-1]=="string"?r[r.length-1]+=e:r.push(e)}var r=[],i;while(t.length>0)i=this.dialect.inline.__oneElement__.call(this,t,n,r),t=t.substr(i.shift()),l(i,s);return r},"]":function(){},"}":function(){},"\\":function(t){return t.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)?[2,t[1]]:[1,"\\"]},"![":function(t){var n=t.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(n){n[2]&&n[2][0]=="<"&&n[2][n[2].length-1]==">"&&(n[2]=n[2].substring(1,n[2].length-1)),n[2]=this.dialect.inline.__call__.call(this,n[2],/\\/)[0];var r={alt:n[1],href:n[2]||""};return n[4]!==undefined&&(r.title=n[4]),[n[0].length,["img",r]]}return n=t.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),n?[n[0].length,["img_ref",{alt:n[1],ref:n[2].toLowerCase(),original:n[0]}]]:[2,"!["]},"[":function y(e){var n=String(e),r=t.DialectHelpers.inline_until_char.call(this,e.substr(1),"]");if(!r)return[1,"["];var i=1+r[0],s=r[1],y,o;e=e.substr(i);var u=e.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(u){var a=u[1];i+=u[0]
.length,a&&a[0]=="<"&&a[a.length-1]==">"&&(a=a.substring(1,a.length-1));if(!u[3]){var f=1;for(var l=0;l<a.length;l++)switch(a[l]){case"(":f++;break;case")":--f==0&&(i-=a.length-l,a=a.substring(0,l))}}return a=this.dialect.inline.__call__.call(this,a,/\\/)[0],o={href:a||""},u[3]!==undefined&&(o.title=u[3]),y=["link",o].concat(s),[i,y]}return u=e.match(/^\s*\[(.*?)\]/),u?(i+=u[0].length,o={ref:(u[1]||String(s)).toLowerCase(),original:n.substr(0,i)},y=["link_ref",o].concat(s),[i,y]):s.length==1&&typeof s[0]=="string"?(o={ref:s[0].toLowerCase(),original:n.substr(0,i)},y=["link_ref",o,s[0]],[i,y]):[1,"["]},"<":function(t){var n;return(n=t.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null?n[3]?[n[0].length,["link",{href:"mailto:"+n[3]},n[3]]]:n[2]=="mailto"?[n[0].length,["link",{href:n[1]},n[1].substr("mailto:".length)]]:[n[0].length,["link",{href:n[1]},n[1]]]:[1,"<"]},"`":function(t){var n=t.match(/(`+)(([\s\S]*?)\1)/);return n&&n[2]?[n[1].length+n[2].length,["inlinecode",n[3]]]:[1,"`"]},"  \n":function(t){return[3,["linebreak"]]}},t.dialects.Gruber.inline["**"]=o("strong","**"),t.dialects.Gruber.inline.__=o("strong","__"),t.dialects.Gruber.inline["*"]=o("em","*"),t.dialects.Gruber.inline._=o("em","_"),t.buildBlockOrder=function(e){var t=[];for(var n in e){if(n=="__order__"||n=="__call__")continue;t.push(n)}e.__order__=t},t.buildInlinePatterns=function(e){var t=[];for(var n in e){if(n.match(/^__.*__$/))continue;var r=n.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(n.length==1?r:"(?:"+r+")")}t=t.join("|"),e.__patterns__=t;var i=e.__call__;e.__call__=function(e,n){return n!=undefined?i.call(this,e,n):i.call(this,e,t)}},t.DialectHelpers={},t.DialectHelpers.inline_until_char=function(e,t){var n=0,r=[];for(;;){if(e[n]==t)return n++,[n,r];if(n>=e.length)return null;res=this.dialect.inline.__oneElement__.call(this,e.substr(n)),n+=res[0],r.push.apply(r,res.slice(1))}},t.subclassDialect=function(e){function t(){}function n(){}return t.prototype=e.block,n.prototype=e.inline,{block:new t,inline:new n}},t.buildBlockOrder(t.dialects.Gruber.block),t.buildInlinePatterns(t.dialects.Gruber.inline),t.dialects.Maruku=t.subclassDialect(t.dialects.Gruber),t.dialects.Maruku.processMetaHash=function(t){var n=u(t),r={};for(var i=0;i<n.length;++i)if(/^#/.test(n[i]))r.id=n[i].substring(1);else if(/^\./.test(n[i]))r["class"]?r["class"]=r["class"]+n[i].replace(/./," "):r["class"]=n[i].substring(1);else if(/\=/.test(n[i])){var s=n[i].split(/\=/);r[s[0]]=s[1]}return r},t.dialects.Maruku.block.document_meta=function(t,n){if(t.lineNumber>1)return undefined;if(!t.match(/^(?:\w+:.*\n)*\w+:.*$/))return undefined;c(this.tree)||this.tree.splice(1,0,{});var r=t.split(/\n/);for(p in r){var i=r[p].match(/(\w+):\s*(.*)$/),s=i[1].toLowerCase(),o=i[2];this.tree[1][s]=o}return[]},t.dialects.Maruku.block.block_meta=function(t,n){var r=t.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!r)return undefined;var i=this.dialect.processMetaHash(r[2]),s;if(r[1]===""){var o=this.tree[this.tree.length-1];s=c(o);if(typeof o=="string")return undefined;s||(s={},o.splice(1,0,s));for(a in i)s[a]=i[a];return[]}var u=t.replace(/\n.*$/,""),f=this.processBlock(u,[]);s=c(f[0]),s||(s={},f[0].splice(1,0,s));for(a in i)s[a]=i[a];return f},t.dialects.Maruku.block.definition_list=function(t,n){var r=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,i=["dl"],s;if(!(a=t.match(r)))return undefined;var o=[t];while(n.length&&r.exec(n[0]))o.push(n.shift());for(var u=0;u<o.length;++u){var a=o[u].match(r),f=a[1].replace(/\n$/,"").split(/\n/),l=a[2].split(/\n:\s+/);for(s=0;s<f.length;++s)i.push(["dt",f[s]]);for(s=0;s<l.length;++s)i.push(["dd"].concat(this.processInline(l[s].replace(/(\n)\s+/,"$1"))))}return[i]},t.dialects.Maruku.inline["{:"]=function(t,n,r){if(!r.length)return[2,"{:"];var i=r[r.length-1];if(typeof i=="string")return[2,"{:"];var s=t.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!s)return[2,"{:"];var o=this.dialect.processMetaHash(s[1]),u=c(i);u||(u={},i.splice(1,0,u));for(var a in o)u[a]=o[a];return[s[0].length,""]},t.buildBlockOrder(t.dialects.Maruku.block),t.buildInlinePatterns(t.dialects.Maruku.inline);var f=Array.isArray||function(e){return Object.prototype.toString.call(e)=="[object Array]"},l;Array.prototype.forEach?l=function(e,t,n){return e.forEach(t,n)}:l=function(e,t,n){for(var r=0;r<e.length;r++)t.call(n||e,e[r],r,e)},e.renderJsonML=function(e,t){t=t||{},t.root=t.root||!1;var n=[];if(t.root)n.push(d(e));else{e.shift(),e.length&&typeof e[0]=="object"&&!(e[0]instanceof Array)&&e.shift();while(e.length)n.push(d(e.shift()))}return n.join("\n\n")}}(function(){return typeof exports=="undefined"?(window.markdown={},window.markdown):exports}()),define("markdown",function(e){return function(){var t,n;return t||e.markdown}}(this)),define("common/inherit",[],function(){return function(t,n){function r(){}r.prototype=n.prototype,t.prototype=new r,t.superClass=n.prototype,t.prototype.constructor=t}}),define("common/controllers/interactive-component",["require","common/controllers/interactive-metadata","common/validator"],function(e){function r(e,r,i){var s;this.component=n.validateCompleteness(t[e],r),this.$element=$("<div>").attr("id",r.id).addClass("component"),this.component.width&&this.$element.css("width",this.component.width),this.component.height&&this.$element.css("height",this.component.height),this.component.onClick&&(typeof this.component.onClick!="function"?s=i.makeFunctionInScriptContext(this.component.onClick):s=this.component.onClick,this.$element.on("click",s),this.$element.addClass("clickable")),this.component.classes&&this.component.classes.length&&this.$element.addClass(this.component.classes.join(" ")),this.component.tooltip&&this.$element.attr("title",this.component.tooltip)}var t=e("common/controllers/interactive-metadata"),n=e("common/validator");return r.prototype.getViewContainer=function(){return this.$element},r.prototype.serialize=function(){return this.component},r}),define("common/controllers/text-controller",["require","markdown","common/inherit","common/controllers/interactive-component"],function(e){function i(e,n){var i,s,o,u,a='class="opens-in-new-window" target="blank"';r.call(this,"text",e,n),this.$element.addClass("interactive-text"),this.$element.addClass("markdown-typography"),i=$.isArray(this.component.text)?this.component.text:[this.component.text],s=this.$element,o="",$.each(i,function(e,t){o+=t+"\n"}),u=t.toHTML(o),u=u.replace(/<a(.*?)>/g,"<a$1 "+a+">"),s.append(u)}var t=e("markdown"),n=e("common/inherit"),r=e("common/controllers/interactive-component");return n(i,r),i}),define("common/controllers/image-controller",["require","lab.config","common/inherit","common/controllers/interactive-component"],function(e){function o(e,t,n){var o=typeof Lab!="undefined"?Lab.config.actualRoot:"";r.call(this,"image",e,t),this._controller=n,this._$img=$("<img>"),this._externalUrl=i.test(this.component.src),this._resourcesUrl=s.test(this.component.src),this._externalUrl?this._$img.attr("src",this.component.src):this._resourcesUrl&&this._$img.attr("src",this.component.src.replace(s,o+"/resources/")),this.component.width!=="auto"&&this._$img.css("width","100%"),this.component.height!=="auto"&&this._$img.css("height","100%"),this._$img.appendTo(this.$element)}var t=e("lab.config"),n=e("common/inherit"),r=e("common/controllers/interactive-component"),i=/^https?:\/\//i,s=/^{resources}\//i;return n(o,r),o.prototype.modelLoadedCallback=function(){var e,n;this._externalUrl||(e=this.component.src,n=this._controller.getModelController().modelUrl,n=n.slice(0,n.lastIndexOf("/")+1),e=t.actualRoot+n+e,this._$img.attr("src",e))},o}),define("common/controllers/radio-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i,s){function h(){var e=model.get(r.property),t,n;for(t=0,n=f.length;t<n;t++)f[t].value===e?(l[t].attr("checked",!0),c[t].addClass("checked")):(l[t].removeAttr("checked"),c[t].removeClass("checked"))}function p(e){var t=$(this).closest("span"),n=t.find("input"),r=t.find(".fakeCheckable"),i,s;e.preventDefault();if(n.attr("disabled")!==undefined)return;for(i=0,s=l.length;i<s;i++)l[i].removeAttr("checked"),c[i].removeClass("checked");n.attr("checked")!==undefined?(n.removeAttr("checked"),r.removeClass("checked")):(n.attr("checked","checked"),r.addClass("checked")),n.trigger("change")}function d(){var n,o,h,d,v,m;r=t.validateCompleteness(e.radio,r),f=r.options;for(v=0,m=f.length;v<m;v++)f[v]=t.validateCompleteness(e.radioOption,f[v]);u=$("<div>").attr("id",r.id),u.addClass("interactive-radio"),u.addClass("component"),u.addClass(r.orientation),r.label&&(h=$("<span>").text(r.label),h.addClass("label"),h.addClass(r.labelOn==="top"?"on-top":"on-left"),u.append(h));for(v=0,m=f.length;v<m;v++)d=f[v],n=$("<input>").attr("type","radio").attr("name",r.id).attr("tabindex",s.getNextTabIndex()).attr("id",r.id+"-"+v),l.push(n),h=$("<label>").attr("for",r.id+"-"+v).text(d.text),o=$('<div class="fakeCheckable">'),c.push(o),d.disabled&&(n.attr("disabled",d.disabled),o.addClass("disabled")),d.selected&&(n.attr("checked",d.selected),o.addClass("checked")),a=$("<span>").addClass("option").append(n).append(o).append(h),u.append(a),o.on("touchstart click",p),h.on("touchstart click",p),n.change(function(e){return function(){e.action?i.makeFunctionInScriptContext(e.action)():e.loadModel?(model.stop(),s.loadModel(e.loadModel)):e.value!==undefined&&model.set(r.property,e.value)}}(d))}var o,u,a,f,l=[],c=[];return o={modelLoadedCallback:function(){r.property!==undefined&&(model.addPropertiesListener([r.property],h),h())},getViewContainer:function(){return u},serialize:function(){var e,t;if(r.property===undefined)for(e=0,t=f.length;e<t;e++)l[e].attr("checked")?f[e].selected=!0:delete f[e].selected;return $.extend(!0,{},r)}},d(),o}}),define("common/controllers/slider-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=function(){var e=model.get(f);w.slider("value",e),d&&E.text(d(e))};x={modelLoadedCallback:function(){f&&model.addPropertiesListener([f],T),c!==undefined&&c!==null?l&&(w.slider("value",c),l(c),d&&E.text(d(c))):f&&T()},getViewContainer:function(){return g},resize:function(){var e,t;r.height!=="auto"&&(e=g.height()-y.outerHeight(!0),b!==undefined&&(e-=b.outerHeight(!0)),S.css("height",e),w.css("top",.5*e),t=parseFloat(E.css("font-size")),E.css("height",e+t*.4),E.css("top",-0.5*e-t*.4))},serialize:function(){var e=$.extend(!0,{},r);return f||(e.initialValue=w.slider("value")),e}},r=t.validateCompleteness(e.slider,r),o=r.min,u=r.max,a=r.steps,l=r.action,f=r.property,c=r.initialValue,h=r.title,p=r.labels,d=r.displayValue,o===undefined&&(o=0),u===undefined&&(u=10),a===undefined&&(a=10),y=$('<p class="title">'+h+"</p>"),S=$('<div class="container">'),w=$('<div class="html-slider">').attr("id",r.id),w.appendTo(S),w.slider({min:o,max:u,step:(u-o)/a}),E=w.find(".ui-slider-handle"),E.attr("tabindex",s.getNextTabIndex()),g=$('<div class="interactive-slider">').append(y).append(S),g.addClass("component");for(v=0;v<p.length;v++)m=p[v],b=$('<p class="label">'+m.label+"</p>"),b.css("left",(m.value-o)/(u-o)*100+"%"),S.append(b);return l&&(l=i.makeFunctionInScriptContext("value",l),w.bind("slide",function(e,t){l(t.value),d&&E.text(d(t.value))})),f&&w.bind("slide",function(e,t){var n={};n[f]=t.value,model&&model.set(n),d&&E.text(d(t.value))}),d&&(d=i.makeFunctionInScriptContext("value",d)),g.css({width:r.width,height:r.height}),r.width==="auto"&&g.css("min-width","12em"),x.resize(),x}}),define("common/controllers/pulldown-controller",["common/controllers/interactive-metadata","common/validator","common/jquery-plugins"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return require("common/jquery-plugins"),function(r,i,s){function p(){h=!0,a.data("selectBox-selectBoxIt").selectOption(model.get(r.property).toString())}function d(){function b(e){var t=parseFloat(n.css("font-size"));return e/t}var n=s.interactiveContainer,o,p,d,v,m,g,y;r=t.validateCompleteness(e.pulldown,r),l=r.options;for(m=0,g=l.length;m<g;m++)l[m]=t.validateCompleteness(e.pulldownOption,l[m]);a=$("<select>");for(m=0,g=l.length;m<g;m++)y=l[m],f=$("<option>").html(y.text),c.push(f),y.disabled&&f.prop("disabled",y.disabled),y.selected&&f.prop("selected",y.selected),y.value&&f.prop("value",y.value),a.append(f);a.change(function(){if(h){h=!1;return}var e=$(this).prop("selectedIndex"),t=r.options[e].action,n=r.options[e].value;t?i.makeFunctionInScriptContext(t)():r.options[e].loadModel?(model.stop(),s.loadModel(r.options[e].loadModel)):n!==undefined&&model.set(r.property,n)}),u=$("<div>").attr("id",r.id).addClass("interactive-pulldown").addClass("component"),r.label&&(o=$("<span>").text(r.label),o.addClass("label"),o.addClass(r.labelOn==="top"?"on-top":"on-left"),u.append(o)),u.append(a),a.selectBoxIt(),u.find(".selectboxit").css("width","auto"),u.find(".selectboxit-text").css("max-width","none"),p=u.measure(function(){return this.width()},"ul",n),d=u.measure(function(){return this.width()},".selectboxit-arrow-container",n),v=b(p+d)+.3+"em",u.find(".selectboxit").css("width",v),u.find(".selectboxit-text").css("max-width",b(p)+"em"),u.find(".selectboxit-container select").css({width:v,height:"100%"})}var o,u,a,f,l,c=[],h=!1;return o={modelLoadedCallback:function(){r.property!==undefined&&(model.addPropertiesListener([r.property],p),p())},getViewContainer:function(){return u},serialize:function(){var e,t;if(r.property===undefined)for(e=0,t=l.length;e<t;e++)c[e].prop("selected")?l[e].selected=!0:delete l[e].selected;return $.extend(!0,{},r)}},d(),o}}),define("common/controllers/numeric-output-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i){var s,o,u,a,f,l,c,h,p,d,v=function(){var e=model.get(s);a?c.text(a(e)):c.text(e)};return r=t.validateCompleteness(e.numericOutput,r),s=r.property,o=r.label,u=r.units,a=r.displayValue,l=$('<span class="label"></span>'),$output=$('<span class="output"></span>'),c=$('<span class="value"></span>'),h=$('<span class="units"></span>'),o&&l.html(o),u&&h.html(u),f=$('<div class="numeric-output">').attr("id",r.id).append(l).append($output.append(c).append(h)),f.addClass("component"),f.addClass(r.orientation),f.css({width:r.width,height:r.height}),a&&(a=i.makeFunctionInScriptContext("value",a)),d={modelLoadedCallback:function(){s&&(p=model.getPropertyDescription(s),p&&(o||l.html(p.getLabel()),u||h.html(p.getUnitAbbreviation())),v(),model.addPropertiesListener([s],v))},getViewContainer:function(){return f},serialize:function(){return $.extend(!0,{},r)}},d}}),define("common/parent-message-controller",[],function(){function r(e,t){Lab.structuredClone.supported()?window.parent.postMessage(e,t):window.parent.postMessage(JSON.stringify(e),t)}function i(t){r(t,e)}function s(e){r(e,"*")}function o(e,n){t[e]=n}function u(){t={}}function a(){return Object.keys(t)}function f(n){if(n.source!==window.parent)return;var r=n.data;typeof r=="string"&&(r=JSON.parse(r)),e||r.type==="hello"&&(e=r.origin),n.origin===e&&t[r.type]&&t[r.type](r)}function l(){if(window.parent===window)return;s({type:"hello",origin:document.location.href.match(/(.*?\/\/.*?)\//)[1]}),window.addEventListener("message",f,!1)}var e,t={},n;return n={initialize:l,getListenerNames:a,addListener:o,removeAllListeners:u,post:i}}),define("common/controllers/parent-message-api",["require","common/parent-message-controller"],function(e){var t=e("common/parent-message-controller");return function(e,n,r){function i(n){t.post({type:"propertyValue",name:n,values:e.get(n)})}t.removeAllListeners(),t.addListener("setFocus",function(e){n&&n.setFocus&&n.setFocus()}),t.addListener("loadInteractive",function(e){r&&r.loadInteractive&&r.loadInteractive(e.data)}),t.addListener("loadModel",function(e){r&&r.loadModel&&r.loadModel(e.data.modelId,e.data.modelObject)}),t.addListener("getModelState",function(e){r&&r.getModelController&&t.post({type:"modelState",values:r.getModelController().state()})}),t.addListener("getInteractiveState",function(e){r&&r.getModelController&&t.post({type:"interactiveState",values:r.serialize()})}),t.addListener("runBenchmarks",function(){var e;r&&r.getModelController&&(e=r.getModelController(),benchmark.bench(e.benchmarks,function(n){console.log(n),t.post({type:"returnBenchmarks",values:{results:n,benchmarks:e.benchmarks}},function(){},function(){})}))}),t.addListener("listenForDispatchEvent",function(n){var r=n.eventName,i=n.properties,s={},o=0,u=null;e.on(r,function(){if(i)for(o=0;o<i.length;o++)u=i[o],s[u]=e.get(u);t.post({type:r,values:s})})}),t.addListener("removeListenerForDispatchEvent",function(t){var n=t.eventName,r=t.properties,i={},s=0,o=null;e.on(n)}),t.addListener("get",function(e){i(e.propertyName)}),t.addListener("observe",function(t){e.addPropertiesListener(t.propertyName,function(){i(t.propertyName)}),i(t.propertyName)}),t.addListener("set",function(t){var n={};n[t.propertyName]=t.propertyValue,e.set(n)}),t.addListener("tick",function(t){e.tick(t.numTimes)}),t.addListener("play",function(t){e.resume()}),t.initialize()}}),function(e,t){typeof exports=="object"&&exports?module.exports=t:typeof define=="function"&&define.amd?define("mustache",t):e.Mustache=t}(this,function(){function u(e,t){return RegExp.prototype.test.call(e,t)}function a(e){return!u(r,e)}function l(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function h(e){return String(e).replace(/[&<>"'\/]/g,function(e){return c[e]})}function p(e){this.string=e,this.tail=e,this.pos=0}function d(e,t){this.view=e,this.parent=t,this.clearCache()}function v(){this.clearCache()}function m(e){function n(e,n,r){if(!t[e]){var i=m(n);t[e]=function(e,t){return i(e,t,r)}}return t[e]}var t={};return function(t,r,i){var s="",o,u;for(var a=0,f=e.length;a<f;++a){o=e[a];switch(o[0]){case"#":u=i.slice(o[3],o[5]),s+=t._section(o[1],r,u,n(a,o[4],i));break;case"^":s+=t._inverted(o[1],r,n(a,o[4],i));break;case">":s+=t._partial(o[1],r);break;case"&":s+=t._name(o[1],r);break;case"name":s+=t._escaped(o[1],r);break;case"text":s+=o[1]}}return s}}function g(e){var t=[],n=t,r=[],i;for(var s=0,o=e.length;s<o;++s){i=e[s];switch(i[0]){case"#":case"^":r.push(i),n.push(i),n=i[4]=[];break;case"/":var u=r.pop();u[5]=i[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}}return t}function y(e){var t=[],n,r;for(var i=0,s=e.length;i<s;++i)n=e[i],n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(r=n,t.push(n));return t}function b(e){return[new RegExp(l(e[0])+"\\s*"),new RegExp("\\s*"+l(e[1]))]}var e={};e.name="mustache.js",e.version="0.7.2",e.tags=["{{","}}"],e.Scanner=p,e.Context=d,e.Writer=v;var t=/\s*/,n=/\s+/,r=/\S/,i=/\s*=/,s=/\s*\}/,o=/#|\^|\/|>|\{|&|=|!/,f=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.escape=h,p.prototype.eos=function(){return this.tail===""},p.prototype.scan=function(e){var t=this.tail.match(e);return t&&t.index===0?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},p.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},d.make=function(e){return e instanceof d?e:new d(e)},d.prototype.clearCache=function(){this._cache={}},d.prototype.push=function(e){return new d(e,this)},d.prototype.lookup=function(e){var t=this._cache[e];if(!t){if(e===".")t=this.view;else{var n=this;while(n){if(e.indexOf(".")>0){var r=e.split("."),i=0;t=n.view;while(t&&i<r.length)t=t[r[i++]]}else t=n.view[e];if(t!=null)break;n=n.parent}}this._cache[e]=t}return typeof t=="function"&&(t=t.call(this.view)),t},v.prototype.clearCache=function(){this._cache={},this._partialCache={}},v.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},v.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},v.prototype.compileTokens=function(e,t){var n=m(e),r=this;return function(e,i){if(i)if(typeof i=="function")r._loadPartial=i;else for(var s in i)r.compilePartial(s,i[s]);return n(r,d.make(e),t)}},v.prototype.render=function(e,t,n){return this.compile(e)(t,n)},v.prototype._section=function(e,t,n,r){var i=t.lookup(e);switch(typeof i){case"object":if(f(i)){var s="";for(var o=0,u=i.length;o<u;++o)s+=r(this,t.push(i[o]));return s}return i?r(this,t.push(i)):"";case"function":var a=this,l=function(e){return a.render(e,t)},c=i.call(t.view,n,l);return c!=null?c:"";default:if(i)return r(this,t)}return""},v.prototype._inverted=function(e,t,n){var r=t.lookup(e);return!r||f(r)&&r.length===0?n(this,t):""},v.prototype._partial=function(e,t){!(e in this._partialCache)&&this._loadPartial&&this.compilePartial(e,this._loadPartial(e));var n=this._partialCache[e];return n?n(t):""},v.prototype._name=function(e,t){var n=t.lookup(e);return typeof n=="function"&&(n=n.call(t.view)),n==null?"":String(n)},v.prototype._escaped=function(t,n){return e.escape(this._name(t,n))},e.parse=function(r,u){function E(){if(m&&!w)while(v.length)d.splice(v.pop(),1);else v=[];m=!1,w=!1}r=r||"",u=u||e.tags,typeof u=="string"&&(u=u.split(n));if(u.length!==2)throw new Error("Invalid tags: "+u.join(", "));var f=b(u),c=new p(r),h=[],d=[],v=[],m=!1,w=!1,S,x,T,N;while(!c.eos()){S=c.pos,T=c.scanUntil(f[0]);if(T)for(var C=0,k=T.length;C<k;++C)N=T.charAt(C),a(N)?v.push(d.length):w=!0,d.push(["text",N,S,S+1]),S+=1,N==="\n"&&E();S=c.pos;if(!c.scan(f[0]))break;m=!0,x=c.scan(o)||"name",c.scan(t);if(x==="=")T=c.scanUntil(i),c.scan(i),c.scanUntil(f[1]);else if(x==="{"){var L=new RegExp("\\s*"+l("}"+u[1]));T=c.scanUntil(L),c.scan(s),c.scanUntil(f[1]),x="&"}else T=c.scanUntil(f[1]);if(!c.scan(f[1]))throw new Error("Unclosed tag at "+c.pos);if(x==="/"){if(h.length===0)throw new Error('Unopened section "'+T+'" at '+S);var A=h.pop();if(A[1]!==T)throw new Error('Unclosed section "'+A[1]+'" at '+S)}var O=[x,T,S,c.pos];d.push(O);if(x==="#"||x==="^")h.push(O);else if(x==="name"||x==="{"||x==="&")w=!0;else if(x==="="){u=T.split(n);if(u.length!==2)throw new Error("Invalid tags at "+S+": "+u.join(", "));f=b(u)}}var A=h.pop();if(A)throw new Error('Unclosed section "'+A[1]+'" at '+c.pos);return g(y(d))};var w=new v;return e.clearCache=function(){return w.clearCache()},e.compile=function(e,t){return w.compile(e,t)},e.compilePartial=function(e,t,n){return w.compilePartial(e,t,n)},e.compileTokens=function(e,t){return w.compileTokens(e,t)},e.render=function(e,t,n){return w.render(e,t,n)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(typeof i!="function")return s;i(s)},e}()),define("text",["module"],function(e){"use strict";var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};return t={version:"2.0.2",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+"."+s.ext,h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.moduleName+"."+o.ext,a=r.toUrl(o.moduleName+"."+o.ext)+".js";t.load(u,r,function(n){var r=function(e){return i(a,e)};r.asModule=function(e,t){return i.asModule(e,a,t)},t.write(e,u,r,s)},s)}},typeof process!="undefined"&&process.versions&&!!process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("")===0&&(r=r.substring(1)),t(r)}):typeof Packages!="undefined"&&typeof java!="undefined"?t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)}:t.createXhr()&&(t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)}),t}),define("text!common/controllers/thermometer.tpl",[],function(){return'<div class="interactive-thermometer component" id="{{id}}">\n  <div class="thermometer-main-container">\n    <div class="thermometer">\n      <div class="thermometer-fill"></div>\n    </div>\n    <p class="label">{{labelText}}</p>\n  </div>\n  <div class="labels-container">\n    {{#labels}}\n      <span class="value-label" style="bottom: {{position}}">{{label}}</span>\n    {{/labels}}\n  </div>\n</div>'}),define("common/controllers/thermometer-controller",["require","mustache","text!common/controllers/thermometer.tpl","common/controllers/interactive-metadata","common/validator","common/jquery-plugins"],function(e){var t=e("mustache"),n=e("text!common/controllers/thermometer.tpl"),r=e("common/controllers/interactive-metadata"),i=e("common/validator");return e("common/jquery-plugins"),function(s,o,u){function S(){var e,o,b,w,E,S,x,T,N,C,k,L;s=i.validateCompleteness(r.thermometer,s),e=s.reading,a=e.units,o=e.offset,b=e.scale,f=e.digits,C=s.min,N=s.max,l=function(e){return b*e+o},c=function(e){return(e-C)/(N-C)*100+"%"},h=s.labelIsReading,E=h?"":"Thermometer",w={id:s.id,labelText:h?"":"Thermometer"},S=s.labels,T=-Infinity,w.labels=[];for(k=0,L=S.length;k<L;k++)w.labels.push({label:S[k].label,position:c(l(S[k].value))}),S[k].label.length>T&&(T=S[k].label.length,x=k);d=$(t.render(n,w)),v=d.find(".thermometer"),m=d.find(".thermometer-fill"),g=d.find(".label"),y=d.find(".labels-container"),T=d.measure(function(){return this.width()/parseFloat(this.css("font-size"))+"em"},".value-label:eq("+x+")",u.interactiveContainer),y.css("width",T),d.css("height",s.height),p=!1,/%$/.test(s.width)?(d.css("width",s.width),p=!0):v.css("width",s.width)}var a,f,l,c,h,p,d,v,m,g,y,b,w=function(e){e=l(e),g.text(e.toFixed(f)+" "+a)},E=function(){var e=model.get("targetTemperature");m.css("height",c(l(e))),h&&w(e)};return b={modelLoadedCallback:function(){model.addPropertiesListener("targetTemperature",function(){E()}),E()},getViewContainer:function(){return d},resize:function(){var e=d.height()-g.height();v.height(e),y.height(e),p&&v.width(d.width()-y.width())},serialize:function(){return s}},S(),b}}),define("common/controllers/playback-controller",["require","common/inherit","common/controllers/interactive-component"],function(e){function r(e,t){n.call(this,"playback",e,t),this.$element.addClass("interactive-playback"),this._modelStopped=!0,this._showClock=!0,this._timeUnits="",this._$reset=$('<a class="reset"><i class="icon-step-backward"></i></a>').appendTo(this.$element),this._$playPause=$('<a class="play-pause"><i class="icon-play"></i><i class="icon-pause"></i></a>').appendTo(this.$element),this._$timeDisplay=$('<span class="time-display">').appendTo(this._$playPause),this._$stepBackward=$('<a class="step"><i class="icon-backward"></i></a>').insertBefore(this._$playPause),this._$stepForward=$('<a class="step"><i class="icon-forward"></i></a>').insertAfter(this._$playPause),this._$reset.after('<div class="spacer reset">'),this._$stepBackward.after('<div class="spacer step">'),this._$stepForward.before('<div class="spacer step">'),this._$reset.on("click",function(){t.api.reset()}),this._$playPause.on("click",$.proxy(function(){this._modelStopped?t.api.start():t.api.stop()},this)),this._$stepBackward.on("click",function(){t.api.stepBack()}),this._$stepForward.on("click",function(){t.api.stepForward()})}var t=e("common/inherit"),n=e("common/controllers/interactive-component");return t(r,n),r.prototype._simulationStateChanged=function(){this._modelStopped=model.is_stopped(),this._modelStopped?this._$playPause.removeClass("playing"):this._$playPause.addClass("playing")},r.prototype._showClockChanged=function(){this._showClock=model.get("showClock"),this._showClock?(this._$playPause.addClass("with-clock"),this._timeChanged()):this._$playPause.removeClass("with-clock")},r.prototype._timeChanged=function(){if(!this._showClock)return;var e=model.get("displayTime").toFixed(1);this._$timeDisplay.html(e+" "+this._timeUnits)},r.prototype._displayModeChanged=function(){var e=model.get("controlButtons"),t;e?e==="play"?(this.$element.find(".step, .reset").addClass("hidden"),this.$element.find(".play-pause").removeClass("hidden")):e==="play_reset"?(this.$element.find(".step").addClass("hidden"),this.$element.find(".play-pause, .reset").removeClass("hidden")):e==="play_reset_step"&&this.$element.find(".step, .reset, .play-pause").removeClass("hidden"):this.$element.find(".step, .reset, .play-pause").addClass("hidden"),t=this.$element.find("a"),t.removeClass("first"),t.removeClass("last"),t=t.not(".hidden"),t.first().addClass("first"),t.last().addClass("last")},r.prototype.modelLoadedCallback=function(){model.on("play."+this.component.id,$.proxy(this._simulationStateChanged,this)),model.on("stop."+this.component.id,$.proxy(this._simulationStateChanged,this)),this._simulationStateChanged(),this._timeUnits=model.getPropertyDescription("displayTime").getUnitAbbreviation(),model.addPropertiesListener(["showClock"],$.proxy(this._showClockChanged,this)),model.addPropertiesListener(["displayTime"],$.proxy(this._timeChanged,this)),this._showClockChanged(),model.addPropertiesListener(["controlButtons"],$.proxy(this._displayModeChanged,this)),this._displayModeChanged()},r}),define("common/controllers/div-controller",["require","common/inherit","common/controllers/interactive-component"],function(e){function r(e,t){n.call(this,"div",e)}var t=e("common/inherit"),n=e("common/controllers/interactive-component");return t(r,n),r}),define("common/controllers/setup-banner",["lab.config","common/controllers/text-controller","common/controllers/image-controller","common/controllers/div-controller","common/controllers/playback-controller"],function(){var e=require("lab.config"),t=require("common/controllers/text-controller"),n=require("common/controllers/image-controller"),r=require("common/controllers/div-controller"),i=require("common/controllers/playback-controller"),s=1.5,o=s*.65,u=s/10;return function(f,l,c,h,p){function w(e,s){var o;e.type==="text"?o=t:e.type==="image"?o=n:e.type==="div"?o=r:e.type==="playback"&&(o=i),d[e.id]=new o(e,f),v.push(s),m[s.id]=[e.id]}function E(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement?!0:~$(".fullscreen").css("background-image").indexOf("exit")}var d={},v=[],m={},g=l.about||l.subtitle,y,b;return v.push({id:"top-bar",top:"0",left:"0",height:s+"em","padding-top"
:u+"em","padding-bottom":u+"em",width:"container.width",aboveOthers:!0}),v.push({id:"bottom-bar",bottom:"container.height",left:"0",width:"container.width",height:"2.5em",belowOthers:!0}),h.update(l),w({type:"text",id:"about-link",text:"About",onClick:function(){g?h.open():c.open()}},{id:"banner-right",fontScale:o,top:"0",height:s+"em","padding-top":u+"em","padding-bottom":u+"em",right:"interactive.width","padding-left":"1em","padding-right":"0.75em",align:"right",aboveOthers:!0}),e.sharing&&(p.update(l),w({type:"text",id:"share-link",text:"Share",onClick:function(){p.open()}},{id:"banner-middle",fontScale:o,top:"0",height:s+"em","padding-top":u+"em","padding-bottom":u+"em",right:"banner-right.left","padding-right":"1em",align:"right",aboveOthers:!0})),c.update(l),w({type:"div",id:"credits-link",height:"2.5em",width:"8.1em",classes:["credits"],tooltip:"Credits",onClick:function(){c.open()}},{id:"banner-bottom-left",bottom:"container.height",left:"0","padding-left":"0.3em",align:"left",belowOthers:!0}),y=document.body,b=y.requestFullScreen||y.webkitRequestFullScreen||y.mozRequestFullScreen||y.msRequestFullScreen,document.cancelFullscreenMethod=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msCancelFullScreen,b&&w({type:"div",id:"fullsize-link",height:"2.5em",width:"2.5em",classes:["fullscreen"],tooltip:"Open interactive in full-screen mode",onClick:function(){E()?document.cancelFullscreenMethod():b.call(y)}},{id:"banner-bottom-right",bottom:"container.height",right:"container.width",align:"left","padding-left":"1em",belowOthers:!0}),w({type:"playback",id:"playback"},{id:"interactive-playback-container",bottom:"container.height",left:"container.width/2 - interactive-playback-container.width/2",height:"banner-bottom-left.height",belowOthers:!0}),{components:d,template:v,layout:m}}}),define("common/controllers/basic-dialog",[],function(){function t(t){this.$element=$("<div>"),this.$element.dialog($.extend({},e,t))}var e={autoOpen:!1,dialogClass:"interactive-dialog",appendTo:"#responsive-content",width:"80%"};return t.prototype.open=function(){this.$element.dialog("open")},t.prototype.set=function(e,t){this.$element.dialog("option",e,t)},t.prototype.setContent=function(e){this.$element.empty(),this.$element.append('<input type="hidden" autofocus="autofocus" />'),this.$element.append(e)},t}),define("common/controllers/about-dialog",["require","arrays","markdown","common/inherit","common/controllers/basic-dialog"],function(e){function s(){i.call(this,{dialogClass:"about-dialog"})}var t=e("arrays"),n=e("markdown"),r=e("common/inherit"),i=e("common/controllers/basic-dialog");return r(s,i),s.prototype.update=function(e){var r=$("<div>"),i,s,o,u='class="opens-in-new-window" target="blank"';this.set("title","About: "+e.title),r.addClass("markdown-typography"),e.subtitle&&(o=n.toHTML(e.subtitle),o=o.replace(/<a(.*?)>/,"<a$1 "+u+">"),r.append(o)),i=t.isArray(e.about)?e.about:[e.about],s="",$.each(i,function(e,t){s+=t+"\n"}),o=n.toHTML(s),o=o.replace(/<a(.*?)>/g,"<a$1 "+u+">"),r.append(o),this.setContent(r)},s}),define("text!common/controllers/share-dialog.tpl",[],function(){return"<div>\n  <h2>\n    Paste this\n    <a class='opens-in-new-window' href='{{embeddableSharingUrl}}' target='_blank'>link</a>\n    in email or IM.\n  </h2>\n  <textarea>{{embeddableSharingUrl}}</textarea>\n  <h2>Paste HTML to embed in website or blog.</h2>\n  <p>Select Size:\n    <select id='iframe-size'>\n      <option value='smaller'>30% smaller</option>\n      <option selected value='actual'>actual</option>\n      <option value='larger'>50% larger</option>\n    </select>\n  </p>\n  <textarea id='share-iframe-content'></textarea>\n  {{> copyright}}\n</div>\n"}),define("text!common/controllers/copyright.tpl",[],function(){return'<div class="copyright-section"><strong>Copyright  2013&nbsp;</strong><a class="opens-in-new-window" href="http://concord.org" id="share-license-link" target="_blank">The Concord Consortium</a>. All rights reserved. The software is licensed under&nbsp;<a class="opens-in-new-window" href="http://opensource.org/licenses/BSD-2-Clause" id="share-license-link" target="_blank">Simplified BSD</a>, <a class="opens-in-new-window" href="http://opensource.org/licenses/MIT" id="share-license-link" target="_blank">MIT</a> or <a class="opens-in-new-window" href="http://opensource.org/licenses/Apache-2.0" id="share-license-link" target="_blank">Apache 2.0</a> licenses. Please provide attribution to the Concord Consortium and the URL&nbsp;<a class="opens-in-new-window" href="http://concord.org/" id="share-license-link" target="_blank">http://concord.org</a>.</div>'}),define("common/controllers/share-dialog",["require","lab.config","mustache","common/inherit","common/controllers/basic-dialog","text!common/controllers/share-dialog.tpl","text!common/controllers/copyright.tpl"],function(e){function f(){var e=u.hash,r=u.href.match(/(.*?\/\/.*?)\//)[1],a=u.pathname.replace(/\/[^\/]+$/,"/embeddable.html");i.call(this,{dialogClass:"share-dialog"}),this._view={},t.homeForSharing?this._view.embeddableSharingUrl=t.homeForSharing+t.homeEmbeddablePath+e:this._view.embeddableSharingUrl=r+a+e,this.setContent(n.render(s,this._view,{copyright:o})),this._$interactiveContainer=$("#responsive-content"),this._$iframeSize=this.$element.find("#iframe-size"),this._$iframeContent=this.$element.find("#share-iframe-content"),this._$iframeSize.on("change",$.proxy(this.updateIframeSize,this)),this.updateIframeSize()}var t=e("lab.config"),n=e("mustache"),r=e("common/inherit"),i=e("common/controllers/basic-dialog"),s=e("text!common/controllers/share-dialog.tpl"),o=e("text!common/controllers/copyright.tpl"),u=document.location,a=n.compile('<iframe width="{{width}}px" height="{{height}}px" frameborder="no" scrolling="no" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true" src="{{{embeddableSharingUrl}}}"></iframe>');return r(f,i),f.prototype.updateIframeSize=function(){var e=this._$interactiveContainer.innerWidth(),t=this._$interactiveContainer.innerHeight(),n=this._$iframeSize.val();switch(n){case"smaller":this._view.width=Math.floor(e*.7),this._view.height=Math.floor(t*.7);break;case"larger":this._view.width=Math.floor(e*1.5),this._view.height=Math.floor(t*1.5);break;default:this._view.width=e,this._view.height=t}this._$iframeContent.val(a(this._view))},f.prototype.update=function(e){this.set("title","Share: "+e.title)},f}),define("text!common/controllers/credits-dialog.tpl",[],function(){return'<div>\n  <p>\n    This interactive was created by the <a href="{{concordUrl}}" target="_blank">Concord Consortium</a>\n    using our <a href="{{nextGenUrl}}" target="_blank">Next-Generation Molecular Workbench</a> software,\n    with funding by a grant from <a href="http://www.google.org/" target="_blank">Google.org</a>.\n   </p>\n   {{#showShareable}}\n   <p>\n      Find a <a href="{{interactiveCreditsUrl}}" class="opens-in-new-window" target="_blank">shareable version</a>\n      of this interactive along with dozens of other open-source interactives for science, math and engineering at\n      <a href="{{concordUrl}}" class="opens-in-new-window" target="_blank">concord.org</a>.\n    </p>\n    {{/showShareable}}\n  {{> copyright}}\n</div>\n'}),define("common/controllers/credits-dialog",["require","lab.config","mustache","common/inherit","common/controllers/basic-dialog","text!common/controllers/credits-dialog.tpl","text!common/controllers/copyright.tpl"],function(e){function u(){i.call(this,{dialogClass:"credits-dialog"})}var t=e("lab.config"),n=e("mustache"),r=e("common/inherit"),i=e("common/controllers/basic-dialog"),s=e("text!common/controllers/credits-dialog.tpl"),o=e("text!common/controllers/copyright.tpl");return r(u,i),u.prototype.update=function(e){var r={concordUrl:"http://concord.org",nextGenUrl:"http://mw.concord.org/nextgen/"},i=document.location.hash,u;this.set("title","Credits: "+e.title),t.homeForSharing?r.interactiveCreditsUrl=t.homeForSharing+t.homeEmbeddablePath+i:r.interactiveCreditsUrl=t.home+t.homeEmbeddablePath+i,t.utmCampaign&&(u="utm_source="+encodeURIComponent(e.title.replace(/ /gi,"+"))+"&utm_medium=embedded_interactive&utm_campaign="+t.utmCampaign,r.concordUrl+="?"+u,r.nextGenUrl+="?"+u,r.interactiveCreditsUrl+="&"+encodeURI("utm_source=embed_link&utm_medium=embedded_interactive&utm_campaign="+t.utmCampaign)),t.sharing||(r.showShareable=!0),this.setContent(n.render(s,r,{copyright:o}))},u}),define("common/layout/semantic-layout-config",[],function(){return{iterationsLimit:35,minModelWidth:150,minFontSize:.65,canonicalFontSize:.9,canonicalInteractiveWidth:588,canonicalInteractiveHeight:414,containerColors:["rgba(0,0,255,0.1)","rgba(255,0,0,0.1)","rgba(0,255,0,0.1)","rgba(255,255,0,0.1)","rgba(0,255,255,0.1)","rgba(255,255,128,0.1)","rgba(128,255,0,0.1)","rgba(255,128,0,0.1)"]}}),define("common/layout/semantic-layout",["require","lab.config","common/layout/semantic-layout-config","arrays","common/console","common/alert"],function(require){var labConfig=require("lab.config"),layoutConfig=require("common/layout/semantic-layout-config"),arrays=require("arrays"),console=require("common/console"),alert=require("common/alert");return function SemanticLayout($interactiveContainer){function reset(){modelWidth=layoutConfig.minModelWidth,modelTop=0,modelLeft=0,topBoundary=0,leftBoundary=0,bottomBarWidth=0}function getDimensionOfContainer(e,t){var n=e.position();switch(t){case"top":return n.top;case"bottom":return n.top+e.outerHeight();case"left":return n.left;case"right":return n.left+e.outerWidth();case"height":return e.outerHeight();case"width":return e.outerWidth()}}function setFontSize(){var e=$interactiveContainer.width()/$interactiveContainer.height(),t,n;interactiveAspectRatio<=e?t=$interactiveContainer.height()/basicInteractiveHeight:t=$interactiveContainer.width()/basicInteractiveWidth,padding=t*10,n=layoutConfig.canonicalFontSize*fontScale*t,n<layoutConfig.minFontSize&&(n=layoutConfig.minFontSize),$("#responsive-content").css("font-size",n+"em")}function setupBackground(){var e=layoutConfig.containerColors,t,n,r;for(n=0,r=containerSpecList.length;n<r;n++)t=containerSpecList[n].id,$containerByID[t].css("background",labConfig.authoring?e[n%e.length]:"")}function createContainers(){var e,t,n,r,i;$interactiveContainer.empty(),$containerByID={},containerSpecByID={};for(r=0,i=containerSpecList.length;r<i;r++){e=containerSpecList[r],t=e.id,containerSpecByID[t]=e,$containerByID[t]=$("<div id='"+t+"'>").appendTo($interactiveContainer),$containerByID[t].css({display:"inline-block",position:"absolute","z-index":"1"}),e.width===undefined&&$containerByID[t].css("white-space","nowrap");for(n in e){if(!e.hasOwnProperty(n))continue;/^padding-/.test(n)?$containerByID[t].css(n,e[n]):n==="align"?$containerByID[t].css("text-align",e[n]):n==="min-width"?$containerByID[t].css("min-width",e[n]):n==="fontScale"&&$containerByID[t].css("font-size",e[n]+"em")}}}function placeComponentsInContainers(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;a=$.extend({},componentByID);for(t in containersContent){if(!containersContent.hasOwnProperty(t))continue;if(!$containerByID[t]){f="Incorrect layout definition - '"+t+"' container does not exist.",alert(f);continue}n=containersContent[t];if(!arrays.isArray(n)){f="Incorrect layout definition for '"+t+"' container. It should specify "+"an array of components or an array of arrays of components (multiple rows).",alert(f);continue}arrays.isArray(n[0])||(n=[n]);for(h=0,p=n.length;h<p;h++){r=n[h],i=$('<div class="interactive-row"/>'),i.css("width","100%"),p===1&&i.css("height","100%"),$containerByID[t].append(i);for(d=0,v=r.length;d<v;d++){e=r[d];if(a[e]===undefined){alert("Incorrect layout definition. Component with ID '"+e+"'' is not defined.");continue}i.append(a[e].getViewContainer()),delete a[e]}}}u=containerSpecByID.bottom||containerSpecList[containerSpecList.length-1],s=$containerByID[u.id].children(),i=s.last(),i.length||(i=$('<div class="interactive-row"/>'),$containerByID[u.id].append(i));for(e in a){if(!a.hasOwnProperty(e))continue;i.append(a[e].getViewContainer())}for(l=0,c=containerSpecList.length;l<c;l++)o=$containerByID[containerSpecList[l].id].children().children(),o.length>1&&o.addClass("component-spacing")}function positionContainers(){var e,t,n,r,i,s,o,u,a,f;$modelContainer.css({width:modelWidth,height:modelController.getHeightForWidth(modelWidth),left:modelLeft,top:modelTop});for(u=0,a=containerSpecList.length;u<a;u++)e=containerSpecList[u],t=$containerByID[e.id],!e.left&&!e.right&&(e.left="0"),!e.top&&!e.bottom&&(e.top="0"),e.left&&(n=parseDimension(e.left),t.css("left",n)),e.top&&(r=parseDimension(e.top),t.css("top",r)),e.height&&t.css("height",parseDimension(e.height)),e.width&&t.css("width",parseDimension(e.width)),e.right&&(i=parseDimension(e.right),n=i-t.outerWidth(),t.css("left",n)),e.bottom&&(s=parseDimension(e.bottom),r=s-t.outerHeight(),t.css("top",r)),e.aboveOthers&&(s=getDimensionOfContainer(t,"bottom")+padding,s>topBoundary&&(topBoundary=s)),e.belowOthers&&(o=getDimensionOfContainer(t,"height"),o>bottomBarWidth&&(bottomBarWidth=o));leftBoundary=padding;for(f in $containerByID){if(!$containerByID.hasOwnProperty(f))continue;if(containerSpecByID[f]&&containerSpecByID[f].aboveOthers)continue;if(containerSpecByID[f]&&containerSpecByID[f].belowOthers)continue;t=$containerByID[f],r=getDimensionOfContainer(t,"top"),t.css("top",r+topBoundary),n=getDimensionOfContainer(t,"left"),t.css("left",n+leftBoundary)}}function resizeModelContainer(){var e=-Infinity,t=-Infinity,n=Infinity,r=Infinity,i,s,o,u,a,f,l;for(i in $containerByID){if(!$containerByID.hasOwnProperty(i))continue;if(containerSpecByID[i]&&containerSpecByID[i].aboveOthers)continue;if(containerSpecByID[i]&&containerSpecByID[i].belowOthers)continue;s=$containerByID[i],o=getDimensionOfContainer(s,"right"),o>e&&(e=o),u=getDimensionOfContainer(s,"bottom"),u>t&&(t=u),f=getDimensionOfContainer(s,"left"),f<n&&(n=f),a=getDimensionOfContainer(s,"top"),a<r&&(r=a)}return e<=availableWidth&&t<=availableHeight-bottomBarWidth&&(Math.abs(availableWidth-e)<1||Math.abs(availableHeight-bottomBarWidth-t)<1)&&Math.abs(n-leftBoundary)<1&&Math.abs(r-topBoundary)<1?!0:(l=Math.min(availableWidth/e,(availableHeight-bottomBarWidth)/t),isNaN(l)||(modelWidth*=l),modelWidth<layoutConfig.minModelWidth&&(modelWidth=layoutConfig.minModelWidth),modelLeft-=n-leftBoundary,modelTop-=r-topBoundary,!1)}function parseDimension(dim){var vars,i,ii,value;if(typeof dim=="number"||/^[0-9]+\.?[0-9]*(em)?$/.test(dim))return dim;vars=dim.match(/[a-zA-Z\-]+\.[a-zA-Z]+/g);for(i=0,ii=vars.length;i<ii;i++)value=getDimension(vars[i]),dim=dim.replace(vars[i],value);return/^[^a-zA-Z]*$/.test(dim)?eval(dim):0}function getDimension(e){switch(e){case"container.width":return availableWidth;case"container.height":return availableHeight+padding;case"interactive.width":return availableWidth-padding;case"interactive.height":return availableHeight-padding*2-bottomBarWidth;default:return e=e.split("."),getDimensionOfContainer($containerByID[e[0]],e[1])}}function calcInteractiveAspectRatio(){var e=layoutConfig.iterationsLimit,t=layoutConfig.canonicalInteractiveWidth,n=layoutConfig.canonicalInteractiveHeight,r=t/n,i=-Infinity,s=-Infinity,o,u,a;reset(),availableWidth=t,availableHeight=n-bottomBarWidth-padding,modelWidth=availableWidth,basicInteractiveWidth=t,basicInteractiveHeight=n,setFontSize(),positionContainers();while(--e>0&&!resizeModelContainer())positionContainers();console.log("[layout] aspect ratio calc: "+(layoutConfig.iterationsLimit-e)+" iterations");for(o in $containerByID){if(!$containerByID.hasOwnProperty(o))continue;u=$containerByID[o],a=getDimensionOfContainer(u,"right"),a>i&&(i=a),a=getDimensionOfContainer(u,"bottom"),a>s&&(s=a)}interactiveAspectRatio=i/s,interactiveAspectRatio<r?(basicInteractiveWidth=n*interactiveAspectRatio,basicInteractiveHeight=n):(basicInteractiveWidth=t,basicInteractiveHeight=t/interactiveAspectRatio)}var layout,containerSpecList,containersContent,componentByID,modelController,fontScale,containerSpecByID,$containerByID,$modelContainer,basicInteractiveWidth,basicInteractiveHeight,interactiveAspectRatio,availableWidth,availableHeight,padding=10,modelWidth,modelTop,modelLeft,topBoundary,leftBoundary,bottomBarWidth;return layout={initialize:function(e,t,n,r){containerSpecList=e,containersContent=t,componentByID=n,fontScale=r,createContainers(),placeComponentsInContainers(),interactiveAspectRatio=null},setupModel:function(e){modelController=e,interactiveAspectRatio=null;if($containerByID.model){if($containerByID.model===modelController.getViewContainer())return;$containerByID.model.remove()}$modelContainer=modelController.getViewContainer(),$modelContainer.css({display:"inline-block",position:"absolute","z-index":"0"}),$modelContainer.appendTo($interactiveContainer),$containerByID.model=$modelContainer},layoutInteractive:function(){var e=layoutConfig.iterationsLimit,t;console.time("[layout] update"),interactiveAspectRatio||calcInteractiveAspectRatio(),reset(),availableWidth=$interactiveContainer.width(),availableHeight=$interactiveContainer.height()-bottomBarWidth-padding,modelWidth=availableWidth,setFontSize(),positionContainers();while(--e>0&&!resizeModelContainer())positionContainers();console.log("[layout] update: "+(layoutConfig.iterationsLimit-e)+" iterations"),modelController.resize();for(t in componentByID)componentByID.hasOwnProperty(t)&&componentByID[t].resize!==undefined&&componentByID[t].resize();setupBackground(),console.timeEnd("[layout] update")}},layout}}),define("common/layout/templates",[],function(){return{simple:[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"narrow-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width / 4","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"wide-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}]}}),define("common/controllers/model-controller",["require","arrays"],function(e){var t=e("arrays");return function(n,r,i,s,o,u,a,f,l){function v(){c.modelContainer.update()}function m(){var e=function(n,r){var i;for(i in n)r[i]===undefined?t.isArray(n[i])?r[i]=$.extend(!0,[],n[i]):typeof n[i]=="object"?r[i]=$.extend(!0,{},n[i]):r[i]=n[i]:typeof r[i]=="object"&&!(r[i]instanceof Array)&&(r[i]=e(n[i],r[i]));return r};d=$.extend(!0,{},i),d=e(r.viewOptions||{},d),p=$.extend(!0,{},s),p=e(r||{},p),p.viewOptions=d}function g(){c.benchmarks=new l(c)}function y(){m(),model=new u(p),model.resetTime(),model.on("tick",v)}function b(){c.modelContainer=new a(c.modelUrl,model,o.getNextTabIndex)}function w(){c.modelContainer.reset(c.modelUrl,model)}function E(e,t,n,o){c.modelUrl=e||c.modelUrl,r=t||r,i=n||i,s=o||s,y(),w(),h.modelReset()}function S(){c.modelContainer.repaint()}function x(){c.modelContainer.resize()}function T(){return model.serialize()}var c={},h=d3.dispatch("modelReset"),p,d;c.on=function(e,t){h.on(e,t)},c.getViewContainer=function(){return c.modelContainer.$el},c.getHeightForWidth=function(e){return c.modelContainer.getHeightForWidth(e)},c.enableKeyboardHandlers=function(){return model.get("enableKeyboardHandlers")},c.reload=E,c.repaint=S,c.resize=x,c.state=T,c.ScriptingAPI=f,c.modelContainer=null,c.benchmarks=null,c.type=u.type,c.modelUrl=n;if(typeof DEVELOPMENT=="undefined")try{y()}catch(N){throw alert(N),new Error(N)}else y();return g(),b(),h.modelReset(),c}}),define("common/performance",[],function(){var e;return typeof performance!="undefined"&&typeof performance.now!="undefined"?e=$.proxy(performance.now,performance):e=$.proxy(Date.now,Date),{now:e}}),define("common/array-types",["require","arrays"],function(e){var t=e("arrays"),n=function(){if(typeof navigator=="undefined")return!0;var e=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,t=navigator.userAgent.match(e);return!t||!t[3]}(),r=t.typed&&n;return{floatType:r?"Float32Array":"regular",int32Type:r?"Int32Array":"regular",int16Type:r?"Int16Array":"regular",int8Type:r?"Int8Array":"regular",uint16Type:r?"Uint16Array":"regular",uint8Type:r?"Uint8Array":"regular"}}),define("md2d/models/engine/constants/units",["require","exports","module"],function(e,t,n){var r=1.66054e-27,i=1.602177e-19,s=i,o=1e-15,u=1e-9,a=10,f=1e3,l={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},c,h,p;t.unit=c={FEMTOSECOND:{name:"femtosecond",value:1,type:l.TIME},SECOND:{name:"second",value:o,type:l.TIME},NANOMETER:{name:"nanometer",value:1,type:l.LENGTH},ANGSTROM:{name:"Angstrom",value:1*a,type:l.LENGTH},METER:{name:"meter",value:1*u,type:l.LENGTH},DALTON:{name:"Dalton",value:1,type:l.MASS},GRAM:{name:"gram",value:1*r*f,type:l.MASS},KILOGRAM:{name:"kilogram",value:1*r,type:l.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:l.ENERGY},JOULE:{name:"Joule",value:r*u*u*(1/o)*(1/o),type:l.ENERGY},EV:{name:"electron volt",value:r*u*u*(1/o)*(1/o)*(1/s),type:l.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:l.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*s,type:l.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:l.CHARGE},COULOMB:{name:"Coulomb",value:i,type:l.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:l.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:l.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:l.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:l.FORCE},NEWTON:{name:"Newton",value:1*r*u*(1/o)*(1/o),type:l.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*r*u*u*(1/o)*(1/o)*(1/s),type:l.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:l.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*u*(1/o),type:l.VELOCITY}},t.ratio=h=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=p=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*h(r,{per:n})}}),define("md2d/models/engine/constants/index",["require","exports","module","./units"],function(e,t,n){var r=e("./units"),i=r.unit,s=r.ratio,o=r.convert,u={ELEMENTARY_CHARGE:{value:1,unit:i.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:i.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:i.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:s(i.DALTON,{per:i.GRAM}),unit:i.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:i.FARADS_PER_METER}},a,f;u.COULOMB_CONSTANT={value:1/(4*Math.PI*u.PERMITTIVITY_OF_FREE_SPACE.value),unit:i.METERS_PER_FARAD},t.unit=i,t.ratio=s,t.convert=o;for(a in u)u.hasOwnProperty(a)&&(f=u[a],t[a]=function(e){return{as:function(t){return r.convert(e.value,{from:e.unit,to:t})}}}(f))}),define("cs",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("md2d/models/aminoacids-props",[],function(){return[{fullName:"Alanine",abbreviation:"Ala",symbol:"A",molWeight:89.09,charge:0,hydrophobicityRB:2.15,pK:0,surface:115,volume:88.6,solubility:16.65,hydrophobicity:1,property:"Total aliphatic; hydrophobic"},{fullName:"Arginine",abbreviation:"Arg",symbol:"R",molWeight:174.2,charge:1,hydrophobicityRB:2.23,pK:12,surface:225,volume:173.4,solubility:15,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Asparagine",abbreviation:"Asn",symbol:"N",molWeight:132.12,charge:0,hydrophobicityRB:1.05,pK:0,surface:160,volume:114.1,solubility:3.53,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Asparticacid",abbreviation:"Asp",symbol:"D",molWeight:133.1,charge:-1,hydrophobicityRB:1.13,pK:4.4,surface:150,volume:111.1,solubility:.778,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Cysteine",abbreviation:"Cys",symbol:"C",molWeight:121.15,charge:0,hydrophobicityRB:1.2,pK:8.5,surface:135,volume:108.5,solubility:1e3,hydrophobicity:1,property:"Polar side chains; semipolar"},{fullName:"Glutamine",abbreviation:"Gln",symbol:"Q",molWeight:146.15,charge:0,hydrophobicityRB:1.65,pK:0,surface:180,volume:143.8,solubility:2.5,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Glutamicacid",abbreviation:"Glu",symbol:"E",molWeight:147.13,charge:-1,hydrophobicityRB:1.73,pK:4.4,surface:190,volume:138.4,solubility:.864,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Glycine",abbreviation:"Gly",symbol:"G",molWeight:75.07,charge:0,hydrophobicityRB:1.18,pK:0,surface:75,volume:60.1,solubility:24.99,hydrophobicity:1,property:"Semipolar"},{fullName:"Histidine",abbreviation:"His",symbol:"H",molWeight:155.16,charge:1,hydrophobicityRB:2.45,pK:6.5,surface:195,volume:153.2,solubility:4.19,hydrophobicity:-2,property:"Basic side chains; strongly polar; cationic"},{fullName:"Isoleucine",abbreviation:"Ile",symbol:"I",molWeight:131.17,charge:0,hydrophobicityRB:3.88,pK:0,surface:175,volume:166.7,solubility:4.117,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Leucine",abbreviation:"Leu",symbol:"L",molWeight:131.17,charge:0,hydrophobicityRB:4.1,pK:10,surface:170,volume:166.7,solubility:2.426,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Lysine",abbreviation:"Lys",symbol:"K",molWeight:146.19,charge:1,hydrophobicityRB:3.05,pK:0,surface:200,volume:168.6,solubility:1e3,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Methionine",abbreviation:"Met",symbol:"M",molWeight:149.21,charge:0,hydrophobicityRB:3.43,pK:0,surface:185,volume:162.9,solubility:3.81,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Phenylalanine",abbreviation:"Phe",symbol:"F",molWeight:165.19,charge:0,hydrophobicityRB:3.46,pK:0,surface:210,volume:189.9,solubility:2.965,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Proline",abbreviation:"Pro",symbol:"P",molWeight:115.13,charge:0,hydrophobicityRB:3.1,pK:0,surface:145,volume:112.7,solubility:162.3,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Serine",abbreviation:"Ser",symbol:"S",molWeight:105.09,charge:0,hydrophobicityRB:1.4,pK:0,surface:115,volume:89,solubility:5.023,hydrophobicity:-1,property:"Semipolar"},{fullName:"Threonine",abbreviation:"Thr",symbol:"T",molWeight:119.12,charge:0,hydrophobicityRB:2.25,pK:0,surface:140,volume:116.1,solubility:1e3,hydrophobicity:-1,property:"Semipolar"},{fullName:"Tryptophan",abbreviation:"Trp",symbol:"W",molWeight:204.23,charge:0,hydrophobicityRB:4.11,pK:0,surface:255,volume:227.8,solubility:1.136,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Tyrosine",abbreviation:"Tyr",symbol:"Y",molWeight:181.19,charge:0,hydrophobicityRB:2.81,pK:10,surface:230,volume:193.6,solubility:.045,hydrophobicity:1,property:"Hydrophobic; total aromatic"},{fullName:"Valine",abbreviation:"Val",symbol:"V",molWeight:117.15,charge:0,hydrophobicityRB:3.38,pK:0,surface:155,volume:140,solubility:8.85,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"}]}),function(){define("cs!md2d/models/aminoacids-helper",["require","md2d/models/aminoacids-props"],function(e){var t,n,r;return r=e("md2d/models/aminoacids-props"),t=5,n={UUU:"Phe",UUC:"Phe",UUA:"Leu",UUG:"Leu",CUU:"Leu",CUC:"Leu",CUA:"Leu",CUG:"Leu",AUU:"Ile",AUC:"Ile",AUA:"Ile",AUG:"Met",GUU:"Val",GUC:"Val",GUA:"Val",GUG:"Val",UCU:"Ser",UCC:"Ser",UCA:"Ser",UCG:"Ser",AGU:"Ser",AGC:"Ser",CCU:"Pro",CCC:"Pro",CCA:"Pro",CCG:"Pro",ACU:"Thr",ACC:"Thr",ACA:"Thr",ACG:"Thr",GCU:"Ala",GCC:"Ala",GCA:"Ala",GCG:"Ala",UAU:"Tyr",UAC:"Tyr",CAU:"His",CAC:"His",CAA:"Gln",CAG:"Gln",AAU:"Asn",AAC:"Asn",AAA:"Lys",AAG:"Lys",GAU:"Asp",GAC:"Asp",GAA:"Glu",GAG:"Glu",UGU:"Cys",UGC:"Cys",UGG:"Trp",CGU:"Arg",CGC:"Arg",CGA:"Arg",CGG:"Arg",AGA:"Arg",AGG:"Arg",GGU:"Gly",GGC:"Gly",GGA:"Gly",GGG:"Gly",UAA:"STOP",UAG:"STOP",UGA:"STOP"},{firstElementID:t,lastElementID:t+r.length-1,cysteineElement:9,abbrToElement:function(e){var t,n,i,s;for(n=i=0,s=r.length;i<s;n=++i){t=r[n];if(t.abbreviation===e)return n+this.firstElementID}},getAminoAcidByElement:function(e){return r[e-this.firstElementID]},isAminoAcid:function(e){return e>=this.firstElementID&&e<=this.lastElementID},getPolarAminoAcids:function(){var e,t,n,r,i;r=["Asn","Gln","Ser","Thr"],i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.abbrToElement(e));return i},codonToAbbr:function(e){return n[e]}}})}.call(this),define("md2d/models/engine/math/distributions",["require","exports","module"],function(e,t,n){t.normal=function(){var e=null;return function(t,n){t==null&&(t=0),n==null&&(n=1);var r,i,s,o,u;return e?(i=e,e=null,i):(o=Math.random(),u=Math.random(),s=2*Math.PI*o,r=Math.sqrt(-2*Math.log(u)),e=t+n*r*Math.sin(s),t+n*r*Math.cos(s))}}()}),define("md2d/models/engine/math/utils",["require","exports","module"],function(e,t,n){t.getWindowedAverager=function(e){e==null&&(e=1e3);var t=0,n=[],r=0;return function(s){return r-=n[t]||0,r+=s,n[t]=s,++t===e&&(t=0),n.length===e?r/e:NaN}}}),define("md2d/models/engine/math/minimizer",["require","exports","module","common/console"],function(e,t,n){var r=e("common/console");t.minimize=function(e,t,n){n=n||{},n.precision==null&&(n.precision=.01);var i=n.precision,s=n.bounds,o=n.maxiter||1e3,u=n.stopval||-Infinity,a=n.maxstep||.01,f=n.eps||.01,l=t.length,c,h,p,d,v,m,g,y,b,w;m=a*a,c=[];for(b=0;b<l;b++)c[b]=t[b];h=e.apply(null,c),p=h[0],v=h[1],y=0;do{if(p<=u)break;if(y>o)return r.log("maxiter reached"),{error:"maxiter reached",f:p,iter:o,x:c};g=0;for(b=0;b<l;b++)g+=v[b]*v[b];if(f*f*g>m){w=Math.sqrt(m/g)/f;for(b=0;b<l;b++)v[b]=w*v[b]}for(b=0;b<l;b++)c[b]-=f*v[b],s&&c[b]<s[b][0]&&(c[b]=s[b][0]),s&&c[b]>s[b][1]&&(c[b]=s[b][1]);d=p,h=e.apply(null,c),p=h[0],v=h[1],y++}while(Math.abs(p-d)>i);return[p,c]}}),define("md2d/models/engine/math/index",["require","exports","module","./distributions","./utils","./minimizer"],function(e,t,n){t.normal=e("./distributions").normal,t.getWindowedAverager=e("./utils").getWindowedAverager,t.minimize=e("./minimizer").minimize}),define("md2d/models/engine/potentials/coulomb",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,s=.346,o=r.COULOMB_CONSTANT.as(r.unit.METERS_PER_FARAD),u=r.ratio(i.NANOMETER,{per:i.METER}),a=Math.pow(r.ratio(i.COULOMB,{per:i.ELEMENTARY_CHARGE}),2),f=r.ratio(i.EV,{per:i.JOULE}),l=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON}),c=s*o*a*u*f,h=s*o*a*u*u*l,p=t.potential=function(e,t,n,r,i){return i&&r>1&&e<1.2&&(r=1+(r-1)/(1+Math.exp(-12*e+7))),c*(t*n/e)/r},d=t.forceFromSquaredDistance=function(e,t,n,r,i){var s=Math.sqrt(e);return i&&r>1&&s<1.2&&(r=1+(r-1)/(1+Math.exp(-12*s+7))),-h*(t*n/e)/r},v=t.forceOverDistanceFromSquaredDistance=function(e,t,n,r,i){return d(e,t,n,r,i)/Math.sqrt(e)},m=t.force=function(e,t,n,r,i){return d(e*e,t,n,r,i)}}),define("md2d/models/engine/potentials/lennard-jones",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,s=r.ratio(i.NANOMETER,{per:i.METER}),o=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON});t.pairwiseEpsilon=function(e,t){return.5*(e+t)},t.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},t.rmin=function(e){return Math.pow(2,1/6)*e},t.radius=function(e){return.5*e},t.newLJCalculator=function(e,n){var u,a,f,l,c,h,p,d=!1,v=function(e,v){u=e,a=v,f=t.rmin(a),u!=null&&a!=null&&(l=4*u*Math.pow(a,12),c=4*u*Math.pow(a,6),h=12*r.convert(l,{from:i.EV,to:i.JOULE})*s*o,p=6*r.convert(c,{from:i.EV,to:i.JOULE})*s*o),d&&typeof n=="function"&&n(m(),this)},m=function(){return{epsilon:u,sigma:a,rmin:f}},g=function(e){if(e==null||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},y=function(e){if(e==null||parseFloat(e)!==e||e<=0)throw new Error("lennardJones: sigma value "+
e+" is invalid")},b;return g(e.epsilon),y(e.sigma),v(e.epsilon,e.sigma),d=!0,b={getCoefficients:m,setEpsilon:function(e){g(e),v(e,a)},setSigma:function(e){y(e),v(u,e)},potentialFromSquaredDistance:function(e){return e?l*Math.pow(e,-6)-c*Math.pow(e,-3):-Infinity},potential:function(e){return b.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return h*i-p*r},force:function(e){return e*b.forceOverDistanceFromSquaredDistance(e*e)}}}}),define("md2d/models/engine/potentials/index",["require","exports","module","./coulomb","./lennard-jones"],function(e,t,n){t.coulomb=e("./coulomb"),t.lennardJones=e("./lennard-jones")}),define("md2d/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"md2d",immutable:!0},imagePath:{defaultValue:"",immutable:!0},minX:{defaultValue:0,serialize:!1},maxX:{defaultValue:10,serialize:!1},minY:{defaultValue:0,serialize:!1},maxY:{defaultValue:10,serialize:!1},width:{defaultValue:10,unitType:"length",immutable:!0},height:{defaultValue:10,unitType:"length",immutable:!0},unitsScheme:{defaultValue:"md2d"},lennardJonesForces:{defaultValue:!0},coulombForces:{defaultValue:!0},temperatureControl:{defaultValue:!1},targetTemperature:{defaultValue:300,unitType:"temperature"},modelSampleRate:{defaultValue:"default"},gravitationalField:{defaultValue:!1,unitType:"acceleration"},timeStep:{defaultValue:1,unitType:"time"},dielectricConstant:{defaultValue:1},realisticDielectricEffect:{defaultValue:!0},solventForceFactor:{defaultValue:1.25},solventForceType:{defaultValue:0},additionalSolventForceMult:{defaultValue:4},additionalSolventForceThreshold:{defaultValue:10,unitType:"length"},polarAAEpsilon:{defaultValue:-2},viscosity:{defaultValue:1},timeStepsPerTick:{defaultValue:50}},viewOptions:{viewPortWidth:{defaultValue:10,unitType:"length",immutable:!0},viewPortHeight:{defaultValue:10,unitType:"length",immutable:!0},viewPortX:{defaultValue:0,unitType:"length",immutable:!0},viewPortY:{defaultValue:0,unitType:"length",immutable:!0},backgroundColor:{defaultValue:"#eeeeee"},showClock:{defaultValue:!0},markColor:{defaultValue:"#f8b500"},keShading:{defaultValue:!1},chargeShading:{defaultValue:!1},useThreeLetterCode:{defaultValue:!0},aminoAcidColorScheme:{defaultValue:"hydrophobicity"},showChargeSymbols:{defaultValue:!0},showVDWLines:{defaultValue:!1},VDWLinesCutoff:{defaultValue:"medium"},showVelocityVectors:{defaultValue:!1},showForceVectors:{defaultValue:!1},showAtomTrace:{defaultValue:!1},atomTraceId:{defaultValue:0},images:{defaultValue:[]},imageMapping:{defaultValue:{}},textBoxes:{defaultValue:[]},xlabel:{defaultValue:!1},ylabel:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},controlButtons:{defaultValue:"play"},gridLines:{defaultValue:!1},atomNumbers:{defaultValue:!1},enableAtomTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},atomTraceColor:{defaultValue:"#6913c5"},velocityVectors:{defaultValue:{color:"#000",width:.01,length:2}},forceVectors:{defaultValue:{color:"#169C30",width:.01,length:2}}},atom:{x:{required:!0,unitType:"length"},y:{required:!0,unitType:"length"},element:{defaultValue:0},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},ax:{defaultValue:0,unitType:"acceleration",serialize:!1},ay:{defaultValue:0,unitType:"acceleration",serialize:!1},charge:{defaultValue:0,unitType:"charge"},friction:{defaultValue:0,unitType:"dampingCoefficient"},visible:{defaultValue:1},pinned:{defaultValue:0},marked:{defaultValue:0},draggable:{defaultValue:0},radius:{readOnly:!0,unitType:"length",serialize:!1},px:{readOnly:!0,unitType:"momentum",serialize:!1},py:{readOnly:!0,unitType:"momentum",serialize:!1},speed:{readOnly:!0,unitType:"velocity",serialize:!1}},element:{mass:{defaultValue:120,unitType:"mass"},sigma:{defaultValue:.3,unitType:"length"},epsilon:{defaultValue:-0.1,unitType:"energy"},radius:{unitType:"length",readOnly:!0,serialize:!1},color:{defaultValue:-855310}},pairwiseLJProperties:{element1:{defaultValue:0},element2:{defaultValue:0},sigma:{unitType:"length"},epsilon:{unitType:"energy"}},obstacle:{width:{unitType:"length",required:!0},height:{unitType:"length",required:!0},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},mass:{defaultValue:Infinity,unitType:"mass"},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},externalAx:{defaultValue:0,unitType:"acceleration"},externalAy:{defaultValue:0,unitType:"accleration"},friction:{defaultValue:0,unitType:"inverseTime"},westProbe:{defaultValue:!1},westProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},northProbe:{defaultValue:!1},northProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},eastProbe:{defaultValue:!1},eastProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},southProbe:{defaultValue:!1},southProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},colorR:{defaultValue:128},colorG:{defaultValue:128},colorB:{defaultValue:128},visible:{defaultValue:!0}},radialBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},length:{unitType:"length",required:!0},strength:{unitType:"stiffness",required:!0},type:{defaultValue:101}},angularBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},atom3:{defaultValue:0},strength:{unitType:"rotationalStiffness",required:!0},angle:{unitType:"angle",required:!0}},restraint:{atomIndex:{required:!0},k:{defaultValue:2e3,unitType:"stiffness"},x0:{defaultValue:0,unitType:"length"},y0:{defaultValue:0,unitType:"length"}},geneticProperties:{DNA:{defaultValue:""},DNAComplement:{readOnly:!0,serialize:!1},mRNA:{immutable:!0},translationStep:{immutable:!0},x:{defaultValue:.01},y:{defaultValue:.01},height:{defaultValue:.12},width:{defaultValue:.08}},textBox:{text:{defaultValue:""},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},anchor:{defaultValue:"lower-left"},layer:{defaultValue:1},width:{},height:{},frame:{},color:{},backgroundColor:{defaultValue:"white"},strokeWidthEms:{defaultValue:.03},strokeOpacity:{defaultValue:1},rotate:{defaultValue:0},fontScale:{defaultValue:1},hostType:{},hostIndex:{},textAlign:{}}}}),function(){var e={}.hasOwnProperty;define("cs!md2d/models/engine/pairwise-lj-properties",["require","md2d/models/metadata","common/validator"],function(t){var n,r,i;return r=t("md2d/models/metadata"),i=t("common/validator"),n=function(){function t(e){this._engine=e,this._data={}}return t.prototype.registerChangeHooks=function(e,t){return this._changePreHook=e,this._changePostHook=t},t.prototype.set=function(t,n,s){var o;s=i.validate(r.pairwiseLJProperties,s),this._changePreHook(),this._data[t]==null&&(this._data[t]={}),this._data[n]==null&&(this._data[n]={}),this._data[t][n]==null&&(this._data[t][n]=this._data[n][t]={});for(o in s){if(!e.call(s,o))continue;this._data[t][n][o]=s[o]}return this._engine.setPairwiseLJProperties(t,n),this._changePostHook()},t.prototype.remove=function(e,t){return this._changePreHook(),delete this._data[e][t],delete this._data[t][e],this._engine.setPairwiseLJProperties(e,t),this._changePostHook()},t.prototype.get=function(e,t){return this._data[e]&&this._data[e][t]?this._data[e][t]:void 0},t.prototype.deserialize=function(e){var t,n,s,o,u;for(o=0,u=e.length;o<u;o++)s=e[o],s=i.validateCompleteness(r.pairwiseLJProperties,s),t=s.element1,n=s.element2,delete s.element1,delete s.element2,this.set(t,n,s)},t.prototype.serialize=function(){var t,n,r,i,s,o;s=[],o=this._data;for(n in o){if(!e.call(o,n))continue;t=o[n];for(r in t){if(!e.call(t,r))continue;n<r&&(i=this.get(n,r),i.element1=Number(n),i.element2=Number(r),s.push(i))}}return s},t.prototype.clone=function(){return $.extend(!0,{},this._data)},t.prototype.restore=function(t){var n,r,i,s;this._data=t,s=this._data;for(r in s){if(!e.call(s,r))continue;n=s[r];for(i in n){if(!e.call(n,i))continue;r<i&&this._engine.setPairwiseLJProperties(r,i)}}},t}()})}.call(this),define("common/serialize",["require","arrays"],function(e){var t=e("arrays"),n=function(e){var r,i;if(t.isArray(e)){for(r=0,i=e.length;r<i;r++)if(e[r]===Infinity||e[r]===-Infinity)e[r]=e[r].toString()}else for(r in e)if(e.hasOwnProperty(r)){if(e[r]===Infinity||e[r]===-Infinity)e[r]=e[r].toString();(typeof e[r]=="object"||t.isArray(e[r]))&&n(e[r])}};return function(r,i,s){var o={},u,a;for(u in r)r.hasOwnProperty(u)&&i[u]!==undefined&&r[u].serialize!==!1&&(a=i[u],t.isArray(a)?o[u]=s!==undefined?t.copy(t.extend(a,s),[]):t.copy(a,[]):typeof a=="object"?o[u]=$.extend(!0,{},a):o[u]=a);return n(o),o}}),define("md2d/models/engine/genetic-properties",["require","common/validator","common/serialize","md2d/models/metadata","cs!md2d/models/aminoacids-helper"],function(e){var t=e("common/validator"),n=e("common/serialize"),r=e("md2d/models/metadata"),i=e("cs!md2d/models/aminoacids-helper"),s=t.ValidationError;return function(){var o,u,a,f,l,c=d3.dispatch("change"),h=function(){var e=f.DNA.replace(/A/g,"t").replace(/G/g,"c").replace(/T/g,"a").replace(/C/g,"g");f.DNAComplement=e.toUpperCase()},p=function(e){if(e.DNA){e.DNA=e.DNA.toUpperCase();if(e.DNA.search(/[^AGTC]/)!==-1)throw new s("DNA","DNA code on sense strand can be defined using only A, G, T or C characters.")}return e},d=function(e){u(),e=t.validateCompleteness(r.geneticProperties,e),e=p(e),f=e,h(),a(),c.change()},v=function(e){var n;u(),e=t.validate(r.geneticProperties,e),e=p(e);for(n in e)e.hasOwnProperty(n)&&(f[n]=e[n]);e.DNA&&(h(),delete f.mRNA,delete f.translationStep),a(),c.change()};return o={registerChangeHooks:function(e,t){u=e,a=t},set:function(e){f===undefined?d(e):v(e)},get:function(){return f},deserialize:function(e){d(e)},serialize:function(){return f?n(r.geneticProperties,f):undefined},validate:function(e){var n={valid:!0};try{e=t.validate(r.geneticProperties,e),p(e)}catch(i){n.valid=!1,n.errors={},n.errors[i.prop]=i.message}return n},on:function(e,t){c.on(e,t)},transcribeDNA:function(){u();var e=f.DNAComplement.replace(/A/g,"u").replace(/G/g,"c").replace(/T/g,"a").replace(/C/g,"g");f.mRNA=e.toUpperCase(),a(),c.change()},translate:function(){var e=[],t,n,r,s;f.mRNA===undefined&&o.transcribeDNA(),t=f.mRNA;for(r=0,s=t.length;r+3<=s;r+=3){n=i.codonToAbbr(t.substr(r,3));if(n==="STOP"||n===undefined)return e;e.push(n)}return e},translateStepByStep:function(){var e,t;return u(),e=o.translate(),f.translationStep===undefined?f.translationStep=0:f.translationStep+=1,t=e[f.translationStep],t===undefined&&(f.translationStep="end"),a(),c.change(),t}},o}}),define("common/models/engines/clone-restore-wrapper",["require","arrays"],function(e){var t=e("arrays");return function(n){return{clone:function(){var e={},r;for(r in n)n.hasOwnProperty(r)&&(e[r]=t.clone(n[r]));return e},restore:function(e){var r;for(r in n)n.hasOwnProperty(r)&&t.copy(e[r],n[r])}}}}),define("md2d/models/engine/cell-list",[],function(){return function(t,n,r){var i,s,o,u,a,f=function(){var e;s=Math.ceil(t/r),o=Math.ceil(n/r),u=s*o,a=new Array(u);for(e=0;e<u;e++)a[e]=[]};return f(),i={reinitialize:function(e){e!==r&&(r=e,f())},addToCell:function(e,t,n){var i=Math.floor(n/r)*s+Math.floor(t/r);a[i].push(e)},getCell:function(e){return a[e]},getRowsNum:function(){return o},getColsNum:function(){return s},getNeighboringCells:function(e,t){var n=e*s+t,r=[];return t+1<s&&e+1<o&&r.push(a[n+s+1]),t+1<s&&r.push(a[n+1]),t+1<s&&e-1>=0&&r.push(a[n-s+1]),e-1>=0&&r.push(a[n-s]),r},clear:function(){var e;for(e=0;e<u;e++)a[e].length=0}},i}}),define("md2d/models/engine/neighbor-list",["require","arrays","common/array-types"],function(e){var t=e("arrays"),n=e("common/array-types");return function(r,i){var s,o,u,a,f,l,c,h,p,d,v=function(){o=r+10,u=0,a=o*(o-1)/2,d=!0,f=t.create(a,0,n.int16Type),l=t.create(o,-1,n.int16Type),c=t.create(o,-1,n.int16Type),h=t.create(o,Infinity,n.floatType),p=t.create(o,Infinity,n.floatType)};return v(),s={reinitialize:function(e,t){r=e,i=t,d=!0,r>o&&v()},clear:function(){var e;u=0;for(e=0;e<r;e++)l[e]=c[e]=-1},getList:function(){return f},markNeighbors:function(e,t){l[e]<0&&(l[e]=u),f[u]=t,u++,c[e]=u},getStartIdxFor:function(e){return l[e]},getEndIdxFor:function(e){return c[e]},saveAtomPosition:function(e,t,n){h[e]=t,p[e]=n},invalidate:function(){d=!0},shouldUpdate:function(e,t){var n=-Infinity,s=-Infinity,o;if(d)return d=!1,!0;for(o=0;o<r;o++)Math.abs(e[o]-h[o])>n&&(n=Math.abs(e[o]-h[o])),Math.abs(t[o]-p[o])>s&&(s=Math.abs(t[o]-p[o]));return Math.sqrt(n*n+s*s)>i}},s}}),define("md2d/models/engine/md2d",["require","exports","module","arrays","common/array-types","common/console","./constants/index","cs!md2d/models/aminoacids-helper","./math/index","./potentials/index","./potentials/index","cs!./pairwise-lj-properties","./genetic-properties","common/models/engines/clone-restore-wrapper","./cell-list","./neighbor-list"],function(e,t,n){var r=e("arrays"),i=e("common/array-types"),s=e("common/console"),o=e("./constants/index"),u=o.unit,a=e("cs!md2d/models/aminoacids-helper"),f=e("./math/index"),l=e("./potentials/index").coulomb,c=e("./potentials/index").lennardJones,h=e("cs!./pairwise-lj-properties"),p=e("./genetic-properties"),d=e("common/models/engines/clone-restore-wrapper"),v=e("./cell-list"),m=e("./neighbor-list"),g=-120*o.BOLTZMANN_CONSTANT.as(u.EV_PER_KELVIN),y=.34,b=39.95,w=o.convert(b,{from:u.DALTON,to:u.KILOGRAM}),E=o.BOLTZMANN_CONSTANT.as(u.JOULES_PER_KELVIN),S=function(e,t,n,r){return e*r-t*n},x=function(e,t){return e*e+t*t},T=function(e,t){var n=2*t,r=2/n*e,i=o.convert(r,{from:u.MW_ENERGY_UNIT,to:u.JOULE});return i/E},N=function(e,t){var n=2*t,r=e*E,i=o.convert(r,{from:u.JOULE,to:u.MW_ENERGY_UNIT}),s=i*n/2;return s},C=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(t<0)throw new Error("md2d: requested temperature "+t+" was less than zero");if(t===Infinity)throw new Error("md2d: requested temperature was Infinity!")};t.createEngine=function(){var e,t=!1,n=!1,g=1,y=!0,b=0,w=1,E=25,N=3,k=!0,L=!1,A=1.67,O=!1,M=!1,_,D=.001,P=[10,10],H=0,B=0,j=10,F=10,I,q=0,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut=0,at,ft,lt,ct,ht,pt,dt=0,vt=[],mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt=0,Ct,kt,Lt,At,Ot,Mt=0,_t,Dt,Pt,Ht,Bt,jt,Ft=0,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on,un,an,fn,ln,cn=0,hn,pn,dn,vn,mn,gn,yn,bn,wn,En,Sn=0,xn,Tn,Nn,Cn,kn,Ln,An,On,Mn,_n,Dn,Pn,Hn,Bn=2,jn=[],Fn=2.5,In=[],qn=[],Rn=!1,Un=[],zn=[],Wn=function(){er(0),tr(0),ir(0),nr(0),rr(0),sr(0),or(0),ur(0),mt=new h(e),hn=new p,Tt=[],xt=e.radialBondResults=[]},Xn=function(){throw new Error("md2d: Don't change the epsilon or sigma parameters of the LJ calculator being used by MD2D. Use the setElementProperties method instead.")},Vn=function(e,t){var n=ft[e],r=ft[t],i=lt[e],s=lt[t],o=mt.get(e,t),u,a;o&&o.epsilon!==undefined?u=o.epsilon:u=c.pairwiseEpsilon(n,r),o&&o.sigma!==undefined?a=o.sigma:a=c.pairwiseSigma(i,s),jn[e][t]=jn[t][e]=Bn*a*Bn*a,In[e][t]=In[t][e]=Fn*a*Fn*a,qn[e][t]=qn[t][e]=c.newLJCalculator({epsilon:u,sigma:a},Xn)},$n=function(){var e=0,t,n,r,i;for(r=0;r<dt;r++)for(i=0;i<=r;i++)vt[r]&&vt[i]&&(t=mt.get(r,i),t&&t.sigma!==undefined?n=t.sigma:n=c.pairwiseSigma(lt[r],lt[i]),Fn*n>e&&(e=Fn*n));return e||Math.max(P[0],P[1])},Jn=function(){var e=Infinity,t,n,r,i;for(r=0;r<dt;r++)for(i=0;i<=r;i++)vt[r]&&vt[i]&&(t=mt.get(r,i),t&&t.sigma!==undefined?n=t.sigma:n=c.pairwiseSigma(lt[r],lt[i]),(Fn-Bn)*n<e&&(e=(Fn-Bn)*n));return e},Kn=function(){xn===undefined?xn=new v(P[0],P[1],$n()):xn.reinitialize($n())},Qn=function(){Tn===undefined?Tn=new m(ut,Jn()):Tn.reinitialize(ut,Jn())},Gn=function(){var e,t,n;Tt=[];for(e=0;e<Nt;e++)t=gt[e],n=yt[e],Tt[t]=Tt[t]||[],Tt[t][n]=!0,Tt[n]=Tt[n]||[],Tt[n][t]=!0},Yn=function(e,t){var n,i;if(Array.isArray(e))for(n=0,i=e.length;n<i;n++)r.isArray(e[n])&&(e[n]=r.extend(e[n],t));else for(n in e)e.hasOwnProperty(n)&&r.isArray(e[n])&&(e[n]=r.extend(e[n],t))},Zn={atoms:function(){z=ot.radius,W=ot.px,X=ot.py,V=ot.x,$=ot.y,J=ot.vx,K=ot.vy,Q=ot.speed,G=ot.ax,Y=ot.ay,Z=ot.charge,tt=ot.friction,et=ot.element,nt=ot.pinned,rt=ot.mass,it=ot.hydrophobicity,st=ot.visited},radialBonds:function(){gt=St.atom1,yt=St.atom2,bt=St.length,wt=St.strength,Et=St.type},restraints:function(){Ct=Ot.atomIndex,kt=Ot.k,Lt=Ot.x0,At=Ot.y0},angularBonds:function(){_t=jt.atom1,Dt=jt.atom2,Pt=jt.atom3,Ht=jt.angle,Bt=jt.strength},elements:function(){at=pt.mass,ft=pt.epsilon,lt=pt.sigma,ct=pt.radius,ht=pt.color},obstacles:function(){It=ln.x,qt=ln.y,Rt=ln.width,Ut=ln.height,Jt=ln.mass,zt=ln.vx,Wt=ln.vy,Xt=ln.externalAx,Vt=ln.externalAy,$t=ln.friction,Kt=ln.westProbe,Qt=ln.northProbe,Gt=ln.eastProbe,Yt=ln.southProbe,on=ln.westProbeValue,un=ln.northProbeValue,an=ln.eastProbeValue,fn=ln.southProbeValue,rn=ln.xPrev,sn=ln.yPrev,Zt=ln.colorR,en=ln.colorG,tn=ln.colorB,nn=ln.visible},springForces:function(){gn=En[0],yn=En[1],bn=En[2],wn=En[3]},vdwPairs:function(){vn=pn.atom1,mn=pn.atom2}},er=function(t){pt=e.elements={},pt.mass=r.create(t,0,i.floatType),pt.epsilon=r.create(t,0,i.floatType),pt.sigma=r.create(t,0,i.floatType),pt.radius=r.create(t,0,i.floatType),pt.color=r.create(t,0,i.Int32Array),Zn.elements()},tr=function(t){ot=e.atoms={},ot.radius=r.create(t,0,i.floatType),ot.px=r.create(t,0,i.floatType),ot.py=r.create(t,0,i.floatType),ot.x=r.create(t,0,i.floatType),ot.y=r.create(t,0,i.floatType),ot.vx=r.create(t,0,i.floatType),ot.vy=r.create(t,0,i.floatType),ot.speed=r.create(t,0,i.floatType),ot.ax=r.create(t,0,i.floatType),ot.ay=r.create(t,0,i.floatType),ot.charge=r.create(t,0,i.floatType),ot.friction=r.create(t,0,i.floatType),ot.element=r.create(t,0,i.uint8Type),ot.pinned=r.create(t,0,i.uint8Type),ot.mass=r.create(t,0,i.floatType),ot.hydrophobicity=r.create(t,0,i.int8Type),ot.visited=r.create(t,0,i.uint8Type),ot.marked=r.create(t,0,i.uint8Type),ot.visible=r.create(t,0,i.uint8Type),ot.draggable=r.create(t,0,i.uint8Type),Zn.atoms()},nr=function(t){St=e.radialBonds={},St.atom1=r.create(t,0,i.uint16Type),St.atom2=r.create(t,0,i.uint16Type),St.length=r.create(t,0,i.floatType),St.strength=r.create(t,0,i.floatType),St.type=r.create(t,0,i.uint8Type),Zn.radialBonds()},rr=function(t){Ot=e.restraints={},Ot.atomIndex=r.create(t,0,i.uint16Type),Ot.k=r.create(t,0,i.floatType),Ot.x0=r.create(t,0,i.floatType),Ot.y0=r.create(t,0,i.floatType),Zn.restraints()},ir=function(t){jt=e.angularBonds={},jt.atom1=r.create(t,0,i.uint16Type),jt.atom2=r.create(t,0,i.uint16Type),jt.atom3=r.create(t,0,i.uint16Type),jt.angle=r.create(t,0,i.floatType),jt.strength=r.create(t,0,i.floatType),Zn.angularBonds()},sr=function(t){pn=e.vdwPairs={},pn.count=0,pn.atom1=r.create(t,0,i.uint16Type),pn.atom2=r.create(t,0,i.uint16Type)},or=function(t){En=e.springForces=[],En[0]=r.create(t,0,i.uint16Type),En[1]=r.create(t,0,i.floatType),En[2]=r.create(t,0,i.floatType),En[3]=r.create(t,0,i.floatType),Zn.springForces()},ur=function(t){ln=e.obstacles={},ln.x=r.create(t,0,i.floatType),ln.y=r.create(t,0,i.floatType),ln.width=r.create(t,0,i.floatType),ln.height=r.create(t,0,i.floatType),ln.mass=r.create(t,0,i.floatType),ln.vx=r.create(t,0,i.floatType),ln.vy=r.create(t,0,i.floatType),ln.externalAx=r.create(t,0,i.floatType),ln.externalAy=r.create(t,0,i.floatType),ln.friction=r.create(t,0,i.floatType),ln.westProbe=r.create(t,0,i.uint8Type),ln.northProbe=r.create(t,0,i.uint8Type),ln.eastProbe=r.create(t,0,i.uint8Type),ln.southProbe=r.create(t,0,i.uint8Type),ln.westProbeValue=r.create(t,0,i.floatType),ln.northProbeValue=r.create(t,0,i.floatType),ln.eastProbeValue=r.create(t,0,i.floatType),ln.southProbeValue=r.create(t,0,i.floatType),ln.xPrev=r.create(t,0,i.floatType),ln.yPrev=r.create(t,0,i.floatType),ln.colorR=r.create(t,0,i.floatType),ln.colorG=r.create(t,0,i.floatType),ln.colorB=r.create(t,0,i.floatType),ln.visible=r.create(t,0,i.uint8Type),Zn.obstacles()},ar,fr=function(){return n&&Rn?1e3:1e3},lr=function(){M=!0,ar=f.getWindowedAverager(fr())},cr=function(){var e=0,t;for(t=0;t<ut;t++)e+=rt[t]*(J[t]*J[t]+K[t]*K[t]);for(t=0;t<cn;t++)Jt[t]!==Infinity&&(e+=Jt[t]*(zt[t]*zt[t]+Wt[t]*Wt[t]));return T(e/2,ut)},hr=function(e,t,n){J[e]+=t,K[e]+=n,W[e]=J[e]*rt[e],X[e]=K[e]*rt[e]},pr=function(e,t){J[e]-=t*($[e]-kn),K[e]+=t*(V[e]-Cn),W[e]=J[e]*rt[e],X[e]=K[e]*rt[e]},dr=function(){for(var e=0;e<ut;e++)hr(e,-On,-Mn),pr(e,-Pn)},vr=function(){var t=0,n=0,r=0,i=0,s=e.getTotalMass(),o;for(o=0;o<ut;o++)t+=V[o],n+=$[o],r+=W[o],i+=X[o];Cn=t/ut,kn=n/ut,Ln=r,An=i,On=r/s,Mn=i/s},mr=function(){var e=0,t=0,n,r;for(r=0;r<ut;r++)n=rt[r],e+=n*S(V[r]-Cn,$[r]-kn,J[r]-On,K[r]-Mn),t+=n*x(V[r]-Cn,$[r]-kn);_n=e,Dn=t,Pn=_n/Dn},gr=function(){vr(),mr()},yr=function(e){var t=0,n=0,r=P[0],i=P[1],s=r-Rt[e],o=i-Ut[e];if(It[e]<t){while(It[e]<t-r)It[e]+=r;It[e]=t+(t-It[e]),zt[e]*=-1}else if(It[e]>s){while(It[e]>s+r)It[e]-=r;It[e]=s-(It[e]-s),zt[e]*=-1}if(qt[e]<n){while(qt[e]<n-i)qt[e]+=i;qt[e]=n+(n-qt[e]),Wt[e]*=-1}else if(qt[e]>o){while(qt[e]>o+r)qt[e]-=r;qt[e]=o-(qt[e]-o),Wt[e]*=-1}},br=function(e){var t=z[e],n=t,r=t,i=P[0],s=P[1],o=i-t,u=s-t;if(V[e]<n){while(V[e]<n-i)V[e]+=i;V[e]=n+(n-V[e]),J[e]*=-1,W[e]*=-1}else if(V[e]>o){while(V[e]>o+i)V[e]-=i;V[e]=o-(V[e]-o),J[e]*=-1,W[e]*=-1}if($[e]<r){while($[e]<r-s)$[e]+=s;$[e]=r+(r-$[e]),K[e]*=-1,X[e]*=-1}else if($[e]>u){while($[e]>u+s)$[e]-=s;$[e]=u-($[e]-u),K[e]*=-1,X[e]*=-1}},wr=function(e,t,n,r){if(cn<1)return;var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;i=z[e],s=V[e],o=$[e];for(u=0;u<cn;u++)a=It[u]-i,f=It[u]+Rt[u]+i,l=qt[u]+Ut[u]+i,c=qt[u]-i,h=rn[u]-i,p=rn[u]+Rt[u]+i,d=sn[u]+Ut[u]+i,v=sn[u]-i,x=0,s>a&&s<f&&o>c&&o<l&&(t<=h?(V[e]=a-(s-a),x=1):t>=p?(V[e]=f+(f-s),x=2):n<=v?($[e]=c-(o-c),x=-1):n>=d&&($[e]=l+(l-o),x=-2)),E=Jt[u],x!==0&&(E!==Infinity?(w=rt[e],S=E+w,x>0?(m=J[e],y=zt[u],J[e]=(m*(w-E)+2*E*y)/S,zt[u]=(y*(E-w)+2*W[e])/S):(g=K[e],b=Wt[u],K[e]=(g*(w-E)+2*E*b)/S,Wt[u]=(b*(E-w)+2*X[e])/S)):x>0?J[e]*=-1:K[e]*=-1,r&&(Kt[u]&&x===1?on[u]+=rt[e]*((m?m:-J[e])-J[e]):Gt[u]&&x===2?an[u]+=rt[e]*(J[e]-(m?m:-J[e])):Yt[u]&&x===-1?fn[u]+=rt[e]*((g?g:-K[e])-K[e]):Qt[u]&&x===-2&&(un[u]+=rt[e]*(K[e]-(g?g:-K[e])))))},Er=function(e,t){if(Tt&&Tt[e]&&Tt[e][t])return;var n=et[e],r=et[t],i=V[t]-V[e],s=$[t]-$[e],o=i*i+s*s,u,a,f;Nn&&o<In[n][r]&&Tn.markNeighbors(e,t),o<jn[n][r]&&(u=qn[n][r].forceOverDistanceFromSquaredDistance(o),a=u*i,f=u*s,G[e]+=a,Y[e]+=f,G[t]-=a,Y[t]-=f)},Sr=function(){if(!k)return;Nn?(s.time("cell lists"),xr(),s.timeEnd("cell lists")):(s.time("neighbor list"),Tr(),s.timeEnd("neighbor list"))},xr=function(){var e=xn.getRowsNum(),t=xn.getColsNum(),n,r,i,s,o,u,a,f,l,c,h,p,d,v;for(n=0;n<e;n++){i=n*t;for(r=0;r<t;r++){s=i+r,o=xn.getCell(s),v=xn.getNeighboringCells(n,r);for(a=0,c=o.length;a<c;a++){l=o[a];for(f=0;f<a;f++)Er(l,o[f]);for(p=0,d=v.length;p<d;p++){u=v[p];for(f=0,h=u.length;f<h;f++)Er(l,u[f])}}}}},Tr=function(){var e=Tn.getList(),t,n,r,i;for(t=0;t<ut;t++)for(r=Tn.getStartIdxFor(t),i=Tn.getEndIdxFor(t);r<i;r++)n=e[r],Er(t,n)},Nr=function(){if(!n||!Rn)return;var e,t,r,i,s,o,u,a,f,c,h,p,d;for(e=0,r=Un.length;e<r;e++){h=Un[e],c=Z[h],d=Tt&&Tt[h];for(t=0;t<e;t++){p=Un[t];if(d&&d[p])continue;i=V[p]-V[h],s=$[p]-$[h],o=i*i+s*s,u=l.forceOverDistanceFromSquaredDistance(o,c,Z[p],g,y),a=u*i,f=u*s,G[h]+=a,Y[h]+=f,G[p]-=a,Y[p]-=f}}},Cr=function(){if(!I)return;var e,t;for(e=0;e<ut;e++)t=I*tt[e],G[e]+=-J[e]*t,Y[e]+=-K[e]*t},kr=function(){if(Nt<1)return;var e,t,n,r,i,s,a,f,l,c,h,p;for(e=0;e<Nt;e++)t=gt[e],n=yt[e],r=V[n]-V[t],i=$[n]-$[t],s=r*r+i*i,a=Math.sqrt(s),f=wt[e],l=bt[e],c=o.convert(f*(a-l),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/a,h=c*r,p=c*i,G[t]+=h,Y[t]+=p,G[n]-=h,Y[n]-=p},Lr=function(){if(Ft<1)return;var e,t,n,r,i,s,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;for(e=0;e<Ft;e++)t=_t[e],n=Dt[e],r=Pt[e],v=Ht[e],d=Bt[e],i=V[t]-V[r],a=V[n]-V[r],s=$[t]-$[r],f=$[n]-$[r],l=i*i+s*s,c=a*a+f*f,h=Math.sqrt(l),p=Math.sqrt(c),g=(i*a+s*f)/(h*p),g>1?g=1:g<-1&&(g=-1),y=Math.sqrt(1-g*g),m=Math.acos(g),y<1e-4&&(y=1e-4),x=o.convert(d*(m-v)/(y*h),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/p,T=i*a+s*f,b=x*(a-T*i/l),w=x*(f-T*s/l),E=x*(i-T*a/c),S=x*(s-T*f/c),G[t]+=b,Y[t]+=w,G[n]+=E,Y[n]+=S,G[r]-=b+E,Y[r]-=w+S},Ar=function(){if(Mt<1)return;var e,t,n,r,i,s,a,f,l,c;for(e=0;e<Mt;e++){c=Ct[e],t=Lt[e]-V[c],n=At[e]-$[c];if(t===0&&n===0)continue;i=t*t+n*n,r=Math.sqrt(i),s=kt[e],a=o.convert(s*r,{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/r,f=a*t,l=a*n,G[c]+=f,Y[c]+=l}},Or=function(){if(Sn<1)return;var e,t,n,r,i,s,a,f,l,c;for(e=0;e<Sn;e++){c=gn[e],t=yn[e]-V[c],n=bn[e]-$[c];if(t===0&&n===0)continue;i=t*t+n*n,r=Math.sqrt(i),s=wn[e],a=o.convert(s*r,{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/r,f=a*t,l=a*n,G[c]+=f,Y[c]+=l}},Mr=function(e){var t=0,n=0,r=0,i,s,o,u;for(o=0,u=e.length;o<u;o++)i=e[o],s=rt[i],t+=V[i]*s,n+=$[i]*s,r+=s;return t/=r,n/=r,{x:t,y:n}},_r=function(){if(b===0||w===0||ut<2)return;var t,n,r,i,s,o,u,a,f,l,c,h,p;for(c=0;c<ut;c++)st[c]=0;i=6e-5*b*w;for(c=0;c<ut;c++){if(st[c]===1)continue;t=e.getMoleculeAtoms(c),t.push(c),r=Mr(t);for(h=0,p=t.length;h<p;h++)n=t[h],st[n]=1,it[n]!==0&&(s=V[n]-r.x,o=$[n]-r.y,u=Math.sqrt(s*s+o*o),l=it[n]*i,l>0&&u<N&&(l*=(1-E)*u/N+E),a=l*s/u,f=l*o/u,G[n]-=a,Y[n]-=f)}},Dr=function(){if(!O)return;var e;for(e=0;e<ut;e++)Y[e]-=O},Pr=function(){var e=a.cysteineElement,t,n;zn.length=0;for(n=0;n<ut;n++)et[n]===e&&zn.push(n);for(n=0;n<Nt;n++)et[gt[n]]===e&&et[yt[n]]===e&&(t=zn.indexOf(gt[n]),t!==-1&&r.remove(zn,t),t=zn.indexOf(yt[n]),t!==-1&&r.remove(zn,t))},Hr=function(){var e,t;if(ut===0)return;for(e=0;e<ut;e++)G[e]=Y[e]=0;Nn=Tn.shouldUpdate(V,$);if(Nn){xn.clear(),Tn.clear();for(e=0;e<ut;e++)xn.addToCell(e,V[e],$[e]),Tn.saveAtomPosition(e,V[e],$[e])}s.time("short-range forces"),Sr(),s.timeEnd("short-range forces"),s.time("long-range forces"),Nr(),s.timeEnd("long-range forces"),kr(),Lr(),Ar(),Or(),Cr(),_r();for(e=0;e<ut;e++)t=1/rt[e],G[e]*=t,Y[e]*=t;Dr()},Br=function(){var e,t;for(e=0;e<ut;e++)t=rt[e],J[e]+=.5*G[e]*R,W[e]=t*J[e],K[e]+=.5*Y[e]*R,X[e]=t*K[e]},jr=function(){var e=P[0]*100,t=P[1]*100,n,r,i;for(i=0;i<ut;i++){n=V[i],r=$[i],V[i]+=J[i]*R,$[i]+=K[i]*R;if(isNaN(V[i])||isNaN($[i])||Math.abs(V[i])>e||Math.abs($[i])>t)throw new Error("Model has diverged!");br(i),wr(i,n,r,!0)}},Fr=function(){var e;for(e=0;e<ut;e++)nt[e]&&(J[e]=K[e]=G[e]=Y[e]=0)},Ir=function(){var e;for(e=0;e<ut;e++)Q[e]=Math.sqrt(J[e]*J[e]+K[e]*K[e])},qr=function(){var e,t,n,r,i,s,o,u;for(u=0;u<cn;u++){if(Jt[u]===Infinity)continue;n=zt[u],r=Wt[u],s=Xt[u],o=Vt[u];if(n||r||s||o||O)i=I*$t[u],e=s-i*n,t=o-i*r-O,rn[u]=It[u],sn[u]=qt[u],It[u]+=n*R+.5*e*U,qt[u]+=r*R+.5*t*U,zt[u]+=e*R,Wt[u]+=t*R,yr(u)}},Rr=function(){var t,n,r,i,s,o,u,a;for(o=0;o<ut;o++)st[o]=0;for(o=0;o<ut;o++){if(st[o]===1)continue;t=e.getMoleculeAtoms(o);if(t.length===0)continue;t.push(o),r=i=s=0;for(u=0,a=t.length;u<a;u++)n=t[u],st[n]=1,nt[n]||(r+=J[n]*rt[n],i+=K[n]*rt[n],s+=rt[n]);s=1/s;for(u=0,a=t.length;u<a;u++)n=t[u],nt[n]||(J[n]-=r*s,K[n]-=i*s,W[n]=J[n]*rt[n],X[n]=K[n]*rt[n])}},Ur=function(e,t){var n,r;e==null&&(e=_),Hn=cr();if(Hn===0){for(r=0;r<ut;r++)nt[r]===!1&&(J[r]=Math.random()*.02-.01,K[r]=Math.random()*.02-.01);Hn=cr();if(Hn===0)return}M&&Math.abs(ar(Hn)-e)<=e*D&&(M=!1);if(t||L||M&&Hn>0){n=Math.sqrt(e/Hn);for(r=0;r<ut;r++)J[r]*=n,K[r]*=n,W[r]*=n,X[r]*=n;for(r=0;r<cn;r++)zt[r]*=n,Wt[r]*=n;Hn=e}},zr=function(){var t,n,i,s,o,u,a,f;for(u=0,f=zn.length;u<f;u++){t=zn[u];for(a=u+1;a<f;a++)n=zn[a],i=V[t]-V[n],s=$[t]-$[n],o=i*i+s*s,o<.07&&(e.addRadialBond({atom1:t,atom2:n,length:Math.sqrt(o),strength:1e4,type:109}),r.remove(zn,u),r.remove(zn,a),f=zn.length,t=zn[u],a=u+1)}},Wr=function(){var e;for(e=0;e<cn;e++)Qt[e]&&(un[e]=0),Yt[e]&&(fn[e]=0),Gt[e]&&(an[e]=0),Kt[e]&&(on[e]=0)},Xr=function(e){var t,n;t=13888.89/e;for(n=0;n<cn;n++)Qt[n]&&(un[n]*=t/Rt[n]),Yt[n]&&(fn[n]*=t/Rt[n]),Gt[n]&&(an[n]*=t/Ut[n]),Kt[n]&&(on[n]*=t/Ut[n])};return e={useCoulombInteraction:function(e){n=!!e},useLennardJonesInteraction:function(e){k=!!e},useThermostat:function(e){L=!!e},setVDWLinesRatio:function(e){typeof e=="number"&&e!==0&&(A=e)},setGravitationalField:function(e){typeof e=="number"&&e!==0?O=e:O=!1},setTargetTemperature:function(e){C(e),_=e},setDielectricConstant:function(e){g=e},setRealisticDielectricEffect:function(e){y=e},setSolventForceType:function(e){b=e},setSolventForceFactor:function(e){w=e},setAdditionalSolventForceMult:function(e){E=e},setAdditionalSolventForceThreshold:function(e){N=e},setTime:function(e){q=e},setDimensions:function(e){if(t)throw new Error("The molecular model's size has already been set, and cannot be reset.");H=e[0],B=e[1],j=e[2],F=e[3],P=[j-H,F-B],t=!0},getDimensions:function(){return[H,B,j,F]},getLJCalculator:function(){return qn},setAtomProperties:function(t,n){var r=a.cysteineElement,i,s,o,u,f;if(n.element!==undefined){if(n.element<0||n.element>=dt)throw new Error("md2d: Unknown element "+n.element+", an atom can't be created.");if(et[t]===r&&n.element!==r)for(f=0;f<Nt;f++)if((gt[f]===t||yt[f]===t)&&Et[f]===109){e.removeRadialBond(f);break}vt[n.element]=!0,n.mass=at[n.element],n.radius=ct[n.element],a.isAminoAcid(n.element)&&(u=a.getAminoAcidByElement(n.element),n.charge=u.charge,n.hydrophobicity=u.hydrophobicity)}!Z[t]&&n.charge?Un.push(t):Z[t]&&n.charge===0&&(s=Un.indexOf(t),o=Un.slice(s+1),Un.length=s,Array.prototype.push.apply(Un,o)),Rn=!!Un.length;for(i in n)n.hasOwnProperty(i)&&(ot[i][t]=n[i]);W[t]=J[t]*rt[t],X[t]=K[t]*rt[t],Q[t]=Math.sqrt(J[t]*J[t]+K[t]*K[t])},setRadialBondProperties:function(e,t){var n,r,i;r=gt[e],i=yt[e],Tt[r]&&Tt[r][i]&&(Tt[r][i]=!1),Tt[i]&&Tt[i][r]&&(Tt[i][r]=!1);for(n in t)t.hasOwnProperty(n)&&(St[n][e]=t[n],xt[e][n]=t[n]);r=gt[e],i=yt[e],Tt[r]||(Tt[r]=[]),Tt[r][i]=!0,Tt[i]||(Tt[i]=[]),Tt[i][r]=!0},setAngularBondProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(jt[n][e]=t[n])},setRestraintProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(Ot[n][e]=t[n])},setElementProperties:function(e,t){var n,r;if(t.mass!=null&&t.mass!==at[e]){at[e]=t.mass;for(n=0;n<ut;n++)et[n]===e&&(rt[n]=t.mass)}if(t.sigma!=null){lt[e]=t.sigma,r=c.radius(t.sigma);if(ct[e]!==r){ct[e]=r;for(n=0;n<ut;n++)et[n]===e&&(z[n]=r)}}t.epsilon!=null&&(ft[e]=t.epsilon),t.color!=null&&(ht[e]=t.color);for(n=0;n<dt;n++)Vn(e,n);Kn(),Qn()},setPairwiseLJProperties:function(e,t){Vn(e,t),Kn(),Qn()},setObstacleProperties:function(t,n){var r;if(!e.canPlaceObstacle(n.x,n.y,n.width,n.height,t))throw new Error("Obstacle can't be placed at "+n.x+", "+n.y);n.x!==undefined&&(n.xPrev=n.x),n.y!==undefined&&(n.yPrev=n.y),typeof n.mass=="string"&&(n.mass=parseFloat(n.mass));for(r in n)n.hasOwnProperty(r)&&(ln[r][t]=n[r])},addAtom:function(t){ut+1>ot.x.length&&(Yn(ot,ut+10),Zn.atoms()),t.ax=t.ay=0,ut++,e.setAtomProperties(ut-1,t),Kn(),Qn()},removeAtom:function(t){var n,i,s,o,u,a;if(t>=ut)throw new Error("Atom "+t+" doesn't exist, so it can't be removed.");n=0;while(n<Nt)gt[n]===t||yt[n]===t?e.removeRadialBond(n):n++;n=Un.indexOf(t),n!==-1&&r.remove(Un,n);for(n=t;n<ut;n++)for(s in ot)ot.hasOwnProperty(s)&&(n===ut-1?ot[s][n]=0:ot[s][n]=ot[s][n+1]);ut--,a=[Un,gt,yt,_t,Dt,Pt];for(o=0;o<a.length;o++){u=a[o];for(n=0,i=u.length;n<i;n++)u[n]>t&&u[n]--}for(n=0,i=xt.length;n<i;n++)xt[n].atom1>t&&xt[n].atom1--,xt[n].atom2>t&&xt[n].atom2--;Gn(),Kn(),Qn(),Tn.invalidate(),Hr()},addElement:function(e){var t;dt>=ft.length&&(Yn(pt,dt+10),Zn.elements()),at[dt]=e.mass,ft[dt]=e.epsilon,lt[dt]=e.sigma,ct[dt]=c.radius(e.sigma),ht[dt]=e.color,qn[dt]=[],jn[dt]=[],In[dt]=[];for(t=0;t<=dt;t++)Vn(dt,t);dt++},addRadialBond:function(t){Nt+1>gt.length&&(Yn(St,Nt+10),Zn.radialBonds()),Nt++,xt[Nt-1]={idx:Nt-1},e.setRadialBondProperties(Nt-1,t)},removeRadialBond:function(t){var n,i,s,o;if(t>=Nt)throw new Error("Radial bond "+t+" doesn't exist, so it can't be removed.");s=gt[t],o=yt[t],n=0;while(n<Ft)Pt[n]===s||Pt[n]===o?e.removeAngularBond(n):n++;for(n=t;n<Nt;n++)for(i in St)St.hasOwnProperty(i)&&(n===Nt-1?St[i][n]=0:St[i][n]=St[i][n+1]);Nt--,r.remove(xt,t),Gn()},addRestraint:function(t){Mt+1>Ot.atomIndex.length&&(Yn(Ot,Mt+10),Zn.restraints()),Mt++,e.setRestraintProperties(Mt-1,t)},addAngularBond:function(t){Ft+1>jt.atom1.length&&(Yn(jt,Ft+10),Zn.angularBonds()),Ft++,e.setAngularBondProperties(Ft-1,t)},removeAngularBond:function(e){var t,n;if(e>=Ft)throw new Error("Angular bond "+e+" doesn't exist, so it can't be removed.");for(t=e;t<Ft;t++)for(n in jt)jt.hasOwnProperty(n)&&(t===Ft-1?jt[n][t]=0:jt[n][t]=jt[n][t+1]);Ft--},addSpringForce:function(e,t,n,r){return Sn+1>En[0].length&&(Yn(En,Sn+1),Zn.springForces()),gn[Sn]=e,yn[Sn]=t,bn[Sn]=n,wn[Sn]=r,Sn++},updateSpringForce:function(e,t,n){yn[e]=t,bn[e]=n},removeSpringForce:function(e){if(e>=Sn)return;Sn--},springForceAtomIndex:function(e){return gn[e]},addObstacle:function(t){if(!e.canPlaceObstacle(t.x,t.y,t.width,t.height))throw new Error("Obstacle can't be placed at "+t.x+", "+t.y+".");cn+1>ln.x.length&&(Yn(ln,cn+1),Zn.obstacles()),cn++,e.setObstacleProperties(cn-1,t)},removeObstacle:function(e){var t,n;if(e>=cn)throw new Error("Obstacle "+e+" doesn't exist, so it can't be removed.");cn--;for(t=e;t<cn;t++)for(n in ln)ln.hasOwnProperty(n)&&(ln[n][t]=ln[n][t+1]);Yn(ln,cn),
Zn.obstacles()},atomInBounds:function(e,t,n){var r=z[n],i;if(e<r||e>P[0]-r||t<r||t>P[1]-r)return!1;for(i=0;i<cn;i++)if(e>It[i]-r&&e<It[i]+Rt[i]+r&&t>qt[i]-r&&t<qt[i]+Ut[i]+r)return!1;return!0},canPlaceAtom:function(t,n,r,i){var s,o,u,a;if(!e.atomInBounds(n,r,i))return!1;for(a=0;a<cn;a++){testX=It[a],testY=qt[a],testXMax=testX+Rt[a],testYMax=testY+Ut[a];if(n>testX&&n<testXMax&&r>testY&&r<testYMax)return!1}return typeof i=="number"&&(s=V[i],o=$[i],V[i]=$[i]=Infinity),u=e.newPotentialCalculator(t,0,!1)(n,r),typeof i=="number"&&(V[i]=s,$[i]=o),u<=0},canPlaceObstacle:function(e,t,n,r,i){var s=e+n,o=t+r,u,a,f,l,c,h;if(e<0||s>P[0]||t<0||o>P[0])return!1;for(h=0;h<ut;h++){c=z[h];if(V[h]>e-c&&V[h]<s+c&&$[h]>t-c&&$[h]<o+c)return!1}for(h=0;h<cn;h++){if(i!==undefined&&i===h)continue;u=It[h],a=qt[h],f=u+Rt[h],l=a+Ut[h];if(s>u&&e<f&&o>a&&t<l)return!1}return!0},setupAtomsRandomly:function(t){var n=t.temperature||100,r=Math.floor(Math.sqrt(ut)),i=Math.ceil(ut/r),s,o,u,a,l,c,h,p;C(n),l=P[0]/(1+i),a=P[1]/(1+r),s=-1;for(o=1;o<=r;o++)for(u=1;u<=i;u++){s++;if(s===ut)break;c=f.normal(1,.25),h=2*Math.random()*Math.PI,p={element:Math.floor(Math.random()*t.userElements),x:u*l,y:o*a,vx:c*Math.cos(h),vy:c*Math.sin(h),charge:2*(s%2)-1},e.setAtomProperties(s,p)}gr(),dr(),Ur(n,!0)},generateProtein:function(t,n){var r=P[0],i=P[1],s=0,o=0,u=a.lastElementID-a.firstElementID+1,f,l,c,h,p,d=.6,v=function(e){return e>i-d||e<d?.1:.02-Math.random()*.04},m=.3,g=function(e,t){return t===0?e>.5*P[1]?-0.1:.1:c>i-m||c<m?0:t},y=function(){return Math.floor(u*Math.random())+a.firstElementID};t!==undefined&&(n=t.length);while(ut>0)e.removeAtom(ut-1);l=.1,c=.1,h=t?a.abbrToElement(t[0]):y(),e.addAtom({x:l,y:c,element:h,visible:!0}),e.minimizeEnergy();for(f=1;f<n;f++){l=V[ut-1],c=$[ut-1],s=v(c),o=g(c,o),l+=s,c+=o;if(l>r-.1)return f;h=t?a.abbrToElement(t[f]):y(),e.addAtom({x:l,y:c,element:h,visible:!0}),p=(z[ut-1]+z[ut-2])*1.25,e.addRadialBond({atom1:ut-1,atom2:ut-2,length:p,strength:1e4}),e.minimizeEnergy()}s=(r-l)/2;for(f=0;f<ut;f++)V[f]+=s;return f},extendProtein:function(t,n,r){var i=a.lastElementID-a.firstElementID+1,s=P[0]/2,o=P[1]/2,u,f,l,c=function(){return Math.floor(i*Math.random())+a.firstElementID},h,p,d=function(){var e=0,t,n;h=p=0;for(n=0;n<ut;n++)t=rt[n],h+=V[n]*t,p+=$[n]*t,e+=t;h/=e,p/=e};t=t!==undefined?t:s/10,n=n!==undefined?n:o/2;if(ut===0)u=r?a.abbrToElement(r):c(),e.addAtom({x:t,y:n,element:u,pinned:!0,visible:!0}),e.minimizeEnergy();else{d();for(l=0;l<ut;l++)nt[l]=!1,V[l]+=(s-h)/5+Math.random()*.04-.02,$[l]+=(o-p)/5+Math.random()*.04-.02;u=r?a.abbrToElement(r):c(),e.addAtom({x:t,y:n,element:u,pinned:!0,visible:!0}),f=(z[ut-1]+z[ut-2])*1.25,e.addRadialBond({atom1:ut-1,atom2:ut-2,length:f,strength:1e4}),e.minimizeEnergy()}},getVdwPairsArray:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=A*A;dn=0;for(e=0;e<ut;e++){c=et[e],u=lt[c],a=lt[c],s=V[e],o=$[e];for(t=e+1;t<ut;t++){if(Nt!==0&&Tt[e]&&Tt[e][t])continue;h=et[t],f=lt[h],l=lt[h],Z[e]*Z[t]<=0&&(n=V[t]-s,r=$[t]-o,i=n*n+r*r,p=.5*(u+f),p*=p,d=a*l,i<p*v&&d>0&&(dn+1>pn.atom1.length&&(Yn(pn,(dn+1)*2),Zn.vdwPairs()),vn[dn]=e,mn[dn]=t,dn++))}}return pn.count=dn,pn},relaxToTemperature:function(t){t!=null&&(_=t),C(_),lr();while(M)e.integrate()},integrate:function(e,t){var n,r,i=q;e===undefined&&(e=100),t===undefined&&(t=1),R=t,U=R*R,Pr(),q===0&&Hr(),n=Math.floor(e/R),Wr();for(r=1;r<=n;r++)q=i+r*R,Br(),jr(),Hr(),Fr(),Br(),Ir(),qr(),Ur(),b!==0&&Rr();Xr(e),zr()},minimizeEnergy:function(){var e=.001,t=1e-4,n=3e3,r,i,s,o,u,a;Hr(),Fr(),r=0;for(u=0;u<ut;u++)r<Math.abs(G[u])&&(r=Math.abs(G[u])),r<Math.abs(Y[u])&&(r=Math.abs(Y[u]));a=0;while(r>t&&a<n){a++,i=e/r;for(u=0;u<ut;u++)s=V[u],o=$[u],V[u]+=G[u]*i,$[u]+=Y[u]*i,br(u),wr(u,s,o,!1);Hr(),Fr(),r=0;for(u=0;u<ut;u++)r<Math.abs(G[u])&&(r=Math.abs(G[u])),r<Math.abs(Y[u])&&(r=Math.abs(Y[u]))}},getRadialBondsForAtom:function(e){var t=[],n,r,i;for(n=0;n<Nt;n++)r=gt[n],i=yt[n],(e==r||e==i)&&t.push(n);return t},getAngularBondsForAtom:function(e){var t=[],n,r,i,s;for(n=0;n<Ft;n++)r=_t[n],i=Dt[n],s=Pt[n],(e==r||e==i||e==s)&&t.push(n);return t},getTotalMass:function(){var e=0,t;for(t=0;t<ut;t++)e+=rt[t];return e},getRadiusOfElement:function(e){return ct[e]},getNumberOfAtoms:function(e){if(typeof e=="undefined")return ut;var t,n=0,r=(new Function("i","return this.atoms."+e)).bind(this);for(t=0;t<ut;t++)r(t)&&n++;return n},getNumberOfElements:function(){return dt},getNumberOfObstacles:function(){return cn},getNumberOfRadialBonds:function(){return Nt},getNumberOfAngularBonds:function(){return Ft},getNumberOfRestraints:function(){return Mt},computeOutputState:function(e){var t,r,i,s,a,f,c,h,p,d,v,m,b,w,E,S,x,N,C,L,A,M,_,D;D=0,_=0;for(t=0;t<ut;t++){O&&(M=rt[t]*O*$[t],D+=o.convert(M,{from:u.MW_ENERGY_UNIT,to:u.EV})),_+=.5*rt[t]*(J[t]*J[t]+K[t]*K[t]);for(r=t+1;r<ut;r++)h=V[r]-V[t],p=$[r]-$[t],S=h*h+p*p,k&&(D-=qn[et[t]][et[r]].potentialFromSquaredDistance(S)),n&&Rn&&(D+=l.potential(Math.sqrt(S),Z[t],Z[r],g,y))}for(t=0;t<Nt;t++)i=gt[t],s=yt[t],f=et[i],c=et[s],h=V[s]-V[i],p=$[s]-$[i],S=h*h+p*p,C=wt[t],L=Math.sqrt(S)-bt[t],D+=.5*C*L*L,k&&(D+=qn[f][c].potentialFromSquaredDistance(S)),n&&Z[i]&&Z[s]&&(D-=l.potential(Math.sqrt(S),Z[i],Z[s],g,y)),xt[t].x1=V[i],xt[t].y1=$[i],xt[t].x2=V[s],xt[t].y2=$[s];for(t=0;t<Ft;t++)i=_t[t],s=Dt[t],a=Pt[t],d=V[i]-V[a],m=V[s]-V[a],v=$[i]-$[a],b=$[s]-$[a],x=Math.sqrt(d*d+v*v),N=Math.sqrt(m*m+b*b),w=(d*m+v*b)/(x*N),w>1?w=1:w<-1&&(w=-1),E=Math.acos(w),A=E-Ht[t],D+=.5*Bt[t]*A*A;for(t=0;t<Mt;t++)i=Ct[t],f=et[i],h=Lt[t]-V[i],p=At[t]-$[i],S=h*h+p*p,C=kt[t],L=Math.sqrt(S),D+=.5*C*L*L;for(t=0;t<cn;t++)Jt[t]!==Infinity&&(O&&(M=Jt[t]*O*qt[t],D+=o.convert(M,{from:u.MW_ENERGY_UNIT,to:u.EV})),_+=.5*Jt[t]*(zt[t]*zt[t]+Wt[t]*Wt[t]));Hn=T(_,ut),e.time=q,e.PE=D,e.KE=o.convert(_,{from:u.MW_ENERGY_UNIT,to:u.EV}),e.temperature=Hn,e.pCM=[Ln,An],e.CM=[Cn,kn],e.vCM=[On,Mn],e.omega_CM=Pn},newPotentialCalculator:function(e,t,r){return function(i,s){var a=0,f=0,c=0,h,p,d=qn[e],v,m,b,w,E,S,x;for(v=0;v<ut;v++)m=i-V[v],b=s-$[v],w=m*m+b*b,S=0,k&&(x=d[et[v]],a+=-x.potentialFromSquaredDistance(w,e,et[v]),r&&(S+=x.forceOverDistanceFromSquaredDistance(w))),n&&Rn&&t&&(E=Math.sqrt(w),a+=-l.potential(E,t,Z[v],g,y),r&&(S+=l.forceOverDistanceFromSquaredDistance(w,t,Z[v],g,y))),S&&(f+=S*m,c+=S*b);return r?(h=o.convert(f,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),p=o.convert(c,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),[a,[h,p]]):a}},findMinimumPELocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=ct[t],u=f.minimize(s,[n,r],{bounds:[[o,P[0]-o],[o,P[1]-o]]});return u.error?!1:u[1]},findMinimumPESquaredLocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=function(e,t){var n,r,i;return n=s(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},u=ct[t],a=f.minimize(o,[n,r],{bounds:[[u,P[0]-u],[u,P[1]-u]],stopval:1e-4,precision:1e-6});return a.error?!1:a[1]},atomsInMolecule:[],depth:0,getMoleculeAtoms:function(e){this.atomsInMolecule.push(e);var t=[],n=this.getBondedAtoms(e),r=this.depth,i,s,o;this.depth++;for(i=0,s=n.length;i<s;i++)o=n[i],~this.atomsInMolecule.indexOf(o)||(t=t.concat(this.getMoleculeAtoms(o)));return r===0?(this.depth=0,this.atomsInMolecule=[]):t.push(e),t},getBondedAtoms:function(e){var t=[],n,r;if(St)for(n=0,r=Nt;n<r;n++)gt[n]===e&&t.push(yt[n]),yt[n]===e&&t.push(gt[n]);return t},getAtomKineticEnergy:function(e){var t=.5*rt[e]*(J[e]*J[e]+K[e]*K[e]);return o.convert(t,{from:u.MW_ENERGY_UNIT,to:u.EV})},getAtomNeighbors:function(e){var t=[],n=Tn.getList(),r,i;for(r=Tn.getStartIdxFor(e),i=Tn.getEndIdxFor(e);r<i;r++)t.push(n[r]);return t},getNeighborList:function(){return Tn},setViscosity:function(e){I=e},getState:function(){return[new d(pt),new d(ot),new d(ln),new d(St),new d(jt),new d(Ot),new d(En),mt,{clone:function(){return{time:q,N:ut,N_elements:dt,N_obstacles:cn,N_radialBonds:Nt,N_angularBonds:Ft,N_restraints:Mt,N_springForces:Sn}},restore:function(e){q=e.time,ut=e.N,dt=e.N_elements,cn=e.N_obstacles,Nt=e.N_radialBonds,Ft=e.N_angularBonds,Mt=e.N_restraints,Sn=e.N_springForces}}]}},Wn(),e.pairwiseLJProperties=mt,e.geneticProperties=hn,e}}),define("common/models/tick-history",[],function(){return function(t,n,r){function l(){return{input:{},state:[],parameters:{}}}function c(){o=[],u={length:0,maxSize:r,index:-1,counter:-1,startCounter:0}}function h(e){var n,r,i,s,o;for(n=0;n<t.input.length;n++)r=t.input[n],e.input[r]=t.getRawPropertyValue(r);s=t.parameters;for(o in s)s.hasOwnProperty(o)&&s[o].isDefined&&(e.parameters[o]=t.getRawPropertyValue(o));i=t.state;for(n=0;n<i.length;n++)e.state[n]=i[n].clone()}function p(){var e=l(),t;h(e),o[u.index+1]=e,o.length>u.maxSize?(o.splice(0,1),u.startCounter++):u.index++,u.counter=u.index+u.startCounter;for(t=0;t<f.length;t++)f[t].push();d(),u.length=o.length}function d(){var e;o.length=u.index+1,u.length=o.length;for(e=0;e<f.length;e++)f[e].invalidate(u.index)}function v(e){var n,r;t.restoreProperties(e.input),t.restoreParameters(e.parameters),r=e.state;for(n=0;n<r.length;n++)t.state[n].restore(r[n]);for(n=0;n<f.length;n++)f[n].extract(u.index)}function m(e){if(e<0)throw new Error("TickHistory: extract index ["+e+"] less than 0");if(e>=o.length)throw new Error("TickHistory: extract index ["+e+"] greater than list.length: "+o.length);return e}var i={},s,o,u,a=1e3,f=[];return i.isEmpty=function(){return u.index===0},i.push=function(){p()},i.returnTick=function(e){var t;return typeof e=="number"?t=e:t=u.index,m(t),o[t]},i.extract=function(e){var t;typeof e=="number"?t=e:t=u.index,m(t),v(o[t])},i.restoreInitialState=function(){c(),v(s),p()},i.reset=c,i.decrementExtract=function(){u.counter>u.startCounter&&(u.index--,u.counter--,v(o[u.index]))},i.incrementExtract=function(){u.index++,u.counter++,v(o[u.index])},i.seekExtract=function(e){e<u.startCounter&&(e=u.startCounter),e>=u.startCounter+u.length&&(e=u.startCounter+u.length-1),u.counter=e,u.index=e-u.startCounter,v(o[u.index])},i.invalidateFollowingState=d,i.get=function(e){return u[e]},i.set=function(e,t){return u[e]=t},i.registerExternalObject=function(e){e.setHistoryLength(u.maxSize),f.push(e)},r==null&&(r=a),s=l(),h(s),c(),p(),i}}),function(){define("cs!md2d/models/running-average-filter",["require"],function(e){var t;return t=function(){function e(e){this.periodLength=e,this._value=[],this._time=[],this._idx=-1,this._maxBufferLength=this.periodLength}return e.prototype.addSample=function(e,t){var n;if(this._time[this._idx]===e){this._value[this._idx]=t;return}if(this._time[this._idx]>e)throw new Error("RunningAverageFilter: cannot add sample with @_time less than previous sample.");this._idx++,this._value.push(t),this._time.push(e),n=[];while(this._value.length>this._maxBufferLength)this._time.shift(),this._value.shift(),n.push(this._idx--);return n},e.prototype.calculate=function(){var e,t,n,r,i,s;t=Math.max(this._time[this._idx]-this.periodLength,0),s=0,i=0,e=this._idx;while(e>0&&this._time[e-1]>=t)r=this._time[e]-this._time[e-1],i+=r,s+=r*(this._value[e-1]+this._value[e])/2,e--;return e>0&&this._time[e]>t&&this._time[e-1]<t&&(r=this._time[e]-t,i+=r,n=this._value[e-1]+(this._value[e]-this._value[e-1])*(t-this._time[e-1])/(this._time[e]-this._time[e-1]),s+=r*(this._value[e]+n)/2),i?s/i:this._value[0]||0},e.prototype.getCurrentBufferLength=function(){return this._value.length},e.prototype.setMaxBufferLength=function(e){return this._maxBufferLength=e},e.prototype.getCurrentTime=function(){return this._time[this._idx]},e.prototype.getCurrentStep=function(){return this._idx},e.prototype.setCurrentStep=function(e){if(e<-1||e>=this._value.length)throw new Error("RunningAverageFilter: cannot seek, location outside available range.");return this._idx=e},e.prototype.invalidate=function(e){return this._value.length=e+1,this._time.length=e+1},e}()})}.call(this),function(){define("cs!md2d/models/solvent",["require"],function(e){var t,n;return n={vacuum:{forceType:0,dielectricConstant:1,color:"#eee"},oil:{forceType:-1,dielectricConstant:10,color:"#f5f1dd"},water:{forceType:1,dielectricConstant:80,color:"#a5d9da"}},t=function(){function e(e){var t,r,i;this.type=e,r=n[this.type];if(r==null)throw new Error("Solvent: unknown type. Use 'vacuum', 'oil' or 'water'.");for(t in r)i=r[t],this[t]=i}return e}()})}.call(this),define("md2d/models/property-description",["require","underscore"],function(e){function n(e){return typeof e=="undefined"}function r(e,t){var n;this._descriptionHash=t,this._label=t.label||"";if(t.unitType){if(!(n=e.units[t.unitType]))throw new Error("PropertyDescription: couldn't find unitType "+t.unitType+" in the supplied units definition.");this._unitType=t.unitType,this._unitName=n.name,this._unitPluralName=n.pluralName,this._unitAbbreviation=n.symbol}t.unitName&&(this._unitName=t.unitName),t.unitPluralName&&(this._unitPluralName=t.unitPluralName),t.unitAbbreviation&&(this._unitAbbreviation=t.unitAbbreviation),this.setFormat(t.format||"g")}var t=e("underscore");return r.prototype.getHash=function(){return t.extend(t.reject({unitName:this.getUnitName(),unitPluralName:this.getUnitPluralName(),unitAbbreviation:this.getUnitAbbreviation()},n),this._descriptionHash)},r.prototype.getLabel=function(){return this._label},r.prototype.getUnitType=function(){return this._unitType},r.prototype.getUnitName=function(){return this._unitName},r.prototype.getUnitPluralName=function(){return this._unitPluralName},r.prototype.getUnitAbbreviation=function(){return this._unitAbbreviation},r.prototype.setFormat=function(e){this._formatter=d3.format(e)},r.prototype.format=function(e,t){t=t||{};var n,r,i,s=!0;return t.format?t.format===this._lastFormat?n=this._lastFormatter:(n=d3.format(t.format),this._lastFormat=t.format,this._lastFormatter=n):n=this._formatter,r=n(e),t&&t.abbreviated!=null&&(s=t.abbreviated),s?r+" "+this._unitAbbreviation:(i=parseFloat(r)!==1,r+" "+(i?this._unitPluralName:this._unitName))},r}),define("md2d/models/unit-definitions/md2d",[],function(){return{name:"md2d",translated:!1,units:{length:{name:"nanometer",pluralName:"nanometers",symbol:"nm"},mass:{name:"atomic mass unit",pluralName:"atomic mass units",symbol:"amu"},time:{name:"femtosecond",pluralName:"femtoseconds",symbol:"fs",displayValue:{unitsPerBaseUnit:.001,pluralName:"picoseconds",name:"picosecond",symbol:"ps"}},inverseTime:{name:"1/femtosecond",pluralName:"1/femtoseconds",symbol:"1/fs"},velocity:{name:"nanometer per femtosecond",pluralName:"nanometers per second",symbol:"nm/s"},acceleration:{name:"nanometer per femtosecond squared",pluralName:"nanometers per femtosecond squared",symbol:"nm/fs"},momentum:{name:"amu nanometer per femtosecond",pluralName:"amu nanometers per femtosecond",symbol:"amunm/fs"},force:{name:"amu nanometer per femtosecond squared",pluralName:"amu nanometers per femtosecond squared",symbol:"amunm/fs"},energy:{name:"electron volt",pluralName:"electron volts",symbol:"eV"},dampingCoefficient:{name:"amu per femtosecond",pluralName:"amu per femtoseconds",symbol:"amu/fs"},stiffness:{name:"electron volt per nanometer squared",pluralName:"electron volts per nanometer squared",symbol:"eV/nm"},rotationalStiffness:{name:"electron volt per radian",pluralName:"electron volts per radian",symbol:"eV/rad"},charge:{name:"elementary charge",pluralName:"elementary charges",symbol:"e"},temperature:{name:"Kelvin",pluralName:"Kelvin",symbol:"K"},pressure:{name:"bar",pluralName:"bar",symbol:"bar"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}}}),define("md2d/models/unit-definitions/mks",[],function(){return{name:"mks",translated:!0,units:{length:{name:"meter",pluralName:"meters",symbol:"m",representationInMD2DUnits:1,valueInSIUnits:1},mass:{name:"kilogram",pluralName:"kilograms",symbol:"kg",representationInMD2DUnits:1,valueInSIUnits:1},time:{name:"second",pluralName:"seconds",symbol:"s",representationInMD2DUnits:1e4,valueInSIUnits:1},inverseTime:{name:"1/second",pluralName:"1/seconds",symbol:"1/s",valueInSIUnits:1},velocity:{name:"meter per second",pluralName:"meters per second",symbol:"m/s",valueInSIUnits:1},acceleration:{name:"meter per second squared",pluralName:"meters per second squared",symbol:"m/s",valueInSIUnits:1},force:{name:"Newton",pluralName:"Newtons",symbol:"N",valueInSIUnits:1},energy:{name:"Joule",pluralName:"Joules",symbol:"J",valueInSIUnits:1},dampingCoefficient:{name:"Newton second per meter",pluralName:"Newton seconds per meter",symbol:"Ns/m",valueInSIUnits:1},stiffness:{name:"Newton per meter",pluralName:"Newtons per meter",symbol:"N/m",valueInSIUnits:1},rotationalStiffness:{name:"Newton-meter per radian",pluralName:"Newton-meters per radian",symbol:"Nm/rad",valueInSIUnits:1},charge:{name:"Coulomb",pluralName:"Coulombs",symbol:"C",valueInSIUnits:1}}}}),define("md2d/models/unit-definitions/index",["require","md2d/models/unit-definitions/md2d","md2d/models/unit-definitions/mks","underscore"],function(e){var t={md2d:e("md2d/models/unit-definitions/md2d"),mks:e("md2d/models/unit-definitions/mks")},n=e("underscore");return{get:function(e){var r;return e==="md2d"?t.md2d:(r=n.extend({},t[e]),r.units=n.extend({},t.md2d.units,t[e].units),r)}}}),define("md2d/models/units-translation",["require","underscore","md2d/models/engine/constants/index","md2d/models/engine/potentials/coulomb"],function(e){var t=e("underscore"),n=e("md2d/models/engine/constants/index"),r=e("md2d/models/engine/potentials/coulomb"),i=n.COULOMB_CONSTANT.as(n.unit.METERS_PER_FARAD),s=["length","mass","time"];return function(o){var u={},a={},f;return t.each(s,function(e){var t=o.units[e];u[e]=t.valueInSIUnits/t.representationInMD2DUnits}),u.inverseTime=1/u.time,u.velocity=u.length/u.time,u.acceleration=u.velocity/u.time,u.force=u.mass*u.acceleration,u.energy=n.ratio(n.unit.MW_ENERGY_UNIT,{per:n.unit.EV}),u.energy*=u.force*u.length,u.dampingCoefficient=u.force/u.velocity,u.stiffness=u.energy/u.length/u.length,u.rotationalStiffness=u.energy/u.length,f=r.force(1,-1,1,1),u.charge=Math.sqrt(f*u.force*u.length*u.length/i),t.each(t.keys(u),function(e){a[e]=u[e]/o.units[e].valueInSIUnits}),{translateToMD2DUnits:function(e,t){return a[t]==null?e:e/a[t]},translateFromMD2DUnits:function(e,t){return a[t]==null?e:e*a[t]}}}}),define("md2d/models/performance-optimizer",[],function(){function t(e){this._model=e,this._initialTimeStep=this._model.get("timeStep"),this._maxTimeStep=this._initialTimeStep*2,this._targetProgressRate=this._initialTimeStep*this._model.get("timeStepsPerTick")*60,this.enabled=!1}var e=2.5;return t.prototype._assessPerformance=function(){if(!this.enabled||this._model.is_stopped())return;var t=this._model.getSimulationProgressRate(),n=this._model.getFPS(),r=this._model.get("timeStep"),i=this._model.get("timeStepsPerTick"),s=this._model.get("temperatureControl")?this._maxTimeStep*2.5:this._maxTimeStep;t<.9*this._targetProgressRate?1.1*r<s?this._model.set("timeStep",1.1*r):n>e&&this._model.set("timeStepsPerTick",Math.round(1.1*i+.5)):t>1.1*this._targetProgressRate&&this._model.set("timeStepsPerTick",Math.round(.9*i-.5)),setTimeout($.proxy(this._assessPerformance,this),250)},t.prototype.enable=function(){if(this.enabled)return;this._model.start(),this.enabled=!0,this._model.set("timeStepsPerTick",5),setTimeout($.proxy(this._assessPerformance,this),250)},t.prototype.disable=function(){this.enabled=!1},t}),define("md2d/models/modeler",["require","arrays","common/console","common/performance","md2d/models/engine/md2d","md2d/models/metadata","common/models/tick-history","cs!md2d/models/running-average-filter","cs!md2d/models/solvent","common/serialize","common/validator","md2d/models/aminoacids-props","cs!md2d/models/aminoacids-helper","md2d/models/engine/constants/units","md2d/models/property-description","md2d/models/unit-definitions/index","md2d/models/units-translation","md2d/models/performance-optimizer","underscore"],function(e){var t=e("arrays"),n=e("common/console"),r=e("common/performance"),i=e("md2d/models/engine/md2d"),s=e("md2d/models/metadata"),o=e("common/models/tick-history"),u=e("cs!md2d/models/running-average-filter"),a=e("cs!md2d/models/solvent"),f=e("common/serialize"),l=e("common/validator"),c=e("md2d/models/aminoacids-props"),h=e("cs!md2d/models/aminoacids-helper"),p=e("md2d/models/engine/constants/units"),d=e("md2d/models/property-description"),v=e("md2d/models/unit-definitions/index"),m=e("md2d/models/units-translation"),g=e("md2d/models/performance-optimizer"),y=e("underscore");return function(b){function it(e){e=y.uniq(e);for(var t=0,n=e.length;t<n;t++)e[t]()}function st(e){var t,n,r=[],i,s;typeof e=="string"?n=[e]:n=e;for(i=0,s=n.length;i<s;i++)t=n[i],X[t]&&(r=r.concat(X[t]));X.all&&(r=r.concat(X.all)),it(r)}function ot(e){var t,n=[],r;for(t in e)if(e.hasOwnProperty(t)){if(Q[t])throw new Error('Attempt to restore output property "'+t+'".');r=e[t],J[t]!==r&&(J["set_"+t]?J["set_"+t](r):J[t]=r,n.push(t))}st(n)}function ut(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&(J[t]!==e[t]||!et[t].isDefined)&&(J[t]=e[t],et[t].isDefined=!0,n.push(t));for(t in et)et.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(et[t].isDefined=!1,J[t]=undefined);st(n)}function at(){var e,t=0,n=w.get_num_atoms();e=-1;while(++e<n)t+=D.atoms.speed[e];return t/n}function ft(e,t){var i=ct("timeStep"),s=D.getNumberOfRadialBonds(),o,u;return T||(o=r.now(),L?(u=o-L,L=o,A.push(u),A.splice(0,A.length-64)):L=o),n.time("integration"),D.integrate(w.get("timeStepsPerTick")*i,i),n.timeEnd("integration"),n.time("reading model state"),vt(),n.timeEnd("reading model state"),n.time("tick history push"),M.push(),n.timeEnd("tick history push"),C=!0,t||E.tick(),s<D.getNumberOfRadialBonds()&&E.addRadialBond(),T}function lt(e){var t,n=[];for(t in e)if(e.hasOwnProperty(t)&&e[t]!==undefined&&e[t]!==null){if(Q[t])throw new Error('Attempt to set read-only output property "'+t+'".');J["set_"+t]?J["set_"+t](e[t]):J[t]=e[t],n.push(t)}st(n)}function ct(e){return J[e]}function ht(e,t){e=y.extend({},e);for(var n in e)e.hasOwnProperty(n)&&(e[n]=t(n,e[n]));return e}function pt(e,t){return rt?ht(e,function(e,n){return rt.translateToMD2DUnits(n,t[e]&&t[e].unitType)}):e}function dt(e,t){return rt?ht(e,function(e,n){return rt.translateFromMD2DUnits(n,t[e]&&t[e].unitType)}):e}function vt(){var e,t,n;St();for(e=0;e<K.length;e++)Q[K[e]].hasCachedValue=!1;for(e=0;e<G.length;e++)Y[G[e]].addSample();for(e=0;e<K.length;e++){n=X[K[e]];if(n)for(t=0;t<n.length;t++)n[t]()}}function mt(){if(V)return;$++,wt(),bt(),Z=!0}function gt(){if(V)return;$--,$===0&&(Z=!1),Et(),M&&M.invalidateFollowingState(),E.invalidation()}function bt(){var e,t;for(e=0;e<K.length;e++)t=Q[K[e]],t.hasCachedValue=!1}function wt(){var e,t,n,r;for(e=0;e<K.length;e++)t=K[e],(r=X[t])&&r.length>0&&(n=Q[t],n.previousValue=n.hasCachedValue?n.cachedValue:n.calculate())}function Et(){var e,t,n,r,i,s=[];St();for(e=0;e<G.length;e++)Y[G[e]].addSample();for(e=0;e<K.length;e++){r=K[e],n=Q[r];if((i=X[r])&&i.length>0){n.hasCachedValue||(n.cachedValue=n.calculate(),n.hasCachedValue=!0);if(n.cachedValue!==n.previousValue)for(t=0;t<i.length;t++)s.push(i[t])}n.previousValue=null}for(e=0;e<s.length;e++)s[e]()}function St(){var e,t,n,r;D.computeOutputState(O),xt();for(e=0,n=w.get_num_atoms();e<n;e++){for(t in H)H.hasOwnProperty(t)&&(R[e][t]=H[t][e]);h.isAminoAcid(H.element[e])&&(r=h.getAminoAcidByElement(H.element[e]),R[e].symbol=r.symbol,R[e].label=r.abbreviation)}}function xt(){var e=function(){return h.isAminoAcid(this.element)},t,n;R||(R=[]);for(t=R.length,n=w.get_num_atoms();t<n;t++)R[t]||(R[t]={idx:t,isAminoAcid:e});R.length=n}function Tt(){var e=D.getNumberOfElements(),t=Math.floor(Math.random()*e);while(h.isAminoAcid(t))t=Math.floor(Math.random()*e);return t}function Nt(){var e,t,n,r;for(n=D.getNumberOfElements();n<=h.lastElementID;n++)w.addElement({id:n});for(n=0,r=c.length;n<r;n++)e=18*Math.pow(c[n].volume/c[0].volume,.3333333333333),t=p.convert(e/10,{from:p.unit.ANGSTROM,to:p.unit.NANOMETER}),D.setElementProperties(h.firstElementID+n,{mass:c[n].molWeight,sigma:t})}this.constructor.type="md2d";var w={},E=d3.dispatch("tick","play","stop","reset","willReset","stepForward","stepBack","seek","addAtom","removeAtom","addRadialBond","removeRadialBond","removeAngularBond","invalidation","textBoxesChanged"),S={"short":1.33,medium:1.67,"long":2},x=1e3,T=!0,N=!1,C=!1,k=!1,L,A=[],O,M,D,P,H,B,j,F,I,q,R,U,z=null,W,X={},V=!1,$=0,J={set_targetTemperature:function(e){this.targetTemperature=e,D&&D.setTargetTemperature(e)},set_temperatureControl:function(e){this.temperatureControl=e,D&&D.useThermostat(e)},set_lennardJonesForces:function(e){this.lennardJonesForces=e,D&&D.useLennardJonesInteraction(e)},set_coulombForces:function(e){this.coulombForces=e,D&&D.useCoulombInteraction(e)},set_solventForceType:function(e){this.solventForceType=e,D&&D.setSolventForceType(e)},set_solventForceFactor:function(e){this.solventForceFactor=e,D&&D.setSolventForceFactor(e)},set_additionalSolventForceMult:function(e){this.additionalSolventForceMult=e,D&&D.setAdditionalSolventForceMult(e)},set_additionalSolventForceThreshold:function(e){this.additionalSolventForceThreshold=e,D&&D.setAdditionalSolventForceThreshold(e)},set_dielectricConstant:function(e){this.dielectricConstant=e,D&&D.setDielectricConstant(e)},set_realisticDielectricEffect:function(e){this.realisticDielectricEffect=e,D&&D.setRealisticDielectricEffect(e)},set_VDWLinesCutoff:function(e){var t;this.VDWLinesCutoff=e,t=S[e],t&&D&&D.setVDWLinesRatio(t)},set_gravitationalField:function(e){this.gravitationalField=e,D&&D.setGravitationalField(e)},set_modelSampleRate:function(e){this.modelSampleRate=e,T||w.restart()},set_timeStep:function(e){this.timeStep=e},set_viscosity:function(e){this.viscosity=e,D&&D.setViscosity(e)},set_polarAAEpsilon:function(e){var t,n,r,i,s,o;this.polarAAEpsilon=e;if(D){t=h.getPolarAminoAcids();for(i=0,o=t.length;i<o;i++){n=t[i];for(s=i+1;s<o;s++)r=t[s],D.pairwiseLJProperties.set(n,r,{epsilon:e})}}}},K=[],Q={},G=[],Y={},Z=!1,et={},tt,nt,rt,yt=function(){var e=[{getNum:"getNumberOfAtoms",addEvent:"addAtom",removeEvent:"removeAtom"},{getNum:"getNumberOfRadialBonds",addEvent:"addRadialBond",removeEvent:"removeRadialBond"}];return function(t){var n,r,i;for(n=0;n<e.length;n++)r=e[n],r.num=D[r.getNum]();t();for(n=0;n<e.length;n++)r=e[n],i=D[r.getNum](),i>r.num?E[r.addEvent]():i<r.num&&E[r.removeEvent]()}}();return w.getStats=function(){return{time:w.get("time"),speed:at(),ke:w.get("kineticEnergy"),temperature:w.get("temperature"),current_step:M.get("counter"),steps:M.get("length")-1}},w.getStatsHistory=function(e){var t,n,r,i,s,o,u=[];n=M.get("length"),arguments.length?r=Math.max(n-e,0):r=0,u.push("time (fs)	total PE (eV)	total KE (eV)	total energy (eV)");for(t=r;t<n;t++)i=M.returnTick(t),o=i.output.PE,s=i.output.KE,u.push(i.output.time+"	"+o+"	"+s+"	"+(o+s));return u.join("\n")},w.stepCounter=function(){return M.get("counter")},w.stepStartCounter=function(){return M.get("startCounter")},w.steps=function(){return M.get("length")},w.isNewStep=function(){return C},w.seek=function(e){return arguments.length||(e=0),w.is_stopped()||w.stop(),C=!1,yt(function(){M.seekExtract(e),vt(),E.seek()}),M.get("counter")},w.stepBack=function(e){return arguments.length||(e=1),w.is_stopped()||w.stop(),C=!1,yt(function(){var t,n;t=-1;while(++t<e)n=M.get("index"),n>0&&(M.decrementExtract(),vt(),E.stepBack())}),M.get("counter")},w.stepForward=function(e){return arguments.length||(e=1),w.is_stopped()||w.stop(),yt(function(){var t,n,r;t=-1;while(++t<e)n=M.get("index"),r=M.get("length"),n<r-1?(M.incrementExtract(),vt(),E.stepForward()):ft()}),M.get("counter")},w.initializeDimensions=function(){w.set({minX:0,maxX:w.get("width"),minY:0,maxY:w.get("height")})},w.initializeEngine=function(){D=i.createEngine(),D.setDimensions([w.get("minX"),w.get("minY"),w.get("maxX"),w.get("maxY")]),D.useLennardJonesInteraction(w.get("lennardJonesForces")),D.useCoulombInteraction(w.get("coulombForces")),D.useThermostat(w.get("temperatureControl")),D.setViscosity(w.get("viscosity")),D.setVDWLinesRatio(S[w.get("VDWLinesCutoff")]),D.setGravitationalField(w.get("gravitationalField")),D.setTargetTemperature(w.get("targetTemperature")),D.setDielectricConstant(w.get("dielectricConstant")),D.setRealisticDielectricEffect(w.get("realisticDielectricEffect")),D.setSolventForceType(w.get("solventForceType")),D.setSolventForceFactor(w.get("solventForceFactor")),D.setAdditionalSolventForceMult(w.get("additionalSolventForceMult")),D.setAdditionalSolventForceThreshold(w.get("additionalSolventForceThreshold")),D.pairwiseLJProperties.registerChangeHooks(mt,gt),D.geneticProperties.registerChangeHooks(mt,gt),window.state=O={},H=D.atoms,B=D.elements,F=D.radialBonds,U=D.radialBondResults,I=D.angularBonds,q=D.restraints,j=D.obstacles},w.createElements=function(e){var t,n,r,i;w.startBatch();if(e===undefined){w.addElement({id:0}),w.endBatch();return}for(t=0,n=e.mass.length;t<n;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);w.addElement(i)}return w.endBatch(),w},w.createNewAtoms=function(e){return w.initializeDimensions(),w.initializeEngine(),w.createElements(P),w.createAtoms(e),w},w.createAtoms=function(e){var t={suppressCheck:!0},n,r,i,s;E.willReset(),w.startBatch(),typeof e=="number"?r=e:e.num!=null?r=e.num:e.x&&(r=e.x.length);if(e.x&&e.y)for(n=0;n<r;n++){s={};for(i in e)e.hasOwnProperty(i)&&(s[i]=e[i][n]);w.addAtom(s,t)}else{for(n=0;n<r;n++)s={x:0,y:0},w.addAtom(s,t);D.setupAtomsRandomly({temperature:w.get("targetTemperature"),userElements:P===undefined?1:P.mass.length}),e.relax&&D.relaxToTemperature()}return w.endBatch(),E.reset(),w},w.createRadialBonds=function(e){var t=e.strength.length,n,r,i;w.startBatch();for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);w.addRadialBond(i)}return w.endBatch(),w},w.createAngularBonds=function(e){var t=e.strength.length,n,r,i;w.startBatch();for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);w.addAngularBond(i)}return w.endBatch(),w},w.createRestraints=function(e){var t=e.atomIndex.length,n,r,i;for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);w.addRestraint(i)}return w},w.createObstacles=function(e){var t=e.x.length,n,r,i;for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);w.addObstacle(i)}return w},w.reset=function(){E.willReset(),mt(),w.resetTime(),M.restoreInitialState(),gt(),E.reset()},w.resetTime=function(){D.setTime(0)},w.getTotalMass=function(){return D.getTotalMass()},w.getAtomKineticEnergy=function(e){return D.getAtomKineticEnergy(e)},w.addRandomAtom=function(e,t){e==null&&(e=Tt()),t==null&&(t=0);var n=w.get("width"),r=w.get("height"),i=w.get("minX"),s=w.get("minY"),o=D.getRadiusOfElement(e),u,a,f,l=0,c=10;do{u=i+Math.random()*n-2*o,a=s+Math.random()*r-2*o,f=D.findMinimumPELocation(e,u,a,0,0,t);if(f&&w.addAtom({element:e,x:f[0],y:f[1],charge:t}))return!0}while(++l<c);return!1},w.addAtom=function(e,t){var n=w.get("minX"),r=w.get("minY"),i=w.get("maxX"),o=w.get("maxY"),u;return t=t||{},e=l.validateCompleteness(s.atom,e),u=D.getRadiusOfElement(e.element),e.x<n+u&&(e.x=n+u),e.x>i-u&&(e.x=i-u),e.y<r+u&&(e.y=r+u),e.y>o-u&&(e.y=o-u),!t.suppressCheck&&!D.canPlaceAtom(e.element,e.x,e.y)?!1:(t.deserialization||mt(),D.addAtom(e),t.deserialization||gt(),t.suppressEvent||E.addAtom(),!0)},w.removeAtom=function(e,t){var n=D.getNumberOfRadialBonds(),r=D.getNumberOfAngularBonds();t=t||{},mt(),D.removeAtom(e),R.length=0,gt(),t.suppressEvent||(E.removeAtom(),D.getNumberOfRadialBonds()!==n&&E.removeRadialBond(),D.getNumberOfAngularBonds()!==r&&E.removeAngularBond())},w.addElement=function(e){e=l.validateCompleteness(s.element,e),D.addElement(e)},w.addObstacle=function(e){var t;e.color!==undefined&&e.colorR===undefined&&(e.colorR=e.color[0],e.colorG=e.color[1],e.colorB=e.color[2]),t=l.validateCompleteness(s.obstacle,e),mt(),D.addObstacle(t),gt()},w.removeObstacle=function(e){mt(),D.removeObstacle(e),gt()},w.addRadialBond=function(e,t){e=l.validateCompleteness(s.radialBond,e),(!t||!t.deserialization)&&mt(),D.addRadialBond(e),(!t||!t.deserialization)&&gt(),E.addRadialBond()},w.removeRadialBond=function(e){mt(),D.removeRadialBond(e),mt(),E.removeRadialBond()},w.addAngularBond=function(e,t){e=l.validateCompleteness(s.angularBond,e),(!t||!t.deserialization)&&mt(),D.addAngularBond(e),(!t||!t.deserialization)&&gt()},w.removeAngularBond=function(e){mt(),D.removeAngularBond(e),gt(),E.removeAngularBond()},w.addRestraint=function(e){e=l.validateCompleteness(s.restraint,e),mt(),D.addRestraint(e),gt()},w.getMoleculeBoundingBox=function(e){var t,n,r,i,s,o=-Infinity,u=Infinity,a=Infinity,f=-Infinity,l,c;t=D.getMoleculeAtoms(e),t.push(e);for(n=0;n<t.length;n++)r=H.x[t[n]],i=H.y[t[n]],s=H.radius[t[n]],r-s<u&&(u=r-s),r+s>f&&(f=r+s),i-s<a&&(a=i-s),i+s>o&&(o=i+s);return l=H.x[e],c=H.y[e],{top:o-c,left:u-l,bottom:a-c,right:f-l}},w.setAtomProperties=function(e,t,n,r){var i,o,u,a,f,c,h;t=l.validate(s.atom,t);if(r){i=D.getMoleculeAtoms(e);if(i.length>0){o=typeof t.x=="number"?t.x-H.x[e]:0,u=typeof 
t.y=="number"?t.y-H.y[e]:0;for(c=0,h=i.length;c<h;c++){a=H.x[i[c]]+o,f=H.y[i[c]]+u;if(!w.setAtomProperties(i[c],{x:a,y:f},n,!1))return!1}}}if(n){var p=typeof t.x=="number"?t.x:H.x[e],d=typeof t.y=="number"?t.y:H.y[e],v=typeof t.element=="number"?t.y:H.element[e];if(!D.canPlaceAtom(v,p,d,e))return!1}return mt(),D.setAtomProperties(e,pt(t,s.atom)),gt(),!0},w.getAtomProperties=function(e){var t=s.atom,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=H[r][e]);return dt(n,t)},w.getRadialBondsForAtom=function(e){return D.getRadialBondsForAtom(e)},w.getAngularBondsForAtom=function(e){return D.getAngularBondsForAtom(e)},w.getMoleculeAtoms=function(e){return D.getMoleculeAtoms(e)},w.setElementProperties=function(e,t){t=l.validate(s.element,t);if(h.isAminoAcid(e))throw new Error("Elements: elements with ID "+e+" cannot be edited, as they define amino acids.");mt(),D.setElementProperties(e,pt(t,s.element)),gt()},w.getElementProperties=function(e){var t=s.element,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=B[r][e]);return dt(n,t)},w.setObstacleProperties=function(e,t){t=l.validate(s.obstacle,t),mt(),D.setObstacleProperties(e,pt(t,s.obstacle)),gt()},w.getObstacleProperties=function(e){var t=s.obstacle,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=j[r][e]);return dt(n,t)},w.setRadialBondProperties=function(e,t){t=l.validate(s.radialBond,t),mt(),D.setRadialBondProperties(e,pt(t,s.radialBond)),gt()},w.getRadialBondProperties=function(e){var t=s.radialBond,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=F[r][e]);return dt(n,t)},w.setRestraintProperties=function(e,t){t=l.validate(s.restraint,t),mt(),D.setRestraintProperties(e,pt(t,s.restraint)),gt()},w.getRestraintProperties=function(e){var t=s.restraint,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=q[r][e]);return dt(n,t)},w.setAngularBondProperties=function(e,t){t=l.validate(s.angularBond,t),mt(),D.setAngularBondProperties(e,pt(t,s.angularBond)),gt()},w.getAngularBondProperties=function(e){var t=s.angularBond,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=I[r][e]);return dt(n,t)},w.setSolvent=function(e){var t=new a(e),n={solventForceType:t.forceType,dielectricConstant:t.dielectricConstant,backgroundColor:t.color};w.set(n)},w.addSpringForce=function(e,t,n,r){return r==null&&(r=500),rt&&(r=rt.translateToMD2DUnits(r,"stiffness")),D.addSpringForce(e,t,n,r)},w.updateSpringForce=function(e,t,n){D.updateSpringForce(e,t,n)},w.removeSpringForce=function(e){D.removeSpringForce(e)},w.addTextBox=function(e){e=l.validateCompleteness(s.textBox,e),J.textBoxes.push(e),E.textBoxesChanged()},w.removeTextBox=function(e){var t=J.textBoxes;if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');J.textBoxes=t.slice(0,e).concat(t.slice(e+1)),E.textBoxesChanged()},w.setTextBoxProperties=function(e,t){var n=J.textBoxes[e],r;if(!n)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=l.validate(s.textBox,t);for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);E.textBoxesChanged()},w.liveDragStart=function(e,t,n){if(z!==null)return;t==null&&(t=H.x[e]),n==null&&(n=H.y[e]),W=w.getAtomProperties(e).friction,w.setAtomProperties(e,{friction:w.LIVE_DRAG_FRICTION}),z=w.addSpringForce(e,t,n,500)},w.liveDrag=function(e,t){w.updateSpringForce(z,e,t)},w.liveDragEnd=function(){var e=D.springForceAtomIndex(z);w.setAtomProperties(e,{friction:W}),w.removeSpringForce(z),z=null},w.get_speed=function(){return t.copy(D.atoms.speed,[])},w.getFPS=function(){var e=0,t=A.length,n=-1;while(++n<t)e+=A[n];return e/=t,e?1/e*1e3:0},w.getSimulationProgressRate=function(){return w.getFPS()*w.get("timeStep")*w.get("timeStepsPerTick")},w.is_stopped=function(){return T},w.get_atoms=function(){return H},w.get_elements=function(){return B},w.get_results=function(){return R},w.get_radial_bond_results=function(){return U},w.get_num_atoms=function(e){return D.getNumberOfAtoms(e)},w.get_obstacles=function(){return j},w.getNumberOfElements=function(){return D.getNumberOfElements()},w.getNumberOfObstacles=function(){return D.getNumberOfObstacles()},w.getNumberOfRadialBonds=function(){return D.getNumberOfRadialBonds()},w.getNumberOfAngularBonds=function(){return D.getNumberOfAngularBonds()},w.get_radial_bonds=function(){return F},w.get_restraints=function(){return q},w.getPairwiseLJProperties=function(){return D.pairwiseLJProperties},w.getGeneticProperties=function(){return D.geneticProperties},w.get_vdw_pairs=function(){return D.getVdwPairsArray()},w.on=function(e,t){return E.on(e,t),w},w.tickInPlace=function(){return E.tick(),w},w.tick=function(e,t){arguments.length||(e=1);var n=t&&t.dontDispatchTickEvent||!1,r=-1;while(++r<e)ft(null,n);return w},w.relax=function(){return D.relaxToTemperature(),w},w.minimizeEnergy=function(){return mt(),D.minimizeEnergy(),gt(),w},w.generateProtein=function(e,t){var n;return mt(),n=D.generateProtein(e,t),R.length=0,gt(),E.addAtom(),n},w.extendProtein=function(e,t,n){mt(),D.extendProtein(e,t,n),R.length=0,gt(),E.addAtom()},w.translateStepByStep=function(){var e=D.geneticProperties.translateStepByStep(),t=D.geneticProperties.get().translationStep,n=D.geneticProperties.get().height,r=D.geneticProperties.get().width,i=r*t*3+1.5*r,s=n*5,o=w.get("width"),u=w.get("height"),a;while(i>o)i-=r*3;while(s>u)s-=n;return e!==undefined?w.extendProtein(i,s,e):(a=w.get_num_atoms()-1,w.setAtomProperties(a,{pinned:!1})),e===undefined},w.animateTranslation=function(){var e=function(){var t=w.translateStepByStep();t===!1&&setTimeout(e,1e3)};if(k===!0)return;k=!0,T&&w.resume(),e()},w.start=function(){return T?w.resume():w},w.restart=function(){N=!0},w.resume=function(){return n.time("gap between frames"),w.timer(function(t){return n.timeEnd("gap between frames"),T?!0:N?(setTimeout(w.resume,0),!0):(ft(t,!1),n.time("gap between frames"),!1)}),N=!1,L=null,T&&(T=!1,E.play()),w},w.timer=function(e){var t,n=w.get("modelSampleRate");n==="default"?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)},w.stop=function(){return T=!0,E.stop(),w},w.ave_ke=function(){return O.KE/w.get_num_atoms()},w.ave_pe=function(){return O.PE/w.get_num_atoms()},w.speed=function(){return at()},w.dimensions=function(){return D.getDimensions()},w.set=function(e,t){var n;arguments.length===1?n=e:(n={},n[e]=t),l.validate(s.mainProperties,n),l.validate(s.viewOptions,n),D&&mt(),lt(pt(n,tt)),D&&gt()},w.get=function(e){var t,n;if(J.hasOwnProperty(e))n=J[e];else if(t=Q[e])Z?n=t.calculate():(t.hasCachedValue||(t.hasCachedValue=!0,t.cachedValue=t.calculate()),n=t.cachedValue);return rt&&tt[e]&&(n=rt.translateFromMD2DUnits(n,tt[e].unitType)),n},w.format=function(e,t){t=t||{};var n=w.getPropertyDescription(e);return n?n.format(w.get(e),t):d3.format(t.format||"g")(w.get(e))},w.addPropertiesListener=function(e,t){function r(e){X[e]||(X[e]=[]),X[e].push(t)}var n;if(typeof e=="string")r(e);else for(n=0;n<e.length;n++)r(e[n])},w.defineOutput=function(e,t,n){K.push(e),tt[e]={unitType:t.unitType},Q[e]={description:new d(nt,t),calculate:n,hasCachedValue:!1,previousValue:null}},w.defineFilteredOutput=function(e,t,n,r,i){var s,o;if(r!=="RunningAverage")throw new Error("FilteredOutput: unknown filter type "+r+".");s=new u(i),o=w.get(n);if(o===undefined||isNaN(Number(o)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");s.addSample(w.get("time"),o),G.push(e),Y[e]={addSample:function(){s.addSample(w.get("time"),w.get(n))}},M.registerExternalObject({push:function(){},extract:function(e){s.setCurrentStep(e)},invalidate:function(e){s.invalidate(e)},setHistoryLength:function(e){s.setMaxBufferLength(e)}}),t.property=n,t.type=r,t.period=i,w.defineOutput(e,t,function(){return s.calculate()})},w.defineParameter=function(e,t,n){et[e]={description:new d(nt,t),setter:n,isDefined:!1},tt[e]={unitType:"untranslated"},J["set_"+e]=function(t){J[e]=t,et[e].isDefined=!0,et[e].setter&&et[e].setter.call(w,t)}},w.getUnitDefinition=function(e){return nt.units[e]},w.getPropertyDescription=function(e){var t=Q[e]||et[e];if(t)return t.description},w.getPropertyType=function(e){if(Q[e])return"output";if(et[e])return"parameter"},w.startBatch=function(){mt(),V=!0},w.endBatch=function(){V=!1,gt()},w.serialize=function(){var e={},t,n,r,i=function(t,n){e.atoms[t].every(function(e){return e===n})&&delete e.atoms[t]};e=f(s.mainProperties,J),e.viewOptions=f(s.viewOptions,J),e.atoms=f(s.atom,H,D.getNumberOfAtoms()),D.getNumberOfRadialBonds()&&(e.radialBonds=f(s.radialBond,F,D.getNumberOfRadialBonds())),D.getNumberOfAngularBonds()&&(e.angularBonds=f(s.angularBond,I,D.getNumberOfAngularBonds()));if(D.getNumberOfObstacles()){e.obstacles=f(s.obstacle,j,D.getNumberOfObstacles()),e.obstacles.color=[];for(n=0,r=e.obstacles.colorR.length;n<r;n++)e.obstacles.color.push([e.obstacles.colorR[n],e.obstacles.colorG[n],e.obstacles.colorB[n]]),e.obstacles.westProbe[n]=Boolean(e.obstacles.westProbe[n]),e.obstacles.northProbe[n]=Boolean(e.obstacles.northProbe[n]),e.obstacles.eastProbe[n]=Boolean(e.obstacles.eastProbe[n]),e.obstacles.southProbe[n]=Boolean(e.obstacles.southProbe[n]);delete e.obstacles.colorR,delete e.obstacles.colorG,delete e.obstacles.colorB}D.getNumberOfRestraints()>0&&(e.restraints=f(s.restraint,q,D.getNumberOfRestraints())),D.geneticProperties.get()!==undefined&&(e.geneticProperties=D.geneticProperties.serialize()),e.elements=f(s.element,B,5),e.pairwiseLJProperties=[],t=D.pairwiseLJProperties.serialize();for(n=0,r=t.length;n<r;n++)t[n].element1<=5&&t[n].element2<=5&&e.pairwiseLJProperties.push(t[n]);return e.temperatureControl===!1&&delete e.targetTemperature,e.viewOptions.showAtomTrace===!1&&delete e.viewOptions.atomTraceId,e.modelSampleRate==="default"&&delete e.modelSampleRate,i("marked",s.atom.marked.defaultValue),i("visible",s.atom.visible.defaultValue),i("draggable",s.atom.draggable.defaultValue),e},w.LIVE_DRAG_FRICTION=10,lt(l.validateCompleteness(s.mainProperties,b)),function(){if(!b.viewOptions||!b.viewOptions.textBoxes)return;var e=b.viewOptions.textBoxes,t,n;for(t=0,n=e.length;t<n;t++)e[t]=l.validateCompleteness(s.textBox,e[t])}(),lt(l.validateCompleteness(s.viewOptions,b.viewOptions||{})),w.initializeDimensions(),w.initializeEngine(),P=b.elements,w.createElements(P),Nt(),w.set({polarAAEpsilon:w.get("polarAAEpsilon")}),b.atoms?w.createAtoms(b.atoms):b.mol_number&&(w.createAtoms(b.mol_number),b.relax&&w.relax()),b.radialBonds&&w.createRadialBonds(b.radialBonds),b.angularBonds&&w.createAngularBonds(b.angularBonds),b.restraints&&w.createRestraints(b.restraints),b.obstacles&&w.createObstacles(b.obstacles),b.pairwiseLJProperties&&D.pairwiseLJProperties.deserialize(b.pairwiseLJProperties),b.geneticProperties&&D.geneticProperties.deserialize(b.geneticProperties),M=new o({input:["targetTemperature","lennardJonesForces","coulombForces","temperatureControl","keShading","chargeShading","showVDWLines","showVelocityVectors","showForceVectors","showClock","timeStepsPerTick","timeStep","viscosity","gravitationalField"],getRawPropertyValue:ct,restoreProperties:ot,parameters:et,restoreParameters:ut,state:D.getState()},w,x),C=!0,nt=v.get(w.get("unitsScheme")),w.get("unitsScheme")!=="md2d"&&(rt=new m(nt)),tt={},y.each(s.mainProperties,function(e,t){e.unitType&&(tt[t]={unitType:e.unitType})}),w.defineOutput("time",{label:"Time",unitType:"time",format:"f"},function(){return O.time}),w.defineOutput("timePerTick",{label:"Model time per tick",unitName:nt.units.time.name,unitPluralName:nt.units.time.pluralName,unitAbbreviation:nt.units.time.symbol,format:"f"},function(){return w.get("timeStep")*w.get("timeStepsPerTick")}),function(){var e;nt.units.time.displayValue?e=nt.units.time.displayValue:(e=y.extend({},nt.units.time),e.unitsPerBaseUnit=1),w.defineOutput("displayTime",{label:"Time",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return w.get("time")*e.unitsPerBaseUnit}),w.defineOutput("displayTimePerTick",{label:"Model time per tick",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return w.get("timePerTick")*e.unitsPerBaseUnit})}(),w.defineOutput("tickCounter",{label:"Tick Counter",unitType:"",format:"4g"},function(){return M.get("counter")}),w.defineOutput("newStep",{label:"New Step",unitType:"",format:""},function(){return C}),w.defineOutput("kineticEnergy",{label:"Kinetic Energy",unitType:"energy",format:".4g"},function(){return O.KE}),w.defineOutput("potentialEnergy",{label:"Potential Energy",unitType:"energy",format:".4g"},function(){return O.PE}),w.defineOutput("totalEnergy",{label:"Total Energy",unitType:"energy",format:".4g"},function(){return O.KE+O.PE}),w.defineOutput("temperature",{label:"Temperature",unitType:"temperature",format:"f"},function(){return O.temperature}),vt(),w.performanceOptimizer=new g(w),w}}),define("common/views/model-view",["require","lab.config","common/console"],function(e){var t=e("lab.config"),n=e("common/console");return function(r,i,s,o){function F(e,n){r=e||r,i=n||i,r&&(p=t.actualRoot+r.slice(0,r.lastIndexOf("/")+1))}function I(){return parseFloat(f.css("font-size"))||18}function q(){h=I(),c=h/18,b={top:0*c,right:0*c,bottom:0*c,left:0*c};if(i.get("xunits")||i.get("yunits"))b.bottom+=h*1.2,b.left+=h*1.3,b.top+=h/2,b.right+=h/2;if(i.get("xlabel")||i.get("ylabel"))b.bottom+=h*.8,b.left+=h*.8}function R(){var e=i.get("width"),t=i.get("height"),n=i.get("minX"),r=i.get("minY"),s=i.get("maxX"),o=i.get("maxY"),u=e/t,a,c;q(),g=f.width(),a=g-b.left-b.right,c=a/u,y=c+b.top+b.bottom,l.style.height=y+"px",w={width:g-b.left-b.right,height:y-b.top-b.bottom},w={width:a,height:c},E={width:e,height:t,minX:n,minY:r,maxX:s,maxY:o},j=l.offsetTop+b.top,B=l.offsetLeft+b.left,S=d3.scale.linear().domain([E.minX,E.maxX]).range([0,w.width]),x=d3.scale.linear().domain([E.maxY,E.minY]).range([0,w.height]),T=function(e){return S(n+e)},H&&H.x(S).y(x)}function U(){var e=function(e){return"translate("+S(e)+",0)"},t=function(e){return"translate(0,"+x(e)+")"},n=function(e){return e?"#ccc":"#666"},r=S.tickFormat(5),s=x.tickFormat(5),o=i.getUnitDefinition("length");d3.event&&d3.event.transform&&d3.event.transform(S,x);var u=C.selectAll("g.x").data(S.ticks(5),String).attr("transform",e).classed("axes",!0);u.select("text").text(r);var a=u.enter().insert("g","a").attr("class","x").attr("transform",e);i.get("gridLines")?a.append("line").attr("stroke",n).attr("y1",0).attr("y2",w.height):a.selectAll("line").remove(),i.get("xunits")?a.append("text").attr("class","xunits").attr("y",w.height).attr("dy",h*.8+"px").attr("text-anchor","middle").text(r):a.select("text.xunits").remove(),i.get("xlabel")?v.append("text").attr("class","axis").attr("class","xlabel").text(o.pluralName).attr("x",w.width/2).attr("y",w.height).attr("dy",h*1.6+"px").style("text-anchor","middle"):v.select("text.xlabel").remove(),u.exit().remove();var f=C.selectAll("g.y").data(x.ticks(5),String).attr("transform",t).classed("axes",!0);f.select("text").text(s);var l=f.enter().insert("g","a").attr("class","y").attr("transform",t).attr("background-fill","#FFEEB6");i.get("gridLines")?l.append("line").attr("stroke",n).attr("x1",0).attr("x2",w.width):l.selectAll("line").remove(),i.get("yunits")?l.append("text").attr("class","yunits").attr("x","-0.3em").attr("dy",h/6+"px").attr("text-anchor","end").text(s):a.select("text.yunits").remove(),i.get("ylabel")?v.append("g").append("text").attr("class","axis").attr("class","ylabel").text(o.pluralName).style("text-anchor","middle").attr("transform","translate("+ -h*1.6+" "+w.height/2+") rotate(-90)"):v.select("text.ylabel").remove(),f.exit().remove()}function z(){m.style("fill",i.get("backgroundColor"))}function W(){X()}function X(){i.get("enableKeyboardHandlers")&&l.focus()}function V(){R(),v===undefined?(d=d3.select(l).append("svg").attr({xmlns:"http://www.w3.org/2000/svg","xmlns:xmlns:xlink":"http://www.w3.org/1999/xlink",width:g,height:y}).style({width:"100%",height:"100%"}),v=d.append("g").attr("class","particle-container-vis"),m=v.append("rect").attr("class","plot"),i.get("enableKeyboardHandlers")&&d3.select(l).attr("tabindex",0).on("mousedown",W),C=v.append("g").attr("class","grid-container"),A=v.append("g").attr("class","image-container-below"),M=v.append("g").attr("class","text-container-below"),k=v.append("g").attr("class","radial-bonds-container"),L=v.append("g").attr("class","vdw-lines-container"),N=v.append("g").attr("class","main-container"),O=v.append("g").attr("class","image-container-top"),_=v.append("g").attr("class","text-container-top"),D=v.append("g").attr("class","brush-container"),u.containers={gridContainer:C,imageContainerBelow:A,textContainerBelow:M,radialBondsContainer:k,VDWLinesContainer:L,mainContainer:N,imageContainerTop:O,textContainerTop:_}):(v.selectAll("g.x").remove(),v.selectAll("g.y").remove()),d.attr({width:g,height:y}),v.attr("transform","translate("+b.left+","+b.top+")"),v.select("rect.plot").attr({width:w.width,height:w.height}),U()}function J(){var e;for(e in P)P.hasOwnProperty(e)&&v.selectAll(e).on("click.custom",null)}function K(){P={},i.url=r,a?a.reset(i):a=new s(u,i),i.addPropertiesListener(["backgroundColor"],Q),i.addPropertiesListener(["gridLines","xunits","yunits","xlabel","ylabel"],function(){V(),Q()})}function Q(){z(),a.repaint(S,x,T),u.updateClickHandlers()}var u={},a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j;return u={$el:null,node:null,update:null,containers:null,scale:R,setFocus:X,getFontSizeInPixels:I,resize:function(){V(),Q()},getHeightForWidth:function(e){var t=i.get("width"),n=i.get("height"),r=t/n,s;return q(),e=e-b.left-b.right,s=e/r,s+b.top+b.bottom},repaint:function(){Q()},reset:function(e,t){J(),u.setSelectHandler(null),F(e,t),V(),K(),Q()},model2px:function(e){return S(e)},model2pxInv:function(e){return x(e)},modelSize2px:function(e){return T(e)},pos:function(){return N.node().parentElement.getBoundingClientRect()},setClickHandler:function(e,t){if(typeof t!="function")throw new Error("Click handler should be a function.");P[e]=t,u.updateClickHandlers()},updateClickHandlers:function(){function t(e){return function(t,r){var i=d3.mouse(m.node()),s=S.invert(i[0]),o=x.invert(i[1]);n.log("[view] click at ("+s.toFixed(3)+", "+o.toFixed(3)+")"),e(s,o,t,r)}}var e;for(e in P)P.hasOwnProperty(e)&&v.selectAll(e).on("click.custom",t(P[e]))},setSelectHandler:function(e){if(typeof e!="function"&&e!==null)throw new Error("Select handler should be a function or null.");D.select("g.select-area").remove();if(e===null)return;H=d3.svg.brush().x(S).y(x).on("brushend.select",function(){var t=H.extent(),r=t[0][0],i=t[0][1],s=t[1][0]-r,o=t[1][1]-i;n.log("[view] selection area ("+r.toFixed(3)+", "+i.toFixed(3)+"), width: "+s+", height: "+o),e(r,i,s,o),H.clear(),D.call(H)}),D.append("g").classed("select-area",!0).call(H)}},f=$("<div>").attr({id:"model-container","class":"container",tabindex:o}).css({width:"50px",height:"50px"}),l=f[0],F(),V(),K(),u.update=a.update,u.$el=f,u.node=l,u}}),define("common/benchmark/benchmark",["require"],function(e){function i(){var e=/ (Chrome)\/(.*?) /,t=/ (Firefox)\/([0123456789ab.]+)/,r=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,i=/ (MSIE) ([0123456789.]+);/,o=/^(Opera)\/.+? Version\/([0123456789.]+)$/,u=/.+?\((iPhone); CPU.+?OS .+?Version\/([0123456789._]+)/,a=/.+?\((iPad); CPU.+?OS .+?Version\/([0123456789._]+)/,f=/.+?\((iPod); CPU (iPhone.+?) like.+?Version\/([0123456789ab._]+)/,l=/.+?(Android) ([0123456789.]+).*?; (.+?)\).+? Chrome\/([0123456789.]+)/,c=/.+?(Android.+?\)).+? Firefox\/([0123456789.]+)/,h=/.+?(Android) ([0123456789ab.]+).*?; (.+?)\)/,p;p=navigator.userAgent.match(e);if(p&&p[1])return{browser:p[1],version:p[2],oscpu:s()};p=navigator.userAgent.match(t);if(p&&p[1]){var d=navigator.buildID,v="";return d&&d.length>=8&&(v="("+d.slice(0,4)+"-"+d.slice(4,6)+"-"+d.slice(6,8)+")"),{browser:p[1],version:p[2]+" "+v,oscpu:s()}}p=navigator.userAgent.match(l);if(p&&p[1])return{browser:"Chrome",version:p[4],oscpu:p[1]+"/"+p[2]+"/"+p[3]};p=navigator.userAgent.match(c);if(p&&p[1])return{browser:"Firefox",version:p[2],oscpu:p[1]};p=navigator.userAgent.match(h);if(p&&p[1])return{browser:"Android",version:p[2],oscpu:p[1]+"/"+p[2]+"/"+p[3]};p=navigator.userAgent.match(r);if(p&&p[3])return{browser:p[3],version:p[2]+"/"+p[1],oscpu:s()};p=navigator.userAgent.match(i);if(p&&p[1]){var m=navigator.userAgent.match(/\(.*?(Windows.+?); (.+?)[;)].*/);return{browser:p[1],version:p[2],oscpu:n[m[1]]+"/"+navigator.cpuClass+"/"+navigator.platform}}return p=navigator.userAgent.match(o),p&&p[1]?{browser:p[1],version:p[2],oscpu:s()}:(p=navigator.userAgent.match(u),p&&p[1]?{browser:"Mobile Safari",version:p[2],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:(p=navigator.userAgent.match(a),p&&p[1]?{browser:"Mobile Safari",version:p[2],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:(p=navigator.userAgent.match(f),p&&p[1]?{browser:"Mobile Safari",version:p[3],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:{browser:"",version:navigator.appVersion,oscpu:""})))}function s(){var e=navigator.userAgent.match(/\((.+?)[;)] (.+?)[;)].*/);if(!e)return"na";if(e[1]==="Macintosh")return e[2];if(e[1].match(/^Windows/)){var t=r[e[2]]||"32",i=navigator.userAgent.match(/\(.*?(Windows NT.+?)[;)]/);return n[i[1]]+"/"+t}}function o(e,t,n){function v(t){var n=e.getElementsByTagName("tr")[0],r=n.appendChild(document.createElement("th"));r.innerHTML=t,l[t]=f++}function m(t){t=t||0;var n=e.appendChild(document.createElement("tr")),r;for(r=0;r<t;r++)n.appendChild(document.createElement("td"));return n}function g(e,t,n){var r;n=n||o,r=n.getElementsByTagName("td")[l[e]],typeof t=="string"&&t.slice(0,1)==="<"?r.innerHTML=t:r.textContent=t}function y(){function m(e){return Math.floor(e)==e}var e,n,r,i,s=d.length,o,u,a=average_row.getElementsByTagName("td"),f,c,h,p=d3.format("5.1f"),v=d3.format("f");for(e=0;e<t.length;e++){r=t[e],u=l[r.name];if(r.numeric===!1)i=d[2],o=i.getElementsByTagName("td")[u],a[u].innerHTML=o.innerHTML;else{f=0;for(n=2;n<s;n++)i=d[n],o=i.getElementsByTagName("td")[u],f+=+o.textContent;c=f/(s-2),r.formatter?c=r.formatter(c):m(c)?c=v(f/(s-2)):c=p(f/(s-2)),a[u].textContent=c}}}var r=0,i,s,o,u,a,f=0,l={},c,h,p,d=e.getElementsByTagName("tr");e.style.display="";if(d.length===0){m(),v("browser"),v("version"),v("cpu/os"),v("date");for(r=0;r<t.length;r++)v(t[r].name);average_row=m(f),average_row.className="average"}else{c=d[0],h=c.getElementsByTagName("th");for(r=0,p=h.length;r<p;r++)l[h[r].innerHTML]=f++}o=m(f),o.className="sample";for(r=0;r<4;r++)u=n[r],g(u[0],u[1]),g(u[0],u[1],average_row);for(r=4;r<n.length;r++)u=n[r],g(u[0],u[1]);y()}function u(e,t,n,r){var s,o,u=[],a=i(),f=d3.time.format("%Y-%m-%d %H:%M");u.push(["browser",a.browser]),u.push(["version",a.version]),u.push(["cpu/os",a.oscpu]),u.push(["date",f(new Date)]),o=0,n&&n();for(s=0;s<e.length;s++)(function(n){n.run(function(i){n.formatter?u.push([n.name,n.formatter(i)]):u.push([n.name,i]),++o===e.length&&(r&&r(),t&&t(u))})})(e[s]),r!==undefined;return u}function a(e,t,n,r,i){var s;return u(e,function(r){o(t,e,r),n(r)},r,i),s}var t="0.0.1",n={"Windows NT 6.2":"Windows 8","Windows NT 6.1":"Windows 7","Windows NT 6.0":"Windows Vista","Windows NT 5.2":"Windows Server 2003; Windows XP x64 Edition","Windows NT 5.1":"Windows XP","Windows NT 5.01":"Windows 2000, Service Pack 1 (SP1)","Windows NT 5.0":"Windows 2000","Windows NT 4.0":"Microsoft Windows NT 4.0"},r={WOW64:"64/32","Win64; IA64":"64","Win64; x64":"64"};return{version:t,what_browser:function(){return i()},run:function(e,t,n,r,i){a(e,t,n,r,i)},bench:function(e,t,n,r){return u(e,t,n,r)},renderToTable:function(e,t,n){o(e,t,n)}}}),function(){define("cs!md2d/views/aminoacid-context-menu",["require","cs!md2d/models/aminoacids-helper"],function(e){var t,n,r,i,s,o,u,a,f,l;return f=e("cs!md2d/models/aminoacids-helper"),o="aminoacids-menu",i="hydrophobic",r="hydrophobic-category",n="hydrophilic",t="hydrophilic-category",a="pos-charge",u="neg-charge",s="marked",l=function(e,s){var o;return o={show:s?"slideDown":"show",hide:s?"slideUp":"hide"},e==="hydrophobic"?($("."+i)[o.show](),$("."+n)[o.hide](),$("."+r).addClass("expanded"),$("."+t).removeClass("expanded")):($("."+i)[o.hide](),$("."+n)[o.show](),$("."+r).removeClass("expanded"),$("."+t).addClass("expanded"))},{register:function(e,c,h){return $.contextMenu("destroy",h),$.contextMenu({selector:h,appendTo:"#responsive-content",className:o,animation:{show:"show",hide:"hide"},callback:function(t,n){var r,i,o;return o=d3.select(n.$trigger[0]).datum(),i=f.getAminoAcidByElement(o.element).abbreviation,n.items[i].$node.removeClass(s),r=f.abbrToElement(t),e.setAtomProperties(o.idx,{element:r}),c.repaint()},position:function(e,t,n){var r,i,s,o,u,a,f;r=$(window);if(!t&&!n){e.determinePosition.call(this,e.$menu);return}return t==="maintain"&&n==="maintain"?o=e.$menu.position():(a=e.$trigger.parents().andSelf().filter(function(){return $(this).css("position")==="fixed"}).length,a&&(n-=r.scrollTop(),t-=r.scrollLeft()),o={top:n,left:t}),i=r.scrollTop()+r.height(),u=r.scrollLeft()+r.width(),s=e.$menu[0].scrollHeight,f=e.$menu[0].scrollWidth,o.top+s>i&&(o.top-=s),o.left+f>u&&(o.left-=f),o.left+=1,e.$menu.css(o)},events:{show:function(e){var t,n,r;return r=d3.select(e.$trigger[0]).datum(),n=f.getAminoAcidByElement(r.element).abbreviation,t=e.items[n].$node,t.addClass(s),t.hasClass(i)?l("hydrophobic"):l("hydrophilic"),!0},hide:function(e){var t,n;return n=d3.select(e.$trigger[0]).datum(),t=f.getAminoAcidByElement(n.element).abbreviation,e.items[t].$node.removeClass(s),!0}},items:{Hydrophobic:{name:"Hydrophobic",className:""+r,callback:function(){return l("hydrophobic",!0),!1}},Gly:{name:"Glycine",className:""+i},Ala:{name:"Alanine",className:""+i},Val:{name:"Valine",className:""+i},Leu:{name:"Leucine",className:""+i},Ile:{name:"Isoleucine",className:""+i},Phe:{name:"Phenylalanine",className:""+i},Pro:{name:"Proline",className:""+i},Trp:{name:"Tryptophan",className:""+i},Met:{name:"Methionine",className:""+i},Cys:{name:"Cysteine",className:""+i},Tyr:{name:"Tyrosine",className:""+i},Hydrophilic:{name:"Hydrophilic",className:""+t,callback:function(){return l("hydrophilic",!0),!1}},Asn:{name:"Asparagine",className:""+n},Gln:{name:"Glutamine",className:""+n},Ser:{name:"Serine",className:""+n},Thr:{name:"Threonine",className:""+n},Asp:{name:"Asparticacid",className:""+n+" "+u},Glu:{name:"Glutamicacid",className:""+n+" "+u},Lys:{name:"Lysine",className:""+n+" "+a},Arg:{name:"Arginine",className:""+n+" "+a},His:{name:"Histidine",className:""+n+" "+a}}}),l("hydrophobic")}}})}.call(this),define("md2d/views/genetic-renderer",["require"],function(e){return function(t,n,r){var i,s,o,u,a=function(){s=n.model2px,o=n.model2pxInv,u=n.modelSize2px,r.getGeneticProperties().on("change",i.setup)},f=function(e,t,n,r,i,s){var o=0,a="",f,l,c;n+="px";for(l=0,c=t.length;l<c;l++)a+=o+"px ",o+=r;if(s===undefined||s==="end")s=t.length/3;s*=3,e.append("text").text(t).attr({"class":"shadow",x:a,dy:i}).style({"stroke-width":u(.01),"font-size":n}),f=e.append("text").attr({"class":"front",x:a,dy:i}).style("font-size",n),f.append("tspan").text(t.substring(0,s)),f.append("tspan").attr("class","marked-mrna").text(t.substring(s,s+3)),f.append("tspan").text(t.substring(s+3))};return i={setup:function(){var e=r.getGeneticProperties().get(),n,i,a;if(e===undefined)return;t.selectAll("g.dna").remove(),n=t.append("g").attr({"class":"dna",transform:"translate("+s(e.x)+","+o(e.y)+")"}),i=u(e.height),a=u(e.width),f(n,e.DNA,i,a,-i),f(n,e.DNAComplement,i,a,0),e.mRNA!==undefined&&f(n,e.mRNA,i,a,-2.5*i,e.translationStep)}},a(),i}}),function(){define("cs!common/layout/wrap-svg-text",["require"],function(e){var t,n;return t="http://www.w3.org/2000/svg",n=window.wrapSVGText=function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;f=/-/gi,e.search("\n")>0?(S=e.split("\n"),p=!0,a=[]):(S=e.split(/[\s-]/),p=!1,a=function(){var t;t=[];while(v=f.exec(e))t.push(v.index);return t}()),u=0,o=0,d=1,b=0;for(l=x=0,T=S.length;x<T;l=++x)E=S[l],u+=E.length+1,l===0||p||r>0&&o>r?(l>0&&(p?(b=Math.max(y.getComputedTextLength(),b),d++):(m=y.firstChild.nodeValue,m.length>S[l-1].length+1?(c=m.slice(m.length-S[l-1].length-1),y.firstChild.nodeValue=m.slice(0,m.length-S[l-1].length-1)):m.length===S[l-1].length+1&&(y.firstChild.nodeValue=m.slice(0,m.length-1)),b=Math.max(y.getComputedTextLength(),b),d++)),y=document.createElementNS(t,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",l===0?0:s),g=document.createTextNode(h),y.appendChild(g),n.appendChild(y),~a.indexOf(u-1)?h=E+"-":h=E+" ",l&&c&&(h=c+h)):~a.indexOf(u-1)?h+=E+"-":h+=E+" ",y.firstChild.nodeValue=h,o=y.getComputedTextLength(),p&&(b=Math.max(y.getComputedTextLength(),b)),p||l&&l===S.length-1&&r>0&&o>r&&(m=y.firstChild.nodeValue,y.firstChild.nodeValue=m.slice(0,m.length-S[l].length-1),y=document.createElementNS(t,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",s),g=document.createTextNode(S[l]),y.appendChild(g),n.appendChild(y),d++);return b===0&&(b=n.childNodes[0].getComputedTextLength()),r>b?w=r:w=b,{lines:d,width:w,textWidth:b}}})}.call(this),define("common/views/gradients",[],function(){return{createRadialGradient:function(e,t,n,r,i){var s,o,u;return o=i.select("defs"),o.empty()&&(o=i.append("defs")),u=o.select("#"+e),u.empty()?u=o.append("radialGradient").attr("id",e).attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"):u.selectAll("stop").remove(),u.append("stop").attr("stop-color",t).attr("offset","0%"),u.append("stop").attr("stop-color",n).attr("offset","40%"),u.append("stop").attr("stop-color",r).attr("offset","80%"),u.append("stop").attr("stop-color",n).attr("offset","100%"),s="url(#"+e+")",this.mainColorOfGradient[s]=r,s},mainColorOfGradient:{}}}),define("md2d/views/renderer",["require","lab.config","common/alert","common/console","common/benchmark/benchmark","cs!md2d/views/aminoacid-context-menu","md2d/views/genetic-renderer","cs!common/layout/wrap-svg-text","common/views/gradients"],function(e){var t=e("lab.config"),n=e("common/alert"),r=e("common/console"),i=e("common/benchmark/benchmark"),s=e("cs!md2d/views/aminoacid-context-menu"),o=e("md2d/views/genetic-renderer"),u=e("cs!common/layout/wrap-svg-text"),a=e("common/views/gradients"),f={STANDARD_STICK:101,LONG_SPRING:102,BOND_SOLID_LINE:103,GHOST:104,UNICOLOR_STICK:105,SHORT_SPRING:106,DOUBLE_BOND:107,TRIPLE_BOND:108,DISULPHIDE_BOND:109};return function(l,c){function Ot(){return z+U(c.get("displayTime"))+W}function Mt(e,t,n,r,i){return c.setAtomProperties(e,{x:t,y:n},r,i)}function _t(e){return"rgb("+K.colorR[e]+","+K.colorG[e]+","+K.colorB[e]+")"}function Dt(e,t,n){var r=(t+Math.pow(2,24)).toString(16),i,s,o,u,f;for(f=r.length;f<6;f++)r=String(0)+r;return i=d3.rgb("#"+r),s=i.toString(),o=i.brighter(1).toString(),u=i.darker(1).toString(),a.createRadialGradient(e,o,s,u,n)}function Pt(){var e,t,n,r,i;for(e=0;e<4;e++)Dt("elem"+e+"-grad",d.color[e],E);r=c.get("markColor"),t=d3.rgb(r),n=t.brighter(1).toString(),i=t.darker(1).toString(),a.createRadialGradient("mark-grad",n,r,i,E)}function Ht(){var e=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#F2F2F2","#FF8080"]),t=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]),n,r,i,s;for(s=0;s<_;s++)n="ke-shading-"+s,i=s/_,r=a.createRadialGradient(n,"#FFFFFF",e(i),t(i),E),M[s]=r;a.createRadialGradient("neg-grad","#ffefff","#fdadad","#e95e5e",E),a.createRadialGradient("pos-grad","#dfffff","#9abeff","#767fbf",E),a.createRadialGradient("neutral-grad","#FFFFFF","#f2f2f2","#A4A4A4",E),a.createRadialGradient("green-grad","#dfffef","#75a643","#2a7216",E),a.createRadialGradient("orange-grad","#F0E6D1","#E0A21B","#AD7F1C",E)}function Bt(e,t){var n,r="Triangle-"+t,i;n=E.select("defs"),n.empty()&&(n=E.append("defs")),i=n.select("#"+r),i.empty()&&(i=n.append("marker").attr("id","Triangle-"+t).attr("viewBox","0 0 10 10").attr("refX","0").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","3").attr("orient","auto").attr("stroke",e).attr("fill",e),i.append("path").attr("d","M 0 0 L 10 5 L 0 10 z"))}function jt(e){var t,n,r;if(e.marked)return"url(#mark-grad)";if(nt)return t=c.getAtomKineticEnergy(e.idx),n=Math.min(5*t,1),M[Math.round(n*(_-1))];if(tt)return r=e.charge,r===0?"url(#neutral-grad)":r>0?"url(#pos-grad)":"url(#neg-grad)";if(!e.isAminoAcid())return O[e.element%4];switch(c.get("aminoAcidColorScheme")){case"none":return"url(#neutral-grad)";case"hydrophobicity":return e.hydrophobicity>0?"url(#orange-grad)":"url(#green-grad)";case"charge":if(e.charge===0)return"url(#neutral-grad)";return e.charge>0?"url(#pos-grad)":"url(#neg-grad)";case"chargeAndHydro":if(e.charge<-0.000001)return"url(#neg-grad)";if(e.charge>1e-6)return"url(#pos-grad)";return e.hydrophobicity>0?"url(#orange-grad)":"url(#green-grad)";default:throw new Error("ModelContainer: unknown amino acid color scheme."
)}}function Ft(e){return Kt(e)?"#888":a.mainColorOfGradient[D[e.atom1]]}function It(e){return Kt(e)?"#888":a.mainColorOfGradient[D[e.atom2]]}function qt(){var e="1%";E.select("#heat-bath").empty()&&E.append("image").attr({id:"heat-bath",x:e,width:"3%",height:"3%",preserveAspectRatio:"xMinYMin","xlink:href":"../../resources/heatbath.gif"}),E.select("#ke-gradient").empty()&&E.append("image").attr({id:"ke-gradient",x:e,width:"12%",height:"12%",preserveAspectRatio:"xMinYMin","xlink:href":"../../resources/ke-gradient.png"})}function Rt(){var e=c.get("temperatureControl"),t,n,r=0,i=1;e?(r+=i,t=E.select("#heat-bath").attr("y",r+"%").style("display",""),n=t.attr("height"),n=Number(n.substring(0,n.length-1)),r+=n):E.select("#heat-bath").style("display","none"),nt?(r+=i,E.select("#ke-gradient").attr("y",r+"%").style("display","")):E.select("#ke-gradient").style("display","none")}function Ut(){E.selectAll("circle").data(p).attr("r",function(e){return w(e.radius)})}function zt(){H.enter().append("circle").attr({"class":function(e){return e.isAminoAcid()?"draggable atom amino-acid":"atom draggable"},r:function(e){return w(e.radius)},cx:function(e){return y(e.x)},cy:function(e){return b(e.y)},"fill-opacity":function(e){return e.visible?1:0},fill:function(e,t){return D[t]}}).on("mousedown",mn).on("mouseover",vn).on("mouseout",yn).call(d3.behavior.drag().on("dragstart",Mn).on("drag",Hn).on("dragend",jn)),H.exit().remove()}function Wt(e,t,n,r,i){e.enter().append("path").attr({"class":"vector-"+i,"marker-end":At?"":"url(#Triangle-"+i+")",d:t,"stroke-width":n,stroke:r,fill:"none"})}function Xt(){xt.enter().append("path").attr({"class":"atomTrace",d:Cn,"stroke-width":w(.01),stroke:St,fill:"none","stroke-dasharray":"6, 6"})}function Vt(){var e=J.enter().append("g");e.attr("class","obstacle").attr("transform",function(e,t){return"translate("+y(K.x[t])+" "+b(K.y[t]+K.height[t])+")"}),e.append("rect").attr({"class":"obstacle-shape",x:0,y:0,width:function(e,t){return w(K.width[t])},height:function(e,t){return w(K.height[t])},fill:function(e,t){return K.visible[t]?_t(t):"rgba(128,128,128, 0)"},"stroke-width":function(e,t){return K.visible[t]?.2:0},stroke:function(e,t){return K.visible[t]?_t(t):"rgba(128,128,128, 0)"}}),e.each(function(e,t){if(!K.externalAx[t]&&!K.externalAy[t])return;var n=d3.select(this),r=K.height[t],i=K.width[t],s=K.externalAx[t],o=K.externalAy[t],u=.06,a=.06,f,l;s&&(f=(r-2*a)/Math.round((r-2*a)/.2),l=d3.range(a,r,f),n.selectAll("path.obstacle-force-hor").data(l).enter().append("path").attr({"class":"obstacle-force-hor",d:function(e){return s<0?"M "+w(i+u+a)+","+w(e)+" L "+w(i+a)+","+w(e):"M "+w(-u-a)+","+w(e)+" L "+w(-a)+","+w(e)}})),o&&(f=(i-2*a)/Math.round((i-2*a)/.2),l=d3.range(a,i,f),n.selectAll("path.obstacle-force-vert").data(l).enter().append("path").attr({"class":"obstacle-force-vert",d:function(e){return o<0?"M "+w(e)+","+w(-u-a)+" L "+w(e)+","+w(-a):"M "+w(e)+","+w(r+u+a)+" L "+w(e)+","+w(r+a)}})),n.selectAll("path.obstacle-force-hor, path.obstacle-force-vert").attr({"marker-end":At?"":"url(#Triangle-"+Ct+")","stroke-width":w(lt),stroke:ft,fill:"none"})})}function $t(){G.enter().append("path").attr({d:function(e){return Jt(e,1)},"stroke-width":function(e){return Kt(e)?Qt(e):w(Math.min(p[e.atom1].radius,p[e.atom2].radius))*.75},stroke:Ft,fill:"none"}).classed("radialbond1",!0).classed("disulphideBond",function(e){return e.type===f.DISULPHIDE_BOND}),Y.enter().append("path").attr({d:function(e){return Jt(e,2)},"stroke-width":function(e){return Kt(e)?Qt(e):w(Math.min(p[e.atom1].radius,p[e.atom2].radius))*.75},stroke:It,fill:"none"}).classed("radialbond2",!0).classed("disulphideBond",function(e){return e.type===f.DISULPHIDE_BOND})}function Jt(e,t){var n,r,i,s,o,u,a,f,l,c,h,d,v,m,g,E,S,x,T,N,C,k,L,A,O,M;u=y(e.x1),f=b(e.y1),a=y(e.x2),l=b(e.y2),s=a-u,o=l-f,N=e.strength,T=Math.sqrt(s*s+o*o)/w(.01),C=Math.floor(e.length*24),k=T/C,S=s/T,x=o/T,L=S*k,A=x*k,O=S*C,M=x*C,c=w(p[e.atom1].radius)*S,h=w(p[e.atom2].radius)*S,v=w(p[e.atom1].radius)*x,m=w(p[e.atom2].radius)*x,d=c-h,g=v-m;if(Kt(e)){E="M "+u+","+f+" ";for(i=0;i<C;i++)i%2===0?(n=u+(i+.5)*L-.5*M,r=f+(i+.5)*A+.5*O):(n=u+(i+.5)*L+.5*M,r=f+(i+.5)*A-.5*O),E+=" L "+n+","+r;return E+=" L "+a+","+l}return t===1?"M "+u+","+f+" L "+(a+u+d)/2+" , "+(l+f+g)/2:"M "+(a+u+d)/2+" , "+(l+f+g)/2+" L "+a+","+l}function Kt(e){return e.type===f.SHORT_SPRING}function Qt(e){return 1.25}function Gt(){var e=w(.02),t=w(.03)+" "+w(.02);et.attr({x1:function(e){return y(p[e[0]].x)},y1:function(e){return b(p[e[0]].y)},x2:function(e){return y(p[e[1]].x)},y2:function(e){return b(p[e[1]].y)}}),et.enter().append("line").attr({"class":"attractionforce",x1:function(e){return y(p[e[0]].x)},y1:function(e){return b(p[e[0]].y)},x2:function(e){return y(p[e[1]].x)},y2:function(e){return b(p[e[1]].y)}}).style({"stroke-width":e,"stroke-dasharray":t}),et.exit().remove()}function Yt(e){return bt+(vt[e.imageUri]||e.imageUri)}function Zt(){var e=[],t,n,r,i,s=[],o=[];N.selectAll("image").remove(),T.selectAll("image").remove();if(!dt)return;for(r=0;r<dt.length;r++)e[r]=new Image,e[r].src=Yt(dt[r])+(Lt?"?"+Math.random():""),e[r].onload=function(r){return function(){t=dt[r].imageLayer,i=t===1?s:o,i.push({i:r,zOrder:dt[r].imageLayerPosition?dt[r].imageLayerPosition:0}),i.sort(function(e,t){return d3.ascending(e.zOrder,t.zOrder)}),gt[r]=[.01*e[r].width,.01*e[r].height],n=t===1?N:T,n.selectAll("image").remove(),n.selectAll("image").data(i,function(e){return e.i}).enter().append("image").attr("x",function(e){return An(e.i)[0]}).attr("y",function(e){return An(e.i)[1]}).attr("class",function(e){return"image_attach"+e.i+" draggable"}).attr("xlink:href",function(t){return e[t.i].src}).attr("width",function(e){return w(gt[e.i][0])}).attr("height",function(e){return w(gt[e.i][1])}).attr("pointer-events","none")}}(r)}function en(e){var t,n,r,i,s,o,u=R*e.fontScale;return e.hostType?e.hostType==="Atom"?(t=p[e.hostIndex].x,n=p[e.hostIndex].y):(t=K.x[e.hostIndex]+K.width[e.hostIndex]/2,n=K.y[e.hostIndex]+K.height[e.hostIndex]/2):(t=e.x,n=e.y),s=y(t),o=b(n),r=s+u*.75,i=o+u*1.2,[r,i,s,o]}function tn(){var e=[k,C],t;t=function(t){var n=e[t-1],r=yt.filter(function(e){return e.layer===t});n.selectAll("g.textBoxWrapper rect").data(r.filter(function(e){return e.frame})).attr({x:function(e){return en(e)[2]},y:function(e){return en(e)[3]},transform:function(e){var t=e.rotate,n=en(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"}}),n.selectAll("g.textBoxWrapper text").data(r).attr({y:function(e){return $(this).find("tspan").attr("x",en(e)[0]),en(e)[1]}})},t(1),t(2)}function nn(){var e,n,i;yt=c.get("textBoxes"),e=[c.get("width"),c.get("height")],n=[k,C],i=function(i){var s=n[i-1],o,u,a;s.selectAll("g.textBoxWrapper").remove(),u=yt.filter(function(e){return e.layer===i}),a=s.selectAll("g.textBoxWrapper").data(u),o=a.enter().append("svg:g").attr("class","textBoxWrapper"),o.filter(function(e){return e.frame}).append("rect").attr({"class":function(e,t){return"textBoxFrame text-"+t},transform:function(e){var t=e.rotate,n=en(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},style:function(e){var t=e.backgroundColor,n=e.strokeWidthEms*q,r=e.strokeOpacity;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:"+n+";stroke-opacity:"+r},width:0,height:0,rx:function(e){return e.frame==="rounded rectangle"?R/2.5:0},ry:function(e){return e.frame==="rounded rectangle"?R/2:0},x:function(e){return en(e)[2]},y:function(e){return en(e)[3]}}),o.append("text").attr({"class":function(){return"textBox"+(AUTHORING?" draggable":"")},transform:function(e){var t=e.rotate,n=en(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},"x-data":function(e){return en(e)[0]},y:function(e){return en(e)[1]},"width-data":function(e){return e.width},"height-data":function(e){return e.height},width:w(e[0]),height:w(e[1]),"xml:space":"preserve","font-family":"'"+t.fontface+"', sans-serif","font-size":function(e){return e.fontScale*R+"px"},fill:function(e){return e.color||"black"},"text-data":function(e){return e.text},"text-anchor":function(e){var t=e.textAlign||"left";return t==="center"&&(t="middle"),t},"has-host":function(e){return!!e.hostType}}).call(d3.behavior.drag().on("drag",Bn).on("dragend",function(e){r.log('"x": '+e.x+","),r.log('"y": '+e.y+",")})),a.exit().remove()},i(1),i(2),$(".textBox").each(function(){var e=this.getAttributeNS(null,"text-data"),t=this.getAttributeNS(null,"x-data"),n=this.getAttributeNS(null,"width-data"),r=this.getAttributeNS(null,"height-data"),i=parseFloat(this.getAttributeNS(null,"font-size")),s=this.getAttributeNS(null,"transform"),o=this.getAttributeNS(null,"has-host"),a=this.getAttributeNS(null,"text-anchor"),f,l,c,h,p,d,v;p=i*1.2,f=+i*1.5,l=i/1.8,n===""?n=-1:n=w(n),r===""?r=-1:r=w(r);while(this.firstChild)this.removeChild(this.firstChild);c=u(e,this,n,t,p),this.parentNode.childElementCount>1&&(h=this.parentNode.childNodes[0],h.setAttributeNS(null,"width",c.width+f),r>0?h.setAttributeNS(null,"height",r):h.setAttributeNS(null,"height",c.lines*p+l)),a==="middle"&&(d=c.width/2,r>0?v=r/2-l*1.5-(c.lines-1)*p/2:v=0,s=s+" translate("+d+","+v+")",$(this).attr("transform",s)),o==="true"&&(d=c.width/-2-f/2,v=c.lines*p/-2-l/2,$(this.parentNode).attr("transform","translate("+d+","+v+")"))})}function rn(){var e,t;tt=c.get("chargeShading"),nt=c.get("keShading"),D.length=p.length;for(e=0,t=p.length;e<t;e++)D[e]=jt(p[e])}function sn(){var e=c.get("showChargeSymbols"),t=c.get("useThreeLetterCode");E.selectAll("circle").remove(),E.selectAll("g.label").remove(),H=E.selectAll("circle").data(p),Ut(),zt(),B=E.selectAll("g.label").data(p),j=B.enter().append("g").attr("class","label").attr("transform",function(e){return"translate("+y(e.x)+","+b(e.y)+")"}),j.each(function(n){var r=d3.select(this),i,s;if(c.get("atomNumbers"))r.append("text").text(n.idx).style("font-size",w(1.4*n.radius)+"px");else if(t&&n.label)r.append("text").text(n.label).attr("class","shadow").style("font-size",w(n.radius)+"px"),r.append("text").text(n.label).style("font-size",w(n.radius)+"px");else if(!t&&n.symbol)r.append("text").text(n.symbol).attr("class","shadow").style("font-size",w(1.4*n.radius)+"px"),r.append("text").text(n.symbol).style("font-size",w(1.4*n.radius)+"px");else if(e){if(n.charge>0)i="+";else{if(!(n.charge<0))return;i="-"}r.append("text").text(i).style("font-size",w(1.6*n.radius)+"px")}s=r.selectAll("text"),s.node()&&(s.attr("pointer-events","none").style({"font-weight":"bold",opacity:.7}),s.attr({x:-s.node().getBBox().width/2,y:"0.31em"})),r.select("text.shadow").style({stroke:"#fff","stroke-width":.15*w(n.radius),"stroke-opacity":.7})})}function on(){K=c.get_obstacles(),E.selectAll("g.obstacle").remove(),K&&(Q.length=K.x.length,J=E.selectAll("g.obstacle").data(Q),Vt())}function un(){S.selectAll("path.radialbond1").remove(),S.selectAll("path.radialbond2").remove(),X=c.get_radial_bonds(),V=c.get_radial_bond_results(),V&&(G=S.selectAll("path.radialbond1").data(V),Y=S.selectAll("path.radialbond2").data(V),$t())}function an(){x.selectAll("line.attractionforce").remove(),fn(),rt=c.get("showVDWLines"),rt&&(et=x.selectAll("line.attractionforce").data(Z),Gt())}function fn(){var e=c.get_vdw_pairs();for(var t=0;t<e.count;t++)Z[t]=[e.atom1[t],e.atom2[t]];Z.splice(e.count)}function ln(){E.selectAll("path.vector-"+Nt).remove(),E.selectAll("path.vector-"+Ct).remove(),it=c.get("showVelocityVectors"),at=c.get("showForceVectors"),it&&(ht=E.selectAll("path.vector-"+Nt).data(p),Wt(ht,En,xn,st,Nt)),at&&(pt=E.selectAll("path.vector-"+Ct).data(p),Wt(pt,Sn,Tn,ft,Ct))}function cn(){E.selectAll("path.atomTrace").remove(),Tt="",wt=c.get("showAtomTrace"),Et=c.get("atomTraceId"),wt&&(xt=E.selectAll("path.atomTrace").data([p[Et]]),Xt())}function hn(){fn(),et=x.selectAll("line.attractionforce").data(Z),Gt()}function pn(){dn()}function dn(){c.get("enableKeyboardHandlers")&&l.node.focus()}function vn(e,t){c.get("enableAtomTooltips")&&P===!1&&gn(t)}function mn(e,t){l.node.focus(),c.get("enableAtomTooltips")&&(P!==!1?(F.style("opacity",1e-6),F.style("display","none"),P=!1):(d3.event.shiftKey?P=t:P=!1,gn(t)))}function gn(e){var t=l.pos(),n=t.left+y(p[e].x),r=t.top+b(p[e].y);F.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.7)").style("left",n+"px").style("top",r+"px").style("zIndex",100).transition().duration(250),I.text("atom: "+e+"\n"+"time: "+Ot()+"\n"+"speed: "+d3.format("+6.3e")(p[e].speed)+"\n"+"vx:    "+d3.format("+6.3e")(p[e].vx)+"\n"+"vy:    "+d3.format("+6.3e")(p[e].vy)+"\n"+"ax:    "+d3.format("+6.3e")(p[e].ax)+"\n"+"ay:    "+d3.format("+6.3e")(p[e].ay)+"\n")}function yn(){!P&&P!==0&&F.style("opacity",1e-6).style(NaN)}function bn(){r.time("view update"),K&&J.attr("transform",function(e,t){return"translate("+y(K.x[t])+" "+b(K.y[t]+K.height[t])+")"}),rt&&hn(),nt&&rn(),V&&Ln(),wn(),it&&Nn(ht,En,xn),at&&Nn(pt,Sn,Tn),wt&&kn(),dt&&dt.length!==0&&On(),yt&&yt.length>0&&tn(),r.timeEnd("view update")}function wn(){H.attr({cx:function(e){return y(e.x)},cy:function(e){return b(e.y)}}),nt&&H.attr("fill",function(e,t){return D[t]}),B.attr("transform",function(e){return"translate("+y(e.x)+","+b(e.y)+")"}),(P===0||P>0)&&gn(P)}function En(e){var t=y(e.x),n=b(e.y),r="M "+t+","+n,i=ut*100;return r+" L "+(t+w(e.vx*i))+","+(n-w(e.vy*i))}function Sn(e){var t=y(e.x),n=b(e.y),r=e.mass,i=ct*100,s="M "+t+","+n;return s+" L "+(t+w(e.ax*r*i))+","+(n-w(e.ay*r*i))}function xn(e){return Math.abs(e.vx)+Math.abs(e.vy)>1e-6?w(ot):0}function Tn(e){return Math.abs(e.ax)+Math.abs(e.ay)>1e-8?w(lt):0}function Nn(e,t,n){e.attr({d:t,"stroke-width":n})}function Cn(e){var t=Math.floor(y(e.x)*100)/100,n=Math.floor(b(e.y)*100)/100,r,i;return Tt?(Tt+=t+","+n+" ",Tt.length>4e3&&(r=Tt.indexOf("L"),i=Tt.indexOf(" "),Tt="M"+Tt.slice(r+1,i)+"L"+Tt.slice(i+1)),Tt):(Tt="M"+t+","+n+"L","M "+t+","+n)}function kn(){xt.attr({d:Cn})}function Ln(){G.attr("d",function(e){return Jt(e,1)}),Y.attr("d",function(e){return Jt(e,2)}),nt&&(G.attr("stroke",Ft),Y.attr("stroke",It))}function An(e){var t=dt[e],n,r,i,s;return t.imageHostType?(t.imageHostType==="Atom"?(n=p[t.imageHostIndex].x,r=p[t.imageHostIndex].y):t.imageHostType==="RectangularObstacle"&&(n=K.x[t.imageHostIndex]+K.width[t.imageHostIndex]/2,r=K.y[t.imageHostIndex]+K.height[t.imageHostIndex]/2),i=gt[e][0],s=gt[e][1],n-=i/2,r+=s/2):(n=t.imageX,r=t.imageY),[y(n),b(r)]}function On(){var e,t,n,r,i;e=dt.length;for(i=0;i<e;i++){if(!gt||!gt[i])continue;r=An(i),t=dt[i].imageLayer,n=t===1?N:T,n.selectAll("image.image_attach"+i).attr("x",r[0]).attr("y",r[1])}}function Mn(e,t){c.is_stopped()?L=[e.x,e.y]:e.draggable&&c.liveDragStart(t)}function _n(e,t,n){return n.left+e<0&&(e=0-n.left),n.right+e>v&&(e=v-n.right),n.bottom+t<0&&(t=0-n.bottom),n.top+t>m&&(t=m-n.top),{x:e,y:t}}function Dn(e,t,n){return e<t?t:e>n?n:e}function Pn(e,t){return{x:Dn(e,0,v),y:Dn(t,0,m)}}function Hn(e,t){var n=y.invert(d3.event.x),r=b.invert(d3.event.y),i;c.is_stopped()?(i=_n(n,r,c.getMoleculeBoundingBox(t)),Mt(t,i.x,i.y,!1,!0),bn()):e.draggable&&(i=Pn(n,r),c.liveDrag(i.x,i.y))}function Bn(e){var t=y.invert(d3.event.dx),n=y.invert(d3.event.dy);if(!AUTHORING||!c.is_stopped())return;e.x=e.x+t,e.y=e.y-n,tn()}function jn(e,t){c.is_stopped()?(Mt(t,e.x,e.y,!0,!0)||(n("You can't drop the atom there"),Mt(t,L[0],L[1],!1,!0)),bn()):e.draggable&&c.liveDragEnd()}function Fn(){var e=d3.select("#model-container");F===undefined&&!e.empty()&&(F=e.append("div").attr("class","tooltip").style("opacity",1e-6),I=F.append("pre"))}function In(){var e,t,n,r,s=i.what_browser();s.browser==="Firefox"&&s.version>="18"&&(e=$("#firefox-warning-pane"),t=l.pos(),n=t.bottom-e.height(),r=t.right-e.width(),e.css({display:"inline",top:n-5,left:r-15,"z-index":100}))}function qn(){dt=c.get("images"),vt=c.get("imageMapping"),mt=c.get("imagePath"),mt?bt=t.actualRoot+mt:c.url&&(bt=t.actualRoot+c.url.slice(0,c.url.lastIndexOf("/")+1)),st=c.get("velocityVectors").color,ot=c.get("velocityVectors").width,ut=c.get("velocityVectors").length,ft=c.get("forceVectors").color,lt=c.get("forceVectors").width,ct=c.get("forceVectors").length,St=c.get("atomTraceColor"),Bt(st,Nt),Bt(ft,Ct),qt(),Ht(),s.register(c,h,'[class~="amino-acid"]'),A=new o(E,h,c)}function Rn(){function e(e){return function(){e(),l.updateClickHandlers()}}E=l.containers.mainContainer,S=l.containers.radialBondsContainer,x=l.containers.VDWLinesContainer,T=l.containers.imageContainerBelow,N=l.containers.imageContainerTop,C=l.containers.textContainerBelow,k=l.containers.textContainerTop,y=l.model2px,b=l.model2pxInv,w=l.modelSize2px,q=l.getFontSizeInPixels(),R=q*.9,p=c.get_results(),d=c.get_elements(),v=c.get("width"),m=c.get("height"),g=v/m,qn(),c.addPropertiesListener(["temperatureControl"],Rt),c.addPropertiesListener(["keShading","chargeShading","showChargeSymbols","useThreeLetterCode","showVDWLines","VDWLinesCutoff","showVelocityVectors","showForceVectors","showAtomTrace","atomTraceId","aminoAcidColorScheme","backgroundColor","markColor"],e(zn)),c.on("addAtom",e(zn)),c.on("removeAtom",e(zn)),c.on("addRadialBond",e(un)),c.on("removeRadialBond",e(un)),c.on("textBoxesChanged",e(nn)),In()}function Un(e){c=e,Rn()}function zn(e,t,n){arguments.length&&(y=e,b=t,w=n),q=l.getFontSizeInPixels(),R=q*.9,Pt(),on(),an(),rn(),un(),sn(),A.setup(),ln(),cn(),Rt(),Zt(),nn(),Fn(),In()}function Wn(){r.time("view update"),K&&J.attr("transform",function(e,t){return"translate("+y(K.x[t])+" "+b(K.y[t]+K.height[t])+")"}),rt&&hn(),nt&&rn(),V&&Ln(),wn(),it&&Nn(ht,En,xn),at&&Nn(pt,Sn,Tn),wt&&kn(),dt&&dt.length!==0&&On(),yt&&yt.length>0&&tn(),r.timeEnd("view update")}var h={},p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O=["url(#elem0-grad)","url(#elem1-grad)","url(#elem2-grad)","url(#elem3-grad)"],M=[],_=25,D=[],P=!1,H,B,j,F,I,q,R,U=d3.format("5.1f"),z="",W=" ("+c.getPropertyDescription("displayTime").getUnitAbbreviation()+")",X,V,J,K,Q=[],G,Y,Z=[],et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt=[],yt,bt,wt,Et,St,xt,Tt,Nt="velocity",Ct="force",kt=i.what_browser(),Lt=kt.browser=="Chrome"&&kt.version>="26",At=kt.browser=="MSIE"&&kt.version>="10.0";return h={update:Wn,repaint:zn,reset:Un,model2px:l.model2px,model2pxInv:l.model2pxInv,modelSize2px:l.modelSize2px},Rn(),h}}),define("md2d/views/view",["require","common/views/model-view","md2d/views/renderer"],function(e){var t=e("common/views/model-view"),n=e("md2d/views/renderer");return function(e,r){return new t(e,r,n)}}),define("md2d/views/dna-edit-dialog",[],function(){return function(){var t,n,r,i,s,o=function(){n=$("<div></div>"),r=$('<input type="text" id="dna-sequence-input" size="45"></input>'),r.appendTo(n),i=$('<p class="error"></p>'),i.appendTo(n),n.dialog({dialogClass:"dna-edit-dialog",appendTo:"#responsive-content",title:"DNA Code on Sense Strand",autoOpen:!1,width:"35em",buttons:{Apply:function(){model.getGeneticProperties().set({DNA:r.val()}),$(this).dialog("close")}}}),s=$(".dna-edit-dialog button:contains('Apply')"),r.on("input",function(){var e={DNA:r.val()},t;t=model.getGeneticProperties().validate(e),t.valid===!1?(s.button("disable"),i.text(t.errors.DNA)):(s.button("enable"),i.text(""))})};return t={open:function(){i.text(""),s.removeAttr("disabled"),r.val(model.getGeneticProperties().get().DNA),n.dialog("open")}},o(),t}}),define("md2d/controllers/scripting-api",["require","md2d/views/dna-edit-dialog"],function(e){var t=e("md2d/views/dna-edit-dialog");return function(n){var r=new t,i=!1;return{getNumberOfAtoms:function(t){return model.get_num_atoms(t)},getNumberOfObstacles:function(){return model.getNumberOfObstacles()},getNumberOfElements:function(){return model.getNumberOfElements()},getNumberOfRadialBonds:function(){return model.getNumberOfRadialBonds()},getNumberOfAngularBonds:function(){return model.getNumberOfAngularBonds()},addAtom:function(t,n){return n&&n.suppressRepaint&&(n.suppressEvent=!0),model.addAtom(t,n)},removeAtom:function(t,n){n&&n.suppressRepaint&&(n.suppressEvent=!0,delete n.suppressRepaint);try{model.removeAtom(t,n)}catch(r){if(!n||!n.silent)throw r}},removeRadialBond:function(t,r){try{model.removeRadialBond(t)}catch(i){if(!r||!r.silent)throw i}n.repaintIfReady()},removeAngularBond:function(t,r){try{model.removeAngularBond(t)}catch(i){if(!r||!r.silent)throw i}n.repaintIfReady()},addRandomAtom:function(){return model.addRandomAtom.apply(model,arguments)},adjustTemperature:function(t){model.set({targetTemperature:t*model.get("targetTemperature")})},limitHighTemperature:function(t){model.get("targetTemperature")>t&&model.set({targetTemperature:t})},randomAtoms:function(t){var r=model.get_num_atoms();t===null&&(t=1+n.randomInteger(r-1));if(!n.isInteger(t))throw new Error("randomAtoms: number of atoms requested, "+t+", is not an integer.");if(t<0)throw new Error("randomAtoms: number of atoms requested, "+t+", was less be greater than zero.");return t>r&&(t=r),n.choose(t,r)},atomsWithinCircle:function(e,t,n,r){var i=[],s,o,u,a;for(u=0,a=model.get_num_atoms();u<a;u++){s=model.getAtomProperties(u);if(typeof r!="undefined"&&s.element!==r)continue;o=Math.sqrt(Math.pow(e-s.x,2)+Math.pow(t-s.y,2)),o<=n&&i.push(u)}return i},atomsWithinRect:function(e,t,n,r,i){var s=[],o,u,a,f,l,c;for(l=0,c=model.get_num_atoms();l<c;l++){o=model.getAtomProperties(l);if(typeof i!="undefined"&&o.element!==i)continue;typeof r=="undefined"?(u=Math.sqrt(Math.pow(e-o.x,2)+Math.pow(t-o.y,2)),u<=n&&s.push(l)):(a=o.x>=e&&o.x<=e+n,f=o.y>=t&&o.y<=t+r,a&&f&&s.push(l))}return s},atomsWithinTriangle:function(e,t,n,r,i,s,o){function c(o,u){var a=[i-e,s-t],f=[n-e,r-t],l=[o-e,u-t],c=a[0]*a[0]+a[1]*a[1],h=a[0]*f[0]+a[1]*f[1],p=a[0]*l[0]+a[1]*l[1],d=f[0]*f[0]+f[1]*f[1],v=f[0]*l[0]+f[1]*l[1],m=1/(c*d-h*h),g=(d*p-h*v)*m,y=(c*v-h*p)*m;return g>=0&&y>=0&&g+y<1}var u=[],a,f,l;for(f=0,l=model.get_num_atoms();f<l;f++){a=model.getAtomProperties(f);if(typeof o!="undefined"&&a.element!==o)continue;c(a.x,a.y)&&u.push(f)}return u},markAtoms:function(t){var r,i;if(arguments.length===0)return;n.isArray(arguments[0])||(t=arguments),n.unmarkAllAtoms();for(r=0,i=t.length;r<i;r++)model.setAtomProperties(t[r],{marked:1});n.repaintIfReady()},unmarkAllAtoms:function(){for(var t=0,r=model.get_num_atoms();t<r;t++)model.setAtomProperties(t,{marked:0});n.repaintIfReady()},traceAtom:function(t){if(t===null)return;model.set({atomTraceId:t}),model.set({showAtomTrace:!0})},untraceAtom:function(){model.set({showAtomTrace:!1})},setAtomProperties:function(t,r,i,s,o){model.setAtomProperties(t,r,i,s),n.repaintIfReady(o)},getAtomProperties:function(t){return model.getAtomProperties(t)},getRadialBondsForAtom:function(t){return model.getRadialBondsForAtom(t)},getAngularBondsForAtom:function(t){return model.getAngularBondsForAtom(t)},getMoleculeAtoms:function(t){return model.getMoleculeAtoms(t)},setElementProperties:function(t,r){model.setElementProperties(t,r),n.repaintIfReady()},setPairwiseLJProperties:function(t,n,r){model.getPairwiseLJProperties().set(t,n,r)},getElementProperties:function(t){return model.getElementProperties(t)},addObstacle:function(t,r){try{model.addObstacle(t)}catch(i){if(!r||!r.silent)throw i}n.repaintIfReady()},setObstacleProperties:function(t,r){model.setObstacleProperties(t,r),n.repaintIfReady()},getObstacleProperties:function(t){return model.getObstacleProperties(t)},removeObstacle:function(t,r){try{model.removeObstacle(t)}catch(i){if(!r||!r.silent)throw i}n.repaintIfReady()},setRadialBondProperties:function(t,r){model.setRadialBondProperties(t,r),n.repaintIfReady()},getRadialBondProperties:function(t){return model.getRadialBondProperties(t)},setAngularBondProperties:function(t,r){model.setAngularBondProperties(t,r),n.repaintIfReady()},getAngularBondProperties:function(t){return model.getAngularBondProperties(t)},setGeneticProperties:function(t){model.getGeneticProperties().set(t)},getGeneticProperties:function(){return model.getGeneticProperties().get()},openDNADialog:function(){r.open()},transcribe:function(){model.getGeneticProperties().transcribeDNA()},translate:function(){var t=model.getGeneticProperties().translate();model.generateProtein(t)},translateStepByStep:function(){model.translateStepByStep()},animateTranslation:function(){model.animateTranslation()},generateRandomProtein:function(e){var t=model.generateProtein(undefined,e);if(t!==e)throw new Error("Generated protein was truncated due to limited area of the model. Only"+t+" amino acids were generated.")},setSolvent:function(t){model.setSolvent(t)},pe:function(){return model.get("potentialEnergy")},ke:function(){return model.get("kineticEnergy")},atomsKe:function(t){var n=0,r;for(r=0;r<t.length;r++)n+=model.getAtomKineticEnergy(t[r]);return n},minimizeEnergy:function(){model.minimizeEnergy(),n.repaintIfReady()},addTextBox:function(e){model.addTextBox(e)},removeTextBox:function(e){model.removeTextBox(e)},setTextBoxProperties:function(e,t){model.setTextBoxProperties(e,t)},repaintIfReady:function(e){i||e&&e.suppressRepaint||n.repaint()},batch:function(e){i=!0,model.startBatch(),e(),model.endBatch(),i=!1,n.repaintIfReady()}}}}),define("md2d/benchmarks/benchmarks",["require"],function(e){return function(t){var n=[{name:"commit",numeric:!1,run:function(e){var t="<a href='"+Lab.version.repo.commit.url+"' class='opens-in-new-window' target='_blank'>"+Lab.version.repo.commit.short_sha+"</a>";Lab.version.repo.dirty&&(t+=" <i>dirty</i>"),e(t)}},{name:"atoms",numeric:!0,run:function(e){e(model.get_num_atoms())}},{name:"temperature",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(model.get("temperature"))}},{name:"just graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;model.stop(),r=+Date.now(),i=-1;while(i++<100)t.modelContainer.update();n=Date.now()-r,e(100/n*1e3)}},{name:"model (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),n=+Date.now(),r=-1;while(r++<100)model.tick(1,{dontDispatchTickEvent:!0});t=Date.now()-n,e(100/t*1e3)}},{name:"model+graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),t=+Date.now(),r=-1;while(r++<100)model.tick();n=Date.now()-t,e(100/n*1e3)}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){model.start(),setTimeout(function(){model.stop();var t=model.stepCounter();setTimeout(function(){model.start(),setTimeout(function(){model.stop(),e((model.stepCounter()-t)/2)},2e3)},100)},1e3)}},{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}}];return n}}),define("md2d/controllers/controller",["require","common/controllers/model-controller","md2d/models/modeler","md2d/views/view","md2d/controllers/scripting-api","md2d/benchmarks/benchmarks"],function(e){var t=e("common/controllers/model-controller"),n=e("md2d/models/modeler"),r=e("md2d/views/view"),i=e("md2d/controllers/scripting-api"),s=e("md2d/benchmarks/benchmarks");return function(e,o,u,a,f){return new t(e,o,u,a,f,n,r,i,s)}}),define("solar-system/models/engine/constants/units",["require","exports","module"],function(e,t,n){var r=86400,i=149597870700,s=5.97219e+24,o=332946,u={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",POWER:"power",FORCE:"force",VELOCITY:"velocity",ACCELERATION:"acceleration",GRAVITATIONAL_CONSTANT:"Gravitational Constant",AREA:"area",VOLUME:"volume",PRESSURE:"pressure"},a,f,l;t.unit=a={DAY:{name:"Day",value:1,type:u.TIME},SECOND:{name:"second",value:r,type:u.TIME},AU:{name:"au",value:1,type:u.LENGTH},METER:{name:"meter",value:i,type:u.LENGTH},EARTH_MASS:{name:"Earth Mass",value:1,type:u.MASS},KILOGRAM:{name:"kilogram",value:s,type:u.MASS},SOLAR_MASS:{name:"Solar Mass",value:o,type:u.MASS},JOULE:{name:"Joule",value:1/s*(1/i)*(1/i)/(1/r*(1/r)),type:u.ENERGY},WATT:{name:"Watt",value:1/s*(1/i)*(1/i)/(1/r*(1/r)*(1/r)),type:u.POWER},NEWTON:{name:"Newton",value:1,type:u.FORCE},METERS_PER_SECOND:{name:"meters per second",value:1/i*r,type:u.VELOCITY},METERS_PER_SECOND_PER_SECOND:{name:"meters per second per second",value:1/i*r*r,type:u.ACCELERATION},METERS_CUBED_PER_KILOGRAMS_TIMES_TIME_SQUARED:{name:"meters cubed per kilograms times second squared",value:1/i*(1/i)*(1/i)/(1/s*r*r),type:u.ACCELERATION},ASTRONOMICAL_FORCE:{name:" in Astronomical units (Earth Mass, AU, Day)",value:1*s,type:u.GRAVITATIONAL_CONSTANT},SI_GC:{name:"gravitational constant of proprtionality in SI units (kg, m, s)",value:1,type:u.GRAVITATIONAL_CONSTANT},ASTRONOMICAL_GC:{name:"gravitational constant of proprtionality in Astronomical units (Earth Mass, AU, Day)",value:1*s*r*r/(i*i*i),type:u.GRAVITATIONAL_CONSTANT}},t.ratio=f=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=l=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*f(r,{per:n})}}),define("solar-system/models/engine/constants/index",["require","exports","module","./units"],function(e,t,n){var r=e("./units"),i=r.unit,s=r.ratio,o=r.convert,u={SOLAR_LUMINOSITY:{value:3.839e+26,unit:i.WATT},ASTRONOMICAL_UNIT_DISTANCE:{value:149597870691,unit:i.METER},GRAVITATIONAL_CONSTANT:{value:6.67384e-11,unit:i.SI_GC}},a,f;t.unit=i,t.ratio=s,t.convert=o;for(a in u)u.hasOwnProperty(a)&&(f=u[a],t[a]=function(e){return{as:function(t){return r.convert(e.value,{from:e.unit,to:t})}}}(f))}),define("solar-system/models/engine/solar-system",["require","exports","module","arrays","common/array-types","./constants/index","common/console","common/models/engines/clone-restore-wrapper"],function(e,t,n){var r=e("arrays"),i=e("common/array-types"),s=e("./constants/index"),o=s.unit,u=e("common/console"),a=e("common/models/engines/clone-restore-wrapper"),f=s.GRAVITATIONAL_CONSTANT.as(s.unit.ASTRONOMICAL_GC);t.createEngine=function(){var e,t=f,n=!1,s=[50,50],o=-25,u=-25,c=25,h=25,p=0,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L=0,A,O,M=function(){P(0)},_=function(e,t){var n,i;if(Array.isArray(e))for(n=0,i=e.length;n<i;n++)r.isArray(e[n])&&(e[n]=r.extend(e[n],t));else for(n in e)e.hasOwnProperty(n)&&r.isArray(e[n])&&(e[n]=r.extend(e[n],t))},D={bodies:function(){m=k.radius,g=k.x,y=k.y,b=k.vx,w=k.vy,E=k.px,S=k.py,x=k.ax,T=k.ay,N=k.mass,C=k.speed,pinned=k.pinned}},P=function(t){k=e.bodies={},k.radius=r.create(t,0,i.float),k.x=r.create(t,0,i.float),k.y=r.create(t,0,i.float),k.vx=r.create(t,0,i.float),k.vy=r.create(t,0,i.float),k.px=r.create(t,0,i.float),k.py=r.create(t,0,i.float),k.ax=r.create(t,0,i.float),k.ay=r.create(t,0,i.float),k.mass=r.create(t,0,i.floatType),k.speed=r.create(t,0,i.float),k.pinned=r.create(t,0,i.uint8),k.marked=r.create(t,0,i.uint8),k.visible=r.create(t,0,i.uint8),D.bodies()},H=function(e){var t=m[e],n=o+t,r=u+t,i=c-t,a=h-t,f=s[0],l=s[1];if(A)g[e]+m[e]<n?g[e]+=f:g[e]-m[e]>i&&(g[e]-=f);else if(g[e]<n){while(g[e]<n-f)g[e]+=f;g[e]=n+(n-g[e]),b[e]*=-1,E[e]*=-1}else if(g[e]>i){while(g[e]>i+f)g[e]-=f;g[e]=i-(g[e]-i),b[e]*=-1,E[e]*=-1}if(O)y[e]+m[e]<r?y[e]+=l:y[e]-m[e]>a&&(y[e]-=l);else if(y[e]<r){while(y[e]<r-l)y[e]+=l;y[e]=r+(r-y[e]),w[e]*=-1,S[e]*=-1}else if(y[e]>a){while(y[e]>a+l)y[e]-=l;y[e]=a-(y[e]-a),w[e]*=-1,S[e]*=-1}},B=function(){var e,t;if(L===0)return;for(e=0;e<L;e++)x[e]=T[e]=0;j()},j=function(){var e,n,r,i,s,o,u,a;e=-1;while(++e<L){m1=N[e],n=e;while(++n<L)r=g[n]-g[e],i=y[n]-y[e],s=r*r+i*i,l=Math.sqrt(s),m2=N[n],o=t*m1*m2/s,u=r/l*o,a=i/l*o,x[e]+=u/m1,T[e]+=a/m1,x[n]-=u/m2,T[n]-=a/m2}},F=function(){var e,t;for(e=0;e<L;e++)t=N[e],b[e]+=.5*x[e]*d,E[e]=t*b[e],w[e]+=.5*T[e]*d,S[e]=t*w[e]},I=function(){var e=s[0]*100,t=s[1]*100,n,r,i;for(i=0;i<L;i++)n=g[i],r=y[i],g[i]+=b[i]*d,y[i]+=w[i]*d,H(i)},q=function(){var e;for(e=0;e<L;e++)pinned[e]&&(b[e]=w[e]=x[e]=T[e]=0)},R=function(){var e;for(e=0;e<L;e++)C[e]=Math.sqrt(b[e]*b[e]+w[e]*w[e])};return e={setTime:function(e){p=e},setDimensions:function(e){if(n)throw new Error("The SolarSystem model's size has already been set, and cannot be reset.");o=e[0],u=e[1],c=e[2],h=e[3],s=[c-o,h-u],n=!0},getDimensions:function(){return[o,c,u,h]},setHorizontalWrapping:function(e){A=!!e},setVerticalWrapping:function(e){O=!!e},setGravitationalConstant:function(e){typeof e=="number"&&e!==0?t=e:t=f},setBodyProperties:function(e,t){var n,r,i,s;for(n in t)t.hasOwnProperty(n)&&(k[n][e]=t[n]);C[e]=Math.sqrt(b[e]*b[e]+w[e]*w[e])},addBody:function(t){L+1>k.x.length&&(_(k,L+10),D.bodies()),t.ax=t.ay=0,L++,e.setBodyProperties(L-1,t)},removeBody:function(e){var t,n,r,i,s,o;if(e>=L)throw new Error("Body "+e+" doesn't exist, so it can't be removed.");for(t=e;t<L;t++)for(r in k)k.hasOwnProperty(r)&&(t===L-1?k[r][t]=0:k[r][t]=k[r][t+1]);L--,updateParticlesAccelerations()},setupBodiesRandomly:function(t){var n=Math.floor(Math.sqrt(L)),r=Math.ceil(L/n),i,o,u,a,f,l,c,h;f=s[0]/
(1+r),a=s[1]/(1+n),i=-1;for(o=1;o<=n;o++)for(u=1;u<=r;u++){i++;if(i===L)break;l=math.normal(1,.25),c=2*Math.random()*Math.PI,h={x:u*f,y:o*a,mass:Math.random()*5,vx:l*Math.cos(c),vy:l*Math.sin(c)},h.radius=radiusFromMass(h.mass),e.setBodyProperties(i,h)}},radiusFromMass:function(e){var t=1e3,n=e/t,r;return r=Math.pow(n/(4/3*Math.PI),1/3),r},integrate:function(e,t){var n,r,i=p;e===undefined&&(e=100),t===undefined&&(t=.1),d=t,v=d*d,p===0&&B(),n=Math.floor(e/d);for(r=1;r<=n;r++)p=i+r*d,F(),q(),I(),B(),F(),R()},getNumberOfBodies:function(){return L},computeOutputState:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,d,v,m,g,y,b,w,E,S,x,T,N;e.time=p},getState:function(){return[new a(k),{clone:function(){return p},restore:function(t){e.setTime(t)}}]}},M(),e}}),define("solar-system/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"solar-system",immutable:!0},imagePath:{defaultValue:"",immutable:!0},minX:{defaultValue:-25,immutable:!0},maxX:{defaultValue:25,immutable:!0},minY:{defaultValue:-25,immutable:!0},maxY:{defaultValue:25,immutable:!0},width:{defaultValue:50},height:{defaultValue:50},unitsScheme:{defaultValue:"solar-system"},modelSampleRate:{defaultValue:"default"},timeStep:{defaultValue:.1},timeStepsPerTick:{defaultValue:50},horizontalWrapping:{defaultValue:!1},verticalWrapping:{defaultValue:!1}},viewOptions:{viewPortWidth:{defaultValue:50,unitType:"length",immutable:!0},viewPortHeight:{defaultValue:50,unitType:"length",immutable:!0},viewPortX:{defaultValue:0,unitType:"length",immutable:!0},viewPortY:{defaultValue:0,unitType:"length",immutable:!0},backgroundColor:{defaultValue:"#eeeeee"},showClock:{defaultValue:!0},markColor:{defaultValue:"#f8b500"},showBodyTrace:{defaultValue:!1},bodyTraceId:{defaultValue:0},bodyTraceColor:{defaultValue:"#ee8833"},images:{defaultValue:[]},imageMapping:{defaultValue:{}},textBoxes:{defaultValue:[]},fitToParent:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},controlButtons:{defaultValue:"play"},gridLines:{defaultValue:!1},planetNumbers:{defaultValue:!1},enableBodyTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},planetTraceColor:{defaultValue:"#6913c5"}},body:{x:{required:!0},y:{required:!0},vx:{defaultValue:0},vy:{defaultValue:0},ax:{defaultValue:0,serialize:!1},ay:{defaultValue:0,serialize:!1},mass:{defaultValue:1},radius:{},pinned:{defaultValue:!1},visible:{defaultValue:1},marked:{defaultValue:0},px:{readOnly:!0,serialize:!1},py:{readOnly:!0,serialize:!1},speed:{readOnly:!0,serialize:!1}},textBox:{text:{defaultValue:""},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},anchor:{defaultValue:"lower-left"},layer:{defaultValue:1},width:{},height:{},frame:{},color:{},backgroundColor:{defaultValue:"white"},strokeWidthEms:{defaultValue:.03},strokeOpacity:{defaultValue:1},rotate:{defaultValue:0},fontScale:{defaultValue:1},hostType:{},hostIndex:{},textAlign:{}}}}),define("solar-system/models/property-description",["require","underscore"],function(e){function n(e){return typeof e=="undefined"}function r(e,t){var n;this._descriptionHash=t,this._label=t.label||"";if(t.unitType){if(!(n=e.units[t.unitType]))throw new Error("PropertyDescription: couldn't find unitType "+t.unitType+" in the supplied units definition.");this._unitType=t.unitType,this._unitName=n.name,this._unitPluralName=n.pluralName,this._unitAbbreviation=n.symbol}t.unitName&&(this._unitName=t.unitName),t.unitPluralName&&(this._unitPluralName=t.unitPluralName),t.unitAbbreviation&&(this._unitAbbreviation=t.unitAbbreviation),this.setFormat(t.format||"g")}var t=e("underscore");return r.prototype.getHash=function(){return t.extend(t.reject({unitName:this.getUnitName(),unitPluralName:this.getUnitPluralName(),unitAbbreviation:this.getUnitAbbreviation()},n),this._descriptionHash)},r.prototype.getLabel=function(){return this._label},r.prototype.getUnitType=function(){return this._unitType},r.prototype.getUnitName=function(){return this._unitName},r.prototype.getUnitPluralName=function(){return this._unitPluralName},r.prototype.getUnitAbbreviation=function(){return this._unitAbbreviation},r.prototype.setFormat=function(e){this._formatter=d3.format(e)},r.prototype.format=function(e,t){t=t||{};var n,r,i,s=!0;return t.format?t.format===this._lastFormat?n=this._lastFormatter:(n=d3.format(t.format),this._lastFormat=t.format,this._lastFormatter=n):n=this._formatter,r=n(e),t&&t.abbreviated!=null&&(s=t.abbreviated),s?r+" "+this._unitAbbreviation:(i=parseFloat(r)!==1,r+" "+(i?this._unitPluralName:this._unitName))},r}),define("solar-system/models/unit-definitions/solar-system",[],function(){return{name:"solar-system",translated:!1,units:{length:{name:"Astronomical Unit",pluralName:"Astronomical Units",symbol:"AU"},mass:{name:"Earth Mass",pluralName:"Earth Masses",symbol:"M"},time:{name:"day",pluralName:"days",symbol:"D",displayValue:{unitsPerBaseUnit:1,name:"day",pluralName:"days",symbol:"D"}},velocity:{name:"Astronomical Unit per day",pluralName:"Astronomical Units per day",symbol:"AU/D"},acceleration:{name:"Astronomical Unit per day squared",pluralName:"Astronomical Units per day squared",symbol:"AU/D"},momentum:{name:"Earth Mass Astronomical Unit per day",pluralName:"Earth Mass Astronomical Units per day",symbol:"MAU/D"},force:{name:"Earth Mass Astronomical Unit per day squared",pluralName:"Earth Mass Astronomical Units per day squared",symbol:"MAU/D"},energy:{name:"joules",pluralName:"joules",symbol:"J"},temperature:{name:"Kelvin",pluralName:"Kelvin",symbol:"K"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}}}),define("solar-system/models/unit-definitions/index",["require","solar-system/models/unit-definitions/solar-system","underscore"],function(e){var t={solarSystem:e("solar-system/models/unit-definitions/solar-system")},n=e("underscore");return{get:function(e){var r;return e==="solar-system"?t.solarSystem:(r=n.extend({},t[e]),r.units=n.extend({},t.solarSystem.units,t[e].units),r)}}}),define("solar-system/models/modeler",["require","arrays","common/console","solar-system/models/engine/solar-system","solar-system/models/metadata","common/models/tick-history","common/serialize","common/validator","solar-system/models/engine/constants/units","solar-system/models/property-description","solar-system/models/unit-definitions/index","underscore"],function(e){var t=e("arrays"),n=e("common/console"),r=e("solar-system/models/engine/solar-system"),i=e("solar-system/models/metadata"),s=e("common/models/tick-history"),o=e("common/serialize"),u=e("common/validator"),a=e("solar-system/models/engine/constants/units"),f=e("solar-system/models/property-description"),l=e("solar-system/models/unit-definitions/index"),c=e("underscore");return function(t){function H(e){e=c.uniq(e);for(var t=0,n=e.length;t<n;t++)e[t]()}function B(e){var t,n,r=[],i,s;typeof e=="string"?n=[e]:n=e;for(i=0,s=n.length;i<s;i++)t=n[i],T[t]&&(r=r.concat(T[t]));T.all&&(r=r.concat(T.all)),H(r)}function j(e){var t,n=[],r;for(t in e)if(e.hasOwnProperty(t)){if(k[t])throw new Error('Attempt to restore output property "'+t+'".');r=e[t],N[t]!==r&&(N["set_"+t]?N["set_"+t](r):N[t]=r,n.push(t))}B(n)}function F(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&(N[t]!==e[t]||!M[t].isDefined)&&(N[t]=e[t],M[t].isDefined=!0,n.push(t));for(t in M)M.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(M[t].isDefined=!1,N[t]=undefined);B(n)}function I(e,t){var r=a.get("timeStep"),i,s;return n.time("integration"),E.integrate(a.get("timeStepsPerTick")*r,r),n.timeEnd("integration"),n.time("reading model state"),z(),n.timeEnd("reading model state"),n.time("tick history push"),w.push(),n.timeEnd("tick history push"),m=!0,t||h.tick(),d}function q(e){var t,n=[];for(t in e)if(e.hasOwnProperty(t)&&e[t]!==undefined&&e[t]!==null){if(k[t])throw new Error('Attempt to set read-only output property "'+t+'".');N["set_"+t]?N["set_"+t](e[t]):N[t]=e[t],n.push(t)}B(n)}function R(e){return N[e]}function U(e,t){e=c.extend({},e);for(var n in e)e.hasOwnProperty(n)&&(e[n]=t(n,e[n]));return e}function z(){var e,t,n;K();for(e=0;e<C.length;e++)k[C[e]].hasCachedValue=!1;for(e=0;e<L.length;e++)A[L[e]].addSample();for(e=0;e<C.length;e++)if(n=T[C[e]])for(t=0;t<n.length;t++)n[t]()}function W(){$()}function X(){J(),w&&w.invalidateFollowingState(),h.invalidation()}function $(){var e,t,n,r;for(e=0;e<C.length;e++)t=C[e],(r=T[t])&&r.length>0&&(n=k[t],n.previousValue=n.hasCachedValue?n.cachedValue:n.calculate())}function J(){var e,t,n,r,i,s=[];K();for(e=0;e<C.length;e++)n=k[C[e]],n.hasCachedValue=!1;for(e=0;e<L.length;e++)A[L[e]].addSample();for(e=0;e<C.length;e++){r=C[e],n=k[r];if((i=T[r])&&i.length>0){n.hasCachedValue||(n.cachedValue=n.calculate(),n.hasCachedValue=!0);if(n.cachedValue!==n.previousValue)for(t=0;t<i.length;t++)s.push(i[t])}n.previousValue=null}for(e=0;e<s.length;e++)s[e]()}function K(){var e,t,n,r;E.computeOutputState(b),Q();for(e=0,n=a.get_num_bodies();e<n;e++)for(t in S)S.hasOwnProperty(t)&&(x[e][t]=S[t][e])}function Q(){var e=function(){return aminoacidsHelper.isAminoAcid(this.element)},t,n;x||(x=[]);for(t=x.length,n=a.get_num_bodies();t<n;t++)x[t]||(x[t]={idx:t,isAminoAcid:e});x.length=n}this.constructor.type="solar-system";var a={},h=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek","addBody","removeBody","invalidation","textBoxesChanged"),p=1e3,d=!0,v=!1,m=!1,g,y=[],b,w,E,S,x,T={},N={set_timeStep:function(e){this.timeStep=e},set_horizontalWrapping:function(e){this.horizontalWrapping=e,E&&E.setHorizontalWrapping(e)},set_verticalWrapping:function(e){this.verticalWrapping=e,E&&E.setVerticalWrapping(e)},set_gravitationalConstant:function(e){this.gravitationalConstant=e,E&&E.setGravitationalConstant(e)}},C=[],k={},L=[],A={},O=!1,M={},D,P,V=function(){var e=[{getNum:"getNumberOfBodies",addEvent:"addBody",removeEvent:"removeBody"}];return function(t){var n,r,i;for(n=0;n<e.length;n++)r=e[n],r.num=E[r.getNum]();t();for(n=0;n<e.length;n++)r=e[n],i=E[r.getNum](),i>r.num?h[r.addEvent]():i<r.num&&h[r.removeEvent]()}}();return a.stepCounter=function(){return w.get("counter")},a.stepStartCounter=function(){return w.get("startCounter")},a.steps=function(){return w.get("length")},a.isNewStep=function(){return m},a.seek=function(e){return arguments.length||(e=0),a.is_stopped()||a.stop(),m=!1,V(function(){w.seekExtract(e),z(),h.seek()}),w.get("counter")},a.stepBack=function(e){return arguments.length||(e=1),a.is_stopped()||a.stop(),m=!1,V(function(){var t,n;t=-1;while(++t<e)n=w.get("index"),n>0&&(w.decrementExtract(),z(),h.stepBack())}),w.get("counter")},a.stepForward=function(e){return arguments.length||(e=1),a.is_stopped()||a.stop(),V(function(){var t,n,r;t=-1;while(++t<e)n=w.get("index"),r=w.get("length"),n<r-1?(w.incrementExtract(),z(),h.stepForward()):I()}),w.get("counter")},a.initializeDimensions=function(){a.set({width:a.get("maxX")-a.get("minX")}),a.set({height:a.get("maxY")-a.get("minY")})},a.initializeEngine=function(){E=r.createEngine(),E.setDimensions([a.get("minX"),a.get("minY"),a.get("maxX"),a.get("maxY")]),E.setHorizontalWrapping(a.get("horizontalWrapping")),E.setVerticalWrapping(a.get("verticalWrapping")),window.state=b={},S=E.bodies},a.createBodies=function(e){var t={supressCheck:!0,deserialization:!0},n,r,i,s;W(),typeof e=="number"?r=e:e.num!=null?r=e.num:e.x&&(r=e.x.length);if(e.x&&e.y)for(n=0;n<r;n++){s={};for(i in e)e.hasOwnProperty(i)&&(s[i]=e[i][n]);s.radius||(s.radius=E.radiusFromMass(e.mass[n])),a.addBody(s,t)}else{for(n=0;n<r;n++)s={x:0,y:0},a.addBody(s,t);E.setupBodiesRandomly()}return X(),h.reset(),a},a.reset=function(){a.resetTime(),w.restoreInitialState(),h.reset()},a.resetTime=function(){E.setTime(0)},a.addRandomBody=function(){var e=a.get("width"),t=a.get("height"),n=a.get("minX"),r=a.get("minY"),i={},s,o;return o=Math.random()*10,s=E.radiusFromMass(o),i={x:n+Math.random()*e-2*s,y:r+Math.random()*t-2*s,vx:(Math.random()-.5)/100,vy:(Math.random()-.5)/100,mass:o,radius:s},a.addBody(i),!1},a.addBody=function(e,t){var n=a.get("minX"),r=a.get("minY"),s=a.get("maxX"),o=a.get("maxY");return t=t||{},e=u.validateCompleteness(i.body,e),t.deserialization||W(),E.addBody(e),t.deserialization||X(),t.supressEvent||h.addBody(),!0},a.removeBody=function(e,t){t=t||{},W(),E.removeBody(e),x.length=0,X(),t.supressEvent||h.removeplanet()},a.setBodyProperties=function(e,t,n,r){var s,o,a,f,l,c;t=u.validate(i.body,t);if(n){var h=typeof t.x=="number"?t.x:S.x[e],p=typeof t.y=="number"?t.y:S.y[e];if(!E.canPlaceplanet(el,h,p,e))return!1}return W(),E.setBodyProperties(e,t),X(),!0},a.getBodyProperties=function(e){var t=i.body,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=S[r][e]);return n},a.addTextBox=function(e){e=u.validateCompleteness(i.textBox,e),N.textBoxes.push(e),h.textBoxesChanged()},a.removeTextBox=function(e){var t=N.textBoxes;if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');N.textBoxes=t.slice(0,e).concat(t.slice(e+1)),h.textBoxesChanged()},a.setTextBoxProperties=function(e,t){var n=N.textBoxes[e];if(!n)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=u.validate(i.textBox,t);for(prop in t)n[prop]=t[prop];h.textBoxesChanged()},a.is_stopped=function(){return d},a.get_bodies=function(){return S},a.get_results=function(){return x},a.get_num_bodies=function(){return E.getNumberOfBodies()},a.on=function(e,t){return h.on(e,t),a},a.tickInPlace=function(){return h.tick(),a},a.tick=function(e,t){arguments.length||(e=1);var n=t&&t.dontDispatchTickEvent||!1,r=-1;while(++r<e)I(null,n);return a},a.start=function(){return a.resume()},a.restart=function(){v=!0},a.resume=function(){return n.time("gap between frames"),a.timer(function(t){return n.timeEnd("gap between frames"),d?!0:v?(setTimeout(a.resume,0),!0):(I(t,!1),n.time("gap between frames"),!1)}),v=!1,d&&(d=!1,h.play()),a},a.timer=function(e){var t,n=a.get("modelSampleRate");n==="default"?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)},a.stop=function(){return d=!0,h.stop(),a},a.set=function(e,t){var n;arguments.length===1?n=e:(n={},n[e]=t),u.validate(i.mainProperties,n),u.validate(i.viewOptions,n),E&&W(),q(n),E&&X()},a.get=function(e){var t;if(N.hasOwnProperty(e))return N[e];if(t=k[e])return t.hasCachedValue?t.cachedValue:(t.hasCachedValue=!0,t.cachedValue=t.calculate(),t.cachedValue)},a.addPropertiesListener=function(e,t){function r(e){T[e]||(T[e]=[]),T[e].push(t)}var n;if(typeof e=="string")r(e);else for(n=0;n<e.length;n++)r(e[n])},a.defineOutput=function(e,t,n){C.push(e),D[e]={unitType:t.unitType},k[e]={description:new f(P,t),calculate:n,hasCachedValue:!1,previousValue:null}},a.defineFilteredOutput=function(e,t,n,r,i){var s,o;if(r!=="RunningAverage")throw new Error("FilteredOutput: unknown filter type "+r+".");s=new RunningAverageFilter(i),o=a.get(n);if(o===undefined||isNaN(Number(o)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");s.addSample(a.get("time"),o),L.push(e),A[e]={addSample:function(){s.addSample(a.get("time"),a.get(n))}},w.registerExternalObject({push:function(){},extract:function(e){s.setCurrentStep(e)},invalidate:function(e){s.invalidate(e)},setHistoryLength:function(e){s.setMaxBufferLength(e)}}),t.property=n,t.type=r,t.period=i,a.defineOutput(e,t,function(){return s.calculate()})},a.defineParameter=function(e,t,n){M[e]={description:new f(P,t),setter:n,isDefined:!1},D[e]={unitType:"untranslated"},N["set_"+e]=function(t){N[e]=t,M[e].isDefined=!0,M[e].setter&&M[e].setter.call(a,t)}},a.getUnitDefinition=function(e){return P.units[e]},a.getPropertyDescription=function(e){var t=k[e]||M[e];if(t)return c.extend({},t.description)},a.serialize=function(){var e={},t,n,r,s=function(t,n){e.bodies[t].every(function(e){return e===n})&&delete e.bodies[t]};return e=o(i.mainProperties,N),e.viewOptions=o(i.viewOptions,N),e.bodies=o(i.body,S,E.getNumberOfBodies()),e.viewOptions.showBodyTrace===!1&&delete e.viewOptions.bodyTraceId,s("marked",i.body.marked.defaultValue),s("visible",i.body.visible.defaultValue),e},q(u.validateCompleteness(i.mainProperties,t)),function(){if(!t.viewOptions||!t.viewOptions.textBoxes)return;var e=t.viewOptions.textBoxes,n,r;for(n=0,r=e.length;n<r;n++)e[n]=u.validateCompleteness(i.textBox,e[n])}(),q(u.validateCompleteness(i.viewOptions,t.viewOptions||{})),a.initializeDimensions(),a.initializeEngine(),t.bodies&&a.createBodies(t.bodies),w=new s({input:["showClock","timeStepsPerTick","timeStep","gravitationalConstant"],getRawPropertyValue:R,restoreProperties:j,parameters:M,restoreParameters:F,state:E.getState()},a,p),m=!0,P=l.get(a.get("unitsScheme")),D={},c.each(i.mainProperties,function(e,t){e.unitType&&(D[t]={unitType:e.unitType})}),a.defineOutput("time",{label:"Time",unitType:"time",format:"f"},function(){return b.time}),a.defineOutput("timePerTick",{label:"Model time per tick",unitName:P.units.time.name,unitPluralName:P.units.time.pluralName,unitAbbreviation:P.units.time.symbol,format:"f"},function(){return a.get("timeStep")*a.get("timeStepsPerTick")}),function(){var e;P.units.time.displayValue?e=P.units.time.displayValue:(e=c.extend({},P.units.time),e.unitsPerBaseUnit=1),a.defineOutput("displayTime",{label:"Time",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return a.get("time")*e.unitsPerBaseUnit}),a.defineOutput("displayTimePerTick",{label:"Model time per tick",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return a.get("timePerTick")*e.unitsPerBaseUnit})}(),a.defineOutput("tickCounter",{label:"Tick Counter",unitType:"",format:"4g"},function(){return w.get("counter")}),a.defineOutput("newStep",{label:"New Step",unitType:"",format:""},function(){return m}),z(),a}}),define("solar-system/views/renderer",["require","lab.config","common/console","cs!common/layout/wrap-svg-text","common/views/gradients"],function(e){var t=e("lab.config"),n=e("common/console"),r=e("cs!common/layout/wrap-svg-text"),i=e("common/views/gradients");return function(r,s){function $(){var e,t,n,r,o;r=s.get("markColor"),t=d3.rgb(r),n=t.brighter(1).toString(),o=t.darker(1).toString(),i.createRadialGradient("mark-grad",n,r,o,y),i.createRadialGradient("neutral-grad","#FFFFFF","#f2f2f2","#A4A4A4",y)}function J(e){return e.marked?"url(#mark-grad)":"url(#neutral-grad)"}function K(){y.selectAll("circle").data(g).attr("r",function(e){return m(e.radius)})}function Q(){var e,t;N.length=g.length;for(e=0,t=g.length;e<t;e++)N[e]=J(g[e])}function G(){y.selectAll("circle").remove(),y.selectAll("g.label").remove(),k=y.selectAll("circle").data(g),Z(),L=y.selectAll("g.label").data(g),A=L.enter().append("g").attr("class","label").attr("transform",function(e){return"translate("+d(e.x)+","+v(e.y)+")"}),A.each(function(e){var t=d3.select(this),n,r;s.get("astromonicalBodyNumbers")&&t.append("text").text(e.idx).style("font-size",m(1.4*e.radius)+"px"),r=t.selectAll("text"),r.node()&&(r.attr("pointer-events","none").style({"font-weight":"bold",opacity:.7}),r.attr({x:-r.node().getComputedTextLength()/2,y:"0.31em"})),t.select("text.shadow").style({stroke:"#fff","stroke-width":.15*m(e.radius),"stroke-opacity":.7})})}function Y(){y.selectAll("path.bodyTrace").remove(),W="",q=s.get("showBodyTrace"),R=s.get("bodyTraceId"),q&&(z=y.selectAll("path.bodyTrace").data([g[R]]),it())}function Z(){k.enter().append("circle").attr({r:function(e){return m(e.radius)},cx:function(e){return d(e.x)},cy:function(e){return v(e.y)}}).style({"fill-opacity":function(e){return e.visible},fill:function(e,t){return N[t]}}).on("mousedown",nt).on("mouseover",tt).on("mouseout",ut)}function et(){k.attr({r:function(e){return m(e.radius)},cx:function(e){return d(e.x)},cy:function(e){return v(e.y)}}),(C===0||C>0)&&ot(C)}function tt(e,t){s.get("enableBodyTooltips")&&ot(t)}function nt(e,t){r.node.focus(),s.get("enableBodyTooltips")&&(C!==!1?(O.style("opacity",1e-6),O.style("display","none"),C=!1):(d3.event.shiftKey?C=t:C=!1,ot(t)))}function rt(){z.attr({d:st})}function it(){z.enter().append("path").attr({"class":"bodyTrace",d:st,"stroke-width":V,stroke:U,fill:"none"})}function st(e){var t=Math.floor(d(e.x)*100)/100,n=Math.floor(v(e.y)*100)/100,r,i;return W?(W+=t+","+n+" ",W.length>X&&(r=W.indexOf("L"),i=W.indexOf(" "),W="M"+W.slice(r+1,i)+"L"+W.slice(i+1)),W):(W="M"+t+","+n+"L","M "+t+","+n)}function ot(e){O.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.7)").style("left",d(g[e].x)+60+"px").style("top",v(g[e].y)+30+"px").style("zIndex",100).transition().duration(250),M.text("astromonicalBody: "+e+"\n"+"time: "+modelTimeLabel()+"\n"+"speed: "+d3.format("+6.3e")(g[e].speed)+"\n"+"vx:    "+d3.format("+6.3e")(g[e].vx)+"\n"+"vy:    "+d3.format("+6.3e")(g[e].vy)+"\n"+"ax:    "+d3.format("+6.3e")(g[e].ax)+"\n"+"ay:    "+d3.format("+6.3e")(g[e].ay)+"\n")}function ut(){!C&&C!==0&&O.style("opacity",1e-6).style(NaN)}function at(){O===undefined&&(O=d3.select("body").append("div").attr("class","tooltip").style("opacity",1e-6),M=O.append("pre"))}function ft(){P=s.get("images"),H=s.get("imageMapping"),B=s.get("imagePath"),B?I=t.actualRoot+B:s.url&&(I=t.actualRoot+s.url.slice(0,s.url.lastIndexOf("/")+1)),U=s.get("bodyTraceColor")}function lt(){function e(e){return function(){e(),r.updateClickHandlers()}}y=r.containers.mainContainer,E=r.containers.imageContainerBelow,S=r.containers.imageContainerTop,x=r.containers.textContainerBelow,T=r.containers.textContainerTop,d=r.model2px,v=r.model2pxInv,m=r.modelSize2px,_=r.getFontSizeInPixels(),D=_*.9,V=_/12,g=s.get_results(),u=s.get("width"),a=s.get("height"),p=u/a,ft(),modelMinX=s.get("minX"),modelMinY=s.get("minY"),modelMaxX=s.get("maxX"),modelMaxY=s.get("maxY"),at(),s.addPropertiesListener(["showBodyTrace","bodyTraceId","backgroundColor","markColor"],e(ht)),s.on("addBody",e(ht)),s.on("removeBody",e(ht))}function ct(e){s=e,lt()}function ht(e,t,n){arguments.length&&(d=e,v=t,m=n),_=r.getFontSizeInPixels(),D=_*.9,$(),Y(),Q(),G()}function pt(){n.time("view update"),et(),q&&rt(),n.timeEnd("view update")}var o={},u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=[],C,k,L,A,O,M,_,D,P,H,B,j=[],F,I,q,R,U,z,W,X=35500,V;return o={update:pt,repaint:ht,reset:ct,model2px:r.model2px,model2pxInv:r.model2pxInv,modelSize2px:r.modelSize2px},lt(),o}}),define("solar-system/views/view",["require","common/console","common/views/model-view","solar-system/views/renderer"],function(e){var t=e("common/console"),n=e("common/views/model-view"),r=e("solar-system/views/renderer");return function(e,t){return new n(e,t,r)}}),define("solar-system/controllers/scripting-api",["require"],function(e){return function(t){return{getNumberOfBodies:function(){return model.get_num_bodies()},addBody:function(t,n){return n&&n.supressRepaint&&(n.supressEvent=!0),model.addBody(t,n)},removeBody:function(t,n){n&&n.supressRepaint&&(n.supressEvent=!0,delete n.supressRepaint);try{model.removeBody(t,n)}catch(r){if(!n||!n.silent)throw r}},addRandomBody:function(){return model.addRandomBody.apply(model,arguments)},randomBodies:function(n){var r=model.get_num_bodies();n===null&&(n=1+t.randomInteger(r-1));if(!t.isInteger(n))throw new Error("randomBodies: number of bodies requested, "+n+", is not an integer.");if(n<0)throw new Error("randomBodies: number of bodies requested, "+n+", was less be greater than zero.");return n>r&&(n=r),t.choose(n,r)},markBodies:function n(){var e,r;if(arguments.length===0)return;if(t.isArray(arguments[0]))return n.apply(null,arguments[0]);t.unmarkAllBodies();for(e=0,r=arguments.length;e<r;e++)model.setBodyProperties(arguments[e],{marked:1});t.repaint()},unmarkAllBodies:function(){for(var n=0,r=model.get_num_bodies();n<r;n++)model.setBodyProperties(n,{marked:0});t.repaint()},traceBody:function(t){if(t===null)return;model.set({bodyTraceId:t}),model.set({showBodyTrace:!0})},untraceBody:function(){model.set({showBodyTrace:!1})},setBodyProperties:function(n,r,i,s,o){model.setBodyProperties(n,r,i,s),(!o||!o.supressRepaint)&&t.repaint()},getBodyProperties:function(t){return model.getBodyProperties(t)},addTextBox:function(e){model.addTextBox(e)},removeTextBox:function(e){model.removeTextBox(e)},setTextBoxProperties:function(e,t){model.setTextBoxProperties(e,t)}}}}),define("solar-system/benchmarks/benchmarks",["require"],function(e){return function(t){var n=[{name:"commit",numeric:!1,run:function(e){var t="<a href='"+Lab.version.repo.commit.url+"' class='opens-in-new-window' target='_blank'>"+Lab.version.repo.commit.short_sha+"</a>";Lab.version.repo.dirty&&(t+=" <i>dirty</i>"),e(t)}},{name:"bodies",numeric:!0,run:function(e){e(model.get_num_bodies())}},{name:"just graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;model.stop(),r=+Date.now(),i=-1;while(i++<100)t.modelContainer.update();n=Date.now()-r,e(100/n*1e3)}},{name:"model (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),n=+Date.now(),r=-1;while(r++<100)model.tick(1,{dontDispatchTickEvent:!0});t=Date.now()-n,e(100/t*1e3)}},{name:"model+graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),t=+Date.now(),r=-1;while(r++<100)model.tick();n=Date.now()-t,e(100/n*1e3)}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){model.start(),setTimeout(function(){model.stop();var t=model.get("time");setTimeout(function(){model.start(),setTimeout(function(){model.stop();var n=model.get("time")-t;e(n/(model.get("timeStepsPerTick")*model.get("timeStep"))/2)},2e3)},100)},1e3)}},{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}}];return n}}),define("solar-system/controllers/controller",["require","common/controllers/model-controller","solar-system/models/modeler","solar-system/views/view","solar-system/controllers/scripting-api","solar-system/benchmarks/benchmarks"],function(e){var t=e("common/controllers/model-controller"),n=e("solar-system/models/modeler"),r=e("solar-system/views/view"),i=e("solar-system/controllers/scripting-api"),s=e("solar-system/benchmarks/benchmarks");return function(e,o,u,a,f){return new t(e,o,u,a,f,n,r,i,s)}}),define("common/controllers/interactives-controller",["require","lab.config","arrays","common/alert","common/controllers/interactive-metadata","common/validator","common/controllers/bar-graph-controller","common/controllers/graph-controller","common/controllers/export-controller","common/controllers/scripting-api","common/controllers/button-controller","common/controllers/checkbox-controller","common/controllers/text-controller","common/controllers/image-controller","common/controllers/radio-controller","common/controllers/slider-controller","common/controllers/pulldown-controller","common/controllers/numeric-output-controller","common/controllers/parent-message-api","common/controllers/thermometer-controller","common/controllers/playback-controller","common/controllers/div-controller","common/controllers/setup-banner","common/controllers/about-dialog","common/controllers/share-dialog","common/controllers/credits-dialog","common/layout/semantic-layout","common/layout/templates","md2d/controllers/controller","solar-system/controllers/controller"],function(e){var t=e("lab.config"),n=e("arrays"),r=e("common/alert"),i=e("common/controllers/interactive-metadata"),s=e("common/validator"),o=e("common/controllers/bar-graph-controller"),u=e("common/controllers/graph-controller"),a=e("common/controllers/export-controller"),f=e("common/controllers/scripting-api"),l=e("common/controllers/button-controller"),c=e("common/controllers/checkbox-controller"),h=e("common/controllers/text-controller"),p=e("common/controllers/image-controller"),d=e("common/controllers/radio-controller"),v=e("common/controllers/slider-controller"),m=e("common/controllers/pulldown-controller"),g=e("common/controllers/numeric-output-controller"),y=e("common/controllers/parent-message-api"),b=e("common/controllers/thermometer-controller"),w=e("common/controllers/playback-controller"),E=e("common/controllers/div-controller"),S=e("common/controllers/setup-banner"),x=e("common/controllers/about-dialog"),T=e("common/controllers/share-dialog"),N=e("common/controllers/credits-dialog"),C=e("common/layout/semantic-layout"),k=e("common/layout/templates"),L=e("md2d/controllers/controller"),A=e("solar-system/controllers/controller"),O={text:h,image:p,button:l,checkbox:c,pulldown:m,radio:d,thermometer:b,barGraph:o,graph:u,slider:v,numericOutput:g,div:E,playback:w};return function(o,u){function U(e){if(d[e])return d[e];throw new Error("No model found with id "+e)}function z(e,n){function o(e,t){c?c.reload(e,t,i,s):(u(t.type,e,t),c.on("modelReset",K),l.modelController=c,K(t)),W(),q.setupModel(c),q.layoutInteractive()}function u(e,t,n){var r=e||"md2d";switch(r){case"md2d":c=new L(t,n,i,s,l);break;case"solar-system":c=new A(t,n,i,s,l)}c.ScriptingAPI&&(D.extend(c.ScriptingAPI),D.exposeScriptingAPI())}var r=U(e),i,s;l.currentModel=r,r.viewOptions?i=$.extend(!0,{},r.viewOptions):i={controlButtons:"play"},g=[],r.onLoad&&g.push(D.makeFunctionInScriptContext(J(r.onLoad))),r.modelOptions&&(s=$.extend(!0,{},r.modelOptions)),n?o(r.url,n):r.url?$.get(t.actualRoot+r.url).done(function(e){e=typeof e=="string"?JSON.parse(e):e,o(r.url,e)}).fail(function(){n={type:"md2d",width:2.5,height:1.5,viewOptions:{backgroundColor:"rgba(245,200,200,255)",showClock:!1,textBoxes:[{text:"Model could not be loaded:",x:0,y:1,width:2.5,height:.25,fontScale:1.4,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"},{text:r.url,x:0,y:.8,width:2.5,height:.25,fontScale:.9,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"}]}},o(r.url,n)}):(n=r.model,o("",n))}function W(){h.off("keydown.interactiveController"),c&&c.enableKeyboardHandlers()&&h.on("keydown.interactiveController",function(e){var t=e.keycode||e.which;switch(t){case 13:e.preventDefault(),D.api.start();break;case 32:e.preventDefault(),D.api.isStopped()?D.api.start():D.api.stop();break;case 37:e.preventDefault(),D.api.isStopped()?D.api.stepBack():D.api.stop();break;case 39:e.preventDefault(),D.api.isStopped()?D.api.stepForward():D.api.stop()}})}function X(){var e,t,n,r,i,s,u;typeof o.template=="string"?e=k[o.template]:e=o.template,t=o.layout,i=o.fontScale,s=S(D,o,I,j,F),r=s.components;for(n in r)r.hasOwnProperty(n)&&(n=r[n],n.modelLoadedCallback&&m.push($.proxy(n.modelLoadedCallback,n)));e=s.template.concat(e),t=$.extend({},t,s.layout),r=$.extend({},E,s.components),q.initialize(e,t,r,i),G()&&($(window).unbind("resize"),$(window).on("resize",function(){l.resize()})),u=function(){l.resize(),setTimeout(l.resize,50)},document.addEventListener("fullscreenchange",u,!1),document.addEventListener("mozfullscreenchange",u,!1),document.addEventListener("webkitfullscreenchange",u,!1)}function V(e){var t=e.type,n=e.id,r;r=new O[t](e,D,l);if(!r.getViewContainer().hasClass("component"))throw new Error("Invalid Interactive Component implementation. Each component has to have 'component' class.");E[n]=r,M.push(r),r.modelLoadedCallback&&m.push($.proxy(r.modelLoadedCallback,r))}function J(e){return typeof e=="string"?e:e.join("\n")}function K(){var e,t;Z("basic",l.currentModel.outputs,o.outputs),et(l.currentModel.parameters,o.parameters),Z("filtered",l.currentModel.filteredOutputs,o.filteredOutputs);for(e=0;e<m.length;e++)m[e]();B=new y(model,c.modelContainer,l);for(e=0;e<v.length;e++)t=v[e],model.addPropertiesListener(t[0],t[1]);for(e=0;e<g.length;e++)g[e]();for(e=0;e<w.length;e++)w[e]()}function Q(e){function l(e,t){var n,o,u;if(!t)return;try{for(n=0,o=t.length;n<o;n++)t[n]=s.validateCompleteness(i[e],t[n])}catch(a){throw u="Incorrect "+e+" definition:\n"+a.message,r(u),new Error(u)}}var t,n,o,u,a,f;try{e=s.validateCompleteness(i.interactive,e)}catch(c){throw f="Incorrect interactive definition:\n"+c.message,r(f),new Error(f)}l("model",e.models),l("parameter",e.parameters),l("output",e.outputs),l("filteredOutput",e.filteredOutputs),o=e.models;for(t=0,n=o.length;t<n;t++)u=o[t],l("parameter",u.parameters),l("output",u.outputs),l("filteredOutput",u.filteredOutputs);a=e.components;try{for(t=0,n=a.length;t<n;t++)a[t]=s.validateCompleteness(i[a[t].type],a[t])}catch(c){throw f="Incorrect "+a[t].type+" component definition:\n"+c.message,r(f),new Error(f)}if(e.exports)try{e.exports=s.validateCompleteness(i.exports,e.exports)}catch(c){throw f="Incorrect exports definition:\n"+c.message,r(f),new Error(f)}return e}function G(){return h.parent().parent().prop("nodeName")==="BODY"}function Y(e){var t,n,r;m=[],o=Q(e),p=o.models;for(n=0,r=p.length;n<r;n++)d[p[n].id]=p[n];t=o.components||[],M=[],E={};for(n=0,r=t.length;n<r;n++)V(t[n]);o.exports&&(H=new a(o.exports),m.push(H.modelLoadedCallback),a.isExportAvailable()&&V({type:"button",text
:"Analyze Data",id:"-lab-analyze-data",action:"exportData();"})),X(),z(p[0].id)}function Z(e,t,n){function o(e){if(!e)return;for(var t=0;t<e.length;t++)r[e[t].name]=e[t]}if(!t&&!n)return;var r={},i,s;o(n),o(t);for(i in r)if(r.hasOwnProperty(i)){s=r[i];switch(e){case"basic":model.defineOutput(s.name,{label:s.label,unitType:s.unitType,unitName:s.unitName,unitPluralName:s.unitPluralName,unitAbbreviation:s.unitAbbreviation},D.makeFunctionInScriptContext(J(s.value)));break;case"filtered":model.defineFilteredOutput(s.name,{label:s.label,unitType:s.unitType,unitName:s.unitName,unitPluralName:s.unitPluralName,unitAbbreviation:s.unitAbbreviation},s.property,s.type,s.period)}}}function et(e,t){if(!e&&!t)return;var n={},r,i,s,o;r=(t||[]).concat(e||[]);for(i=0;i<r.length;i++)s=r[i],o=undefined,s.onChange&&(o=D.makeFunctionInScriptContext("value",J(s.onChange))),model.defineParameter(s.name,{label:s.label,unitType:s.unitType,unitName:s.unitName,unitPluralName:s.unitPluralName,unitAbbreviation:s.unitAbbreviation},o),s.initialValue!==undefined&&(n[s.name]=s.initialValue),_[s.name]=s;model.set(n)}var l={},c,h,p=[],d={},v=[],m=[],g=[],b=[],w=[],E={},M=[],_=[],D,P,H,B,j,F,I,q,R;return R=function(){var e=-1;return function(){return e++}},l={getDGExportController:function(){return H},getModelController:function(){return c},pushOnLoadScript:function(e){g.push(e)},getNextTabIndex:R,resize:function(){var e;q.layoutInteractive();for(e=0;e<b.length;e++)b[e]()},on:function(e,t){if(typeof t=="function")t=[t];else{if(!$.isArray(t))throw new Error("Invalid callback, must be a function or array of functions.");if(t.some(function(e){return typeof e!="function"}))throw new Error("Invalid callback, must be an array of functions.")}switch(e){case"resize":b=b.concat(t);break;case"modelLoaded":w=w.concat(t)}},get:function(e){return o[e]},serialize:function(){var e,t,r,i,s;if(model!==undefined&&model.get!==undefined)for(i in _)_.hasOwnProperty(i)&&(i=_[i],s=model.get(i.name),s!==undefined&&(i.initialValue=s));e={title:o.title,publicationStatus:o.publicationStatus,subtitle:o.subtitle,fontScale:o.fontScale,about:n.isArray(o.about)?$.extend(!0,[],o.about):o.about,models:$.extend(!0,[],o.models),parameters:$.extend(!0,[],o.parameters),outputs:$.extend(!0,[],o.outputs),filteredOutputs:$.extend(!0,[],o.filteredOutputs)},e.components=[];for(t=0,r=M.length;t<r;t++)M[t].serialize&&e.components.push(M[t].serialize());return e.layout=$.extend(!0,{},o.layout),typeof o.template=="string"?e.template=o.template:e.template=$.extend(!0,{},o.template),e},loadInteractive:Y,validateInteractive:Q,loadModel:z},D=new f(l,P),D.exposeScriptingAPI(),h=$(u),l.interactiveContainer=h,q=new C(h),I=new N,j=new x,F=new T,l.on("resize",$.proxy(F.updateIframeSize,F)),Y(o,u),l}}),define("solar-system/public-api",["require","common/controllers/interactives-controller","common/benchmark/benchmark"],function(e){var t=e("common/controllers/interactives-controller"),n=e("common/benchmark/benchmark"),r;return r={version:"0.0.1",interactivesController:t},window.controllers=r,window.benchmark=n,r}),require(["solar-system/public-api"],undefined,undefined,!0)})();