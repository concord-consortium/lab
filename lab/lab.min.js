(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),grapher={version:"0.0.1"},grapher.data=function(a){var b=0,c=a.length,d=[];for(b=0;b<c;b+=2)d.push({x:a[b],y:a[b+1]});return d},grapher.indexedData=function(a,b){var c=0,d=b||0,e=a.length,f=[];for(c=0;c<e;c++)f.push({x:c+d,y:a[c]});return f},grapher.colors=function(a){var b={bright_red:"#ff0000",dark_red:"#990000",bright_blue:"#4444ff",dark_blue:"#110077",bright_green:"#00dd00",dark_green:"#118800",bright_purple:"#cc00cc",dark_purple:"#770099",bright_orange:"#ee6600",dark_orange:"#aa4400",bright_turquoise:"#00ccbb",dark_turquoise:"#008877"};return b[a]},grapher.sampleGraph=function(a){function n(){var a=l.select("path").attr("d",line(k)),b=l.select("svg").selectAll("circle").data(k,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",6).on("mousedown",function(a){selected=dragged=a,n()}),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function o(){if(!dragged)return;var a=d3.svg.mouse(l.node());dragged.x=x.invert(Math.max(0,Math.min(g.width,a[0]))),dragged.y=y.invert(Math.max(0,Math.min(g.height,a[1]))),n()}function p(){if(!dragged)return;o(),dragged=null}function q(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=k.indexOf(selected);k.splice(a,1),selected=k.length?k[a>0?a-1:0]:null,n()}}function r(){var a=x.tickFormat(10),b=y.tickFormat(10),c=l.selectAll("g.x").data(x.ticks(10),String).attr("transform",h);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",h);d.append("svg:line").attr("stroke",j).attr("y1",0).attr("y2",g.height),d.append("svg:text").attr("y",g.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(l[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),c.exit().remove();var e=l.selectAll("g.y").data(y.ticks(10),String).attr("transform",i);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",i).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",j).attr("x1",0).attr("x2",g.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(l[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),e.exit().remove(),n()}var b={};b.xmax=60,b.xmin=0,b.ymax=40,b.ymin=0,b.title="Simple Graph",b.xlabel="X Axis",b.ylabel="Y Axis";var c=document.getElementById("chart"),d=c.clientWidth,e=c.clientHeight,f={top:b.title?30:20,right:30,bottom:b.xlabel?40:10,left:b.ylabel?70:45},g={width:d-f.left-f.right,height:e-f.top-f.bottom},h=function(a){return"translate("+x(a)+",0)"},i=function(a){return"translate(0,"+y(a)+")"},j=function(a){return a?"#ccc":"#666"},k=grapher.indexedData(d3.range(1,60).map(function(a){return a,15+Math.random()*10}));x=d3.scale.linear().domain([b.xmin,b.xmax]).range([0,g.width]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([b.ymax,b.ymin]).nice().range([0,g.height]).nice(),line=d3.svg.line().x(function(a,b){return x(k[b].x)}).y(function(a,b){return y(k[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=selected=null;var l=d3.select(c).append("svg:svg").attr("width",d).attr("height",e).append("svg:g").attr("transform","translate("+f.left+","+f.top+")"),m=l.append("svg:rect").attr("width",g.width).attr("height",g.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().x(x).y(y).scaleExtent([1,8]).on("zoom",r)).on("mousedown",function(){d3.event.altKey&&(k.push(selected=dragged=d3.svg.mouse(l.node())),n(),d3.event.preventDefault(),d3.event.stopPropagation())});l.append("svg:svg").attr("top",0).attr("left",0).attr("width",g.width).attr("height",g.height).attr("viewBox","0 0 "+g.width+" "+g.height).append("svg:path").attr("class","line").attr("d",line(k)),b.title&&l.append("svg:text").text(b.title).attr("x",g.width/2).attr("dy","-1em").style("text-anchor","middle"),b.xlabel&&l.append("svg:text").text(b.xlabel).attr("x",g.width/2).attr("y",g.height).attr("dy","2.4em").style("text-anchor","middle"),b.ylabel&&l.append("svg:g").append("svg:text").text(b.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+g.height/2+") rotate(-90)"),d3.select(window).on("mousemove",o).on("mouseup",p).on("keydown",q),r(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(l[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!=0){var g,h;g=1+(downx/c-1)*(f/(downx-d)),h=[d,d+f*g],x.domain(h),r()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){rupy=downscaley.invert(b[1]),yaxis1=downscaley.domain()[1],yaxis2=downscaley.domain()[0],yextent=yaxis2-yaxis1;if(rupy!=0){var i,h;i=downy/rupy,h=[yaxis1+yextent*i,yaxis1],y.domain(h),r()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(r(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(r(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.graph=function(a){function b(a){a.each(function(a,b){var c=d3.select(this),d=Infinity,d=Infinity,e=-Infinity,e=-Infinity,f=x.call(this,a,b),g=y.call(this,a,b),h=domain&&domain.call(this,a,b)||[d3.min(f),d3.max(f)],i=domain&&domain.call(this,a,b)||[d3.min(g),d3.max(g)],j=d3.scale.linear().domain(h).range([0,width]),k=d3.scale.linear().domain(i).range([height,0]),l=this.__chart__&&this.__chart__.x||j,m=this.__chart__&&this.__chart__.y||k,n=c.selectAll(".x.axis").data([,]);n.enter().append("svg:g").attr("class","x axis"),n.attr("transform","translate(0,"+height+")").call(xAxis.scales([l,j]));var o=c.selectAll(".y.axis").data([,]);o.enter().append("svg:g").attr("class","y axis"),o.call(yAxis.scales([m,k])),this.__chart__={x:j,y:k};var p=c.selectAll("g.datum").data(f),q=function(a,b){return"translate("+j(a)+","+k(g[b])+")"};p.enter().append("svg:g").attr("class","datum").attr("transform",function(a,b){return"translate("+l(a)+","+m(g[b])+")"}).style("opacity",1e-6).transition().duration(duration).delay(function(a){return l(a)*5}).attr("transform",q).style("opacity",1),p.transition().duration(duration).delay(function(a){return j(a)*5}).attr("transform",q).style("opacity",1),p.exit().transition().duration(duration).delay(function(a){return j(a)*5}).attr("transform",q).style("opacity",1e-6).remove(),d3.timer.flush()})}function l(){var a=k.select("path").attr("d",line(j)),b=k.selectAll("circle").data(j,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",6).on("mousedown",function(a){selected=dragged=a,l()}),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function m(){if(!dragged)return;var a=d3.svg.mouse(k.node());dragged.x=x.invert(Math.max(0,Math.min(c[0],a[0]))),dragged.y=y.invert(Math.max(0,Math.min(c[1],a[1]))),l()}function n(){if(!dragged)return;m(),dragged=null}function o(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=j.indexOf(selected);j.splice(a,1),selected=j.length?j[a>0?a-1:0]:null,l()}}function p(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),b=y.tickFormat(10),d=k.selectAll("g.x").data(x.ticks(10),String).attr("transform",g);d.select("text").text(a);var e=d.enter().insert("svg:g","a").attr("class","x").attr("transform",g);e.append("svg:line").attr("stroke",i).attr("y1",0).attr("y2",c[1]),e.append("svg:text").attr("y",c[1]).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(k[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),d.exit().remove();var f=k.selectAll("g.y").data(y.ticks(10),String).attr("transform",h);f.select("text").text(b);var j=f.enter().insert("svg:g","a").attr("class","y").attr("transform",h).attr("background-fill","#FFEEB6");j.append("svg:line").attr("stroke",i).attr("x1",0).attr("x2",c[0]),j.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(k[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),f.exit().remove(),l()}var c=[890,450],d=[20,30,20,40],e=c[0]-d[1]-d[3],f=c[1]-d[0]-d[2],g=function(a){return"translate("+x(a)+",0)"},h=function(a){return"translate(0,"+y(a)+")"},i=function(a){return a?"#ccc":"#666"},j=grapher.indexedData(d3.range(1,60).map(function(a){return a,15+Math.random()*10}));x=d3.scale.linear().domain([15,45]).range([0,e]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([40,10]).range([0,f]),line=d3.svg.line().x(function(a,b){return x(j[b].x)}).y(function(a,b){return y(j[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=j[0];var k=d3.select("#chart").append("svg:svg").attr("width",c[0]+d[3]+d[1]).attr("height",c[1]+d[0]+d[2]).append("svg:g").attr("transform","translate("+d[3]+","+d[0]+")"),b=k.append("svg:rect").attr("width",c[0]).attr("height",c[1]).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",p)).on("mousedown",function(){d3.event.altKey&&(j.push(selected=dragged=d3.svg.mouse(k.node())),l(),d3.event.preventDefault(),d3.event.stopPropagation())});k.append("svg:path").attr("class","line").attr("d",line(j)),d3.select(window).on("mousemove",m).on("mouseup",n).on("keydown",o),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),l()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String),p(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(k[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!=0){var g,h;g=1+(downx/c-1)*(f/(downx-d)),h=[d,d+f*g],x.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){rupy=downscaley.invert(b[1]),yaxis1=downscaley.domain()[1],yaxis2=downscaley.domain()[0],yextent=yaxis2-yaxis1;if(rupy!=0){var i,h;i=downy/rupy,h=[yaxis1+yextent*i,yaxis1],y.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(p(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(p(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.citiesSampleGraph=function(a){function l(){var a=j.select("path").attr("d",line(i)),b=j.selectAll("circle").data(i,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",6).on("mousedown",function(a){selected=dragged=a,l()}),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function m(){if(!dragged)return;var a=d3.svg.mouse(j.node());dragged.x=x.invert(Math.max(0,Math.min(b[0],a[0]))),dragged.y=y.invert(Math.max(0,Math.min(b[1],a[1]))),l()}function n(){if(!dragged)return;m(),dragged=null}function o(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=i.indexOf(selected);i.splice(a,1),selected=i.length?i[a>0?a-1:0]:null,l()}}function p(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),c=y.tickFormat(10),d=j.selectAll("g.x").data(x.ticks(10),String).attr("transform",f);d.select("text").text(a);var e=d.enter().insert("svg:g","a").attr("class","x").attr("transform",f);e.append("svg:line").attr("stroke",h).attr("y1",0).attr("y2",b[1]),e.append("svg:text").attr("y",b[1]).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),d.exit().remove();var i=j.selectAll("g.y").data(y.ticks(10),String).attr("transform",g);i.select("text").text(c);var k=i.enter().insert("svg:g","a").attr("class","y").attr("transform",g).attr("background-fill","#FFEEB6");k.append("svg:line").attr("stroke",h).attr("x1",0).attr("x2",b[0]),k.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(c).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),i.exit().remove(),l()}var b=[890,450],c=[20,30,20,40],d=b[0]-c[1]-c[3],e=b[1]-c[0]-c[2],f=function(a){return"translate("+x(a)+",0)"},g=function(a){return"translate(0,"+y(a)+")"},h=function(a){return a?"#ccc":"#666"},i=grapher.indexedData(a.average_temperatures,1);x=d3.scale.linear().domain([1,12]).range([0,d]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([30,-30]).range([0,e]),line=d3.svg.line().x(function(a,b){return x(i[b].x)}).y(function(a,b){return y(i[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=i[0];var j=d3.select("#chart").append("svg:svg").attr("width",b[0]+c[3]+c[1]).attr("height",b[1]+c[0]+c[2]).append("svg:g").attr("transform","translate("+c[3]+","+c[0]+")"),k=j.append("svg:rect").attr("width",b[0]).attr("height",b[1]).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",p)).on("mousedown",function(){d3.event.altKey&&(i.push(selected=dragged=d3.svg.mouse(j.node())),l(),d3.event.preventDefault(),d3.event.stopPropagation())});j.append("svg:path").attr("class","line").attr("d",line(i)),d3.select(window).on("mousemove",m).on("mouseup",n).on("keydown",o),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),l()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String),p(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(j[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!=0){var g,h;g=downx/c,h=[d,d+f*g],x.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){rupy=downscaley.invert(b[1]),yaxis1=downscaley.domain()[1],yaxis2=downscaley.domain()[0],yextent=yaxis2-yaxis1;if(rupy!=0){var i,h;i=downy/rupy,h=[yaxis1+yextent*i,yaxis1],y.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(p(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(p(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.surfaceTemperatureSampleGraph=function(a){function v(){var a=t.select("path").attr("d",p(k)),b=t.select("svg").selectAll("circle").data(k,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return}).attr("cy",function(a){return o(a[1])}).attr("r",4).on("mousedown",function(a){selected=s=a,v()}).transition().duration(300).ease("elastic").attr("r",2),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return l(a[0])}).attr("cy",function(a){return o(a[1])}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function w(){if(!s)return;var a=d3.svg.mouse(t.node());s[0]=l.invert(Math.max(0,Math.min(g.width,a[0]))),s[1]=o.invert(Math.max(0,Math.min(g.height,a[1]))),v()}function x(){if(!s)return;w(),s=null}function y(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=k.indexOf(selected);k.splice(a,1),selected=k.length?k[a>0?a-1:0]:null,v()}}function z(){d3.event&&d3.event.transform&&isNaN(n)&&isNaN(r)&&d3.event.transform(l,o);var a=l.tickFormat(10),b=o.tickFormat(10),c=t.selectAll("g.x").data(l.ticks(10),String).attr("transform",h);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",h);d.append("svg:line").attr("stroke",j).attr("y1",0).attr("y2",g.height),d.append("svg:text").attr("y",g.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(t[0][0]);n=l.invert(b[0]),m=null,m=l.copy()}),c.exit().remove();var e=t.selectAll("g.y").data(o.ticks(10),String).attr("transform",i);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",i).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",j).attr("x1",0).attr("x2",g.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(t[0][0]);r=o.invert(b[1]),q=o.copy()}),e.exit().remove(),v()}var b={};b.xmax=2e3,b.xmin=500,b.ymax=15,b.ymin=13,b.title="Earth's Surface Temperature: years 500-2009",b.xlabel="Year",b.ylabel="Degrees C";var c=document.getElementById("chart"),d=c.clientWidth,e=c.clientHeight,f={top:b.title?30:20,right:30,bottom:b.xlabel?40:10,left:b.ylabel?70:45},g={width:d-f.left-f.right,height:e-f.top-f.bottom},h=function(a){return"translate("+l(a)+",0)"},i=function(a){return"translate(0,"+o(a)+")"},j=function(a){return a?"#ccc":"#666"},k=a.temperature_anomolies.map(function(b){return[b[0],b[1]+a.global_surface_temperature_1961_1990]}),l=d3.scale.linear().domain([b.xmin,b.xmax]).range([0,g.width]),m=l.copy(),n=Math.NaN,o=d3.scale.linear().domain([b.ymax,b.ymin]).nice().range([0,g.height]).nice(),p=d3.svg.line().x(function(a,b){return l(k[b][0])}).y(function(a,b){return o(k[b][1])}),q=o.copy(),r=Math.NaN,s=selected=null,t=d3.select("#chart").append("svg:svg").attr("width",d).attr("height",e).append("svg:g").attr("transform","translate("+f.left+","+f.top+")"),u=t.append("svg:rect").attr("width",g.width).attr("height",g.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().x(l).y(o).on("zoom",z)).on("mousedown",function(){d3.event.altKey&&(points.push(selected=s=d3.svg.mouse(t.node())),v(),d3.event.preventDefault(),d3.event.stopPropagation())});t.append("svg:svg").attr("top",0).attr("left",0).attr("width",g.width).attr("height",g.height).attr("viewBox","0 0 "+g.width+" "+g.height).append("svg:path").attr("class","line").attr("d",p(k)),b.title&&t.append("svg:text").text(b.title).attr("x",g.width/2).attr("dy","-1em").style("text-anchor","middle"),b.xlabel&&t.append("svg:text").text(b.xlabel).attr("x",g.width/2).attr("y",g.height).attr("dy","2.4em").style("text-anchor","middle"),b.ylabel&&t.append("svg:g").append("svg:text").text(b.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+g.height/2+") rotate(-90)"),d3.select(window).on("mousemove",w).on("mouseup",x).on("keydown",y),z(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(t[0][0]);if(!isNaN(n)){var c=m.invert(b[0]),d=m.domain()[0],e=m.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/n,g=1+(n/c-1)*(f/(n-d))/h,i=[d,d+f*g],l.domain(i),z()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(r)){var j=q.invert(b[1]),k=q.domain()[1],p=q.domain()[0],s=p-k;if(j!==0){var u,v,w;v=s/r,u=1-(j/r-1)*(s/(r-k))/v,w=[k+s*u,k],o.domain(w),z()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(n)||(z(),n=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(r)||(z(),r=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.lennardJonesSampleGraph=function(){function o(){var a=m.select("path").attr("d",line(l)),b=x.domain()[1]-x.domain()[0],c=m.select("svg").selectAll("circle").data(l,function(a){return a});c.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",4).on("mousedown",function(a){selected=dragged=a,o()}).transition().duration(300).ease("elastic").attr("r",2),c.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),c.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function p(){if(!dragged)return;var a=d3.svg.mouse(m.node());dragged[0]=x.invert(Math.max(0,Math.min(f.width,a[0]))),dragged[1]=y.invert(Math.max(0,Math.min(f.height,a[1]))),o()}function q(){if(!dragged)return;p(),dragged=null}function r(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=l.indexOf(selected);l.splice(a,1),selected=l.length?l[a>0?a-1:0]:null,o()}}function s(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),b=y.tickFormat(10),c=m.selectAll("g.x").data(x.ticks(10),String).attr("transform",i);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",i);d.append("svg:line").attr("stroke",k).attr("y1",0).attr("y2",f.height),d.append("svg:text").attr("y",f.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(m[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),c.exit().remove();var e=m.selectAll("g.y").data(y.ticks(10),String).attr("transform",j);e.select("text").text(b);var g=e.enter().insert("svg:g","a").attr("class","y").attr("transform",j).attr("background-fill","#FFEEB6");g.append("svg:line").attr("stroke",k).attr("x1",0).attr("x2",f.width),g.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(m[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),e.exit().remove(),o()}var a={};a.epsilon=-0.5,a.sigma=10,a.r_min=Math.pow(2,1/6)*a.sigma,a.alpha=4*Math.pow(a.epsilon*a.sigma,12),a.beta=4*Math.pow(a.epsilon*a.sigma,6),a.xmax=a.sigma,a.xmin=0,a.ymax=5,a.ymin=-1,a.title="Lennard-Jones potential",a.xlabel="Radius",a.ylabel="Potential Well";var b=document.getElementById("chart"),c=b.clientWidth,d=b.clientHeight,e={top:a.title?100:20,right:30,bottom:a.xlabel?40:10,left:a.ylabel?70:45},f={width:c-e.left-e.right,height:d-e.top-e.bottom},g=f.width,h=f.height,i=function(a){return"translate("+x(a)+",0)"},j=function(a){return"translate(0,"+y(a)+")"},k=function(a){return a?"#ccc":"#666"},l=d3.range(a.sigma*10).map(function(b){return{x:b*.1,y:a.alpha/Math.pow(b*10,12)-a.beta/Math.pow(b*10,6)}});x=d3.scale.linear().domain([a.xmin,a.xmax]).range([0,g]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([a.ymax,a.ymin]).nice().range([0,h]).nice(),line=d3.svg.line().x(function(a,b){return x(l[b].x)}).y(function(a,b){return y(l[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=l[0];var m=d3.select("#chart").append("svg:svg").attr("width",c).attr("height",d).append("svg:g").attr("transform","translate("+e.left+","+e.top+")"),n=m.append("svg:rect").attr("width",f.width).attr("height",f.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",s)).on("mousedown",function(){d3.event.altKey&&(points.push(selected=dragged=d3.svg.mouse(m.node())),o(),d3.event.preventDefault(),d3.event.stopPropagation())});m.append("svg:svg").attr("top",0).attr("left",0).attr("width",f.width).attr("height",f.height).attr("viewBox","0 0 "+f.width+" "+f.height).append("svg:path").attr("class","line").attr("d",line(l)),a.title&&m.append("svg:text").text(a.title).attr("x",f.width/2).attr("dy","-1em").style("text-anchor","middle"),a.xlabel&&m.append("svg:text").text(a.xlabel).attr("x",f.width/2).attr("y",f.height).attr("dy","2.4em").style("text-anchor","middle"),a.ylabel&&m.append("svg:g").append("svg:text").text(a.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+f.height/2+") rotate(-90)"),d3.select(window).on("mousemove",p).on("mouseup",q).on("keydown",r),s(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(m[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/downx,g=1+(downx/c-1)*(f/(downx-d))/h,i=[d,d+f*g],x.domain(i),s()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){var j=downscaley.invert(b[1]),k=downscaley.domain()[1],l=downscaley.domain()[0],n=l-k;if(j!==0){var o,p,q;p=n/downy,o=1-(j/downy-1)*(n/(downy-k))/p,q=[k+n*o,k],y.domain(q),s()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(s(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(s(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})}})();var require=function(a,b){var c=require.resolve(a,b||"/"),d=require.modules[c];if(!d)throw new Error("Failed to resolve module "+a+", tried "+c);var e=d._cached?d._cached:d();return e};require.paths=[],require.modules={},require.extensions=[".js",".coffee"],require._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},require.resolve=function(){return function(a,b){function g(a){if(require.modules[a])return a;for(var b=0;b<require.extensions.length;b++){var c=require.extensions[b];if(require.modules[a+c])return a+c}}function h(a){a=a.replace(/\/+$/,"");var b=a+"/package.json";if(require.modules[b]){var d=require.modules[b](),e=d.browserify;if(typeof e=="object"&&e.main){var f=g(c.resolve(a,e.main));if(f)return f}else if(typeof e=="string"){var f=g(c.resolve(a,e));if(f)return f}else if(d.main){var f=g(c.resolve(a,d.main));if(f)return f}}return g(a+"/index")}function i(a,b){var c=j(b);for(var d=0;d<c.length;d++){var e=c[d],f=g(e+"/"+a);if(f)return f;var i=h(e+"/"+a);if(i)return i}var f=g(a);if(f)return f}function j(a){var b;a==="/"?b=[""]:b=c.normalize(a).split("/");var d=[];for(var e=b.length-1;e>=0;e--){if(b[e]==="node_modules")continue;var f=b.slice(0,e+1).join("/")+"/node_modules";d.push(f)}return d}b||(b="/");if(require._core[a])return a;var c=require.modules.path();b=c.resolve("/",b);var d=b||"/";if(a.match(/^(?:\.\.?\/|\/)/)){var e=g(c.resolve(d,a))||h(c.resolve(d,a));if(e)return e}var f=i(a,d);if(f)return f;throw new Error("Cannot find module '"+a+"'")}}(),require.alias=function(a,b){var c=require.modules.path(),d=null;try{d=require.resolve(a+"/package.json","/")}catch(e){d=require.resolve(a,"/")}var f=c.dirname(d),g=(Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b})(require.modules);for(var h=0;h<g.length;h++){var i=g[h];if(i.slice(0,f.length+1)===f+"/"){var j=i.slice(f.length);require.modules[b+j]=require.modules[f+j]}else i===f&&(require.modules[b]=require.modules[f])}},require.define=function(a,b){var c=require._core[a]?"":require.modules.path().dirname(a),d=function(a){return require(a,c)};d.resolve=function(a){return require.resolve(a,c)},d.modules=require.modules,d.define=require.define;var e={exports:{}};require.modules[a]=function(){return require.modules[a]._cached=e.exports,b.call(e.exports,d,e,e.exports,c,a),require.modules[a]._cached=e.exports,e.exports}},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(){var a=[],b=typeof window!="undefined"&&window.postMessage&&window.addEventListener;return b&&window.addEventListener("message",function(b){if(b.source===window&&b.data==="browserify-tick"){b.stopPropagation();if(a.length>0){var c=a.shift();c()}}},!0),function(c){b?(a.push(c),window.postMessage("browserify-tick","*")):setTimeout(c,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(a){if(a==="evals")return require("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),require.define("path",function(a,b,c,d,e){function f(a,b){var c=[];for(var d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}function g(a,b){var c=0;for(var d=a.length;d>=0;d--){var e=a[d];e=="."?a.splice(d,1):e===".."?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}var h=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;c.resolve=function(){var a="",b=!1;for(var c=arguments.length;c>=-1&&!b;c--){var d=c>=0?arguments[c]:process.cwd();if(typeof d!="string"||!d)continue;a=d+"/"+a,b=d.charAt(0)==="/"}return a=g(f(a.split("/"),function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."},c.normalize=function(a){var b=a.charAt(0)==="/",c=a.slice(-1)==="/";return a=g(f(a.split("/"),function(a){return!!a}),!b).join("/"),!a&&!b&&(a="."),a&&c&&(a+="/"),(b?"/":"")+a},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(f(a,function(a,b){return a&&typeof a=="string"}).join("/"))},c.dirname=function(a){var b=h.exec(a)[1]||"",c=!1;return b?b.length===1||c&&b.length<=3&&b.charAt(1)===":"?b:b.substring(0,b.length-1):"."},c.basename=function(a,b){var c=h.exec(a)[2]||"";return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return h.exec(a)[3]||""}}),require.define("/arrays/arrays.js",function(a,b,c,d,e){var f;f=c.arrays={},f.version="0.0.1",f.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,f.typed=!1;try{var g=new Float64Array(0);f.typed=!0}catch(h){}f.create=function(a,b,c){c||(f.webgl||f.typed?c="Float32Array":c="regular"),b=b||0;var d,e;if(c==="regular")d=new Array(a);else switch(c){case"Float64Array":d=new Float64Array(a);break;case"Float32Array":d=new Float32Array(a);break;case"Int32Array":d=new Int32Array(a);break;case"Int16Array":d=new Int16Array(a);break;case"Int8Array":d=new Int8Array(a);break;case"Uint32Array":d=new Uint32Array(a);break;case"Uint16Array":d=new Uint16Array(a);break;case"Uint8Array":d=new Uint8Array(a);break;default:d=new Array(a)}e=-1;while(++e<a)d[e]=b;return d},f.constructor_function=function(a){if(a.buffer&&a.buffer.__proto__.constructor)return a.__proto__.constructor;if(a.constructor===Array)return a.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+a+", source.constructor: "+a.constructor+", source.buffer: "+a.buffer+", source.buffer.slice: "+a.buffer.slice+", source.buffer.__proto__: "+a.buffer.__proto__+", source.buffer.__proto__.constructor: "+a.buffer.__proto__.constructor)},f.copy=function(a,b){var c=a.length,d=-1;while(++d<c)b[d]=a[d];return b.length=c,b},f.clone=function(a){var b,c=a.length,d,e;e=f.constructor_function(a);if(e===Array){d=new e(c);for(b=0;b<c;b++)d[b]=a[b];return d}if(a.buffer.slice)return d=new e(a.buffer.slice(0)),d;d=new e(c);for(b=0;b<c;b++)d[b]=a[b];return d},f.between=function(a,b,c){return c<Math.max(a,b)&&c>Math.min(a,b)},f.max=function(
a){return Math.max.apply(Math,a)},f.min=function(a){return Math.min.apply(Math,a)},f.maxTypedArray=function(a){var b,c,d=Number.MIN_VALUE,e=a.length;for(c=0;c<e;c++)b=a[c],d=b>d?b:d;return d},f.minTypedArray=function(a){var b,c,d=Number.MAX_VALUE,e=a.length;for(c=0;c<e;c++)b=a[c],d=b<d?b:d;return d},f.maxAnyArray=function(a){try{return Math.max.apply(Math,a)}catch(b){if(b instanceof TypeError){var c,d,e=Number.MIN_VALUE,f=a.length;for(d=0;d<f;d++)c=a[d],e=c>e?c:e;return e}}},f.minAnyArray=function(a){try{return Math.min.apply(Math,a)}catch(b){if(b instanceof TypeError){var c,d,e=Number.MAX_VALUE,f=a.length;for(d=0;d<f;d++)c=a[d],e=c<e?c:e;return e}}},f.average=function(a){var b,c=0,d=a.length;for(b=0;b<d;b++)c+=a[b];return c/d}}),require.define("/constants/index.js",function(a,b,c,d,e){var f=a("./units"),g=f.unit,h=f.ratio,i=f.convert,j={ELEMENTARY_CHARGE:{value:1,unit:g.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:g.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:g.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:h(g.DALTON,{per:g.GRAM}),unit:g.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:g.FARADS_PER_METER}},k,l;j.COULOMB_CONSTANT={value:1/(4*Math.PI*j.PERMITTIVITY_OF_FREE_SPACE.value),unit:g.METERS_PER_FARAD},c.unit=g,c.ratio=h,c.convert=i;for(k in j)j.hasOwnProperty(k)&&(l=j[k],c[k]=function(a){return{as:function(b){return f.convert(a.value,{from:a.unit,to:b})}}}(l))}),require.define("/constants/units.js",function(a,b,c,d,e){var f=1.66054e-27,g=1.602177e-19,h=g,i=1e-15,j=1e-9,k=10,l=1e3,m={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},n,o,p;c.unit=n={FEMTOSECOND:{name:"femtosecond",value:1,type:m.TIME},SECOND:{name:"second",value:i,type:m.TIME},NANOMETER:{name:"nanometer",value:1,type:m.LENGTH},ANGSTROM:{name:"Angstrom",value:1*k,type:m.LENGTH},METER:{name:"meter",value:1*j,type:m.LENGTH},DALTON:{name:"Dalton",value:1,type:m.MASS},GRAM:{name:"gram",value:1*f*l,type:m.MASS},KILOGRAM:{name:"kilogram",value:1*f,type:m.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:m.ENERGY},JOULE:{name:"Joule",value:f*j*j*(1/i)*(1/i),type:m.ENERGY},EV:{name:"electron volt",value:f*j*j*(1/i)*(1/i)*(1/h),type:m.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:m.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*h,type:m.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:m.CHARGE},COULOMB:{name:"Coulomb",value:g,type:m.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:m.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:m.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:m.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:m.FORCE},NEWTON:{name:"Newton",value:1*f*j*(1/i)*(1/i),type:m.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:m.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*j*(1/i),type:m.VELOCITY}},c.ratio=o=function(a,b){var c=function(a,b){if(a.type!==b.type)throw new Error("Attempt to convert incompatible type '"+a.name+"'' to '"+b.name+"'")};if(b.per)return c(a,b.per),a.value/b.per.value;if(b.as)return c(a,b.as),b.as.value/a.value;throw new Error("units.ratio() received arguments it couldn't understand.")},c.convert=p=function(a,b){var c=b&&b.from,d=b&&b.to;if(!c)throw new Error('units.convert() did not receive a "from" argument');if(!d)throw new Error('units.convert() did not receive a "to" argument');return a*o(d,{per:c})}}),require.define("/math/index.js",function(a,b,c,d,e){c.normal=a("./distributions").normal,c.getWindowedAverager=a("./utils").getWindowedAverager}),require.define("/math/distributions.js",function(a,b,c,d,e){c.normal=function(){var a=null;return function(b,c){b==null&&(b=0),c==null&&(c=1);var d,e,f,g,h;return a?(e=a,a=null,e):(g=Math.random(),h=Math.random(),f=2*Math.PI*g,d=Math.sqrt(-2*Math.log(h)),a=b+c*d*Math.sin(f),b+c*d*Math.cos(f))}}()}),require.define("/math/utils.js",function(a,b,c,d,e){c.getWindowedAverager=function(a){a==null&&(a=1e3);var b=0,c=[],d=0;return function(e){return d-=c[b]||0,d+=e,c[b]=e,++b===a&&(b=0),c.length===a?d/a:NaN}}}),require.define("/potentials/index.js",function(a,b,c,d,e){var f=c.potentials={};c.coulomb=a("./coulomb"),c.getLennardJonesCalculator=a("./lennard-jones").getLennardJonesCalculator}),require.define("/potentials/coulomb.js",function(a,b,c,d,e){var f=a("../constants"),g=f.unit,h=f.COULOMB_CONSTANT.as(f.unit.METERS_PER_FARAD),i=f.ratio(g.NANOMETER,{per:g.METER}),j=Math.pow(f.ratio(g.COULOMB,{per:g.ELEMENTARY_CHARGE}),2),k=f.ratio(g.EV,{per:g.JOULE}),l=f.ratio(g.MW_FORCE_UNIT,{per:g.NEWTON}),m=h*j*i*k,n=h*j*i*i*l,o=c.potential=function(a,b,c){return-m*(b*c/a)},p=c.forceFromSquaredDistance=function(a,b,c){return-n*(b*c/a)},q=c.force=function(a,b,c){return p(a*a)}}),require.define("/potentials/lennard-jones.js",function(a,b,c,d,e){var f=a("../constants"),g=f.unit,h=f.ratio(g.NANOMETER,{per:g.METER}),i=f.ratio(g.MW_FORCE_UNIT,{per:g.NEWTON});c.getLennardJonesCalculator=function(a){var b=-1,c=4,d,e,j,k,l,m=function(m,n){arguments.length&&(b=m,c=n,d=Math.pow(2,1/6)*c,e=4*b*Math.pow(c,12),j=4*b*Math.pow(c,6),k=12*f.convert(e,{from:g.EV,to:g.JOULE})*h*i,l=6*f.convert(j,{from:g.EV,to:g.JOULE})*h*i);var o={epsilon:b,sigma:c,rmin:d};return typeof a=="function"&&a(o),o},n=function(a){return e*Math.pow(a,-6)+j*Math.pow(a,-3)-b},o=function(a){var b=1/a,c=b*b*b,d=c*b,e=d*c;return k*e-l*d};return m(b,c),{coefficients:m,setEpsilon:function(a){return m(a,c)},setSigma:function(a){return m(b,a)},potentialFromSquaredDistance:n,potential:function(a){return n(a*a)},forceOverDistanceFromSquaredDistance:o,force:function(a){return a*o(a*a)}}}}),require.define("/md2d.js",function(a,b,c,d,e){typeof window=="undefined"&&(window={});var f=c.model={},g=a("./arrays/arrays").arrays,h=a("./constants"),i=h.unit,j=a("./math"),k=a("./potentials").coulomb,l=window.lennardJones=a("./potentials").getLennardJonesCalculator(),m=-120*h.BOLTZMANN_CONSTANT.as(i.EV_PER_KELVIN),n=.34,o=39.95,p=h.convert(o,{from:i.DALTON,to:i.KILOGRAM}),q=h.BOLTZMANN_CONSTANT.as(i.JOULES_PER_KELVIN),r,s=!0,t,u,v=!0,w=function(){try{new Float32Array}catch(a){return!1}return!0}(),x=.01*-(4*o/10)*Math.sqrt(2*q*h.ratio(i.MW_ENERGY_UNIT,{per:i.JOULE})*200/o),y,z=.1,A=20,B,C=[10,10],D,E,F,G,H,I,J,K,L,M,N,O,P,Q=12,R,S=0,T=1,U=2,V=3,W=4,X=5,Y=6,Z=7,$=8,_=9,ba=10,bb=11;f.INDICES={RADIUS:S,PX:T,PY:U,X:V,Y:W,VX:X,VY:Y,SPEED:Z,AX:$,AY:_,MASS:ba,CHARGE:bb},l.setEpsilon(m),l.setSigma(n),f.setSize=function(a){},f.setLJEpsilon=function(a){l.setEpsilon(a),s=!0},f.setLJSigma=function(a){l.setSigma(a),s=!0},f.getLJEpsilon=function(){return l.coefficients().epsilon},f.getLJSigma=function(){return l.coefficients().sigma},t=function(){y=l.coefficients().rmin*5,s=!1},u=function(){B=Infinity},f.createNodes=function(a){a=a||{};var b=a.num||50,c=a.temperature||100,d=l.coefficients().rmin,e=.5,k=w&&v?"Float32Array":"regular",m=h.BOLTZMANN_CONSTANT.as(i.JOULES_PER_KELVIN),n,p,q,r,s,t,u,x,y,z,A,B,S=0,T=0,U,V;u=Math.floor(Math.sqrt(b)),x=Math.ceil(b/u),f.nodes=R=g.create(Q,null,"regular"),R[f.INDICES.RADIUS]=g.create(b,d*e,k),f.radius=D=R[f.INDICES.RADIUS],R[f.INDICES.PX]=g.create(b,0,k),f.px=E=R[f.INDICES.PX],R[f.INDICES.PY]=g.create(b,0,k),f.py=F=R[f.INDICES.PY],R[f.INDICES.X]=g.create(b,0,k),f.x=G=R[f.INDICES.X],R[f.INDICES.Y]=g.create(b,0,k),f.y=H=R[f.INDICES.Y],R[f.INDICES.VX]=g.create(b,0,k),f.vx=I=R[f.INDICES.VX],R[f.INDICES.VY]=g.create(b,0,k),f.vy=J=R[f.INDICES.VY],R[f.INDICES.SPEED]=g.create(b,0,k),f.speed=K=R[f.INDICES.SPEED],R[f.INDICES.AX]=g.create(b,0,k),f.ax=L=R[f.INDICES.AX],R[f.INDICES.AY]=g.create(b,0,k),f.ay=M=R[f.INDICES.AY],R[f.INDICES.MASS]=g.create(b,o,k),f.mass=N=R[f.INDICES.MASS],P=f.totalMass=o*b,R[f.INDICES.CHARGE]=g.create(b,0,k),f.charge=O=R[f.INDICES.CHARGE],z=C[0]/(1+x),y=C[1]/(1+u),console.log("initializing to temp",c),r=-1;for(s=1;s<=u;s++)for(t=1;t<=x;t++){r++;if(r===b)break;G[r]=t*z,H[r]=s*y,r<Math.floor(b/2)&&(n=h.convert(N[r],{from:i.DALTON,to:i.KILOGRAM}),p=Math.sqrt(2*m*c/n),q=h.convert(p,{from:i.METERS_PER_SECOND,to:i.MW_VELOCITY_UNIT}),A=j.normal(q,q/4),B=2*Math.random()*Math.PI,I[r]=A*Math.cos(B),J[r]=A*Math.sin(B),I[b-r-1]=-I[r],J[b-r-1]=-J[r]),S+=I[r]*N[r],T+=J[r]*N[r],L[r]=0,M[r]=0,K[r]=Math.sqrt(I[r]*I[r]+J[r]*J[r]),O[r]=2*(r%2)-1}U=S/P,V=T/P},r=function(a){var b=0,c=a.setOnceState,d=a.readWriteState,e=a.settableState||{},f=window.state={},g=c.size,m=d.ax,n=d.ay,o=d.charge,p=d.nodes,r=d.radius,u=d.speed,v=d.vx,w=d.vy,z=d.x,C=d.y,D=e.useCoulombInteraction,E=e.useLennardJonesInteraction,F=e.useThermostat,G=e.targetTemperature,H=!1,I=!1,J=function(){var a=0,b,c=p[0].length;for(b=0;b<c;b++)a+=N[b]*u[b]*u[b];return a}(),K=function(){var a=[0,0],b,c=p[0].length;for(b=0;b<c;b++)a[0]+=z[b]*N[b],a[1]+=C[b]*N[b];return a[0]=a[0]/P,a[1]=a[1]/P,a}(),L=0,M=0,O=.5,Q=.001,R,S=function(){return D?1e3:1e3},T=function(a){a==null&&(a={});var b=a.windowSize||S();H=!0,R=j.getWindowedAverager(b)},U=function(a){var b=a/p[0].length,c=h.convert(b,{from:i.MW_ENERGY_UNIT,to:i.JOULE});return c/q};return f.time=b,{useCoulombInteraction:function(a){a!==D&&(D=a,T())},useLennardJonesInteraction:function(a){a!==E&&(E=a,E&&T())},useThermostat:function(a){F=a},setTargetTemperature:function(a){console.log("target temp = ",a),a!==G&&(G=a,T()),G=a},relaxToTemperature:function(a){a!=null&&(G=a),T(),I=!0;while(H)this.integrate();I=!1},getOutputState:function(){return f},integrate:function(a,c){a==null&&(a=500),c==null&&(c=10),s&&t();var d=b,e=Math.floor(a/c),j=c*c,q=p[0].length,S,T,V,W,X=y*y,Y=B*B,Z=x*x,$,_,ba,bb,bc,bd,be,bf,bg=r[0],bh=r[0],bi=g[0]-r[0],bj=g[1]-r[0],bk,bl,bm,bn,bo,bp,bq=U(J/2),br;for(bf=1;bf<=e;bf++){b=d+bf*c;if(H&&Math.abs(R(bq)-G)<=G*Q){H=!1;if(I)break}br=1;if(H||F&&bq>0)br=1+O*(G/bq-1);J=0,bl=[0,0];for(S=0;S<q;S++)br!==1&&(v[S]*=br,w[S]*=br),z[S]+=v[S]*c+.5*m[S]*j,C[S]+=w[S]*c+.5*n[S]*j,V=v[S]*v[S]+w[S]*w[S],u[S]=Math.sqrt(V),z[S]<bg?(z[S]=bg+(bg-z[S]),v[S]*=-1):z[S]>bi&&(z[S]=bi-(z[S]-bi),v[S]*=-1),C[S]<bh?(C[S]=bh+(bh-C[S]),w[S]*=-1):C[S]>bj&&(C[S]=bj-(C[S]-bj),w[S]*=-1),bl[0]+=z[S]*N[S],bl[1]+=C[S]*N[S],v[S]+=.5*m[S]*c,w[S]+=.5*n[S]*c;bl[0]/=P,bl[1]/=P;for(S=0;S<q;S++)m[S]=0,n[S]=0;if(E||D)for(S=0;S<q;S++)for(T=S+1;T<q;T++)bd=z[T]-z[S],be=C[T]-C[S],W=bd*bd+be*be,E&&W<X&&(_=l.forceOverDistanceFromSquaredDistance(W),_*_*W>Z&&(_=x/Math.sqrt(W)),ba=_/N[S],bb=ba*bd,bc=ba*be,m[S]+=bb,n[S]+=bc,m[T]-=bb,n[T]-=bc),D&&W<Y&&($=Math.min(k.forceFromSquaredDistance(W,o[S],o[T]),A),_=$/Math.sqrt(W),ba=_/N[S],bb=ba*bd,bc=ba*be,m[S]+=bb,n[S]+=bc,m[T]-=bb,n[T]-=bc);bm=0,bn=0;for(S=0;S<q;S++)v[S]+=.5*m[S]*c,w[S]+=.5*n[S]*c,bm+=N[S]*v[S],bn+=N[S]*w[S],V=v[S]*v[S]+w[S]*w[S],J+=N[S]*V,u[S]=Math.sqrt(V);bo=bm/P,bp=bn/P,L+=bo*c,M+=bp*c,bq=U(J/2)}bk=0;for(S=0;S<q;S++)for(T=S+1;T<q;T++)bd=z[T]-z[S],be=C[T]-C[S],W=bd*bd+be*be,E&&(bk+=l.potentialFromSquaredDistance(W)),D&&W<Y&&(bk+=k.potential(Math.sqrt(W),o[S],o[T]));f.time=b,f.pressure=0,f.PE=bk,f.KE=.5*h.convert(J,{from:i.MW_ENERGY_UNIT,to:i.EV}),f.T=bq,f.CM=bl||K,f.vCM=[bo,bp],f.driftCM=[L,M]}}},f.getIntegrator=function(a,b){a=a||{};var c=a.lennard_jones_forces||!0,d=a.coulomb_forces||!1,e=a.temperature_control||!1,f=a.temperature||1,g;return u(),g=r({setOnceState:{size:C},settableState:{useLennardJonesInteraction:c,useCoulombInteraction:d,useThermostat:e,targetTemperature:f},readWriteState:{ax:L,ay:M,charge:O,nodes:R,px:E,py:F,radius:D,speed:K,vx:I,vy:J,x:G,y:H},outputState:b}),g.integrate(0),g}}),require("/md2d.js"),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),molecules_coulomb={},molecules_coulomb={version:"0.0.1"};var a=-50;molecules_coulomb.force=function(b,c,d){return a*(c*d/(b*b))},molecules_coulomb.potential=function(b,c,d){return-a*(c*d/b)},molecules_lennard_jones={},molecules_lennard_jones={version:"0.0.1"};var b=-1,c=4,d=Math.pow(2,1/6)*c,e=4*b*Math.pow(c,12),f=4*b*Math.pow(c,6);molecules_lennard_jones.epsilon=function(a){return molecules_lennard_jones.coefficients(a,c)},molecules_lennard_jones.sigma=function(a){return molecules_lennard_jones.coefficients(b,a)},molecules_lennard_jones.coefficients=function(a,g){arguments.length&&(b=a,c=g,d=Math.pow(2,1/6)*c,e=4*b*Math.pow(c,12),f=4*b*Math.pow(c,6));var h={epsilon:b,sigma:c,rmin:d,alpha:e,beta:f};return h},molecules_lennard_jones.potential=function(a){return(e/Math.pow(a,12)-f/Math.pow(a,6))*-1},molecules_lennard_jones.force=function(a){var b=Math.pow(a,6),c=b*a,d=b*c;return 12*e/d-6*f/c};var g=require("./md2d").model;modeler={},modeler.VERSION="0.2.0",modeler.model=function(){function N(a){return.1+19.99*a}function O(){var a,b=0,c=M[0].length;a=-1;while(++a<c)b+=G[a];return b/c}function P(){return m===0}function Q(){var a,b=[],c=L;a=-1;while(++a<c)b[a]=arrays.clone(M[a]);l.length=m,m++,n++,o=!0,l.push({nodes:b,ke:j}),m>1e3&&(l.splice(0,1),m=1e3)}function R(){var a;return P()&&Q(),w.integrate(),r=x.pressure,i=x.PE,s.push(r),s.splice(0,s.length-16),j=x.KE,Q(),k||(a=Date.now(),t?(t=a-t,t&&u.push(t),t=a,u.splice(0,u.length-128)):t=a,c.tick({type:"tick"})),k}function S(){l=[],m=0,n=-1}function T(){l.length=m+1}function U(a){var b,c=L;if(a<0)throw new Error("modeler: request for tick_history_list["+a+"]");if(a>=l.length)throw new Error("modeler: request for tick_history_list["+a+"], tick_history_list.length="+l.length);b=-1;while(++b<c)arrays.copy(l[a].nodes[b],M[b]);j=l[a].ke}function V(){return s.reduce(function(a,b){return a+b})/s.length}function W(a){if(!arguments.length)return W.reduce(function(a,b){return a+b})/s.length;W.push(a),W.splice(0,W.length-100)}function X(){var a,b,c=0,d=u.length;a=-1;while(++a<d)c+=u[a];return b=c/d,b?1/b*1e3:0}function Y(a){v=a,w&&w.setTargetTemperature(N(a))}var a={},b=[],c=d3.dispatch("tick"),d=[100,100],e,f,h,i,j,k=!0,l=[],m=0,n=0,o=!1,p,q,r,s=[0],t,u=[],v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=12,M;return a.INDICES={RADIUS:g.INDICES.RADIUS,PX:g.INDICES.PX,PY:g.INDICES.PY,X:g.INDICES.X,Y:g.INDICES.Y,VX:g.INDICES.VX,VY:g.INDICES.VY,SPEED:g.INDICES.SPEED,AX:g.INDICES.AX,AY:g.INDICES.AY,MASS:g.INDICES.MASS,CHARGE:g.INDICES.CHARGE},g.setSize(d),a.getStats=function(){return{speed:O(),ke:j,temperature:v,pressure:V(),current_step:n,steps:l.length-1}},a.stepCounter=function(){return n},a.steps=function(){return P()?0:l.length-1},a.isNewStep=function(){return o},a.seek=function(a){return arguments.length||(a=0),k=!0,o=!1,m=a,n=a,U(m),n},a.stepBack=function(a){arguments.length||(a=1);var b=-1;k=!0,o=!1;while(++b<a)m>1&&(m--,n--,U(m-1),y&&y());return n},a.stepForward=function(a){arguments.length||(a=1);var b=-1;k=!0;while(++b<a)m<l.length?(U(m),m++,n++,y&&y()):(R(),y&&y());return n},a.set_lj_coefficients=function(a,b){p=a,q=b},a.setEpsilon=function(a){g.setLJEpsilon(a)},a.setSigma=function(a){g.setLJSigma(a)},a.getEpsilon=function(){return g.getLJEpsilon()},a.getSigma=function(){return g.getLJSigma()},a.set_radius=function(a){},a.get_speed=function(){return arrays.copy(G,[])},a.get_rate=function(){return X()},a.set_temperature_control=function(a){e=a,w&&w.useThermostat(a)},a.set_lennard_jones_forces=function(a){f=a,w&&w.useLennardJonesInteraction(a)},a.set_coulomb_forces=function(a){h=a,w&&w.useCoulombInteraction(a)},a.get_nodes=function(){return M},a.get_atoms=function(){return b},a.initialize=function(b){return b=b||{},b.temperature!=null&&(b.temperature=N(b.temperature)),f=b.lennard_jones_forces||!0,h=b.coulomb_forces||!1,e=b.temperature_control||!1,y=b.model_listener||!1,S(),o=!0,w=g.getIntegrator(b),x=w.getOutputState(),a},a.relax=function(){return a},a.on=function(b,d){return c.on(b,d),a},a.tickInPlace=function(){return c.tick({type:"tick"}),a},a.tick=function(b){arguments.length||(b=1);var c=-1;while(++c<b)R();return a},a.nodes=function(c){return c=c||{},c.temperature!=null&&(c.temperature=N(c.temperature)),g.createNodes(c),M=g.nodes,z=g.radius,A=g.px,B=g.py,C=g.x,D=g.y,E=g.vx,F=g.vy,G=g.speed,H=g.ax,I=g.ay,halfMass=g.halfMass,K=g.charge,b.length=M[0].length,a},a.start=function(){return a.initialize(),a.resume()},a.resume=function(){return k=!1,d3.timer(R),a},a.stop=function(){return k=!0,a},a.ke=function(){return x?x.KE:undefined},a.ave_ke=function(){return x?x.KE/M[0].length:undefined},a.pe=function(){return x?x.PE:undefined},a.ave_pe=function(){return x?x.PE/M[0].length:undefined},a.speed=function(){return O()},a.pressure=function(){return V()},a.temperature=function(b){return arguments.length?(Y(b),a):v},a.size=function(b){return arguments.length?(d=b,g.setSize(b),a):d},a}}(),function(){function a(){var a=/ (Chrome)\/(.*?) /,b=/ (Firefox)\/([0123456789ab.]+)/,c=/ Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,d=/ (MSIE) ([0123456789.]+);/,e=/([0123456789.]+) \((iPad);.*? Version\/([0123456789.]+) Mobile\/(\S+)/,f;return f=navigator.userAgent.match(a),f&&f[1]?navigator.platform.match(/Win/)?{browser:f[1],version:f[2],oscpu:navigator.platform}:{browser:f[1],version:f[2],oscpu:navigator.appVersion.match(/(Macintosh); (.*?)\)/)[2]}:(f=navigator.userAgent.match(b),f&&f[1]?navigator.oscpu.match(/Windows /)?{browser:f[1],version:f[2],oscpu:navigator.platform}:{browser:f[1],version:f[2],oscpu:navigator.oscpu}:(f=navigator.userAgent.match(c),f&&f[2]?{browser:f[2],version:f[1],oscpu:navigator.appVersion.match(/(Macintosh); (.*?)\)/)[2]}:(f=navigator.userAgent.match(d),f&&f[1]?{browser:f[1],version:f[2],oscpu:navigator.cpuClass+"/"+navigator.platform}:(f=navigator.userAgent.match(e),f&&f[2]?{browser:f[2],version:f[3]+"/"+f[4],oscpu:f[1]}:{browser:"",version:navigator.appVersion,oscpu:""}))))}function b(b,c){function i(){return b.appendChild(document.createElement("tr"))}function l(a,b,c){c=c||"td",a.appendChild(document.createElement(c)).textContent=b}function m(a,b){h&&l(j,a,"th"),l(k,b)}var d=0,e,f,g=[];b.style.display="";var h=b.getElementsByTagName("tr").length==0,j=i(),k=i();f=a(),m("browser",f.browser),m("version",f.version),m("cpu/os",f.oscpu);var n=d3.time.format("%Y-%m-%d %H:%M");m("date",n(new Date));for(d=0;d<c.length;d++)e=c[d],m(e.name,e.run())}typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),benchmark={},benchmark={version:"0.0.1"},benchmark.what_browser=function(){return a()},benchmark.run=function(a,c){b(a,c)}}(),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),function(){arrays={},arrays={version:"0.0.1"},arrays.webgl=!!window.WebGLRenderingContext,arrays.typed=!1;try{var a=new Float64Array(0);arrays.typed=!0}catch(b){}arrays.create=function(a,b,c){c||(arrays.webgl||arrays.typed?c="Float32Array":c="regular"),b=b||0;var d,e;if(c==="regular")d=new Array(a);else switch(c){case"Float64Array":d=new Float64Array(a);break;case"Float32Array":d=new Float32Array(a);break;case"Int32Array":d=new Int32Array(a);break;case"Int16Array":d=new Int16Array(a);break;case"Int8Array":d=new Int8Array(a);break;case"Uint32Array":d=new Uint32Array(a);break;case"Uint16Array":d=new Uint16Array(a);break;case"Uint8Array":d=new Uint8Array(a);break;default:d=new Array(a)}e=-1;while(++e<a)d[e]=b;return d},arrays.constructor_function=function(a){if(a.buffer&&a.buffer.__proto__.constructor)return a.__proto__.constructor;if(a.constructor===Array)return a.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+a+", source.constructor: "+a.constructor+", source.buffer: "+a.buffer+", source.buffer.slice: "+a.buffer.slice+", source.buffer.__proto__: "+a.buffer.__proto__+", source.buffer.__proto__.constructor: "+a.buffer.__proto__.constructor)},arrays.copy=function(a,b){var c=a.length;i=-1;while(++i<c)b[i]=a[i];return b.length=c,b},arrays.clone=function(a){var b,c=a.length,d,e;e=arrays.constructor_function(a);if(e==Array){d=new e(c);for(b=0;b<c;b++)d[b]=a[b];return d}if(a.buffer.slice)return d=new e(a.buffer.slice(0)),d;d=new e(c);for(b=0;b<c;b++)d[b]=a[b];return d},arrays.between=function(a,b,c){return c<Math.max(a,b)&&c>Math.min(a,b)},arrays.max=function(a){return Math.max.apply(Math,a)},arrays.min=function(a){return Math.min.apply(Math,a)},arrays.maxTypedArray=function(a){var b,c,d=Number.MIN_VALUE,e=a.length;for(c=0;c<e;c++)b=a[c],d=b>d?b:d;return d},arrays.minTypedArray=function(a){var b,c,d=Number.MAX_VALUE,e=a.length;for(c=0;c<e;c++)b=a[c],d=b<d?b:d;return d},arrays.maxAnyArray=function(a){try{return Math.max.apply(Math,a)}catch(b){if(b instanceof TypeError){var c,d,e=Number.MIN_VALUE,f=a.length;for(d=0;d<f;d++)c=a[d],e=c>e?c:e;return e}}},arrays.minAnyArray=function(a){try{return Math.min.apply(Math,a)}catch(b){if(b instanceof TypeError){var c,d,e=Number.MAX_VALUE,f=a.length;for(d=0;d<f;d++)c=a[d],e=c<e?c:e;return e}}},arrays.average=function(a){var b,c=0,d=a.length;for(b=0;b<d;b++)c+=a[b];return c/d}}()}(),function(){function H(){return C+B(model.stepCounter()*sample_time)+D}function I(a){return nodes[model.INDICES.X][a]}function J(a){return nodes[model.INDICES.Y][a]}function K(a){return nodes[model.INDICES.RADIUS][a]}function L(a){return nodes[model.INDICES.SPEED][a]}function M(a){return nodes[model.INDICES.VX][a]}function N(a){return nodes[model.INDICES.VY][a]}function O(a){return nodes[model.INDICES.CHARGE][a]}function P(){layout.mc_container=u.append("svg:svg").attr("class","mc_container").attr("top",0).attr("left",0).attr("width",f.width).attr("height",f.height).attr("viewBox","0 0 "+f.width+" "+f.height),E=layout.mc_container.append("svg:defs").append("svg:radialGradient").attr("id","neg-grad").attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"),E.append("svg:stop").attr("stop-color","#ffefff").attr("offset","0%"),E.append("svg:stop").attr("stop-color","#fdadad").attr("offset","40%"),E.append("svg:stop").attr("stop-color","#e95e5e").attr("offset","80%"),E.append("svg:stop").attr("stop-color","#fdadad").attr("offset","100%"),F=layout.mc_container.append("svg:defs").append("svg:radialGradient").attr("id","pos-grad").attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"),F.append("svg:stop").attr("stop-color","#dfffff").attr("offset","0%"),F.append("svg:stop").attr("stop-color","#9abeff").attr("offset","40%"),F.append("svg:stop").attr("stop-color","#767fbf").attr("offset","80%"),F.append("svg:stop").attr("stop-color","#9abeff").attr("offset","100%"),G=layout.mc_container.append("svg:defs").append("svg:radialGradient").attr("id","neu-grad").attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"),G.append("svg:stop").attr("stop-color","#dfffef").attr("offset","0%"),G.append("svg:stop").attr("stop-color","#75a643").attr("offset","40%"),G.append("svg:stop").attr("stop-color","#2a7216").attr("offset","80%"),G.append("svg:stop").attr("stop-color","#75a643").attr("offset","100%")}function W(a){}function X(a,b){U.style("opacity",1).style("left",d3.event.pageX+6+"px").style("top",d3.event.pageY-30+"px").transition().duration(250),V.text("speed: "+d3.format("6.3f")(L(b))+"\n"+"vx:    "+d3.format("6.3f")(M(b))+"\n"+"vy:    "+d3.format("6.3f")(N(b))+"\n")}function Y(a){}function Z(){U.style("opacity",1e-6)}function bs(){var a=bp.selectAll("circle").data(lj_data.variables,function(a){return a}),b=bp.select("path").attr("d",lj_line(lennard_jones_potential)),c=bj.domain()[1]-bj.domain()[0];a.enter().append("svg:circle").attr("class",function(a){return a===bo?"selected":null}).attr("cx",function(a){return bj(a.x)}).attr("cy",function(a){return bl(a.y)}).attr("r",8).on("mousedown",function(a){a.coefficient=="epsilon"?a.x=lj_data.coefficients.rmin:a.y=0,coefficient_selected=bo=a,bs()}),a.attr("class",function(a){return a===coefficient_selected?"selected":null}).attr("cx",function(a){return bj(a.x)}).attr("cy",function(a){return bl(a.y)}),a.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function bt(){if(!bo)return;_.onselectstart=function(){return!1};var a=d3.svg.mouse(bp.node()),b,c;bo.coefficient=="epsilon"?(b=lj_data.coefficients.rmin,c=bl.invert(Math.max(0,Math.min(bd.height,a[1]))),c>lj_epsilon_max&&(c=lj_epsilon_max),c<lj_epsilon_min&&(c=lj_epsilon_min),update_epsilon(c)):(c=0,b=bj.invert(Math.max(0,Math.min(bd.width,a[0]))),b<lj_sigma_min&&(b=lj_sigma_min),b>lj_sigma_max&&(b=lj_sigma_max),update_sigma(b)),layout.update_molecule_radius(),model.tick(),bo.x=b,bo.y=c,bs()}function bu(){isNaN(bk)||(_.onselectstart=function(){return!0},layout.lj_redraw(),bk=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(bm)||(layout.lj_redraw(),bm=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),bo=null}function bQ(){bO=model.get_speed(),speed_graph.xmax=d3.max(bO),speed_graph.xmin=d3.min(bO),speed_graph.quantile=d3.quantile(bO,.1),bJ=speed_graph.ymax,bE=d3.scale.linear().domain([speed_graph.xmin,speed_graph.xmax]).range([0,bz]),bF=d3.scale.linear().domain([speed_graph.ymax,speed_graph.ymin]).nice().range([0,bA])}function bR(){speed_bins=d3.layout.histogram().frequency(!1).bins(bE.ticks(60))(bO),bG=(by.width-speed_bins.length)/speed_bins.length,bI=(speed_graph.xmax-speed_graph.xmin)/speed_bins.length,speed_max=d3.max(speed_bins,function(a){return a.y})}function b_(){layout.lennard_jones_forces_checkbox.checked?model.set_lennard_jones_forces(!0):model.set_lennard_jones_forces(!1)}function ca(){layout.coulomb_forces_checkbox.checked?model.set_coulomb_forces(!0):model.set_coulomb_forces(!1),layout.setup_particles()}typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),layout={version:"0.0.1"},layout.selection="",layout.display={},layout.canonical={width:1280,height:800},layout.regular_display=!1,layout.not_rendered=!0,layout.fontsize=!1,layout.cancelFullScreen=!1,layout.screen_factor=1,layout.checkbox_factor=1.1,layout.checkbox_scale=1.1,layout.canonical.width=1280,layout.canonical.height=800,layout.getDisplayProperties=function(a){if(!arguments.length)var a={};return a.screen={width:screen.width,height:screen.height},a.client={width:document.body.clientWidth,height:document.body.clientHeight},a.window={width:document.width,height:document.height},a.page={width:layout.getPageWidth(),height:layout.getPageHeight()},a},layout.checkForResize=function(){(layout.display.screen.width!=screen.width||layout.display.screen.height!=screen.height||layout.display.window.width!=document.width||layout.display.window.height!=document.height)&&layout.setupScreen()},layout.setupScreen=function(a){function d(){b.style.width=layout.display.page.width*.42+"px",b.style.height=layout.display.page.width*.4-4+"px",layout.finishSetupMoleculeContainer()}function e(){_.style.width=layout.display.page.width*.24+"px",_.style.height=layout.display.page.width*.18+"px",layout.finishSetupPotentialChart()}function f(){speed_distribution_chart.style.width=layout.display.page.width*.23+"px",speed_distribution_chart.style.height=layout.display.page.width*.18+"px",layout.finishSetupSpeedDistributionChart()}function g(){kechart.style.width=layout.display.page.width*.48+4+"px",kechart.style.height=layout.display.page.width*.2+5+"px",layout.finishSetupKEChart()}function h(){b.style.width=layout.display.page.height*.7+"px",b.style.height=layout.display.page.height*.7+"px",layout.finishSetupMoleculeContainer()}function i(){_.style.width=layout.display.page.width*.24+"px",_.style.height=layout.display.page.height*.28+"px",layout.finishSetupPotentialChart()}function j(){speed_distribution_chart.style.width=layout.display.page.width*.22+"px",speed_distribution_chart.style.height=layout.display.page.height*.28+"px",layout.finishSetupSpeedDistributionChart()}function k(){kechart.style.width=layout.display.page.width*.47+5+"px",kechart.style.height=layout.display.page.height*.4+0+"px",layout.finishSetupKEChart()}function l(){var a=layout.display.page.height*.74;b.style.width=a+"px",b.style.height=a+"px",layout.finishSetupMoleculeContainer()}function m(){var a=document.getElementById("description-right");a!==null&&(a.style.width=Math.max(layout.display.page.width*.3,layout.display.page.width-layout.display.page.height-20)+"px")}function n(){var a=layout.display.page.height*.78;b.style.width=a+"px",b.style.height=a+"px",layout.finishSetupMoleculeContainer()}function o(){var a=layout.display.page.height*.75;b.style.width=a+"px",b.style.height=a+"px",layout.finishSetupMoleculeContainer()}function p(){var a=document.getElementById("description-right");a!==null&&(a.style.width=layout.display.window.width*.3+"px")}var c=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;layout.display=layout.getDisplayProperties(),layout.regular_display||(layout.regular_display=layout.getDisplayProperties());if(c){layout.screen_factor=layout.display.screen.width/layout.canonical.width,layout.checkbox_factor=Math.max(.8,layout.checkbox_scale*layout.screen_factor),layout.bodycss.style.fontSize=layout.screen_factor+"em",layout.not_rendered=!0;switch(layout.selection){case"simple-screen":o(),p();break;case"simple-static-screen":layout.not_rendered&&(o(),m());break;case"simple-iframe":o(),p();break;default:h(),i(),j(),k()}}else{layout.cancelFullScreen?(layout.cancelFullScreen=!1,layout.regular_display=layout.previous_display):layout.regular_display=layout.getDisplayProperties(),layout.screen_factor=layout.regular_display.page.width/layout.canonical.width,layout.checkbox_factor=Math.max(.8,layout.checkbox_scale*layout.screen_factor);switch(layout.selection){case"simple-screen":layout.bodycss.style.fontSize=layout.screen_factor+"em",l(),m();break;case"simple-static-screen":layout.not_rendered&&(layout.bodycss.style.fontSize=layout.screen_factor+"em",l(),m(),layout.not_rendered=!1);break;case"simple-iframe":layout.bodycss.style.fontSize=layout.screen_factor+"em",n();break;case"full-static-screen":layout.not_rendered&&(layout.bodycss.style.fontSize=layout.screen_factor+"em",d(),e(),f(),g(),layout.not_rendered=!1);break;default:layout.bodycss.style.fontSize=layout.screen_factor+"em",d(),e(),f(),g()}layout.regular_display=layout.getDisplayProperties()}layout.transform&&$("input[type=checkbox]").css(layout.transform,"scale("+layout.checkbox_factor+","+layout.checkbox_factor+")"),layout.setupTemperature(),bT&&(bT.style.display="none")},layout.getStyleForSelector=function(a){var b,c=document.styleSheets;for(var d=0;d<c.length;d++)if(c[d])try{b=c[d].rules||c[d].cssRules;if(b)for(var e=0;e<b.length;e++)if(b[e].selectorText==a)return b[e]}catch(f){}return!1},layout.getPageHeight=function(){var a;return self.innerHeight?a=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&(a=layout.display.window.height),a},layout.getPageWidth=function(){var a;return self.innerWidth?a=self.innerWidth:document.documentElement&&document.documentElement.clientWidth?a=document.documentElement.clientWidth:document.body&&(a=window.width),a},layout.getTransformProperty=function(a){var b=["transform","WebkitTransform","msTransform","MozTransform","OTransform"],c;while(c=b.shift())if(typeof a.style[c]!="undefined")return c;return!1};var a=document.getElementById("description-right");a!==null&&(layout.fontsize=parseInt(layout.getStyleForSelector("#description-right").style.fontSize)),layout.bodycss=layout.getStyleForSelector("body"),layout.transform=layout.getTransformProperty(document.body);var b=document.getElementById("molecule-container"),c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,z,A,B=d3.format("5.3f"),C="time: ",D=" (ns)",E,F,G;layout.finishSetupMoleculeContainer=function(){mc_graph.grid_lines=mc_graph.grid_lines==undefined|mc_graph.grid_lines,mc_graph.xunits=mc_graph.xunits==undefined|mc_graph.xunits,mc_graph.yunits=mc_graph.yunits==undefined|mc_graph.yunits,mc_graph.model_time_label=mc_graph.model_time_label==undefined|mc_graph.model_time_label,mc_graph.atom_mubers=mc_graph.atom_mubers==undefined|mc_graph.atom_mubers,mc_graph.playback_controller=mc_graph.playback_controller==undefined|mc_graph.playback_controller,mc_graph.playback_only_controller=mc_graph.playback_only_controller==undefined|mc_graph.playback_only_controller,c=b.clientWidth,d=b.clientHeight,e={top:mc_graph.title?40*layout.screen_factor:20,right:25,bottom:mc_graph.xlabel?46*layout.screen_factor:20,left:mc_graph.ylabel?60*layout.screen_factor:25};if(mc_graph.playback_controller||mc_graph.playback_only_controller)e.bottom+=30*layout.screen_factor;f={width:c-e.left-e.right,height:d-e.top-e.bottom},z=f.width/2-50,A=f.height+(mc_graph.ylabel?75*layout.screen_factor:30),g=f.width,h=f.height,i=function(
a,b){return"translate("+l(a)+",0)"},j=function(a,b){return"translate(0,"+o(a)+")"},k=function(a,b){return a?"#ccc":"#666"},l=d3.scale.linear().domain([mc_graph.xmin,mc_graph.xmax]).range([0,g]),m=l.copy(),n=Math.NaN,o=d3.scale.linear().domain([mc_graph.ymax,mc_graph.ymin]).nice().range([0,h]).nice(),p=o.copy(),q=Math.NaN,r=null,undefined!==u?(d3.select(b).select("svg").attr("width",c).attr("height",d),u.select("svg").attr("width",c).attr("height",d),u.select("rect.mc_plot").attr("width",f.width).attr("height",f.height).style("fill","#EEEEEE"),u.select("svg.mc_container").attr("top",0).attr("left",0).attr("width",f.width).attr("height",f.height).attr("viewBox","0 0 "+f.width+" "+f.height),mc_graph.title&&u.select("text.title").attr("x",f.width/2).attr("dy","-1em"),mc_graph.xlabel&&u.select("text.xlabel").attr("x",f.width/2).attr("y",f.height),mc_graph.ylabel&&u.select("text.ylabel").attr("transform","translate(-40 "+f.height/2+") rotate(-90)"),mc_graph.model_time_label&&w.text(H()).attr("x",f.width-100).attr("y",f.height),u.selectAll("g.x").remove(),u.selectAll("g.y").remove(),layout.update_molecule_radius(),Q.attr("cx",function(a,b){return l(I(b))}).attr("cy",function(a,b){return o(J(b))}).attr("r",function(a,b){return l(K(b))}),R.attr("transform",function(a,b){return"translate("+l(I(b))+","+o(J(b))+")"}),(mc_graph.playback_controller||mc_graph.play_only_controller)&&t.position(z,A,layout.screen_factor),layout.mc_redraw()):(s=d3.select(b).append("svg:svg").attr("width",c).attr("height",d),u=s.append("svg:g").attr("transform","translate("+e.left+","+e.top+")"),v=u.append("svg:rect").attr("class","mc_plot").attr("width",f.width).attr("height",f.height).style("fill","#EEEEEE"),mc_graph.title&&u.append("svg:text").attr("class","title").text(mc_graph.title).attr("x",f.width/2).attr("dy","-1em").style("text-anchor","middle"),mc_graph.xlabel&&u.append("svg:text").attr("class","xlabel").text(mc_graph.xlabel).attr("x",f.width/2).attr("y",f.height).attr("dy","2.4em").style("text-anchor","middle"),mc_graph.ylabel&&u.append("svg:g").append("svg:text").attr("class","ylabel").text(mc_graph.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+f.height/2+") rotate(-90)"),mc_graph.model_time_label&&(w=u.append("svg:text").attr("class","model_time_label").text(H()).attr("x",f.width-100).attr("y",f.height).attr("dy","2.4em").style("text-anchor","start")),mc_graph.playback_controller&&(t=new PlaybackComponentSVG(s,model_player,z,A,layout.screen_factor)),mc_graph.play_only_controller&&(t=new PlayOnlyComponentSVG(s,model_player,z,A,layout.screen_factor)),layout.mc_redraw(),P())},layout.mc_redraw=function(){d3.event&&d3.event.transform&&isNaN(n)&&isNaN(q)&&d3.event.transform(x,y);var a=l.tickFormat(10),b=o.tickFormat(10);if(mc_graph.xunits){var c=u.selectAll("g.x").data(l.ticks(10),String).attr("transform",i);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",i);mc_graph.grid_lines&&d.append("svg:line").attr("stroke",k).attr("y1",0).attr("y2",f.height),d.append("svg:text").attr("y",f.height).attr("dy","1em").attr("text-anchor","middle").text(a),c.exit().remove()}if(mc_graph.xunits){var e=u.selectAll("g.y").data(o.ticks(10),String).attr("transform",j);e.select("text").text(b);var g=e.enter().insert("svg:g","a").attr("class","y").attr("transform",j).attr("background-fill","#FFEEB6");mc_graph.grid_lines&&g.append("svg:line").attr("stroke",k).attr("x1",0).attr("x2",f.width),g.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b),mc_graph.model_time_label&&w.text(H()),e.exit().remove()}},layout.update_molecule_radius=function(){var a=molecules_lennard_jones.coefficients(),b=a.rmin*mol_rmin_radius_factor;model.set_radius(b),layout.mc_container.selectAll("circle").data(atoms).attr("r",function(a,b){return l(K(b))}),layout.mc_container.selectAll("text").attr("font-size",l(b*1.3))};var Q,R,S,T,U=d3.select("#viz").append("div").attr("class","tooltip").style("opacity",1e-6),V=U.append("pre");layout.setup_particles=function(){var a=molecules_lennard_jones.coefficients(),b=a.rmin*mol_rmin_radius_factor;model.set_radius(b),layout.mc_container.selectAll("circle").remove(),layout.mc_container.selectAll("g").remove(),Q=layout.mc_container.selectAll("circle").data(atoms),Q.enter().append("svg:circle").attr("r",function(a,b){return l(K(b))}).attr("cx",function(a,b){return l(I(b))}).attr("cy",function(a,b){return o(J(b))}).style("cursor","crosshair").style("fill",function(a,b){return layout.coulomb_forces_checkbox.checked?l(O(b))>0?"url('#pos-grad')":"url('#neg-grad')":"url('#neu-grad')"}).on("mousedown",X).on("mouseout",Z);var c=l(a.rmin*mol_rmin_radius_factor*1.5);mol_number>100&&(c*=.9),R=layout.mc_container.selectAll("g.label").data(atoms),S=R.enter().append("svg:g").attr("class","label").attr("transform",function(a,b){return"translate("+l(I(b))+","+o(J(b))+")"}),mc_graph.atom_mubers?S.append("svg:text").attr("class","index").attr("font-size",c).attr("style","font-weight: bold; opacity: .7").attr("x",0).attr("y","0.31em").text(function(a){return a.index}):S.append("svg:text").attr("class","index").attr("font-size",c).attr("style","font-weight: bold; opacity: .7").attr("x",0).attr("y","0.31em").text(function(a,b){return layout.coulomb_forces_checkbox.checked?l(O(b))>0?"+":"":""})},layout.update_molecule_positions=function(){mc_graph.model_time_label&&w.text(H()),R=layout.mc_container.selectAll("g.label").data(atoms),R.attr("transform",function(a,b){return"translate("+l(I(b))+","+o(J(b))+")"}),Q=layout.mc_container.selectAll("circle").data(atoms),Q.attr("cx",function(a,b){return l(nodes[model.INDICES.X][b])}).attr("cy",function(a,b){return o(nodes[model.INDICES.Y][b])}).attr("r",function(a,b){return l(nodes[model.INDICES.RADIUS][b])})};var _=document.getElementById("lj-potential-chart"),ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br;layout.finishSetupPotentialChart=function(){ba=_.clientWidth,bb=_.clientHeight,bc={top:lj_graph.title?36:20,right:30,bottom:lj_graph.xlabel?46:20,left:lj_graph.ylabel?60:45},bd={width:ba-bc.left-bc.right,height:bb-bc.top-bc.bottom},be=bd.width,bf=bd.height,bg=function(a){return"translate("+bj(a)+",0)"},bh=function(a){return"translate(0,"+bl(a)+")"},bi=function(a){return a?"#ccc":"#666"},bj=d3.scale.linear().domain([lj_data.xmin,lj_data.xmax]).range([0,be]),bk=Math.NaN,bl=d3.scale.linear().domain([lj_data.ymax,lj_data.ymin]).nice().range([0,bf]).nice(),lj_line=d3.svg.line().x(function(a,b){return bj(lennard_jones_potential[b][0])}).y(function(a,b){return bl(lennard_jones_potential[b][1])}),bm=Math.NaN,bn=null,lj_selected=lj_data.variables[0],bo,coefficient_selected=lj_data.variables[0],undefined!==bp?(d3.select(_).select("svg").attr("width",ba).attr("height",bb),bp.select("svg").attr("width",ba).attr("height",bb),bp.select("rect.plot").attr("width",bd.width).attr("height",bd.height).style("fill","#EEEEEE"),bp.select("svg.container").attr("top",0).attr("left",0).attr("width",bd.width).attr("height",bd.height).attr("viewBox","0 0 "+bd.width+" "+bd.height),bp.select("svg.linebox").attr("top",0).attr("left",0).attr("width",bd.width).attr("height",bd.height).attr("viewBox","0 0 "+bd.width+" "+bd.height),lj_graph.title&&bp.select("text.title").attr("x",bd.width/2).attr("dy","-1em"),lj_graph.xlabel&&bp.select("text.xlabel").attr("x",bd.width/2).attr("y",bd.height),lj_graph.ylabel&&bp.select("text.ylabel").attr("transform","translate(-40 "+bd.height/2+") rotate(-90)"),bp.selectAll("g.x").remove(),bp.selectAll("g.y").remove()):(bp=d3.select(_).append("svg:svg").attr("width",ba).attr("height",bb).append("svg:g").attr("transform","translate("+bc.left+","+bc.top+")"),bq=bp.append("svg:rect").attr("class","plot").attr("width",bd.width).attr("height",bd.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().x(bj).y(bl).scaleExtent([1,8]).on("zoom",layout.lj_redraw)).on("mousedown",function(){d3.event.altKey&&(lj_points.push(lj_selected=bn=d3.svg.mouse(bp.node())),bs(),d3.event.preventDefault(),d3.event.stopPropagation())}),bp.append("svg:svg").attr("class","linebox").attr("top",0).attr("left",0).attr("width",bd.width).attr("height",bd.height).attr("viewBox","0 0 "+bd.width+" "+bd.height).append("svg:path").attr("class","line").attr("d",lj_line(lennard_jones_potential)),lj_graph.title&&bp.append("svg:text").attr("class","title").text(lj_graph.title).attr("x",bd.width/2).attr("dy","-1em").style("text-anchor","middle"),lj_graph.xlabel&&bp.append("svg:text").attr("class","xlabel").text(lj_graph.xlabel).attr("x",bd.width/2).attr("y",bd.height).attr("dy","2.4em").style("text-anchor","middle"),lj_graph.ylabel&&bp.append("svg:g").append("svg:text").attr("class","ylabel").text(lj_graph.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+bd.height/2+") rotate(-90)"),bp.on("mousemove",bt).on("mouseup",bu)),layout.lj_redraw()},layout.lj_redraw=function(){var a=bj.tickFormat(10),b=bl.tickFormat(10),c=bp.selectAll("g.x").data(bj.ticks(10),String).attr("transform",bg);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",bg);d.append("svg:line").attr("stroke",bi).attr("y1",0).attr("y2",bd.height),d.append("svg:text").attr("y",bd.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(bp[0][0]);bk=bj.invert(b[0])}),c.exit().remove();var e=bp.selectAll("g.y").data(bl.ticks(10),String).attr("transform",bh);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",bh).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",bi).attr("x1",0).attr("x2",bd.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(bp[0][0]);bm=bl.invert(b[1])}),e.exit().remove(),bs()},d3.select(_).on("mousemove",function(a){var b=d3.svg.mouse(bp[0][0]);if(!isNaN(bk)){var c=bj.invert(b[0]),d=bj.domain()[0],e=bj.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/bk,g=1+(bk/c-1)*(f/(bk-d))/h,i=[d,d+f*g],bj.domain(i),layout.lj_redraw()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(bm)){var j=bl.invert(b[1]),k=bl.domain()[1],l=bl.domain()[0],m=l-k;if(j!==0){var n,o,p;o=m/bm,n=1-(j/bm-1)*(m/(bm-k))/o,p=[k+m*n,k],bl.domain(p),layout.lj_redraw()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(bk)||(layout.lj_redraw(),bk=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(bm)||(layout.lj_redraw(),bm=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())}),speed_distribution_chart=document.getElementById("speed-distribution-chart");var bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP;layout.finishSetupSpeedDistributionChart=function(){bv=speed_distribution_chart.clientWidth,bw=speed_distribution_chart.clientHeight,bx={top:speed_graph.title?36:20,right:30,bottom:speed_graph.xlabel?46:20,left:speed_graph.ylabel?60:45},by={width:bv-bx.left-bx.right,height:bw-bx.top-bx.bottom},bz=by.width,bA=by.height,bB=function(a){return"translate("+bE(a)+",0)"},bC=function(a){return"translate(0,"+bF(a)+")"},bD=function(a){return a?"#ccc":"#666"},bQ(),bR(),undefined!==bK?(d3.select(speed_distribution_chart).select("svg").attr("width",bv).attr("height",bw),bK.select("rect.plot").attr("width",by.width).attr("height",by.height),speed_graph.title&&bK.select("text.title").attr("x",by.width/2).attr("dy","-1em"),speed_graph.xlabel&&bK.select("text.xlabel").attr("x",by.width/2).attr("y",by.height),speed_graph.ylabel&&bK.select("text.ylabel").attr("transform","translate(-40 "+by.height/2+") rotate(-90)"),bK.selectAll("g.x").remove(),bK.selectAll("g.y").remove()):(bK=d3.select(speed_distribution_chart).append("svg:svg").attr("width",bv).attr("height",bw).append("svg:g").attr("transform","translate("+bx.left+","+bx.top+")"),bL=bK.append("svg:rect").attr("class","plot").attr("width",by.width).attr("height",by.height).style("fill","#EEEEEE"),speed_graph.title&&bK.append("svg:text").attr("class","title").text(speed_graph.title).attr("x",by.width/2).attr("dy","-1em").style("text-anchor","middle"),speed_graph.xlabel&&bK.append("svg:text").attr("class","xlabel").text(speed_graph.xlabel).attr("x",by.width/2).attr("y",by.height).attr("dy","2.4em").style("text-anchor","middle"),speed_graph.ylabel&&bK.append("svg:g").append("svg:text").attr("class","ylabel").text(speed_graph.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+by.height/2+") rotate(-90)")),layout.speed_redraw()},layout.speed_redraw=function(){d3.event&&d3.event.transform&&isNaN(speed_downx)&&isNaN(speed_downy)&&d3.event.transform(bE,bF);var a=bE.tickFormat(5),b=bF.tickFormat(5),c=bK.selectAll("g.y").data(bF.ticks(5),String).attr("transform",bC);c.select("text").text(b);var d=c.enter().insert("svg:g","a").attr("class","y").attr("transform",bC).attr("background-fill","#FFEEB6");d.append("svg:line").attr("stroke",bD).attr("x1",0).attr("x2",by.width),d.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(bK[0][0]);speed_downy=bF.invert(b[1]),speed_downscaley=bF.copy()}),c.exit().remove(),layout.speed_update()},layout.speed_update=function(){bQ(),bO.length>2&&(speed_kde=science.stats.kde().sample(bO),bE.domain([speed_graph.xmin,speed_graph.xmax]),speed_bins=d3.layout.histogram().frequency(!0).bins(bE.ticks(60))(bO),bG=(by.width-speed_bins.length)/speed_bins.length,bI=(speed_graph.xmax-speed_graph.xmin)/speed_bins.length,speed_max=d3.max(speed_bins,function(a){return a.y}),bK.selectAll("g.bar").remove(),bM=bK.selectAll("g.bar").data(speed_bins),bM.enter().append("svg:g").attr("class","bar").attr("transform",function(a,b){return"translate("+bE(a.x)+","+(bA-bF(bJ-a.y))+")"}).append("svg:rect").attr("class","bar").attr("fill","steelblue").attr("width",bG).attr("height",function(a){return bF(bJ-a.y)}))};var bS=document.getElementById("start-benchmarks"),bT=document.getElementById("benchmarks-table"),bU=[{name:"molecules",run:function(){return mol_number}},{name:"temperature",run:function(){return temperature}},{name:"100 Steps (steps/s)",run:function(){modelStop();var a=+Date.now(),b=-1;while(b++<100)model.tick();return elapsed=Date.now()-a,d3.format("5.1f")(100/elapsed*1e3)}},{name:"100 Steps w/graphics",run:function(){modelStop();var a=+Date.now(),b=-1;while(b++<100)model.tick(),model_listener();return elapsed=Date.now()-a,d3.format("5.1f")(100/elapsed*1e3)}}];bS&&(bS.onclick=function(){benchmark.run(bT,bU)}),layout.datatable_visible=!1;var bV=document.getElementById("toggle-datatable"),bW=document.getElementById("datatable-table");layout.hide_datatable=function(){bW&&(bW.style.display="none")},layout.render_datatable=function(a){function i(){return bW.getElementsByTagName("tr").length==0}function j(a){a=a||"data";var b=bW.appendChild(document.createElement("tr"));return b.className=a,b}function k(a,b,c,d){c=c||"td",d=d||1;var e=a.appendChild(document.createElement(c));e.textContent=b,d>1&&(e.colSpan=d)}function l(a,b,c){c=c||"td";var d;d=-1;while(++d<b.length)k(a,b[d])}function m(a,b,c){c=c||"td";var d=a.getElementsByTagName(c),f=0;if(d.length>0){d[0].textContent=b;while(++f<d.length)d[f].textContent=h[f](nodes[model.INDICES[e[f]]][b])}f--;while(++f<e.length)k(a,h[f](nodes[model.INDICES[e[f]]][b]))}function n(a,b){i()&&k(j("title"),a,"th"),k(results_row,b)}function o(a,b,c){c=c||1;var d;d=-1;while(++d<b.length)k(a,b[d],"th",c)}function p(a){var b=-1,c=d.length;while(++b<a)b>=d.length&&j();while(--c>=b)bW.removeChild(d[b]);return bW.getElementsByClassName("data")}function q(a,b){var c=-1;while(++c<b.length)k(a,b[c])}function r(a,b,c,d){var e;e=-1;while(++e<d.length)q(b[e],d[e])}bW.style.display="";var b,c=bW.getElementsByClassName("title"),d=bW.getElementsByClassName("data"),e=["PX","PY","X","Y","VX","VY","AX","AY","SPEED","RADIUS","MASS","CHARGE"],f=d3.format(" 2d"),g=d3.format(" 3.4f"),h=[f,g,g,g,g,g,g,g,g,g,g,g,f];a=a||!1;if(c.length==0){var s=j("title");o(s,e),d=p(atoms.length)}a&&(d=p(atoms.length)),b=-1;while(++b<atoms.length)m(d[b],b)},bV&&(bV.onclick=function(){layout.datatable_visible?(layout.datatable_visible=!1,bV.textContent="Show Data Table",bW.style.display="none"):(layout.datatable_visible=!0,bV.textContent="Hide Data Table",layout.render_datatable(),bW.style.display="")});var bX=document.getElementById("select-temperature"),bY=document.createElement("span");if(bX==null)layout.setupTemperature=function(){};else{layout.setupTemperature=function(){if(Modernizr.inputtypes.range){var a=document.createElement("input");a.type="range",a.min="0",a.max="10",a.step="0.5",a.value=+bX.value,bX.parentNode.replaceChild(a,bX),a.id="select-temperature",bX=a,bY.id="select-temperature-display",bY.innerText=temperature,bX.parentNode.appendChild(bY),bX=document.getElementById("select-temperature")}bX.onchange=bZ};function bZ(){temperature=+bX.value,bX.type==="range"&&(bY.innerText=d3.format("4.1f")(temperature)),model.temperature(temperature)}bX.type==="range"&&(bX.value=temperature,bY.innerText=d3.format("4.1f")(temperature)),layout.temperature_control_checkbox=document.getElementById("temperature-control-checkbox");function b$(){layout.temperature_control_checkbox.checked?model.set_temperature_control(!0):model.set_temperature_control(!1)}layout.temperature_control_checkbox.onchange=b$}layout.lennard_jones_forces_checkbox=document.getElementById("lennard-jones-forces-checkbox"),layout.lennard_jones_forces_checkbox&&(layout.lennard_jones_forces_checkbox.onchange=b_),layout.coulomb_forces_checkbox=document.getElementById("coulomb-forces-checkbox"),layout.coulomb_forces_checkbox&&(layout.coulomb_forces_checkbox.onchange=ca);var cb=document.getElementById("stats");layout.displayStats=function(){var a=model.ke(),b=model.pe(),c=a+b;cb&&(cb.textContent="Time: "+d3.format("5.3f")(model.stepCounter()*sample_time)+" (ns), "+"KE: "+d3.format("1.4f")(a)+", "+"TE: "+d3.format("1.4f")(c)+", "+"Pressure: "+d3.format("6.3f")(model.pressure())+", "+"Rate: "+d3.format("5.1f")(model.get_rate())+" (steps/s)")};if(document.querySelectorAll){var cc=document.querySelector("#fullscreen");cc&&(cc.style.cursor="pointer",cc.addEventListener("click",function(){var a=document.documentElement,b=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen,c=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen,d=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen;b?c?(layout.cancelFullScreen=!0,d.call(document)):(layout.cancelFullScreen=!1,b.call(a)):alert("You'll need to use a newer browser to use the\nfull-screen API.\n\nChrome v15 (beta)\nhttp://www.google.com/landing/chrome/beta/\n\nChrome v17 Canary:\nhttp://tools.google.com/dlpage/chromesxs\n\nSafari v5.1.1:\n\nFireFox v9 Aurora:\nhttps://www.mozilla.org/en-US/firefox/channel/\n\nFireFox v10 Nightly\nhttp://nightly.mozilla.org/\nOpen 'about:config' and set: full-screen-api-enabled")},!1))}layout.heatCoolButtons=function(a,b,c,d){var e=new ButtonComponent(a,"circlesmall-plus"),f=new ButtonComponent(b,"circlesmall-minus");e.add_action(function(){var c=model.temperature();c<d?($(a).removeClass("inactive"),$(b).removeClass("inactive"),c=Math.floor(c*2)/2+.5,model.temperature(c)):$(a).addClass("inactive")}),f.add_action(function(){var d=model.temperature();d>c?($(a).removeClass("inactive"),$(b).removeClass("inactive"),d=Math.floor(d*2)/2-.5,model.temperature(d)):$(b).addClass("inactive")})}}(),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),graphx={version:"0.0.1"},graphx.graph=function(a){function C(){e=d.clientWidth,f=d.clientHeight,g={top:graph.title?40:20,right:30,bottom:graph.xlabel?50:10,left:graph.ylabel?70:45},h={width:e-g.left-g.right,height:f-g.top-g.bottom},i=h.width,j=h.height,k=function(a){return"translate("+n(a)+",0)"},l=function(a){return"translate(0,"+r(a)+")"},m=function(a){return a?"#ccc":"#666"},n=d3.scale.linear().domain([graph.xmin,graph.xmax]).range([0,i]),p=d3.scale.linear().domain([graph.xmin*graph.sample,graph.xmax*graph.sample]).range([0,i]),q=function(a){return"translate("+p(a)+",0)"},o=Math.NaN,r=d3.scale.linear().domain([graph.ymax,graph.ymin]).range([0,j]),t=d3.svg.line().x(function(a,b){return n(B[b].x)}).y(function(a,b){return r(B[b].y)}),s=Math.NaN,u=null,v=B[0];if(undefined!==z){var a=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;a&&(r=d3.scale.linear().domain([graph.ymax,graph.ymin]).range([j,0])),d3.select(d).select("svg").attr("width",e).attr("height",f),z.select("rect.plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE"),z.select("svg.viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height),graph.title&&z.select("text.title").attr("x",h.width/2).attr("dy","-1em"),graph.xlabel&&z.select("text.xlabel").attr("x",h.width/2).attr("y",h.height),graph.ylabel&&z.select("text.ylabel").attr("transform","translate(-50 "+h.height/2+") rotate(-90)"),z.selectAll("g.x").remove(),z.selectAll("g.y").remove(),M()}else z=d3.select(d).append("svg:svg").attr("width",e).attr("height",f).append("svg:g").attr("transform","translate("+g.left+","+g.top+")"),z.append("svg:rect").attr("class","plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown",function(){d3.event.altKey&&(B.push(v=u=d3.svg.mouse(z.node())),O(),d3.event.preventDefault(),d3.event.stopPropagation())}),z.append("svg:svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height).append("svg:path").attr("class","line").attr("d",t(B)),w=z.select("path")[0][0],x=w.pathSegList,y=z.node(),A=document.createElementNS("http://www.w3.org/2000/svg","circle"),A.setAttribute("cx",1),A.setAttribute("cy",1),A.setAttribute("r",1),graph.title&&z.append("svg:text").attr("class","title").text(graph.title).attr("x",h.width/2).attr("dy","-1em").style("text-anchor","middle"),graph.xlabel&&z.append("svg:text").attr("class","xlabel").text(graph.xlabel).attr("x",h.width/2).attr("y",h.height).attr("dy","2.4em").style("text-anchor","middle"),graph.ylabel&&z.append("svg:g").append("svg:text").attr("class","ylabel").text(graph.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+h.height/2+") rotate(-90)"),L();S()}function D(a){B=T(a,0),O()}function F(a){var b=B.length;if(b===0)x;else{var c={x:b,y:a};B.push(c);var d=n.call(self,b,b),e=r.call(self,a,b);x.appendItem(w.createSVGPathSegLinetoAbs(d,e))}}function G(a){if(B.length==0)return;var b=B.length,d=n.call(self,b-1,b-1),e=r.call(self,B[b-1].y,b-1),f={x:b,y:a};B.push(f);var g=n.call(self,b,b),h=r.call(self,a,b);c.beginPath(),c.moveTo(d,e),c.lineTo(g,h),c.stroke()}function H(){b.width=b.width,c.fillStyle="rgba(0,255,0, 0.05)",c.fillRect(0,0,b.width,b.height),c.strokeStyle="rgba(255,65,0, 1.0)"}function I(){x.clear(),b.style.zIndex=100}function J(){b.style.zIndex=-100,z.select("path.line").attr("d",t(B))}function K(){if(B.length==0)return;var a=n.call(self,0,0),d=r.call(self,B[0].y,0),e;H(),c.fillRect(0,0,b.width,b.height),c.beginPath(),c.moveTo(a,d);for(e=0;e<B.length-1;e++)a=n.call(self,e,e),d=r.call(self,B[e].y,e),c.lineTo(a,d);c.stroke()}function L(){b=document.createElement("canvas"),d.appendChild(b),b.style.zIndex=-100,N(b)}function M(){N(b),K()}function N(a){var e={};e.rect=d.children[0].getElementsByTagName("rect")[0],e.width=e.rect.width.baseVal.value,e.height=e.rect.height.baseVal.value,e.left=e.rect.getCTM().e,e.top=e.rect.getCTM().f,a.style.position="absolute",a.width=e.width,a.height=e.height,a.style.width=e.width+"px",a.style.height=e.height+"px",a.offsetLeft=e.left,a.offsetTop=e.top,a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.border="solid 1px red",c=b.getContext("2d"),c.globalCompositeOperation="source-over",c.lineWidth=1,c.fillStyle="rgba(0,255,0, 0.05)",c.fillRect(0,0,a.width,b.height),c.strokeStyle="rgba(255,65,0, 1.0)",b.style.border="solid 1px red"}function O(){var a,c,e,f,g,h=d.children[0].getElementsByTagName("rect")[0];if(b.style.zIndex==-100)var i=z.select("path").attr("d",t(B));K();if(graph.selectable_points){var j=z.selectAll("circle").data(B,function(a){return a});j.enter().append("svg:circle").attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a.x)}).attr("cy",function(a){return r(a.y)}).attr("r",1).on("mousedown",function(a){v=u=a,O()}),j.attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a.x)}).attr("cy",function(a){return r(a.y)}),j.exit().remove()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function P(){if(!u)return;d.onselectstart=function(){return!1};var a=d3.svg.mouse(z.node());u.x=n.invert(Math.max(0,Math.min(h.width,a[0]))),u.y=r.invert(Math.max(0,Math.min(h.height,a[1]))),O()}function Q(){if(!u)return;d.onselectstart=function(){return!0},P(),u=null}function R(){if(!v)return;switch(d3.event.keyCode){case 8:case 46:var a=B.indexOf(v);B.splice(a,1),v=B.length?B[a>0?a-1:0]:null,O()}}function S(){d3.event&&d3.event.transform&&isNaN(o)&&isNaN(s)&&d3.event.transform(n,r),graph.xmin=n.domain()[0],graph.xmax=n.domain()[1],graph.ymin=r.domain()[0],graph.ymax=r.domain()[1];var a=p.tickFormat(10),b=r.tickFormat(10),c=z.selectAll("g.x").data(p.ticks(10),String).attr("transform",q);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",q);d.append("svg:line").attr("stroke",m).attr("y1",0).attr("y2",h.height),d.append("svg:text").attr("y",h.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(z[0][0]);o=p.invert(b[0])}),c.exit().remove();var e=z.selectAll("g.y").data(r.ticks(10),String).attr("transform",l);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",l).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",m).attr("x1",0).attr("x2",h.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(z[0][0]);s=r.invert(b[1])}),e.exit().remove(),O()}function T(a,b){var c=0,d=b||0,e=a.length,f=[];for(c=0;c<e;c++)f.push({x:c+d,y:a[c]});return f}graph={},graph.container=a.container||document.getElementById("chart"),graph.dataset=a.dataset||[0],graph.xmax=a.xmax||10,graph.xmin=a.xmin||0,graph.sample=a.sample||1,graph.ymax=a.ymax||10,graph.ymin=a.ymin||0,graph.title=a.title,graph.xlabel=a.xlabel,graph.ylabel=a.ylabel,graph.selectable_points=a.selectable_points||!1,graph.setup_graph=function(a){C()},graph.new_data=function(a){D(a),O()},graph.change_xaxis=function(a){n=d3.scale.linear().domain([0,a]).range([0,i]),graph.xmax=a,p=d3.scale.linear().domain([graph.xmin*graph.sample,graph.xmax*graph.sample]).range([0,i]),O(),K(),S()},graph.change_yaxis=function(a){r=d3.scale.linear().domain([a,0]).range([0,j]),graph.ymax=a,O(),K(),S()},graph.add_point=function(a){F(a)},graph.update=function(){O()},graph.add_canvas_point=function(a){G(a)},graph.initialize_canvas=function(){L()},graph.show_canvas=function(){I()},graph.hide_canvas=function(){J()},graph.clear_canvas=function(){H()},graph.update_canvas=function(){K()};var b,c,d,e,f,g={},h={},i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=T(graph.dataset,0);d=graph.container,C(),d3.select(d).on("mousemove",P).on("mouseup",Q).on("keydown",R);var E=function(){var a="",b=function(b,c,d){var e=a,f=-1,g=b.length,h=[],i;e.length===0&&(h.push("M",c.call(self,b[0].x,0),",",d.call(self,b[0].y,0)),f++);while(++f<g)h.push("L",c.call(self,b[f].x,f),",",d.call(self,b[f].y,f));return a+=h.join("")};return b}();return d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(z[0][0]);if(!isNaN(o)){var c=p.invert(b[0]),d=p.domain()[0],e=p.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/o,g=1+(o/c-1)*(f/(o-d))/h,i=[d,d+f*g],p.domain(i),graph.sample!==1&&n.domain([i[0]/graph.sample,i[1]/graph.sample]),S()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(s)){var j=r.invert(b[1]),k=r.domain()[1],l=r.domain()[0],m=l-k;if(j!==0){var q,t,u;t=m/s,q=(j-k)/(s-k)*(m/(s-k))/t,u=[k+m*1/q,k],k>0&&(u[0]+=k),r.domain(u),S()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(o)||(S(),o=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(s)||(S(),s=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())}),graph}}(),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=Object.prototype.hasOwnProperty,o=function(a,b){function d(){this.constructor=a}for(var c in b)n.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};m=typeof exports!="undefined"&&exports!==null?exports:this,c=function(){function a(a){this.dom_id=a,this.dom_id?this.dom_element=$(this.dom_id):this.dom_element=$("<div>"),this.dom_element.addClass("component")}return a}(),b=function(a){function b(a,c,d){this.dom_id=a,this.name=c!=null?c:"play",this.actions=d!=null?d:[],b.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button").addClass(this.name).addClass("up"),this.state="up",this.init_mouse_handlers()}return o(b,a),b.prototype.set_state=function(a){return this.dom_element.removeClass(this.state),this.state=a,this.dom_element.addClass(this.state)},b.prototype.init_mouse_handlers=function(){var a,b=this;return a=this,this.dom_element.mousedown(function(b){return a.set_state("down")}),this.dom_element.mouseup(function(){return a.set_state("up"),a.do_action()}),this.dom_element.mouseleave(function(){return a.set_state("up")})},b.prototype.add_action=function(a){return this.actions.push(a)},b.prototype.do_action=function(){var a,b,c,d,e;d=this.actions,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a());return e},b}(c),m.ButtonComponent=b,l=function(a){function b(a,c){var d,e,f;this.dom_id=a,c==null&&(c=[]),b.__super__.constructor.call(this,this.dom_id,"toggle"),this.buttons=[];for(e=0,f=c.length;e<f;e++)d=c[e],this.add_button(d);this.button_index=0,this.enable_button(0)}return o(b,a),b.prototype.add_button=function(a){var b,c;a.dom_element.remove(),a.dom_element.css("margin","0px"),this.dom_element.append(a.dom_element),this.buttons.push(a),this.add_width(a.dom_element),this.add_height(a.dom_element),c=this,b=this.buttons.length-1;if(b!==this.button_index)return this.disable_button(b)},b.prototype.add_width=function(a){var b,c;c=this.dom_element.width(),b=a.outerWidth(!0);if(c<b)return this.dom_element.width(""+b+"px")},b.prototype.add_height=function(a){var b,c;c=this.dom_element.height(),b=a.outerHeight(!0);if(c<b)return this.dom_element.height(""+b+"px")},b.prototype.disable_button=function(a){var b;b=this.buttons[a];if(b)return b.dom_element.addClass("hidden")},b.prototype.enable_button=function(a){var b;b=this.buttons[a];if(b)return b.dom_element.removeClass("hidden")},b.prototype.set_active=function(a){return this.disable_button(this.button_index),this.button_index=a,this.button_index=this.button_index%this.buttons.length,this.enable_button(this.button_index)},b.prototype.enable_next_button=function(){return this.set_active(this.button_index+1)},b.prototype.current_button=function(){return this.button_index<this.buttons.length?this.buttons[this.button_index]:null},b.prototype.do_action=function(){if(this.current_button())return this.current_button().do_action(),this.enable_next_button()},b}(b),m.ToggleButtonComponent=l,a=function(a){function b(a,c){var d,e,f;this.dom_id=a,c==null&&(c=[]),b.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button_bar"),this.buttons=[],this.dom_element.width("1px"),this.dom_element.height("1px");for(e=0,f=c.length;e<f;e++)d=c[e],this.add_button(d)}return o
(b,a),b.prototype.add_button=function(a){var b;return b=a.dom_element,this.dom_element.append(b),this.add_width(b),this.add_height(b),this.buttons.push(a)},b.prototype.add_width=function(a){var b;return b=this.dom_element.width(),b+=a.outerWidth(!0),this.dom_element.width(""+b+"px")},b.prototype.add_height=function(a){var b,c;c=this.dom_element.height(),b=a.outerHeight(!0);if(c<b)return this.dom_element.height(""+b+"px")},b}(c),m.ButtonBarComponent=a,g=function(a){function c(a,d,e){var f,g,h,i,j,k=this;this.dom_id=a,this.playable=d,e==null&&(e=!0),c.__super__.constructor.call(this,this.dom_id),i=new b(null,"play"),i.add_action(function(){return k.playable.play()}),h=new b(null,"pause"),h.add_action(function(){return k.playable.stop()}),this.toggle=new l(null,[i,h]),this.play_index=0,this.stop_index=1,j=new b(null,"reset"),j.add_action(function(){return k.playable.seek(1),k.play()}),this.add_button(j),e||(g=new b(null,"forward"),g.add_action(function(){return k.playable.forward(),k.stop()}),this.add_button(g)),this.add_button(this.toggle),e||(f=new b(null,"back"),f.add_action(function(){return k.playable.back(),k.stop()}),this.add_button(f)),this.play()}return o(c,a),c.prototype.stop=function(){return this.toggle.set_active(this.play_index)},c.prototype.play=function(){return this.toggle.set_active(this.stop_index)},c}(a),m.PlaybackBarComponent=g,d=function(){function a(a,b){var c=this;this.dom_id=a!=null?a:"#slider",this.value_changed_function=b,this.dom_element=$(this.dom_id),this.precision=this.dom_element.attr("data-precision")||3,this.min=this.dom_element.attr("data-min")||0,this.max=this.dom_element.attr("data-max")||1,this.step=this.dom_element.attr("data-stop")||.01,this.value=this.dom_element.attr("data-value")||.5,this.label=this.dom_element.attr("data-label"),this.label_id=this.dom_element.attr("data-label-id"),this.orientation=this.dom_element.attr("data-orientation")||"horizontal",this.dom_element.slider(),this.update_options(),this.dom_element.bind("slide",function(a,b){console.log("slider value: "+b.value),c.update_label(b.value);if(c.value_changed_function)return c.value_changed_function(b.value)}),this.update_label(this.value)}return a.prototype.set_max=function(a){return this.max=a,this.update_options()},a.prototype.set_min=function(a){return this.min=a,this.update_options()},a.prototype.update_options=function(){var a;return a={orientation:this.orientation,min:this.min,max:this.max,value:this.value,step:this.step,range:"min"},this.dom_element.slider("option",a)},a.prototype.update_label=function(a){if(this.label_id)return $(this.label_id).text(""+this.label+" "+a)},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.JSliderComponent=d,f=function(){function a(a,b,c,d,e){this.svg_element=a,this.playable=b!=null?b:null,this.offsets={play:1,stop:1},this.width=200,this.height=34,this.xpos=c,this.ypos=d,this.scale=e||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return a.prototype.offset=function(a){return this.offsets[a]*this.unit_width*2+this.unit_width},a.prototype.make_button=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=this;e=this.group.append("svg:g"),i=this.offset(a),e.attr("x",i).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width);for(k=0,m=c.length;k<m;k++){g=c[k],d=e.append(b),d.attr("class",""+a+" button-art"),h="";for(l=0,n=g.length;l<n;l++)f=g[l],i=this.offset(a)+f.x*this.unit_width,j=this.vertical_padding+f.y*this.unit_width,h+=" "+i+","+j,d.attr("points",h)}return e.on("click",function(){return o.action(a)}),e},a.prototype.action=function(a){console.log("running "+a+" ");if(this.playable)switch(a){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+a)}else console.log("no @playable defined");return this.update_ui()},a.prototype.init_play_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",a)},a.prototype.init_stop_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",a)},a.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height),this.init_play_button(),this.init_stop_button(),this.hide(this.play)},a.prototype.position=function(a,b,c){return this.xpos=a,this.ypos=b,this.scale=c||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},a.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},a.prototype.hide=function(a){return a.style("visibility","hidden")},a.prototype.show=function(a){return a.style("visibility","visible")},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.PlayOnlyComponentSVG=f,m.ModelPlayer=e,e=function(){function a(a){this.model=a,this.playing=!0}return a.prototype.play=function(){return this.model.resume(),this.playing=!0},a.prototype.stop=function(){return this.model.stop(),this.playing=!1},a.prototype.forward=function(){return this.stop(),this.model.stepForward()},a.prototype.back=function(){return this.stop(),this.model.stepBack()},a.prototype.seek=function(a){return this.stop(),this.model.seek(a),this.play()},a}(),h=function(){function a(a,b){this.dom_id=a!=null?a:"#playback",this.playable=b!=null?b:null,this.dom_element=d3.select(this.dom_id).attr("class","component playback"),this.offsets={reset:0,back:1,play:2,stop:2,forward:3},this.width=parseInt(this.dom_element.style("width")),this.height=parseInt(this.dom_element.style("height")),this.unit_width=this.width/9,this.height<this.unit_width&&(this.height=this.unit_width+2,this.dom_element.style("height",this.height+"px")),this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return a.prototype.offset=function(a){return this.offsets[a]*this.unit_width*2+this.unit_width},a.prototype.make_button=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=this;e=this.svg.append("svg:g"),i=this.offset(a),e.attr("x",i).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width);for(k=0,m=c.length;k<m;k++){g=c[k],d=e.append(b),d.attr("class",""+a+" button-art"),h="";for(l=0,n=g.length;l<n;l++)f=g[l],i=this.offset(a)+f.x*this.unit_width,j=this.vertical_padding+f.y*this.unit_width,h+=" "+i+","+j,d.attr("points",h)}return e.on("click",function(){return o.action(a)}),e},a.prototype.action=function(a){console.log("running "+a+" ");if(this.playable)switch(a){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+a)}else console.log("no @playable defined");return this.update_ui()},a.prototype.init_reset_button=function(){var a;return a=[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:.25,y:0},{x:.5,y:.25}]],this.reset=this.make_button("reset","svg:polyline",a)},a.prototype.init_play_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",a)},a.prototype.init_stop_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",a)},a.prototype.init_back_button=function(){var a;return a=[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],this.back=this.make_button("back","svg:polyline",a)},a.prototype.init_forward_button=function(){var a;return a=[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]],this.forward=this.make_button("forward","svg:polyline",a)},a.prototype.init_view=function(){return this.svg=this.dom_element.append("svg:svg").attr("width",this.width).attr("height",this.height),this.init_reset_button(),this.init_play_button(),this.init_stop_button(),this.init_forward_button(),this.init_back_button(),this.hide(this.play)},a.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},a.prototype.hide=function(a){return a.style("visibility","hidden")},a.prototype.show=function(a){return a.style("visibility","visible")},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.PlaybackComponent=h,m.ModelPlayer=e,i=function(){function a(a,b,c,d,e){this.svg_element=a,this.playable=b!=null?b:null,this.offsets={reset:0,back:1,play:2,stop:2,forward:3},this.width=200,this.height=34,this.xpos=c,this.ypos=d,this.scale=e||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return a.prototype.offset=function(a){return this.offsets[a]*this.unit_width*2+this.unit_width},a.prototype.make_button=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=this;e=this.group.append("svg:g"),i=this.offset(a),e.attr("x",i).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width);for(k=0,m=c.length;k<m;k++){g=c[k],d=e.append(b),d.attr("class",""+a+" button-art"),h="";for(l=0,n=g.length;l<n;l++)f=g[l],i=this.offset(a)+f.x*this.unit_width,j=this.vertical_padding+f.y*this.unit_width,h+=" "+i+","+j,d.attr("points",h)}return e.on("click",function(){return o.action(a)}),e},a.prototype.action=function(a){console.log("running "+a+" ");if(this.playable)switch(a){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+a)}else console.log("no @playable defined");return this.update_ui()},a.prototype.init_reset_button=function(){var a;return a=[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:.25,y:0},{x:.5,y:.25}]],this.reset=this.make_button("reset","svg:polyline",a)},a.prototype.init_play_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",a)},a.prototype.init_stop_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",a)},a.prototype.init_back_button=function(){var a;return a=[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],this.back=this.make_button("back","svg:polyline",a)},a.prototype.init_forward_button=function(){var a;return a=[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]],this.forward=this.make_button("forward","svg:polyline",a)},a.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height),this.init_reset_button(),this.init_play_button(),this.init_stop_button(),this.init_forward_button(),this.init_back_button(),this.hide(this.play)},a.prototype.position=function(a,b,c){return this.xpos=a,this.ypos=b,this.scale=c||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},a.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},a.prototype.hide=function(a){return a.style("visibility","hidden")},a.prototype.show=function(a){return a.style("visibility","visible")},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.PlaybackComponentSVG=i,m.ModelPlayer=e,j=function(){function a(a,b){this.dom_id=a!=null?a:"#slider",this.value_changed_function=b,this.dom_element=$(this.dom_id),this.dom_element.addClass("component").addClass("slider"),this.precision=this.dom_element.attr("data-precision")||3,this.min=this.dom_element.attr("data-min")||0,this.max=this.dom_element.attr("data-max")||1,this.value=this.dom_element.attr("data-value")||.5,this.label=this.dom_element.attr("data-label"),this.mouse_down=!1,this.width=this.dom_element.width(),this.height=this.dom_element.height(),this.init_view(),this.init_mouse_handlers()}return a.prototype.horizontal_orientation=function(){if(this.width>this.height)return!0},a.prototype.init_view=function(){var a;return this.slider_well=$("<div>").addClass("slider_well"),this.dom_element.append(this.slider_well),a=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=a,this.horizontal_orientation()&&(a=this.height/4,this.y1=this.y2=a,this.x1=0,this.x2=this.width),this.handle_y=(this.y1+this.y2)/2,this.handle_x=(this.x1+this.x2)/2,this.init_slider_fill(),this.slider_well_height=this.slider_well.height(),this.slider_well_width=this.slider_well.width(),this.init_handle(),this.init_label()},a.prototype.init_slider_fill=function(){return this.slider_fill=$("<div>").addClass("slider_fill"),this.slider_well.append(this.slider_fill),this.horizontal_orientation()?this.slider_fill.addClass("horizontal"):this.slider_fill.addClass("vertical"),this.update_slider_filled()},a.prototype.update_slider_filled=function(){return this.horizontal_orientation()?this.slider_fill.width(""+this.handle_x+"px"):this.slider_fill.height(""+this.handle_y+"px")},a.prototype.init_handle=function(){return this.handle=$("<div>").addClass("handle"),this.slider_well.append(this.handle),this.handle_width=parseInt(this.handle.width()),this.handle_height=parseInt(this.handle.height()),this.handle_width_offset=this.handle_width/2-(this.handle_width-this.slider_well_width)/2,this.handle_height_offset=this.handle_height/2-(this.handle_height-this.slider_well_height)/2,this.update_handle()},a.prototype.update_handle=function(){return this.handle.css("left",""+(this.handle_x-this.handle_width/2)+"px").css("top",""+(this.handle_y-this.handle_height_offset)+"px")},a.prototype.init_label=function(){return this.text_label=$("<div/>").addClass("label"),this.dom_element.append(this.text_label),this.update_label()},a.prototype.scaled_value=function(){var a;return a=this.value,a*=this.max-this.min,a+=this.min,a},a.prototype.update_label=function(){var a;return this.label?(a=this.scaled_value().toFixed(this.precision),this.text_label.text(""+this.label+": "+a)):this.text_label.hide()},a.prototype.handle_mousedown=function(a){var b=this;return this.dragging=!0,$(document).bind("mouseup.drag",this.documentMouseUpDelegate=function(a){return b.handle_mouseup(a)}),$(document).bind("mousemove.drag",this.documentMouseMoveDelegate=function(a){return b.handle_drag(a)}),this.handle_drag(a)},a.prototype.handle_drag=function(a){var b,c,d,e;return this.dragging?(document.onselectstart=function(){return!1},d=a.pageX-this.slider_well.position().left,e=a.pageY-this.slider_well.position().top,this.horizontal_orientation()?(b=this.width-this.handle_width/4,c=this.handle_width/4,this.handle_x=d,this.handle_x<c&&(this.handle_x=c),this.handle_x>b&&(this.handle_x=b),this.value=this.handle_x/this.width):(this.handle_y=a.y,this.handle.attr("cy",this.handle_y),this.slider_fill.attr("y",this.handle_y).attr("height",this.height-this.handle_y),this.value=this.handle_y/this.height),typeof this.value_changed_function=="function"&&this.value_changed_function(this.scaled_value()),this.update_handle(),this.update_slider_filled(),this.update_label()):!1},a.prototype.handle_mouseup=function(){return document.onselectstart=function(){return!0},this.dragging&&($(document).unbind("mousemove",this.documentMouseMoveDelegate),$(document).unbind("mouseup",this.documentMouseUpDelegate),this.dragging=!1),!0},a.prototype.init_mouse_handlers=function(){var a=this;return this.slider_well.bind("mousedown",this.documentMouseUpDelegate=function(b){return a.handle_mousedown(b)})},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.SliderComponent=j,k=function(){function a(a){this.dom_id=a!=null?a:"#thermometer",this.dom_element=d3.select(this.dom_id).attr("class","thermometer"),this.width=1,this.height=12,this.max=.7,this.samples=[],this.last_draw_time=(new Date).getTime(),this.sample_interval_ms=250,this.last_draw_time-=this.sample_interval_ms,this.init_svg()}return a.prototype.init_svg=function(){return this.dom_element.style("border","1px solid black"),this.svg=this.dom_element.append("svg:svg").attr("width",this.width+"em").attr("height",this.height+"em").append("svg:g"),this.thermometer=this.svg.append("svg:rect"),this.thermometer.attr("width",this.width+"em"),this.thermometer.attr("height",this.height+"em"),this.thermometer.style("fill","#f4b626"),d3.select("#therm_text").attr("class","therm_text")},a.prototype.time_to_redraw=function(){var a;return a=(new Date).getTime(),a>this.last_draw_time+this.sample_interval_ms},a.prototype.add_value=function(a){this.samples.push(a);if(this.time_to_redraw())return this.redraw(),this.samples=[]},a.prototype.get_avg=function(){var a,b,c,d,e;b=0,e=this.samples;for(c=0,d=e.length;c<d;c++)a=e[c],b+=a;return b/this.samples.length},a.prototype.scaled_display_value=function(){return this.get_avg()/this.max*this.height},a.prototype.redraw=function(){var a,b;return a=this.get_avg().toFixed(4),b=this.scaled_display_value(),this.thermometer.attr("y",this.height-b+"em"),this.thermometer.attr("height",b+"em"),this.last_draw_time=(new Date).getTime(),d3.select("#therm_text").text("Temperature")},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.Thermometer=k}.call(this);